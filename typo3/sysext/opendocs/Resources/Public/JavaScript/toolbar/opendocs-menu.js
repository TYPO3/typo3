/*
 * This file is part of the TYPO3 CMS project.
 *
 * It is free software; you can redistribute it and/or modify it under
 * the terms of the GNU General Public License, either version 2
 * of the License, or any later version.
 *
 * For the full copyright and license information, please read the
 * LICENSE.txt file that was distributed with this source code.
 *
 * The TYPO3 project - inspiring people to share!
 */
import i from"@typo3/core/ajax/ajax-request.js";import"@typo3/backend/element/spinner-element.js";import l from"@typo3/backend/viewport.js";import{Sizes as u}from"@typo3/backend/enum/icon-types.js";import s from"@typo3/core/event/regular-event.js";var e;(function(r){r.containerSelector="#typo3-cms-opendocs-backend-toolbaritems-opendocstoolbaritem",r.closeSelector=".t3js-topbar-opendocs-close",r.menuContainerSelector=".dropdown-menu",r.toolbarIconSelector=".toolbar-item-icon .t3js-icon",r.counterSelector="#tx-opendocs-counter",r.entrySelector=".t3js-open-doc"})(e||(e={}));class a{constructor(){this.hashDataAttributeName="opendocsidentifier",document.addEventListener("typo3:opendocs:updateRequested",()=>this.updateMenu()),l.Topbar.Toolbar.registerEvent(()=>{this.initializeEvents(),this.updateMenu()})}static updateNumberOfDocs(){const n=document.querySelector(e.containerSelector),o=document.querySelector(e.counterSelector);let t=parseInt(n.querySelector("[data-open-docs]")?.dataset.openDocs,10);isNaN(t)&&(t=0),o.textContent=t.toString(),o.classList.toggle("hidden",t===0)}updateMenu(){const n=document.querySelector(e.containerSelector+" "+e.toolbarIconSelector),o=n.cloneNode(!0),t=document.createElement("typo3-backend-spinner");t.setAttribute("size",u.small),n.replaceWith(t),new i(TYPO3.settings.ajaxUrls.opendocs_menu).get().then(async c=>{document.querySelector(e.containerSelector+" "+e.menuContainerSelector).innerHTML=await c.resolve(),a.updateNumberOfDocs()}).finally(()=>{document.querySelector(e.containerSelector+" typo3-backend-spinner").replaceWith(o)})}initializeEvents(){const n=document.querySelector(e.containerSelector);new s("click",(o,t)=>{o.preventDefault(),o.stopImmediatePropagation();const c=t.dataset[this.hashDataAttributeName];this.closeDocument(c)}).delegateTo(n,e.closeSelector),new s("click",(o,t)=>{o.preventDefault(),document.querySelector("typo3-backend-module-router").setAttribute("endpoint",t.getAttribute("href"))}).delegateTo(n,e.entrySelector)}closeDocument(n){const o={};n&&(o.md5sum=n),new i(TYPO3.settings.ajaxUrls.opendocs_closedoc).post(o).then(async t=>{const c=document.querySelector(e.containerSelector);c.querySelector(e.menuContainerSelector).innerHTML=await t.resolve(),a.updateNumberOfDocs()})}}var d=new a;export{d as default};
