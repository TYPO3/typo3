/*
 * This file is part of the TYPO3 CMS project.
 *
 * It is free software; you can redistribute it and/or modify it under
 * the terms of the GNU General Public License, either version 2
 * of the License, or any later version.
 *
 * For the full copyright and license information, please read the
 * LICENSE.txt file that was distributed with this source code.
 *
 * The TYPO3 project - inspiring people to share!
 */
import{html as r,nothing as g}from"lit";import{lll as t}from"@typo3/core/lit-helper.js";import{until as h}from"lit/directives/until.js";import p from"@typo3/core/event/regular-event.js";import{FileListActionEvent as v}from"@typo3/filelist/file-list-actions.js";import s from"@typo3/backend/modal.js";import f from"@typo3/core/ajax/ajax-request.js";import"@typo3/core/ajax/ajax-response.js";import u from"@typo3/backend/notification.js";import y from"@typo3/backend/viewport.js";import{FormatUtility as _}from"@typo3/backend/utility/format-utility.js";import{ThumbnailSize as k}from"@typo3/backend/element/thumbnail-element.js";import{topLevelModuleImport as w}from"@typo3/backend/utility/top-level-module-import.js";class ${constructor(){new p(v.replace,e=>{const i=e.detail.resources[0],c=s.advanced({title:t("file_replace.title",i.name),type:s.types.default,size:s.sizes.small,content:r`${h(this.loadEditor(i.identifier),r`<typo3-backend-spinner></typo3-backend-spinner>`)}`,buttons:[{text:TYPO3.lang["file_replace.button.cancel"]||"Cancel",btnClass:"btn-default",name:"cancel",trigger:()=>{c.hideModal()}},{text:TYPO3.lang["file_replace.button.replace"]||"Replace",btnClass:"btn-primary",name:"rename",trigger:()=>{c.querySelector("form")?.requestSubmit()}}],callback:function(o){new p("submit",d=>{d.preventDefault();const m=new FormData(d.target);m.set("uid",i.uid.toString()),new f(TYPO3.settings.ajaxUrls.resource_replace).post(m).then(async b=>{const n=await b.resolve();n.status.length>0&&n.status.forEach(l=>{n.success?u.success(l.title,l.message):u.error(l.title,l.message)}),y.ContentContainer.refresh(),o.hideModal()})}).delegateTo(o,"form")}})}).bindTo(document)}async loadEditor(e){const i=await(await new f(TYPO3.settings.ajaxUrls.resource_gather).withQueryArguments({identifier:e}).get()).resolve();return await w("@typo3/backend/element/datetime-element.js"),this.composeEditForm(i)}composeEditForm(e){const a=new URL(top.TYPO3.settings.Resource.thumbnailUrl,window.origin);return a.searchParams.set("identifier",e.uid.toString(10)),r`<div class=file-replace-dialog>${t("file_replace.intro",e.name)}<div class=file-replace-dialog-summary>${e.hasPreview?r`<div class=file-replace-dialog-summary-thumbnail><typo3-backend-thumbnail url=${a} size=${k.large} width=96 keepaspectratio></typo3-backend-thumbnail></div>`:g}<div class=file-replace-dialog-summary-info><dl><dt>${t("file_info_filename")}</dt><dd>${e.name}</dd><dt>${t("file_info_filesize")}</dt><dd>${_.fileSizeAsString(e.size)}</dd><dt>${t("file_info_creation_date")}</dt><dd><typo3-backend-datetime format=datetime datetime=${e.createdAt}></typo3-backend-datetime></dd></dl></div></div><form><div class=form-group><label class=form-label for=file_replace>${t("file_replace.new_file.label")}</label> <input id=file_replace type=file class=form-control name=replace_1></div><div class=form-check><input type=checkbox value=1 id=keepFilename name=keepFilename class=form-check-input checked> <label class=form-check-label for=keepFilename>${t("file_replace.keepFilename.label",e.name)}</label></div></form></div>`}}var F=new $;export{F as default};
