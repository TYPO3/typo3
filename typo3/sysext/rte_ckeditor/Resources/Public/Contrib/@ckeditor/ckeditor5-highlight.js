import{Command as B,Plugin as b}from"@ckeditor/ckeditor5-core";import{IconEraser as w,IconMarker as E,IconPen as H}from"@ckeditor/ckeditor5-icons";import{ButtonView as T,createDropdown as M,SplitButtonView as A,addToolbarToDropdown as I,MenuBarMenuView as C,MenuBarMenuListView as P,MenuBarMenuListItemView as f,MenuBarMenuListItemButtonView as v,ListSeparatorView as O,ToolbarSeparatorView as S}from"@ckeditor/ckeditor5-ui";/**
* @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class V extends B{refresh(){const e=this.editor.model,t=e.document;this.value=t.selection.getAttribute("highlight"),this.isEnabled=e.schema.checkAttributeInSelection(t.selection,"highlight")}execute(e={}){const t=this.editor.model,c=t.document.selection,n=e.value;t.change(i=>{if(c.isCollapsed){const h=c.getFirstPosition();if(c.hasAttribute("highlight")){const o=d=>d.item.hasAttribute("highlight")&&d.item.getAttribute("highlight")===this.value,a=h.getLastMatchingPosition(o,{direction:"backward"}),l=h.getLastMatchingPosition(o),u=i.createRange(a,l);!n||this.value===n?(h.isEqual(l)||i.removeAttribute("highlight",u),i.removeSelectionAttribute("highlight")):(h.isEqual(l)||i.setAttribute("highlight",n,u),i.setSelectionAttribute("highlight",n))}else n&&i.setSelectionAttribute("highlight",n)}else{const h=t.schema.getValidRanges(c.getRanges(),"highlight");for(const o of h)n?i.setAttribute("highlight",n,o):i.removeAttribute("highlight",o)}})}}/**
* @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class y extends b{static get pluginName(){return"HighlightEditing"}static get isOfficialPlugin(){return!0}constructor(e){super(e),e.config.define("highlight",{options:[{model:"yellowMarker",class:"marker-yellow",title:"Yellow marker",color:"var(--ck-content-highlight-marker-yellow)",type:"marker"},{model:"greenMarker",class:"marker-green",title:"Green marker",color:"var(--ck-content-highlight-marker-green)",type:"marker"},{model:"pinkMarker",class:"marker-pink",title:"Pink marker",color:"var(--ck-content-highlight-marker-pink)",type:"marker"},{model:"blueMarker",class:"marker-blue",title:"Blue marker",color:"var(--ck-content-highlight-marker-blue)",type:"marker"},{model:"redPen",class:"pen-red",title:"Red pen",color:"var(--ck-content-highlight-pen-red)",type:"pen"},{model:"greenPen",class:"pen-green",title:"Green pen",color:"var(--ck-content-highlight-pen-green)",type:"pen"}]})}init(){const e=this.editor;e.model.schema.extend("$text",{allowAttributes:"highlight"});const t=e.config.get("highlight.options");e.conversion.attributeToElement(_(t)),e.commands.add("highlight",new V(e))}}function _(g){const e={model:{key:"highlight",values:[]},view:{}};for(const t of g)e.model.values.push(t.model),e.view[t.model]={name:"mark",classes:t.class};return e}function R(g,{insertAt:e}={}){if(typeof document>"u")return;const t=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css",window.litNonce&&r.setAttribute("nonce",window.litNonce),e==="top"&&t.firstChild?t.insertBefore(r,t.firstChild):t.appendChild(r),r.styleSheet?r.styleSheet.cssText=g:r.appendChild(document.createTextNode(g))}R(":root{--ck-content-highlight-marker-yellow:#fdfd77;--ck-content-highlight-marker-green:#62f962;--ck-content-highlight-marker-pink:#fc7899;--ck-content-highlight-marker-blue:#72ccfd;--ck-content-highlight-pen-red:#e71313;--ck-content-highlight-pen-green:#128a00}.ck-content .marker-yellow{background-color:var(--ck-content-highlight-marker-yellow)}.ck-content .marker-green{background-color:var(--ck-content-highlight-marker-green)}.ck-content .marker-pink{background-color:var(--ck-content-highlight-marker-pink)}.ck-content .marker-blue{background-color:var(--ck-content-highlight-marker-blue)}.ck-content .pen-red{background-color:transparent;color:var(--ck-content-highlight-pen-red)}.ck-content .pen-green{background-color:transparent;color:var(--ck-content-highlight-pen-green)}");/**
* @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class x extends b{get localizedOptionTitles(){const e=this.editor.t;return{"Yellow marker":e("Yellow marker"),"Green marker":e("Green marker"),"Pink marker":e("Pink marker"),"Blue marker":e("Blue marker"),"Red pen":e("Red pen"),"Green pen":e("Green pen")}}static get pluginName(){return"HighlightUI"}static get isOfficialPlugin(){return!0}init(){const e=this.editor.config.get("highlight.options");for(const t of e)this._addHighlighterButton(t);this._addRemoveHighlightButton(),this._addDropdown(e),this._addMenuBarButton(e)}_addRemoveHighlightButton(){const e=this.editor.t,t=this.editor.commands.get("highlight");this._addButton("removeHighlight",e("Remove highlight"),w,null,r=>{r.bind("isEnabled").to(t,"isEnabled")})}_addHighlighterButton(e){const t=this.editor.commands.get("highlight");this._addButton("highlight:"+e.model,e.title,p(e.type),e.model,r);function r(c){c.bind("isEnabled").to(t,"isEnabled"),c.bind("isOn").to(t,"value",n=>n===e.model),c.iconView.fillColor=e.color,c.isToggleable=!0}}_addButton(e,t,r,c,n){const i=this.editor;i.ui.componentFactory.add(e,h=>{const o=new T(h),a=this.localizedOptionTitles[t]?this.localizedOptionTitles[t]:t;return o.set({label:a,icon:r,tooltip:!0}),o.on("execute",()=>{i.execute("highlight",{value:c}),i.editing.view.focus()}),n(o),o})}_addDropdown(e){const t=this.editor,r=t.t,c=t.ui.componentFactory,n=e[0],i=e.reduce((h,o)=>(h[o.model]=o,h),{});c.add("highlight",h=>{const o=t.commands.get("highlight"),a=M(h,A),l=a.buttonView;l.set({label:r("Highlight"),tooltip:!0,lastExecuted:n.model,commandValue:n.model,isToggleable:!0}),l.bind("icon").to(o,"value",s=>p(d(s,"type"))),l.bind("color").to(o,"value",s=>d(s,"color")),l.bind("commandValue").to(o,"value",s=>d(s,"model")),l.bind("isOn").to(o,"value",s=>!!s),l.delegate("execute").to(a);const u=()=>{const s=e.map(m=>{const k=c.create("highlight:"+m.model);return this.listenTo(k,"execute",()=>{a.buttonView.set({lastExecuted:m.model})}),k});return s.push(new S),s.push(c.create("removeHighlight")),s};a.bind("isEnabled").to(o,"isEnabled"),I(a,u,{enableActiveItemFocusOnDropdownOpen:!0,ariaLabel:r("Text highlight toolbar")}),F(a),l.on("execute",()=>{t.execute("highlight",{value:l.commandValue})}),this.listenTo(a,"execute",()=>{t.editing.view.focus()});function d(s,m){const k=!s||s===l.lastExecuted?l.lastExecuted:s;return i[k][m]}return a})}_addMenuBarButton(e){const t=this.editor,r=t.t,c=t.commands.get("highlight");t.ui.componentFactory.add("menuBar:highlight",n=>{const i=new C(n);i.buttonView.set({label:r("Highlight"),icon:p("marker")}),i.bind("isEnabled").to(c),i.buttonView.iconView.fillColor="transparent";const h=new P(n);for(const l of e){const u=new f(n,i),d=new v(n);d.set({label:l.title,icon:p(l.type),role:"menuitemradio",isToggleable:!0}),d.iconView.fillColor=l.color,d.delegate("execute").to(i),d.bind("isOn").to(c,"value",s=>s===l.model),d.on("execute",()=>{t.execute("highlight",{value:l.model}),t.editing.view.focus()}),u.children.add(d),h.items.add(u)}h.items.add(new O(n));const o=new f(n,i),a=new v(n);return a.set({label:r("Remove highlight"),icon:w}),a.delegate("execute").to(i),a.on("execute",()=>{t.execute("highlight",{value:null}),t.editing.view.focus()}),o.children.add(a),h.items.add(o),i.panelView.children.add(h),i})}}function F(g){g.buttonView.actionView.iconView.bind("fillColor").to(g.buttonView,"color")}function p(g){return g==="marker"?E:H}/**
* @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class L extends b{static get requires(){return[y,x]}static get pluginName(){return"Highlight"}static get isOfficialPlugin(){return!0}}export{L as Highlight,V as HighlightCommand,y as HighlightEditing,x as HighlightUI};
