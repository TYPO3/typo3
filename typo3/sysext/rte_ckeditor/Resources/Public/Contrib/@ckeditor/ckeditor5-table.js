import{Command as S,Plugin as k,icons as y}from"@ckeditor/ckeditor5-core";import{toWidgetEditable as Oe,toWidget as mo,Widget as bo,isWidget as go,WidgetToolbarRepository as De}from"@ckeditor/ckeditor5-widget";import{first as Ue,global as Z,CKEditorError as Ge,KeystrokeHandler as ee,FocusTracker as te,Collection as $e,getLocalizedArrowKeyCodeDirection as fo,Rect as je,DomEmitterMixin as po}from"@ckeditor/ckeditor5-utils";import{View as z,addKeyboardHandlingForGrid as wo,ButtonView as P,createDropdown as oe,MenuBarMenuView as Co,SwitchButtonView as ko,SplitButtonView as _o,addListToDropdown as fe,ViewModel as qe,ViewCollection as pe,FocusCycler as we,InputTextView as vo,ColorSelectorView as To,FormHeaderView as Ke,submitHandler as Xe,LabelView as B,LabeledFieldView as R,createLabeledDropdown as Je,createLabeledInputText as L,ToolbarView as Ce,BalloonPanelView as N,ContextualBalloon as ne,normalizeColorOptions as le,getLocalizedColorOptions as ie,clickOutsideHandler as Ye}from"@ckeditor/ckeditor5-ui";import{ClipboardMarkersUtils as ke,ClipboardPipeline as yo}from"@ckeditor/ckeditor5-clipboard";import{DomEventObserver as Ao,isColor as So,isLength as Qe,isPercentage as xo,addBorderRules as Ze,addPaddingRules as Ro,addBackgroundRules as et,enablePlaceholder as Vo,Element as Io}from"@ckeditor/ckeditor5-engine";import{isObject as Po,debounce as tt,isEqual as ot,throttle as Eo}from"lodash-es";/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/function _e(i,e){const{modelAttribute:t,styleName:o,viewElement:n,defaultValue:l,reduceBoxSides:r=!1,shouldUpcast:s=()=>!0}=e;i.for("upcast").attributeToAttribute({view:{name:n,styles:{[o]:/[\s\S]+/}},model:{key:t,value:a=>{if(!s(a))return;const c=a.getNormalizedStyle(o),d=r?se(c):c;if(l!==d)return d}}})}function ve(i,e,t,o){i.for("upcast").add(n=>n.on("element:"+e,(l,r,s)=>{if(!r.modelRange)return;const a=["border-top-width","border-top-color","border-top-style","border-bottom-width","border-bottom-color","border-bottom-style","border-right-width","border-right-color","border-right-style","border-left-width","border-left-color","border-left-style"].filter(b=>r.viewItem.hasStyle(b));if(!a.length)return;const c={styles:a};if(!s.consumable.test(r.viewItem,c))return;const d=[...r.modelRange.getItems({shallow:!0})].pop();s.consumable.consume(r.viewItem,c);const u={style:r.viewItem.getNormalizedStyle("border-style"),color:r.viewItem.getNormalizedStyle("border-color"),width:r.viewItem.getNormalizedStyle("border-width")},h={style:se(u.style),color:se(u.color),width:se(u.width)};h.style!==o.style&&s.writer.setAttribute(t.style,h.style,d),h.color!==o.color&&s.writer.setAttribute(t.color,h.color,d),h.width!==o.width&&s.writer.setAttribute(t.width,h.width,d)}))}function K(i,e){const{modelElement:t,modelAttribute:o,styleName:n}=e;i.for("downcast").attributeToAttribute({model:{name:t,key:o},view:l=>({key:"style",value:{[n]:l}})})}function re(i,e){const{modelAttribute:t,styleName:o}=e;i.for("downcast").add(n=>n.on(`attribute:${t}:table`,(l,r,s)=>{const{item:a,attributeNewValue:c}=r,{mapper:d,writer:u}=s;if(!s.consumable.consume(r.item,l.name))return;const h=[...d.toViewElement(a).getChildren()].find(b=>b.is("element","table"));c?u.setStyle(o,c,h):u.removeStyle(o,h)}))}function se(i){if(!i)return;const e=["top","right","bottom","left"];if(!e.every(l=>i[l]))return i;const o=i.top;return e.every(l=>i[l]===o)?o:i}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/function _(i,e,t,o,n=1){e!=null&&n!==void 0&&n!==null&&e>n?o.setAttribute(i,e,t):o.removeAttribute(i,t)}function F(i,e,t={}){const o=i.createElement("tableCell",t);return i.insertElement("paragraph",o),i.insert(o,e),o}function Te(i,e){const t=e.parent.parent,o=parseInt(t.getAttribute("headingColumns")||"0"),{column:n}=i.getCellLocation(e);return!!o&&n<o}function ae(i,e,t){const{modelAttribute:o}=t;i.extend("tableCell",{allowAttributes:[o]}),_e(e,{viewElement:/^(td|th)$/,...t}),K(e,{modelElement:"tableCell",...t})}function M(i){const e=i.getSelectedElement();return e&&e.is("element","table")?e:i.getFirstPosition().findAncestor("table")}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/function zo(){return i=>{i.on("element:figure",(e,t,o)=>{if(!o.consumable.test(t.viewItem,{name:!0,classes:"table"}))return;const n=Lo(t.viewItem);if(!n||!o.consumable.test(n,{name:!0}))return;o.consumable.consume(t.viewItem,{name:!0,classes:"table"});const l=o.convertItem(n,t.modelCursor),r=Ue(l.modelRange.getItems());if(!r){o.consumable.revert(t.viewItem,{name:!0,classes:"table"});return}o.convertChildren(t.viewItem,o.writer.createPositionAt(r,"end")),o.updateConversionResult(r,t)})}}function Bo(){return i=>{i.on("element:table",(e,t,o)=>{const n=t.viewItem;if(!o.consumable.test(n,{name:!0}))return;const{rows:l,headingRows:r,headingColumns:s}=No(n),a={};s&&(a.headingColumns=s),r&&(a.headingRows=r);const c=o.writer.createElement("table",a);if(o.safeInsert(c,t.modelCursor)){if(o.consumable.consume(n,{name:!0}),l.forEach(d=>o.convertItem(d,o.writer.createPositionAt(c,"end"))),o.convertChildren(n,o.writer.createPositionAt(c,"end")),c.isEmpty){const d=o.writer.createElement("tableRow");o.writer.insert(d,o.writer.createPositionAt(c,"end")),F(o.writer,o.writer.createPositionAt(d,"end"))}o.updateConversionResult(c,t)}})}}function Wo(){return i=>{i.on("element:tr",(e,t)=>{t.viewItem.isEmpty&&t.modelCursor.index==0&&e.stop()},{priority:"high"})}}function nt(i){return e=>{e.on(`element:${i}`,(t,o,{writer:n})=>{if(!o.modelRange)return;const l=o.modelRange.start.nodeAfter,r=n.createPositionAt(l,0);if(o.viewItem.isEmpty){n.insertElement("paragraph",r);return}const s=Array.from(l.getChildren());if(s.every(a=>a.is("element","$marker"))){const a=n.createElement("paragraph");n.insert(a,n.createPositionAt(l,0));for(const c of s)n.move(n.createRangeOn(c),n.createPositionAt(a,"end"))}},{priority:"low"})}}function Lo(i){for(const e of i.getChildren())if(e.is("element","table"))return e}function No(i){let e=0,t;const o=[],n=[];let l;for(const r of Array.from(i.getChildren())){if(r.name!=="tbody"&&r.name!=="thead"&&r.name!=="tfoot")continue;r.name==="thead"&&!l&&(l=r);const s=Array.from(r.getChildren()).filter(a=>a.is("element","tr"));for(const a of s)if(l&&r===l||r.name==="tbody"&&Array.from(a.getChildren()).length&&Array.from(a.getChildren()).every(c=>c.is("element","th")))e++,o.push(a);else{n.push(a);const c=Fo(a);(!t||c<t)&&(t=c)}}return{headingRows:e,headingColumns:t||0,rows:[...o,...n]}}function Fo(i){let e=0,t=0;const o=Array.from(i.getChildren()).filter(n=>n.name==="th"||n.name==="td");for(;t<o.length&&o[t].name==="th";){const n=o[t],l=parseInt(n.getAttribute("colspan")||"1");e=e+l,t++}return e}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class C{constructor(e,t={}){this._jumpedToStartRow=!1,this._table=e,this._startRow=t.row!==void 0?t.row:t.startRow||0,this._endRow=t.row!==void 0?t.row:t.endRow,this._startColumn=t.column!==void 0?t.column:t.startColumn||0,this._endColumn=t.column!==void 0?t.column:t.endColumn,this._includeAllSlots=!!t.includeAllSlots,this._skipRows=new Set,this._row=0,this._rowIndex=0,this._column=0,this._cellIndex=0,this._spannedCells=new Map,this._nextCellAtColumn=-1}[Symbol.iterator](){return this}next(){this._canJumpToStartRow()&&this._jumpToNonSpannedRowClosestToStartRow();const e=this._table.getChild(this._rowIndex);if(!e||this._isOverEndRow())return{done:!0,value:void 0};if(!e.is("element","tableRow"))return this._rowIndex++,this.next();if(this._isOverEndColumn())return this._advanceToNextRow();let t=null;const o=this._getSpanned();if(o)this._includeAllSlots&&!this._shouldSkipSlot()&&(t=this._formatOutValue(o.cell,o.row,o.column));else{const n=e.getChild(this._cellIndex);if(!n)return this._advanceToNextRow();const l=parseInt(n.getAttribute("colspan")||"1"),r=parseInt(n.getAttribute("rowspan")||"1");(l>1||r>1)&&this._recordSpans(n,r,l),this._shouldSkipSlot()||(t=this._formatOutValue(n)),this._nextCellAtColumn=this._column+l}return this._column++,this._column==this._nextCellAtColumn&&this._cellIndex++,t||this.next()}skipRow(e){this._skipRows.add(e)}_advanceToNextRow(){return this._row++,this._rowIndex++,this._column=0,this._cellIndex=0,this._nextCellAtColumn=-1,this.next()}_isOverEndRow(){return this._endRow!==void 0&&this._row>this._endRow}_isOverEndColumn(){return this._endColumn!==void 0&&this._column>this._endColumn}_formatOutValue(e,t=this._row,o=this._column){return{done:!1,value:new Mo(this,e,t,o)}}_shouldSkipSlot(){const e=this._skipRows.has(this._row),t=this._row<this._startRow,o=this._column<this._startColumn,n=this._endColumn!==void 0&&this._column>this._endColumn;return e||t||o||n}_getSpanned(){const e=this._spannedCells.get(this._row);return e&&e.get(this._column)||null}_recordSpans(e,t,o){const n={cell:e,row:this._row,column:this._column};for(let l=this._row;l<this._row+t;l++)for(let r=this._column;r<this._column+o;r++)(l!=this._row||r!=this._column)&&this._markSpannedCell(l,r,n)}_markSpannedCell(e,t,o){this._spannedCells.has(e)||this._spannedCells.set(e,new Map),this._spannedCells.get(e).set(t,o)}_canJumpToStartRow(){return!!this._startRow&&this._startRow>0&&!this._jumpedToStartRow}_jumpToNonSpannedRowClosestToStartRow(){const e=this._getRowLength(0);for(let t=this._startRow;!this._jumpedToStartRow;t--)e===this._getRowLength(t)&&(this._row=t,this._rowIndex=t,this._jumpedToStartRow=!0)}_getRowLength(e){return[...this._table.getChild(e).getChildren()].reduce((o,n)=>o+parseInt(n.getAttribute("colspan")||"1"),0)}}class Mo{constructor(e,t,o,n){this.cell=t,this.row=e._row,this.column=e._column,this.cellAnchorRow=o,this.cellAnchorColumn=n,this._cellIndex=e._cellIndex,this._rowIndex=e._rowIndex,this._table=e._table}get isAnchor(){return this.row===this.cellAnchorRow&&this.column===this.cellAnchorColumn}get cellWidth(){return parseInt(this.cell.getAttribute("colspan")||"1")}get cellHeight(){return parseInt(this.cell.getAttribute("rowspan")||"1")}get rowIndex(){return this._rowIndex}getPositionBefore(){return this._table.root.document.model.createPositionAt(this._table.getChild(this.row),this._cellIndex)}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */function lt(i,e){return(t,{writer:o})=>{const n=t.getAttribute("headingRows")||0,l=o.createContainerElement("table",null,[]),r=o.createContainerElement("figure",{class:"table"},l);n>0&&o.insert(o.createPositionAt(l,"end"),o.createContainerElement("thead",null,o.createSlot(s=>s.is("element","tableRow")&&s.index<n))),n<i.getRows(t)&&o.insert(o.createPositionAt(l,"end"),o.createContainerElement("tbody",null,o.createSlot(s=>s.is("element","tableRow")&&s.index>=n)));for(const{positionOffset:s,filter:a}of e.additionalSlots)o.insert(o.createPositionAt(l,s),o.createSlot(a));return o.insert(o.createPositionAt(l,"after"),o.createSlot(s=>s.is("element","tableRow")?!1:!e.additionalSlots.some(({filter:a})=>a(s)))),e.asWidget?Oo(r,o):r}}function Ho(){return(i,{writer:e})=>i.isEmpty?e.createEmptyElement("tr"):e.createContainerElement("tr")}function it(i={}){return(e,{writer:t})=>{const o=e.parent,n=o.parent,l=n.getChildIndex(o),r=new C(n,{row:l}),s=n.getAttribute("headingRows")||0,a=n.getAttribute("headingColumns")||0;let c=null;for(const d of r)if(d.cell==e){const h=d.row<s||d.column<a?"th":"td";c=i.asWidget?Oe(t.createEditableElement(h),t):t.createContainerElement(h);break}return c}}function rt(i={}){return(e,{writer:t})=>{if(!e.parent.is("element","tableCell")||!st(e))return null;if(i.asWidget)return t.createContainerElement("span",{class:"ck-table-bogus-paragraph"});{const o=t.createContainerElement("p");return t.setCustomProperty("dataPipeline:transparentRendering",!0,o),o}}}function st(i){return i.parent.childCount==1&&!Do(i)}function Oo(i,e){return e.setCustomProperty("table",!0,i),mo(i,e,{hasSelectionHandle:!0})}function Do(i){return!i.getAttributeKeys().next().done}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class Uo extends S{refresh(){const e=this.editor.model,t=e.document.selection,o=e.schema;this.isEnabled=Go(t,o)}execute(e={}){const t=this.editor,o=t.model,n=t.plugins.get("TableUtils"),l=t.config.get("table.defaultHeadings.rows"),r=t.config.get("table.defaultHeadings.columns");e.headingRows===void 0&&l&&(e.headingRows=l),e.headingColumns===void 0&&r&&(e.headingColumns=r),o.change(s=>{const a=n.createTable(s,e);o.insertObject(a,null,null,{findOptimalPosition:"auto"}),s.setSelection(s.createPositionAt(a.getNodeByPath([0,0,0]),0))})}}function Go(i,e){const t=i.getFirstPosition().parent,o=t===t.root?t:t.parent;return e.checkChild(o,"table")}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class at extends S{constructor(e,t={}){super(e),this.order=t.order||"below"}refresh(){const e=this.editor.model.document.selection,o=!!this.editor.plugins.get("TableUtils").getSelectionAffectedTableCells(e).length;this.isEnabled=o}execute(){const e=this.editor,t=e.model.document.selection,o=e.plugins.get("TableUtils"),n=this.order==="above",l=o.getSelectionAffectedTableCells(t),r=o.getRowIndexes(l),s=n?r.first:r.last,a=l[0].findAncestor("table");o.insertRows(a,{at:n?s:s+1,copyStructureFromAbove:!n})}}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class ct extends S{constructor(e,t={}){super(e),this.order=t.order||"right"}refresh(){const e=this.editor.model.document.selection,o=!!this.editor.plugins.get("TableUtils").getSelectionAffectedTableCells(e).length;this.isEnabled=o}execute(){const e=this.editor,t=e.model.document.selection,o=e.plugins.get("TableUtils"),n=this.order==="left",l=o.getSelectionAffectedTableCells(t),r=o.getColumnIndexes(l),s=n?r.first:r.last,a=l[0].findAncestor("table");o.insertColumns(a,{columns:1,at:n?s:s+1})}}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class dt extends S{constructor(e,t={}){super(e),this.direction=t.direction||"horizontally"}refresh(){const t=this.editor.plugins.get("TableUtils").getSelectionAffectedTableCells(this.editor.model.document.selection);this.isEnabled=t.length===1}execute(){const e=this.editor.plugins.get("TableUtils"),t=e.getSelectionAffectedTableCells(this.editor.model.document.selection)[0];this.direction==="horizontally"?e.splitCellHorizontally(t,2):e.splitCellVertically(t,2)}}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/function ut(i,e,t){const{startRow:o,startColumn:n,endRow:l,endColumn:r}=e,s=t.createElement("table"),a=l-o+1;for(let d=0;d<a;d++)t.insertElement("tableRow",s,"end");const c=[...new C(i,{startRow:o,endRow:l,startColumn:n,endColumn:r,includeAllSlots:!0})];for(const{row:d,column:u,cell:h,isAnchor:b,cellAnchorRow:g,cellAnchorColumn:m}of c){const f=d-o,p=s.getChild(f);if(!b)(g<o||m<n)&&F(t,t.createPositionAt(p,"end"));else{const w=t.cloneElement(h);t.append(w,p),ft(w,d,u,l,r,t)}}return $o(s,i,o,n,t),s}function ht(i,e,t=0){const o=[],n=new C(i,{startRow:t,endRow:e-1});for(const l of n){const{row:r,cellHeight:s}=l,a=r+s-1;r<e&&e<=a&&o.push(l)}return o}function mt(i,e,t){const o=i.parent,n=o.parent,l=o.index,r=parseInt(i.getAttribute("rowspan")),s=e-l,a={},c=r-s;c>1&&(a.rowspan=c);const d=parseInt(i.getAttribute("colspan")||"1");d>1&&(a.colspan=d);const u=l,h=u+s,b=[...new C(n,{startRow:u,endRow:h,includeAllSlots:!0})];let g=null,m;for(const f of b){const{row:p,column:w,cell:v}=f;v===i&&m===void 0&&(m=w),m!==void 0&&m===w&&p===h&&(g=F(t,f.getPositionBefore(),a))}return _("rowspan",s,i,t),g}function bt(i,e){const t=[],o=new C(i);for(const n of o){const{column:l,cellWidth:r}=n,s=l+r-1;l<e&&e<=s&&t.push(n)}return t}function gt(i,e,t,o){const n=parseInt(i.getAttribute("colspan")),l=t-e,r={},s=n-l;s>1&&(r.colspan=s);const a=parseInt(i.getAttribute("rowspan")||"1");a>1&&(r.rowspan=a);const c=F(o,o.createPositionAfter(i),r);return _("colspan",l,i,o),c}function ft(i,e,t,o,n,l){const r=parseInt(i.getAttribute("colspan")||"1"),s=parseInt(i.getAttribute("rowspan")||"1");if(t+r-1>n){const d=n-t+1;_("colspan",d,i,l,1)}if(e+s-1>o){const d=o-e+1;_("rowspan",d,i,l,1)}}function $o(i,e,t,o,n){const l=parseInt(e.getAttribute("headingRows")||"0");if(l>0){const s=l-t;_("headingRows",s,i,n,0)}const r=parseInt(e.getAttribute("headingColumns")||"0");if(r>0){const s=r-o;_("headingColumns",s,i,n,0)}}function ye(i,e){const t=e.getColumns(i),o=new Array(t).fill(0);for(const{column:l}of new C(i))o[l]++;const n=o.reduce((l,r,s)=>r?l:[...l,s],[]);if(n.length>0){const l=n[n.length-1];return e.removeColumns(i,{at:l}),!0}return!1}function Ae(i,e){const t=[],o=e.getRows(i);for(let n=0;n<o;n++)i.getChild(n).isEmpty&&t.push(n);if(t.length>0){const n=t[t.length-1];return e.removeRows(i,{at:n}),!0}return!1}function Se(i,e){ye(i,e)||Ae(i,e)}function pt(i,e){const t=Array.from(new C(i,{startColumn:e.firstColumn,endColumn:e.lastColumn,row:e.lastRow}));if(t.every(({cellHeight:l})=>l===1))return e.lastRow;const n=t[0].cellHeight-1;return e.lastRow+n}function wt(i,e){const t=Array.from(new C(i,{startRow:e.firstRow,endRow:e.lastRow,column:e.lastColumn}));if(t.every(({cellWidth:l})=>l===1))return e.lastColumn;const n=t[0].cellWidth-1;return e.lastColumn+n}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class ce extends S{constructor(e,t){super(e),this.direction=t.direction,this.isHorizontal=this.direction=="right"||this.direction=="left"}refresh(){const e=this._getMergeableCell();this.value=e,this.isEnabled=!!e}execute(){const e=this.editor.model,t=e.document,n=this.editor.plugins.get("TableUtils").getTableCellsContainingSelection(t.selection)[0],l=this.value,r=this.direction;e.change(s=>{const a=r=="right"||r=="down",c=a?n:l,d=a?l:n,u=d.parent;Ko(d,c,s);const h=this.isHorizontal?"colspan":"rowspan",b=parseInt(n.getAttribute(h)||"1"),g=parseInt(l.getAttribute(h)||"1");s.setAttribute(h,b+g,c),s.setSelection(s.createRangeIn(c));const m=this.editor.plugins.get("TableUtils"),f=u.findAncestor("table");Se(f,m)})}_getMergeableCell(){const t=this.editor.model.document,o=this.editor.plugins.get("TableUtils"),n=o.getTableCellsContainingSelection(t.selection)[0];if(!n)return;const l=this.isHorizontal?jo(n,this.direction,o):qo(n,this.direction,o);if(!l)return;const r=this.isHorizontal?"rowspan":"colspan",s=parseInt(n.getAttribute(r)||"1");if(parseInt(l.getAttribute(r)||"1")===s)return l}}function jo(i,e,t){const n=i.parent.parent,l=e=="right"?i.nextSibling:i.previousSibling,r=(n.getAttribute("headingColumns")||0)>0;if(!l)return;const s=e=="right"?i:l,a=e=="right"?l:i,{column:c}=t.getCellLocation(s),{column:d}=t.getCellLocation(a),u=parseInt(s.getAttribute("colspan")||"1"),h=Te(t,s),b=Te(t,a);return r&&h!=b?void 0:c+u===d?l:void 0}function qo(i,e,t){const o=i.parent,n=o.parent,l=n.getChildIndex(o);if(e=="down"&&l===t.getRows(n)-1||e=="up"&&l===0)return null;const r=parseInt(i.getAttribute("rowspan")||"1"),s=n.getAttribute("headingRows")||0,a=e=="down"&&l+r===s,c=e=="up"&&l===s;if(s&&(a||c))return null;const d=parseInt(i.getAttribute("rowspan")||"1"),u=e=="down"?l+d:l,h=[...new C(n,{endRow:u})],g=h.find(f=>f.cell===i).column,m=h.find(({row:f,cellHeight:p,column:w})=>w!==g?!1:e=="down"?f===u:u===f+p);return m&&m.cell?m.cell:null}function Ko(i,e,t){Ct(i)||(Ct(e)&&t.remove(t.createRangeIn(e)),t.move(t.createRangeIn(i),t.createPositionAt(e,"end"))),t.remove(i)}function Ct(i){const e=i.getChild(0);return i.childCount==1&&e.is("element","paragraph")&&e.isEmpty}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class Xo extends S{refresh(){const e=this.editor.plugins.get("TableUtils"),t=e.getSelectionAffectedTableCells(this.editor.model.document.selection),o=t[0];if(o){const n=o.findAncestor("table"),r=e.getRows(n)-1,s=e.getRowIndexes(t),a=s.first===0&&s.last===r;this.isEnabled=!a}else this.isEnabled=!1}execute(){const e=this.editor.model,t=this.editor.plugins.get("TableUtils"),o=t.getSelectionAffectedTableCells(e.document.selection),n=t.getRowIndexes(o),l=o[0],r=l.findAncestor("table"),s=t.getCellLocation(l).column;e.change(a=>{const c=n.last-n.first+1;t.removeRows(r,{at:n.first,rows:c});const d=Jo(r,n.first,s,t.getRows(r));a.setSelection(a.createPositionAt(d,0))})}}function Jo(i,e,t,o){const n=i.getChild(Math.min(e,o-1));let l=n.getChild(0),r=0;for(const s of n.getChildren()){if(r>t)return l;l=s,r+=parseInt(s.getAttribute("colspan")||"1")}return l}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class Yo extends S{refresh(){const e=this.editor.plugins.get("TableUtils"),t=e.getSelectionAffectedTableCells(this.editor.model.document.selection),o=t[0];if(o){const n=o.findAncestor("table"),l=e.getColumns(n),{first:r,last:s}=e.getColumnIndexes(t);this.isEnabled=s-r<l-1}else this.isEnabled=!1}execute(){const e=this.editor.plugins.get("TableUtils"),[t,o]=Zo(this.editor.model.document.selection,e),n=t.parent.parent,l=[...new C(n)],r={first:l.find(a=>a.cell===t).column,last:l.find(a=>a.cell===o).column},s=Qo(l,t,o,r);this.editor.model.change(a=>{const c=r.last-r.first+1;e.removeColumns(n,{at:r.first,columns:c}),a.setSelection(a.createPositionAt(s,0))})}}function Qo(i,e,t,o){return parseInt(t.getAttribute("colspan")||"1")>1?t:e.previousSibling||t.nextSibling?t.nextSibling||e.previousSibling:o.first?i.reverse().find(({column:l})=>l<o.first).cell:i.reverse().find(({column:l})=>l>o.last).cell}function Zo(i,e){const t=e.getSelectionAffectedTableCells(i),o=t[0],n=t.pop(),l=[o,n];return o.isBefore(n)?l:l.reverse()}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class en extends S{refresh(){const e=this.editor.plugins.get("TableUtils"),t=this.editor.model,o=e.getSelectionAffectedTableCells(t.document.selection),n=o.length>0;this.isEnabled=n,this.value=n&&o.every(l=>this._isInHeading(l,l.parent.parent))}execute(e={}){if(e.forceValue===this.value)return;const t=this.editor.plugins.get("TableUtils"),o=this.editor.model,n=t.getSelectionAffectedTableCells(o.document.selection),l=n[0].findAncestor("table"),{first:r,last:s}=t.getRowIndexes(n),a=this.value?r:s+1,c=l.getAttribute("headingRows")||0;o.change(d=>{if(a){const u=a>c?c:0,h=ht(l,a,u);for(const{cell:b}of h)mt(b,a,d)}_("headingRows",a,l,d,0)})}_isInHeading(e,t){const o=parseInt(t.getAttribute("headingRows")||"0");return!!o&&e.parent.index<o}}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class tn extends S{refresh(){const e=this.editor.model,t=this.editor.plugins.get("TableUtils"),o=t.getSelectionAffectedTableCells(e.document.selection),n=o.length>0;this.isEnabled=n,this.value=n&&o.every(l=>Te(t,l))}execute(e={}){if(e.forceValue===this.value)return;const t=this.editor.plugins.get("TableUtils"),o=this.editor.model,n=t.getSelectionAffectedTableCells(o.document.selection),l=n[0].findAncestor("table"),{first:r,last:s}=t.getColumnIndexes(n),a=this.value?r:s+1;o.change(c=>{if(a){const d=bt(l,a);for(const{cell:u,column:h}of d)gt(u,h,a,c)}_("headingColumns",a,l,c,0)})}}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/const on=5,xe=40,nn=2;/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/function ln(i){const e=new Set;for(const t of i.document.differ.getChanges()){let o=null;switch(t.type){case"insert":o=["table","tableRow","tableCell"].includes(t.name)?t.position:null;break;case"remove":o=["tableRow","tableCell"].includes(t.name)?t.position:null;break;case"attribute":t.range.start.nodeAfter&&(o=["table","tableRow","tableCell"].includes(t.range.start.nodeAfter.name)?t.range.start:null);break}if(!o)continue;const n=o.nodeAfter&&o.nodeAfter.is("element","table")?o.nodeAfter:o.findAncestor("table");for(const l of i.createRangeOn(n).getItems())l.is("element","table")&&J(l)&&e.add(l)}return e}function rn(i,e){return xe*100/kt(i,e)}function kt(i,e){const t=_t(i,"tbody",e)||_t(i,"thead",e),o=e.editing.view.domConverter.mapViewToDom(t);return Re(o)}function _t(i,e,t){return[...[...t.editing.mapper.toViewElement(i).getChildren()].find(l=>l.is("element","table")).getChildren()].find(l=>l.is("element",e))}function Re(i){const e=Z.window.getComputedStyle(i);return e.boxSizing==="border-box"?parseFloat(e.width)-parseFloat(e.paddingLeft)-parseFloat(e.paddingRight)-parseFloat(e.borderLeftWidth)-parseFloat(e.borderRightWidth):parseFloat(e.width)}function sn(i,e){const t=e.getCellLocation(i).column,o=i.getAttribute("colspan")||1;return{leftEdge:t,rightEdge:t+o-1}}function x(i){const e=Math.pow(10,nn),t=typeof i=="number"?i:parseFloat(i);return Math.round(t*e)/e}function an(i,e,t){return i<=e?x(e):i>=t?x(t):x(i)}function cn(i,e){return Array(i).fill(e)}function X(i){return i.map(e=>typeof e=="number"?e:parseFloat(e)).filter(e=>!Number.isNaN(e)).reduce((e,t)=>e+t,0)}function Ve(i){const e=i.map(n=>n==="auto"?n:parseFloat(n.replace("%","")));let t=dn(e);const o=X(t);return o!==100&&(t=t.map(n=>x(n*100/o)).map((n,l,r)=>{if(!(l===r.length-1))return n;const a=X(r);return x(n+100-a)})),t.map(n=>n+"%")}function dn(i){const e=i.filter(n=>n==="auto").length;if(e===0)return i.map(n=>x(n));const t=X(i),o=Math.max((100-t)/e,on);return i.map(n=>n==="auto"?o:n).map(n=>x(n))}function un(i){const e=Z.window.getComputedStyle(i);return e.boxSizing==="border-box"?parseInt(e.width):parseFloat(e.width)+parseFloat(e.paddingLeft)+parseFloat(e.paddingRight)+parseFloat(e.borderWidth)}function vt(i,e,t,o){for(let n=0;n<Math.max(t.length,i.length);n++){const l=i[n],r=t[n];r?l?o.setAttribute("columnWidth",r,l):o.appendElement("tableColumn",{columnWidth:r},e):o.remove(l)}}function J(i){if(i.is("element","tableColumnGroup"))return i;const e=i.getChildren();return Array.from(e).find(t=>t.is("element","tableColumnGroup"))}function Y(i){const e=J(i);return e?Array.from(e.getChildren()):[]}function hn(i){return Y(i).map(e=>e.getAttribute("columnWidth"))}function mn(i,e){return Y(i).reduce((o,n)=>{const l=n.getAttribute("columnWidth"),r=n.getAttribute("colSpan");if(!r)return o.push(l),o;for(let s=0;s<r;s++)o.push(l);return e.removeAttribute("colSpan",n),o},[])}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class T extends k{static get pluginName(){return"TableUtils"}static get isOfficialPlugin(){return!0}init(){this.decorate("insertColumns"),this.decorate("insertRows")}getCellLocation(e){const t=e.parent,o=t.parent,n=o.getChildIndex(t),l=new C(o,{row:n});for(const{cell:r,row:s,column:a}of l)if(r===e)return{row:s,column:a};/* istanbul ignore next -- @preserve */}createTable(e,t){const o=e.createElement("table"),n=t.rows||2,l=t.columns||2;return Ie(e,o,0,n,l),t.headingRows&&_("headingRows",Math.min(t.headingRows,n),o,e,0),t.headingColumns&&_("headingColumns",Math.min(t.headingColumns,l),o,e,0),o}insertRows(e,t={}){const o=this.editor.model,n=t.at||0,l=t.rows||1,r=t.copyStructureFromAbove!==void 0,s=t.copyStructureFromAbove?n-1:n,a=this.getRows(e),c=this.getColumns(e);if(n>a)throw new Ge("tableutils-insertrows-insert-out-of-range",this,{options:t});o.change(d=>{const u=e.getAttribute("headingRows")||0;if(u>n&&_("headingRows",u+l,e,d,0),!r&&(n===0||n===a)){Ie(d,e,n,l,c);return}const h=r?Math.max(n,s):n,b=new C(e,{endRow:h}),g=new Array(c).fill(1);for(const{row:m,column:f,cellHeight:p,cellWidth:w,cell:v}of b){const A=m+p-1,U=m<n&&n<=A,q=m<=s&&s<=A;U?(d.setAttribute("rowspan",p+l,v),g[f]=-w):r&&q&&(g[f]=w)}for(let m=0;m<l;m++){const f=d.createElement("tableRow");d.insert(f,e,n);for(let p=0;p<g.length;p++){const w=g[p],v=d.createPositionAt(f,"end");w>0&&F(d,v,w>1?{colspan:w}:void 0),p+=Math.abs(w)-1}}})}insertColumns(e,t={}){const o=this.editor.model,n=t.at||0,l=t.columns||1;o.change(r=>{const s=e.getAttribute("headingColumns");n<s&&r.setAttribute("headingColumns",s+l,e);const a=this.getColumns(e);if(n===0||a===n){for(const d of e.getChildren())d.is("element","tableRow")&&$(l,r,r.createPositionAt(d,n?"end":0));return}const c=new C(e,{column:n,includeAllSlots:!0});for(const d of c){const{row:u,cell:h,cellAnchorColumn:b,cellAnchorRow:g,cellWidth:m,cellHeight:f}=d;if(b<n){r.setAttribute("colspan",m+l,h);const p=g+f-1;for(let w=u;w<=p;w++)c.skipRow(w)}else $(l,r,d.getPositionBefore())}})}removeRows(e,t){const o=this.editor.model,n=t.rows||1,l=this.getRows(e),r=t.at,s=r+n-1;if(s>l-1)throw new Ge("tableutils-removerows-row-index-out-of-range",this,{table:e,options:t});o.change(a=>{const c={first:r,last:s},{cellsToMove:d,cellsToTrim:u}=fn(e,c);if(d.size){const h=s+1;pn(e,h,d,a)}for(let h=s;h>=r;h--)a.remove(e.getChild(h));for(const{rowspan:h,cell:b}of u)_("rowspan",h,b,a);gn(e,c,a),ye(e,this)||Ae(e,this)})}removeColumns(e,t){const o=this.editor.model,n=t.at,l=t.columns||1,r=t.at+l-1;o.change(s=>{bn(e,{first:n,last:r},s);const a=Y(e);for(let c=r;c>=n;c--){for(const{cell:d,column:u,cellWidth:h}of[...new C(e)])u<=c&&h>1&&u+h>c?_("colspan",h-1,d,s):u===c&&s.remove(d);if(a[c]){const d=c===0?a[1]:a[c-1],u=parseFloat(a[c].getAttribute("columnWidth")),h=parseFloat(d.getAttribute("columnWidth"));s.remove(a[c]),s.setAttribute("columnWidth",u+h+"%",d)}}Ae(e,this)||ye(e,this)})}splitCellVertically(e,t=2){const o=this.editor.model,l=e.parent.parent,r=parseInt(e.getAttribute("rowspan")||"1"),s=parseInt(e.getAttribute("colspan")||"1");o.change(a=>{if(s>1){const{newCellsSpan:c,updatedSpan:d}=Tt(s,t);_("colspan",d,e,a);const u={};c>1&&(u.colspan=c),r>1&&(u.rowspan=r);const h=s>t?t-1:s-1;$(h,a,a.createPositionAfter(e),u)}if(s<t){const c=t-s,d=[...new C(l)],{column:u}=d.find(({cell:m})=>m===e),h=d.filter(({cell:m,cellWidth:f,column:p})=>{const w=m!==e&&p===u,v=p<u&&p+f>u;return w||v});for(const{cell:m,cellWidth:f}of h)a.setAttribute("colspan",f+c,m);const b={};r>1&&(b.rowspan=r),$(c,a,a.createPositionAfter(e),b);const g=l.getAttribute("headingColumns")||0;g>u&&_("headingColumns",g+c,l,a)}})}splitCellHorizontally(e,t=2){const o=this.editor.model,n=e.parent,l=n.parent,r=l.getChildIndex(n),s=parseInt(e.getAttribute("rowspan")||"1"),a=parseInt(e.getAttribute("colspan")||"1");o.change(c=>{if(s>1){const d=[...new C(l,{startRow:r,endRow:r+s-1,includeAllSlots:!0})],{newCellsSpan:u,updatedSpan:h}=Tt(s,t);_("rowspan",h,e,c);const{column:b}=d.find(({cell:f})=>f===e),g={};u>1&&(g.rowspan=u),a>1&&(g.colspan=a);let m=0;for(const f of d){const{column:p,row:w}=f,v=w>=r+h,A=p===b;m>=u&&A&&(m=0),v&&A&&(m||$(1,c,f.getPositionBefore(),g),m++)}}if(s<t){const d=t-s,u=[...new C(l,{startRow:0,endRow:r})];for(const{cell:g,cellHeight:m,row:f}of u)if(g!==e&&f+m>r){const p=m+d;c.setAttribute("rowspan",p,g)}const h={};a>1&&(h.colspan=a),Ie(c,l,r+1,d,1,h);const b=l.getAttribute("headingRows")||0;b>r&&_("headingRows",b+d,l,c)}})}getColumns(e){return[...e.getChild(0).getChildren()].filter(o=>o.is("element","tableCell")).reduce((o,n)=>{const l=parseInt(n.getAttribute("colspan")||"1");return o+l},0)}getRows(e){return Array.from(e.getChildren()).reduce((t,o)=>o.is("element","tableRow")?t+1:t,0)}createTableWalker(e,t={}){return new C(e,t)}getSelectedTableCells(e){const t=[];for(const o of this.sortRanges(e.getRanges())){const n=o.getContainedElement();n&&n.is("element","tableCell")&&t.push(n)}return t}getTableCellsContainingSelection(e){const t=[];for(const o of e.getRanges()){const n=o.start.findAncestor("tableCell");n&&t.push(n)}return t}getSelectionAffectedTableCells(e){const t=this.getSelectedTableCells(e);return t.length?t:this.getTableCellsContainingSelection(e)}getRowIndexes(e){const t=e.map(o=>o.parent.index);return this._getFirstLastIndexesObject(t)}getColumnIndexes(e){const t=e[0].findAncestor("table"),n=[...new C(t)].filter(l=>e.includes(l.cell)).map(l=>l.column);return this._getFirstLastIndexesObject(n)}isSelectionRectangular(e){if(e.length<2||!this._areCellInTheSameTableSection(e))return!1;const t=new Set,o=new Set;let n=0;for(const r of e){const{row:s,column:a}=this.getCellLocation(r),c=parseInt(r.getAttribute("rowspan"))||1,d=parseInt(r.getAttribute("colspan"))||1;t.add(s),o.add(a),c>1&&t.add(s+c-1),d>1&&o.add(a+d-1),n+=c*d}return Cn(t,o)==n}sortRanges(e){return Array.from(e).sort(wn)}_getFirstLastIndexesObject(e){const t=e.sort((l,r)=>l-r),o=t[0],n=t[t.length-1];return{first:o,last:n}}_areCellInTheSameTableSection(e){const t=e[0].findAncestor("table"),o=this.getRowIndexes(e),n=parseInt(t.getAttribute("headingRows"))||0;if(!this._areIndexesInSameSection(o,n))return!1;const l=this.getColumnIndexes(e),r=parseInt(t.getAttribute("headingColumns"))||0;return this._areIndexesInSameSection(l,r)}_areIndexesInSameSection({first:e,last:t},o){const n=e<o,l=t<o;return n===l}}function Ie(i,e,t,o,n,l={}){for(let r=0;r<o;r++){const s=i.createElement("tableRow");i.insert(s,e,t),$(n,i,i.createPositionAt(s,"end"),l)}}function $(i,e,t,o={}){for(let n=0;n<i;n++)F(e,t,o)}function Tt(i,e){if(i<e)return{newCellsSpan:1,updatedSpan:1};const t=Math.floor(i/e),o=i-t*e+t;return{newCellsSpan:t,updatedSpan:o}}function bn(i,e,t){const o=i.getAttribute("headingColumns")||0;if(o&&e.first<o){const n=Math.min(o-1,e.last)-e.first+1;t.setAttribute("headingColumns",o-n,i)}}function gn(i,{first:e,last:t},o){const n=i.getAttribute("headingRows")||0;if(e<n){const l=t<n?n-(t-e+1):e;_("headingRows",l,i,o,0)}}function fn(i,{first:e,last:t}){const o=new Map,n=[];for(const{row:l,column:r,cellHeight:s,cell:a}of new C(i,{endRow:t})){const c=l+s-1;if(l>=e&&l<=t&&c>t){const h=t-l+1,b=s-h;o.set(r,{cell:a,rowspan:b})}if(l<e&&c>=e){let h;c>=t?h=t-e+1:h=c-e+1,n.push({cell:a,rowspan:s-h})}}return{cellsToMove:o,cellsToTrim:n}}function pn(i,e,t,o){const l=[...new C(i,{includeAllSlots:!0,row:e})],r=i.getChild(e);let s;for(const{column:a,cell:c,isAnchor:d}of l)if(t.has(a)){const{cell:u,rowspan:h}=t.get(a),b=s?o.createPositionAfter(s):o.createPositionAt(r,0);o.move(o.createRangeOn(u),b),_("rowspan",h,u,o),s=u}else d&&(s=c)}function wn(i,e){const t=i.start,o=e.start;return t.isBefore(o)?-1:1}function Cn(i,e){const t=Array.from(i.values()),o=Array.from(e.values()),n=Math.max(...t),l=Math.min(...t),r=Math.max(...o),s=Math.min(...o);return(n-l+1)*(r-s+1)}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class kn extends S{refresh(){const e=this.editor.plugins.get(T),t=e.getSelectedTableCells(this.editor.model.document.selection);this.isEnabled=e.isSelectionRectangular(t)}execute(){const e=this.editor.model,t=this.editor.plugins.get(T);e.change(o=>{const n=t.getSelectedTableCells(e.document.selection),l=n.shift(),{mergeWidth:r,mergeHeight:s}=vn(l,n,t);_("colspan",r,l,o),_("rowspan",s,l,o);for(const c of n)_n(c,l,o);const a=l.findAncestor("table");Se(a,t),o.setSelection(l,"in")})}}function _n(i,e,t){yt(i)||(yt(e)&&t.remove(t.createRangeIn(e)),t.move(t.createRangeIn(i),t.createPositionAt(e,"end"))),t.remove(i)}function yt(i){const e=i.getChild(0);return i.childCount==1&&e.is("element","paragraph")&&e.isEmpty}function vn(i,e,t){let o=0,n=0;for(const c of e){const{row:d,column:u}=t.getCellLocation(c);o=At(c,u,o,"colspan"),n=At(c,d,n,"rowspan")}const{row:l,column:r}=t.getCellLocation(i),s=o-r,a=n-l;return{mergeWidth:s,mergeHeight:a}}function At(i,e,t,o){const n=parseInt(i.getAttribute(o)||"1");return Math.max(t,e+n)}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class Tn extends S{constructor(e){super(e),this.affectsData=!1}refresh(){const t=this.editor.plugins.get("TableUtils").getSelectionAffectedTableCells(this.editor.model.document.selection);this.isEnabled=t.length>0}execute(){const e=this.editor.model,t=this.editor.plugins.get("TableUtils"),o=t.getSelectionAffectedTableCells(e.document.selection),n=t.getRowIndexes(o),l=o[0].findAncestor("table"),r=[];for(let s=n.first;s<=n.last;s++)for(const a of l.getChild(s).getChildren())r.push(e.createRangeOn(a));e.change(s=>{s.setSelection(r)})}}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class yn extends S{constructor(e){super(e),this.affectsData=!1}refresh(){const t=this.editor.plugins.get("TableUtils").getSelectionAffectedTableCells(this.editor.model.document.selection);this.isEnabled=t.length>0}execute(){const e=this.editor.plugins.get("TableUtils"),t=this.editor.model,o=e.getSelectionAffectedTableCells(t.document.selection),n=o[0],l=o.pop(),r=n.findAncestor("table"),s=e.getCellLocation(n),a=e.getCellLocation(l),c=Math.min(s.column,a.column),d=Math.max(s.column,a.column),u=[];for(const h of new C(r,{startColumn:c,endColumn:d}))u.push(t.createRangeOn(h.cell));t.change(h=>{h.setSelection(u)})}}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/function An(i){i.document.registerPostFixer(e=>Sn(e,i))}function Sn(i,e){const t=e.document.differ.getChanges();let o=!1;const n=new Set;for(const l of t){let r=null;l.type=="insert"&&l.name=="table"&&(r=l.position.nodeAfter),(l.type=="insert"||l.type=="remove")&&(l.name=="tableRow"||l.name=="tableCell")&&(r=l.position.findAncestor("table")),Pn(l)&&(r=l.range.start.findAncestor("table")),r&&!n.has(r)&&(o=xn(r,i)||o,o=Rn(r,i)||o,n.add(r))}return o}function xn(i,e){let t=!1;const o=Vn(i);if(o.length){t=!0;for(const n of o)_("rowspan",n.rowspan,n.cell,e,1)}return t}function Rn(i,e){let t=!1;const o=In(i),n=[];for(const[a,c]of o.entries())!c&&i.getChild(a).is("element","tableRow")&&n.push(a);if(n.length){t=!0;for(const a of n.reverse())e.remove(i.getChild(a)),o.splice(a,1)}const l=o.filter((a,c)=>i.getChild(c).is("element","tableRow")),r=l[0];if(!l.every(a=>a===r)){const a=l.reduce((c,d)=>d>c?d:c,0);for(const[c,d]of l.entries()){const u=a-d;if(u){for(let h=0;h<u;h++)F(e,e.createPositionAt(i.getChild(c),"end"));t=!0}}}return t}function Vn(i){const e=parseInt(i.getAttribute("headingRows")||"0"),t=Array.from(i.getChildren()).reduce((n,l)=>l.is("element","tableRow")?n+1:n,0),o=[];for(const{row:n,cell:l,cellHeight:r}of new C(i)){if(r<2)continue;const a=n<e?e:t;if(n+r>a){const c=a-n;o.push({cell:l,rowspan:c})}}return o}function In(i){const e=new Array(i.childCount).fill(0);for(const{rowIndex:t}of new C(i,{includeAllSlots:!0}))e[t]++;return e}function Pn(i){if(i.type!=="attribute")return!1;const e=i.attributeKey;return e==="headingRows"||e==="colspan"||e==="rowspan"}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/function En(i){i.document.registerPostFixer(e=>zn(e,i))}function zn(i,e){const t=e.document.differ.getChanges();let o=!1;for(const n of t)n.type=="insert"&&n.name=="table"&&(o=Bn(n.position.nodeAfter,i)||o),n.type=="insert"&&n.name=="tableRow"&&(o=St(n.position.nodeAfter,i)||o),n.type=="insert"&&n.name=="tableCell"&&(o=Pe(n.position.nodeAfter,i)||o),(n.type=="remove"||n.type=="insert")&&Wn(n)&&(o=Pe(n.position.parent,i)||o);return o}function Bn(i,e){let t=!1;for(const o of i.getChildren())o.is("element","tableRow")&&(t=St(o,e)||t);return t}function St(i,e){let t=!1;for(const o of i.getChildren())t=Pe(o,e)||t;return t}function Pe(i,e){if(i.childCount==0)return e.insertElement("paragraph",i),!0;const t=Array.from(i.getChildren()).filter(o=>o.is("$text"));for(const o of t)e.wrap(e.createRangeOn(o),"paragraph");return!!t.length}function Wn(i){return i.position.parent.is("element","tableCell")?i.type=="insert"&&i.name=="$text"||i.type=="remove":!1}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/function Ln(i,e){const t=i.document.differ;for(const o of t.getChanges()){let n,l=!1;if(o.type=="attribute"){const c=o.range.start.nodeAfter;if(!c||!c.is("element","table")||o.attributeKey!="headingRows"&&o.attributeKey!="headingColumns")continue;n=c,l=o.attributeKey=="headingRows"}else(o.name=="tableRow"||o.name=="tableCell")&&(n=o.position.findAncestor("table"),l=o.name=="tableRow");if(!n)continue;const r=n.getAttribute("headingRows")||0,s=n.getAttribute("headingColumns")||0,a=new C(n);for(const c of a){const u=c.row<r||c.column<s?"th":"td",h=e.mapper.toViewElement(c.cell);h&&h.is("element")&&h.name!=u&&e.reconvertItem(l?c.cell.parent:c.cell)}}}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/function Nn(i,e){const t=i.document.differ,o=new Set;for(const n of t.getChanges()){const l=n.type=="attribute"?n.range.start.parent:n.position.parent;l.is("element","tableCell")&&o.add(l)}for(const n of o.values()){const l=Array.from(n.getChildren()).filter(r=>Fn(r,e.mapper));for(const r of l)e.reconvertItem(r)}}function Fn(i,e){if(!i.is("element","paragraph"))return!1;const t=e.toViewElement(i);return t?st(i)!==t.is("element","span"):!1}function I(i,{insertAt:e}={}){if(!i||typeof document>"u")return;const t=document.head||document.getElementsByTagName("head")[0],o=document.createElement("style");o.type="text/css",window.litNonce&&o.setAttribute("nonce",window.litNonce),e==="top"&&t.firstChild?t.insertBefore(o,t.firstChild):t.appendChild(o),o.styleSheet?o.styleSheet.cssText=i:o.appendChild(document.createTextNode(i))}I(":root{--ck-color-selector-focused-cell-background:rgba(158,201,250,.3)}.ck-widget.table td.ck-editor__nested-editable.ck-editor__nested-editable_focused,.ck-widget.table td.ck-editor__nested-editable:focus,.ck-widget.table th.ck-editor__nested-editable.ck-editor__nested-editable_focused,.ck-widget.table th.ck-editor__nested-editable:focus{background:var(--ck-color-selector-focused-cell-background);outline:1px solid var(--ck-color-focus-border);outline-offset:-1px}");/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class j extends k{static get pluginName(){return"TableEditing"}static get isOfficialPlugin(){return!0}static get requires(){return[T]}constructor(e){super(e),this._additionalSlots=[]}init(){const e=this.editor,t=e.model,o=t.schema,n=e.conversion,l=e.plugins.get(T);o.register("table",{inheritAllFrom:"$blockObject",allowAttributes:["headingRows","headingColumns"]}),o.register("tableRow",{allowIn:"table",isLimit:!0}),o.register("tableCell",{allowContentOf:"$container",allowIn:"tableRow",allowAttributes:["colspan","rowspan"],isLimit:!0,isSelectable:!0}),n.for("upcast").add(zo()),n.for("upcast").add(Bo()),n.for("editingDowncast").elementToStructure({model:{name:"table",attributes:["headingRows"]},view:lt(l,{asWidget:!0,additionalSlots:this._additionalSlots})}),n.for("dataDowncast").elementToStructure({model:{name:"table",attributes:["headingRows"]},view:lt(l,{additionalSlots:this._additionalSlots})}),n.for("upcast").elementToElement({model:"tableRow",view:"tr"}),n.for("upcast").add(Wo()),n.for("downcast").elementToElement({model:"tableRow",view:Ho()}),n.for("upcast").elementToElement({model:"tableCell",view:"td"}),n.for("upcast").elementToElement({model:"tableCell",view:"th"}),n.for("upcast").add(nt("td")),n.for("upcast").add(nt("th")),n.for("editingDowncast").elementToElement({model:"tableCell",view:it({asWidget:!0})}),n.for("dataDowncast").elementToElement({model:"tableCell",view:it()}),n.for("editingDowncast").elementToElement({model:"paragraph",view:rt({asWidget:!0}),converterPriority:"high"}),n.for("dataDowncast").elementToElement({model:"paragraph",view:rt(),converterPriority:"high"}),n.for("downcast").attributeToAttribute({model:"colspan",view:"colspan"}),n.for("upcast").attributeToAttribute({model:{key:"colspan",value:xt("colspan")},view:"colspan"}),n.for("downcast").attributeToAttribute({model:"rowspan",view:"rowspan"}),n.for("upcast").attributeToAttribute({model:{key:"rowspan",value:xt("rowspan")},view:"rowspan"}),e.config.define("table.defaultHeadings.rows",0),e.config.define("table.defaultHeadings.columns",0),e.commands.add("insertTable",new Uo(e)),e.commands.add("insertTableRowAbove",new at(e,{order:"above"})),e.commands.add("insertTableRowBelow",new at(e,{order:"below"})),e.commands.add("insertTableColumnLeft",new ct(e,{order:"left"})),e.commands.add("insertTableColumnRight",new ct(e,{order:"right"})),e.commands.add("removeTableRow",new Xo(e)),e.commands.add("removeTableColumn",new Yo(e)),e.commands.add("splitTableCellVertically",new dt(e,{direction:"vertically"})),e.commands.add("splitTableCellHorizontally",new dt(e,{direction:"horizontally"})),e.commands.add("mergeTableCells",new kn(e)),e.commands.add("mergeTableCellRight",new ce(e,{direction:"right"})),e.commands.add("mergeTableCellLeft",new ce(e,{direction:"left"})),e.commands.add("mergeTableCellDown",new ce(e,{direction:"down"})),e.commands.add("mergeTableCellUp",new ce(e,{direction:"up"})),e.commands.add("setTableColumnHeader",new tn(e)),e.commands.add("setTableRowHeader",new en(e)),e.commands.add("selectTableRow",new Tn(e)),e.commands.add("selectTableColumn",new yn(e)),An(t),En(t),this.listenTo(t.document,"change:data",()=>{Ln(t,e.editing),Nn(t,e.editing)})}registerAdditionalSlot(e){this._additionalSlots.push(e)}}function xt(i){return e=>{const t=parseInt(e.getAttribute(i));return Number.isNaN(t)||t<=0?null:t}}I(".ck .ck-insert-table-dropdown__grid{display:flex;flex-direction:row;flex-wrap:wrap}:root{--ck-insert-table-dropdown-padding:10px;--ck-insert-table-dropdown-box-height:11px;--ck-insert-table-dropdown-box-width:12px;--ck-insert-table-dropdown-box-margin:1px}.ck .ck-insert-table-dropdown__grid{padding:var(--ck-insert-table-dropdown-padding) var(--ck-insert-table-dropdown-padding) 0;width:calc(var(--ck-insert-table-dropdown-box-width)*10 + var(--ck-insert-table-dropdown-box-margin)*20 + var(--ck-insert-table-dropdown-padding)*2)}.ck .ck-insert-table-dropdown__label,.ck[dir=rtl] .ck-insert-table-dropdown__label{text-align:center}.ck .ck-insert-table-dropdown-grid-box{border:1px solid var(--ck-color-base-border);border-radius:1px;margin:var(--ck-insert-table-dropdown-box-margin);min-height:var(--ck-insert-table-dropdown-box-height);min-width:var(--ck-insert-table-dropdown-box-width);outline:none;transition:none}@media (prefers-reduced-motion:reduce){.ck .ck-insert-table-dropdown-grid-box{transition:none}}.ck .ck-insert-table-dropdown-grid-box:focus{box-shadow:none}.ck .ck-insert-table-dropdown-grid-box.ck-on{background:var(--ck-color-focus-outer-shadow);border-color:var(--ck-color-focus-border)}");/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class Rt extends z{constructor(e){super(e);const t=this.bindTemplate;this.items=this._createGridCollection(),this.keystrokes=new ee,this.focusTracker=new te,this.set("rows",0),this.set("columns",0),this.bind("label").to(this,"columns",this,"rows",(o,n)=>`${n} \xD7 ${o}`),this.setTemplate({tag:"div",attributes:{class:["ck"]},children:[{tag:"div",attributes:{class:["ck-insert-table-dropdown__grid"]},on:{"mouseover@.ck-insert-table-dropdown-grid-box":t.to("boxover")},children:this.items},{tag:"div",attributes:{class:["ck","ck-insert-table-dropdown__label"],"aria-hidden":!0},children:[{text:t.to("label")}]}],on:{mousedown:t.to(o=>{o.preventDefault()}),click:t.to(()=>{this.fire("execute")})}}),this.on("boxover",(o,n)=>{const{row:l,column:r}=n.target.dataset;this.items.get((parseInt(l,10)-1)*10+(parseInt(r,10)-1)).focus()}),this.focusTracker.on("change:focusedElement",(o,n,l)=>{if(!l)return;const{row:r,column:s}=l.dataset;this.set({rows:parseInt(r),columns:parseInt(s)})}),this.on("change:columns",()=>this._highlightGridBoxes()),this.on("change:rows",()=>this._highlightGridBoxes())}render(){super.render(),wo({keystrokeHandler:this.keystrokes,focusTracker:this.focusTracker,gridItems:this.items,numberOfColumns:10,uiLanguageDirection:this.locale&&this.locale.uiLanguageDirection});for(const e of this.items)this.focusTracker.add(e.element);this.keystrokes.listenTo(this.element)}reset(){this.set({rows:1,columns:1})}focus(){this.items.get(0).focus()}focusLast(){this.items.get(0).focus()}_highlightGridBoxes(){const e=this.rows,t=this.columns;this.items.map((o,n)=>{const l=Math.floor(n/10),r=n%10,s=l<e&&r<t;o.set("isOn",s)})}_createGridButton(e,t,o,n){const l=new P(e);return l.set({label:n,class:"ck-insert-table-dropdown-grid-box"}),l.extendTemplate({attributes:{"data-row":t,"data-column":o}}),l}_createGridCollection(){const e=[];for(let t=0;t<100;t++){const o=Math.floor(t/10),n=t%10,l=`${o+1} \xD7 ${n+1}`;e.push(this._createGridButton(this.locale,o+1,n+1,l))}return this.createCollection(e)}}var Mn='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M2.5 1h15A1.5 1.5 0 0 1 19 2.5v15a1.5 1.5 0 0 1-1.5 1.5h-15A1.5 1.5 0 0 1 1 17.5v-15A1.5 1.5 0 0 1 2.5 1zM2 2v16h16V2H2z" opacity=".6"/><path d="M18 7v1H2V7h16zm0 5v1H2v-1h16z" opacity=".6"/><path d="M14 1v18a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1V1a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1zm-2 1H8v4h4V2zm0 6H8v4h4V8zm0 6H8v4h4v-4z"/></svg>',Hn='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M2.5 1h15A1.5 1.5 0 0 1 19 2.5v15a1.5 1.5 0 0 1-1.5 1.5h-15A1.5 1.5 0 0 1 1 17.5v-15A1.5 1.5 0 0 1 2.5 1zM2 2v16h16V2H2z" opacity=".6"/><path d="M7 2h1v16H7V2zm5 0h1v16h-1V2z" opacity=".6"/><path d="M1 6h18a1 1 0 0 1 1 1v6a1 1 0 0 1-1 1H1a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1zm1 2v4h4V8H2zm6 0v4h4V8H8zm6 0v4h4V8h-4z"/></svg>',On='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M2.5 1h15A1.5 1.5 0 0 1 19 2.5v15a1.5 1.5 0 0 1-1.5 1.5h-15A1.5 1.5 0 0 1 1 17.5v-15A1.5 1.5 0 0 1 2.5 1zM2 2v16h16V2H2z" opacity=".6"/><path d="M7 2h1v16H7V2zm5 0h1v7h-1V2zm6 5v1H2V7h16zM8 12v1H2v-1h6z" opacity=".6"/><path d="M7 7h12a1 1 0 0 1 1 1v11a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1V8a1 1 0 0 1 1-1zm1 2v9h10V9H8z"/></svg>';/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class Vt extends k{static get pluginName(){return"TableUI"}static get isOfficialPlugin(){return!0}init(){const e=this.editor,t=this.editor.t,n=e.locale.contentLanguageDirection==="ltr";e.ui.componentFactory.add("insertTable",l=>{const r=e.commands.get("insertTable"),s=oe(l);s.bind("isEnabled").to(r),s.buttonView.set({icon:y.table,label:t("Insert table"),tooltip:!0});let a;return s.on("change:isOpen",()=>{a||(a=new Rt(l),s.panelView.children.add(a),a.delegate("execute").to(s),s.on("execute",()=>{e.execute("insertTable",{rows:a.rows,columns:a.columns}),e.editing.view.focus()}))}),s}),e.ui.componentFactory.add("menuBar:insertTable",l=>{const r=e.commands.get("insertTable"),s=new Co(l),a=new Rt(l);return a.delegate("execute").to(s),s.on("change:isOpen",(c,d,u)=>{u||a.reset()}),a.on("execute",()=>{e.execute("insertTable",{rows:a.rows,columns:a.columns}),e.editing.view.focus()}),s.buttonView.set({label:t("Table"),icon:y.table}),s.panelView.children.add(a),s.bind("isEnabled").to(r),s}),e.ui.componentFactory.add("tableColumn",l=>{const r=[{type:"switchbutton",model:{commandName:"setTableColumnHeader",label:t("Header column"),bindIsOn:!0}},{type:"separator"},{type:"button",model:{commandName:n?"insertTableColumnLeft":"insertTableColumnRight",label:t("Insert column left")}},{type:"button",model:{commandName:n?"insertTableColumnRight":"insertTableColumnLeft",label:t("Insert column right")}},{type:"button",model:{commandName:"removeTableColumn",label:t("Delete column")}},{type:"button",model:{commandName:"selectTableColumn",label:t("Select column")}}];return this._prepareDropdown(t("Column"),Mn,r,l)}),e.ui.componentFactory.add("tableRow",l=>{const r=[{type:"switchbutton",model:{commandName:"setTableRowHeader",label:t("Header row"),bindIsOn:!0}},{type:"separator"},{type:"button",model:{commandName:"insertTableRowAbove",label:t("Insert row above")}},{type:"button",model:{commandName:"insertTableRowBelow",label:t("Insert row below")}},{type:"button",model:{commandName:"removeTableRow",label:t("Delete row")}},{type:"button",model:{commandName:"selectTableRow",label:t("Select row")}}];return this._prepareDropdown(t("Row"),Hn,r,l)}),e.ui.componentFactory.add("mergeTableCells",l=>{const r=[{type:"button",model:{commandName:"mergeTableCellUp",label:t("Merge cell up")}},{type:"button",model:{commandName:n?"mergeTableCellRight":"mergeTableCellLeft",label:t("Merge cell right")}},{type:"button",model:{commandName:"mergeTableCellDown",label:t("Merge cell down")}},{type:"button",model:{commandName:n?"mergeTableCellLeft":"mergeTableCellRight",label:t("Merge cell left")}},{type:"separator"},{type:"button",model:{commandName:"splitTableCellVertically",label:t("Split cell vertically")}},{type:"button",model:{commandName:"splitTableCellHorizontally",label:t("Split cell horizontally")}}];return this._prepareMergeSplitButtonDropdown(t("Merge cells"),On,r,l)})}_prepareDropdown(e,t,o,n){const l=this.editor,r=oe(n),s=this._fillDropdownWithListOptions(r,o);return r.buttonView.set({label:e,icon:t,tooltip:!0}),r.bind("isEnabled").toMany(s,"isEnabled",(...a)=>a.some(c=>c)),this.listenTo(r,"execute",a=>{l.execute(a.source.commandName),a.source instanceof ko||l.editing.view.focus()}),r}_prepareMergeSplitButtonDropdown(e,t,o,n){const l=this.editor,r=oe(n,_o),s="mergeTableCells",a=l.commands.get(s),c=this._fillDropdownWithListOptions(r,o);return r.buttonView.set({label:e,icon:t,tooltip:!0,isEnabled:!0}),r.bind("isEnabled").toMany([a,...c],"isEnabled",(...d)=>d.some(u=>u)),this.listenTo(r.buttonView,"execute",()=>{l.execute(s),l.editing.view.focus()}),this.listenTo(r,"execute",d=>{l.execute(d.source.commandName),l.editing.view.focus()}),r}_fillDropdownWithListOptions(e,t){const o=this.editor,n=[],l=new $e;for(const r of t)Dn(r,o,n,l);return fe(e,l),n}}function Dn(i,e,t,o){if(i.type==="button"||i.type==="switchbutton"){const n=i.model=new qe(i.model),{commandName:l,bindIsOn:r}=i.model,s=e.commands.get(l);t.push(s),n.set({commandName:l}),n.bind("isEnabled").to(s),r&&n.bind("isOn").to(s,"value"),n.set({withText:!0})}o.add(i)}I(':root{--ck-table-selected-cell-background:rgba(158,207,250,.3)}.ck.ck-editor__editable .table table td.ck-editor__editable_selected,.ck.ck-editor__editable .table table th.ck-editor__editable_selected{box-shadow:unset;caret-color:transparent;outline:unset;position:relative}.ck.ck-editor__editable .table table td.ck-editor__editable_selected:after,.ck.ck-editor__editable .table table th.ck-editor__editable_selected:after{background-color:var(--ck-table-selected-cell-background);bottom:0;content:"";left:0;pointer-events:none;position:absolute;right:0;top:0}.ck.ck-editor__editable .table table td.ck-editor__editable_selected ::selection,.ck.ck-editor__editable .table table td.ck-editor__editable_selected:focus,.ck.ck-editor__editable .table table th.ck-editor__editable_selected ::selection,.ck.ck-editor__editable .table table th.ck-editor__editable_selected:focus{background-color:transparent}.ck.ck-editor__editable .table table td.ck-editor__editable_selected .ck-widget,.ck.ck-editor__editable .table table th.ck-editor__editable_selected .ck-widget{outline:unset}.ck.ck-editor__editable .table table td.ck-editor__editable_selected .ck-widget>.ck-widget__selection-handle,.ck.ck-editor__editable .table table th.ck-editor__editable_selected .ck-widget>.ck-widget__selection-handle{display:none}');/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class W extends k{static get pluginName(){return"TableSelection"}static get isOfficialPlugin(){return!0}static get requires(){return[T,T]}init(){const e=this.editor,t=e.model,o=e.editing.view;this.listenTo(t,"deleteContent",(n,l)=>this._handleDeleteContent(n,l),{priority:"high"}),this.listenTo(o.document,"insertText",(n,l)=>this._handleInsertTextEvent(n,l),{priority:"high"}),this._defineSelectionConverter(),this._enablePluginDisabling()}getSelectedTableCells(){const e=this.editor.plugins.get(T),t=this.editor.model.document.selection,o=e.getSelectedTableCells(t);return o.length==0?null:o}getSelectionAsFragment(){const e=this.editor.plugins.get(T),t=this.getSelectedTableCells();return t?this.editor.model.change(o=>{const n=o.createDocumentFragment(),{first:l,last:r}=e.getColumnIndexes(t),{first:s,last:a}=e.getRowIndexes(t),c=t[0].findAncestor("table");let d=a,u=r;if(e.isSelectionRectangular(t)){const g={firstColumn:l,lastColumn:r,firstRow:s,lastRow:a};d=pt(c,g),u=wt(c,g)}const b=ut(c,{startRow:s,startColumn:l,endRow:d,endColumn:u},o);return o.insert(b,n,0),n}):null}setCellSelection(e,t){const o=this._getCellsToSelect(e,t);this.editor.model.change(n=>{n.setSelection(o.cells.map(l=>n.createRangeOn(l)),{backward:o.backward})})}getFocusCell(){const o=[...this.editor.model.document.selection.getRanges()].pop().getContainedElement();return o&&o.is("element","tableCell")?o:null}getAnchorCell(){const e=this.editor.model.document.selection,o=Ue(e.getRanges()).getContainedElement();return o&&o.is("element","tableCell")?o:null}_defineSelectionConverter(){const e=this.editor,t=new Set;e.conversion.for("editingDowncast").add(n=>n.on("selection",(l,r,s)=>{const a=s.writer;o(a);const c=this.getSelectedTableCells();if(!c)return;for(const u of c){const h=s.mapper.toViewElement(u);a.addClass("ck-editor__editable_selected",h),t.add(h)}const d=s.mapper.toViewElement(c[c.length-1]);a.setSelection(d,0)},{priority:"lowest"}));function o(n){for(const l of t)n.removeClass("ck-editor__editable_selected",l);t.clear()}}_enablePluginDisabling(){const e=this.editor;this.on("change:isEnabled",()=>{if(!this.isEnabled){const t=this.getSelectedTableCells();if(!t)return;e.model.change(o=>{const n=o.createPositionAt(t[0],0),l=e.model.schema.getNearestSelectionRange(n);o.setSelection(l)})}})}_handleDeleteContent(e,t){const o=this.editor.plugins.get(T),n=t[0],l=t[1],r=this.editor.model,s=!l||l.direction=="backward",a=o.getSelectedTableCells(n);a.length&&(e.stop(),r.change(c=>{const d=a[s?a.length-1:0];r.change(h=>{for(const b of a)r.deleteContent(h.createSelection(b,"in"))});const u=r.schema.getNearestSelectionRange(c.createPositionAt(d,0));n.is("documentSelection")?c.setSelection(u):n.setTo(u)}))}_handleInsertTextEvent(e,t){const o=this.editor,n=this.getSelectedTableCells();if(!n)return;const l=o.editing.view,r=o.editing.mapper,s=n.map(a=>l.createRangeOn(r.toViewElement(a)));t.selection=l.createSelection(s)}_getCellsToSelect(e,t){const o=this.editor.plugins.get("TableUtils"),n=o.getCellLocation(e),l=o.getCellLocation(t),r=Math.min(n.row,l.row),s=Math.max(n.row,l.row),a=Math.min(n.column,l.column),c=Math.max(n.column,l.column),d=new Array(s-r+1).fill(null).map(()=>[]),u={startRow:r,endRow:s,startColumn:a,endColumn:c};for(const{row:g,cell:m}of new C(e.findAncestor("table"),u))d[g-r].push(m);const h=l.row<n.row,b=l.column<n.column;return h&&d.reverse(),b&&d.forEach(g=>g.reverse()),{cells:d.flat(),backward:h||b}}}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class It extends k{static get pluginName(){return"TableClipboard"}static get isOfficialPlugin(){return!0}static get requires(){return[ke,yo,W,T]}init(){const e=this.editor,t=e.editing.view.document;this.listenTo(t,"copy",(o,n)=>this._onCopyCut(o,n)),this.listenTo(t,"cut",(o,n)=>this._onCopyCut(o,n)),this.listenTo(e.model,"insertContent",(o,[n,l])=>this._onInsertContent(o,n,l),{priority:"high"}),this.decorate("_replaceTableSlotCell")}_onCopyCut(e,t){const o=this.editor.editing.view,n=this.editor.plugins.get(W),l=this.editor.plugins.get(ke);n.getSelectedTableCells()&&(e.name=="cut"&&!this.editor.model.canEditAt(this.editor.model.document.selection)||(t.preventDefault(),e.stop(),this.editor.model.enqueueChange({isUndoable:e.name==="cut"},()=>{const r=l._copySelectedFragmentWithMarkers(e.name,this.editor.model.document.selection,()=>n.getSelectionAsFragment());o.document.fire("clipboardOutput",{dataTransfer:t.dataTransfer,content:this.editor.data.toView(r),method:e.name})})))}_onInsertContent(e,t,o){if(o&&!o.is("documentSelection"))return;const n=this.editor.model,l=this.editor.plugins.get(T),r=this.editor.plugins.get(ke),s=this.getTableIfOnlyTableInContent(t,n);if(!s)return;const a=l.getSelectionAffectedTableCells(n.document.selection);if(!a.length){Se(s,l);return}e.stop(),t.is("documentFragment")?r._pasteMarkersIntoTransformedElement(t.markers,c=>this._replaceSelectedCells(s,a,c)):this.editor.model.change(c=>{this._replaceSelectedCells(s,a,c)})}_replaceSelectedCells(e,t,o){const n=this.editor.plugins.get(T),l={width:n.getColumns(e),height:n.getRows(e)},r=Un(t,l,o,n),s=r.lastRow-r.firstRow+1,a=r.lastColumn-r.firstColumn+1,c={startRow:0,startColumn:0,endRow:Math.min(s,l.height)-1,endColumn:Math.min(a,l.width)-1};e=ut(e,c,o);const d=t[0].findAncestor("table"),u=this._replaceSelectedCellsWithPasted(e,l,d,r,o);if(this.editor.plugins.get("TableSelection").isEnabled){const h=n.sortRanges(u.map(b=>o.createRangeOn(b)));o.setSelection(h)}else o.setSelection(u[0],0);return d}_replaceSelectedCellsWithPasted(e,t,o,n,l){const{width:r,height:s}=t,a=$n(e,r,s),c=[...new C(o,{startRow:n.firstRow,endRow:n.lastRow,startColumn:n.firstColumn,endColumn:n.lastColumn,includeAllSlots:!0})],d=[];let u;for(const f of c){const{row:p,column:w}=f;w===n.firstColumn&&(u=f.getPositionBefore());const v=p-n.firstRow,A=w-n.firstColumn,U=a[v%s][A%r],q=U?l.cloneElement(U):null,G=this._replaceTableSlotCell(f,q,u,l);G&&(ft(G,p,w,n.lastRow,n.lastColumn,l),d.push(G),u=l.createPositionAfter(G))}const h=parseInt(o.getAttribute("headingRows")||"0"),b=parseInt(o.getAttribute("headingColumns")||"0"),g=n.firstRow<h&&h<=n.lastRow,m=n.firstColumn<b&&b<=n.lastColumn;if(g){const f={first:n.firstColumn,last:n.lastColumn},p=Ee(o,h,f,l,n.firstRow);d.push(...p)}if(m){const f={first:n.firstRow,last:n.lastRow},p=ze(o,b,f,l);d.push(...p)}return d}_replaceTableSlotCell(e,t,o,n){const{cell:l,isAnchor:r}=e;return r&&n.remove(l),t?(n.insert(t,o),t):null}getTableIfOnlyTableInContent(e,t){if(!e.is("documentFragment")&&!e.is("element"))return null;if(e.is("element","table"))return e;if(e.childCount==1&&e.getChild(0).is("element","table"))return e.getChild(0);const o=t.createRangeIn(e);for(const n of o.getItems())if(n.is("element","table")){const l=t.createRange(o.start,t.createPositionBefore(n));if(t.hasContent(l,{ignoreWhitespaces:!0}))return null;const r=t.createRange(t.createPositionAfter(n),o.end);return t.hasContent(r,{ignoreWhitespaces:!0})?null:n}return null}}function Un(i,e,t,o){const n=i[0].findAncestor("table"),l=o.getColumnIndexes(i),r=o.getRowIndexes(i),s={firstColumn:l.first,lastColumn:l.last,firstRow:r.first,lastRow:r.last},a=i.length===1;return a&&(s.lastRow+=e.height-1,s.lastColumn+=e.width-1,Gn(n,s.lastRow+1,s.lastColumn+1,o)),a||!o.isSelectionRectangular(i)?jn(n,s,t):(s.lastRow=pt(n,s),s.lastColumn=wt(n,s)),s}function Gn(i,e,t,o){const n=o.getColumns(i),l=o.getRows(i);t>n&&o.insertColumns(i,{at:n,columns:t-n}),e>l&&o.insertRows(i,{at:l,rows:e-l})}function $n(i,e,t){const o=new Array(t).fill(null).map(()=>new Array(e).fill(null));for(const{column:n,row:l,cell:r}of new C(i))o[l][n]=r;return o}function jn(i,e,t){const{firstRow:o,lastRow:n,firstColumn:l,lastColumn:r}=e,s={first:o,last:n},a={first:l,last:r};ze(i,l,s,t),ze(i,r+1,s,t),Ee(i,o,a,t),Ee(i,n+1,a,t,o)}function Ee(i,e,t,o,n=0){return e<1?void 0:ht(i,e,n).filter(({column:s,cellWidth:a})=>Pt(s,a,t)).map(({cell:s})=>mt(s,e,o))}function ze(i,e,t,o){return e<1?void 0:bt(i,e).filter(({row:r,cellHeight:s})=>Pt(r,s,t)).map(({cell:r,column:s})=>gt(r,s,e,o))}function Pt(i,e,t){const o=i+e-1,{first:n,last:l}=t,r=i>=n&&i<=l,s=i<n&&o>=n;return r||s}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class Et extends k{static get pluginName(){return"TableKeyboard"}static get isOfficialPlugin(){return!0}static get requires(){return[W,T]}init(){const e=this.editor,o=e.editing.view.document,n=e.t;this.listenTo(o,"arrowKey",(...l)=>this._onArrowKey(...l),{context:"table"}),this.listenTo(o,"tab",(...l)=>this._handleTabOnSelectedTable(...l),{context:"figure"}),this.listenTo(o,"tab",(...l)=>this._handleTab(...l),{context:["th","td"]}),e.accessibility.addKeystrokeInfoGroup({id:"table",label:n("Keystrokes that can be used in a table cell"),keystrokes:[{label:n("Move the selection to the next cell"),keystroke:"Tab"},{label:n("Move the selection to the previous cell"),keystroke:"Shift+Tab"},{label:n("Insert a new table row (when in the last cell of a table)"),keystroke:"Tab"},{label:n("Navigate through the table"),keystroke:[["arrowup"],["arrowright"],["arrowdown"],["arrowleft"]]}]})}_handleTabOnSelectedTable(e,t){const o=this.editor,l=o.model.document.selection.getSelectedElement();!l||!l.is("element","table")||(t.preventDefault(),t.stopPropagation(),e.stop(),o.model.change(r=>{r.setSelection(r.createRangeIn(l.getChild(0).getChild(0)))}))}_handleTab(e,t){const o=this.editor,n=this.editor.plugins.get(T),l=this.editor.plugins.get("TableSelection"),r=o.model.document.selection,s=!t.shiftKey;let a=n.getTableCellsContainingSelection(r)[0];if(a||(a=l.getFocusCell()),!a)return;t.preventDefault(),t.stopPropagation(),e.stop();const c=a.parent,d=c.parent,u=d.getChildIndex(c),h=c.getChildIndex(a),b=h===0;if(!s&&b&&u===0){o.model.change(p=>{p.setSelection(p.createRangeOn(d))});return}const g=h===c.childCount-1,m=u===n.getRows(d)-1;if(s&&m&&g&&(o.execute("insertTableRowBelow"),u===n.getRows(d)-1)){o.model.change(p=>{p.setSelection(p.createRangeOn(d))});return}let f;if(s&&g)f=d.getChild(u+1).getChild(0);else if(!s&&b){const p=d.getChild(u-1);f=p.getChild(p.childCount-1)}else f=c.getChild(h+(s?1:-1));o.model.change(p=>{p.setSelection(p.createRangeIn(f))})}_onArrowKey(e,t){const o=this.editor,n=t.keyCode,l=fo(n,o.locale.contentLanguageDirection);this._handleArrowKeys(l,t.shiftKey)&&(t.preventDefault(),t.stopPropagation(),e.stop())}_handleArrowKeys(e,t){const o=this.editor.plugins.get(T),n=this.editor.plugins.get("TableSelection"),l=this.editor.model,r=l.document.selection,s=["right","down"].includes(e),a=o.getSelectedTableCells(r);if(a.length){let d;return t?d=n.getFocusCell():d=s?a[a.length-1]:a[0],this._navigateFromCellInDirection(d,e,t),!0}const c=r.focus.findAncestor("tableCell");/* istanbul ignore if: paranoid check -- @preserve */if(!c)return!1;if(!r.isCollapsed)if(t){if(r.isBackward==s&&!r.containsEntireContent(c))return!1}else{const d=r.getSelectedElement();if(!d||!l.schema.isObject(d))return!1}return this._isSelectionAtCellEdge(r,c,s)?(this._navigateFromCellInDirection(c,e,t),!0):!1}_isSelectionAtCellEdge(e,t,o){const n=this.editor.model,l=this.editor.model.schema,r=o?e.getLastPosition():e.getFirstPosition();if(!l.getLimitElement(r).is("element","tableCell"))return n.createPositionAt(t,o?"end":0).isTouching(r);const s=n.createSelection(r);return n.modifySelection(s,{direction:o?"forward":"backward"}),r.isEqual(s.focus)}_navigateFromCellInDirection(e,t,o=!1){const n=this.editor.model,l=e.findAncestor("table"),r=[...new C(l,{includeAllSlots:!0})],{row:s,column:a}=r[r.length-1],c=r.find(({cell:w})=>w==e);let{row:d,column:u}=c;switch(t){case"left":u--;break;case"up":d--;break;case"right":u+=c.cellWidth;break;case"down":d+=c.cellHeight;break}const h=d<0||d>s,b=u<0&&d<=0,g=u>a&&d>=s;if(h||b||g){n.change(w=>{w.setSelection(w.createRangeOn(l))});return}u<0?(u=o?0:a,d--):u>a&&(u=o?a:0,d++);const m=r.find(w=>w.row==d&&w.column==u).cell,f=["right","down"].includes(t),p=this.editor.plugins.get("TableSelection");if(o&&p.isEnabled){const w=p.getAnchorCell()||e;p.setCellSelection(w,m)}else{const w=n.createPositionAt(m,f?0:"end");n.change(v=>{v.setSelection(w)})}}}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class zt extends Ao{constructor(){super(...arguments),this.domEventType=["mousemove","mouseleave"]}onDomEvent(e){this.fire(e.type,e)}}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class Bt extends k{static get pluginName(){return"TableMouse"}static get isOfficialPlugin(){return!0}static get requires(){return[W,T]}init(){this.editor.editing.view.addObserver(zt),this._enableShiftClickSelection(),this._enableMouseDragSelection()}_enableShiftClickSelection(){const e=this.editor,t=e.plugins.get(T);let o=!1;const n=e.plugins.get(W);this.listenTo(e.editing.view.document,"mousedown",(l,r)=>{const s=e.model.document.selection;if(!this.isEnabled||!n.isEnabled||!r.domEvent.shiftKey)return;const a=n.getAnchorCell()||t.getTableCellsContainingSelection(s)[0];if(!a)return;const c=this._getModelTableCellFromDomEvent(r);c&&Wt(a,c)&&(o=!0,n.setCellSelection(a,c),r.preventDefault())}),this.listenTo(e.editing.view.document,"mouseup",()=>{o=!1}),this.listenTo(e.editing.view.document,"selectionChange",l=>{o&&l.stop()},{priority:"highest"})}_enableMouseDragSelection(){const e=this.editor;let t,o,n=!1,l=!1;const r=e.plugins.get(W);this.listenTo(e.editing.view.document,"mousedown",(s,a)=>{!this.isEnabled||!r.isEnabled||a.domEvent.shiftKey||a.domEvent.ctrlKey||a.domEvent.altKey||(t=this._getModelTableCellFromDomEvent(a))}),this.listenTo(e.editing.view.document,"mousemove",(s,a)=>{if(!a.domEvent.buttons||!t)return;const c=this._getModelTableCellFromDomEvent(a);c&&Wt(t,c)&&(o=c,!n&&o!=t&&(n=!0)),n&&(l=!0,r.setCellSelection(t,o),a.preventDefault())}),this.listenTo(e.editing.view.document,"mouseup",()=>{n=!1,l=!1,t=null,o=null}),this.listenTo(e.editing.view.document,"selectionChange",s=>{l&&s.stop()},{priority:"highest"})}_getModelTableCellFromDomEvent(e){const t=e.target,o=this.editor.editing.view.createPositionAt(t,0);return this.editor.editing.mapper.toModelPosition(o).parent.findAncestor("tableCell",{includeSelf:!0})}}function Wt(i,e){return i.parent.parent==e.parent.parent}I(".ck-content .table{display:table;margin:.9em auto}.ck-content .table table{border:1px double #b3b3b3;border-collapse:collapse;border-spacing:0;height:100%;width:100%}.ck-content .table table td,.ck-content .table table th{border:1px solid #bfbfbf;min-width:2em;padding:.4em}.ck-content .table table th{background:rgba(0,0,0,.05);font-weight:700}@media print{.ck-content .table table{height:auto}}.ck-content[dir=rtl] .table th{text-align:right}.ck-content[dir=ltr] .table th{text-align:left}.ck-editor__editable .ck-table-bogus-paragraph{display:inline-block;width:100%}");/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class Lt extends k{static get requires(){return[j,Vt,W,Bt,Et,It,bo]}static get pluginName(){return"Table"}static get isOfficialPlugin(){return!0}}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class qn extends k{static get pluginName(){return"PlainTableOutput"}static get isOfficialPlugin(){return!0}static get requires(){return[Lt]}init(){const e=this.editor;e.conversion.for("dataDowncast").elementToStructure({model:"table",view:Kn,converterPriority:"high"}),e.plugins.has("TableCaption")&&e.conversion.for("dataDowncast").elementToElement({model:"caption",view:(t,{writer:o})=>{if(t.parent.name==="table")return o.createContainerElement("caption")},converterPriority:"high"}),e.plugins.has("TableProperties")&&Xn(e)}}function Kn(i,{writer:e}){const t=i.getAttribute("headingRows")||0,o=e.createSlot(c=>c.is("element","tableRow")&&c.index<t),n=e.createSlot(c=>c.is("element","tableRow")&&c.index>=t),l=e.createSlot(c=>!c.is("element","tableRow")),r=e.createContainerElement("thead",null,o),s=e.createContainerElement("tbody",null,n),a=[];return t&&a.push(r),t<i.childCount&&a.push(s),e.createContainerElement("table",null,[l,...a])}function Xn(i){const e={"border-width":"tableBorderWidth","border-color":"tableBorderColor","border-style":"tableBorderStyle","background-color":"tableBackgroundColor"};for(const[t,o]of Object.entries(e))i.conversion.for("dataDowncast").add(n=>n.on(`attribute:${o}:table`,(l,r,s)=>{const{item:a,attributeNewValue:c}=r,{mapper:d,writer:u}=s;if(!s.consumable.consume(a,l.name))return;const h=d.toViewElement(a);c?u.setStyle(t,c,h):u.removeStyle(t,h)},{priority:"high"}))}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/function Nt(i){const e=Ft(i);return e||de(i)}function Ft(i){const e=i.getSelectedElement();return e&&Mt(e)?e:null}function de(i){const e=i.getFirstPosition();if(!e)return null;let t=e.parent;for(;t;){if(t.is("element")&&Mt(t))return t;t=t.parent}return null}function Mt(i){return!!i.getCustomProperty("table")&&go(i)}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class Jn extends k{static get requires(){return[De]}static get pluginName(){return"TableToolbar"}static get isOfficialPlugin(){return!0}afterInit(){const e=this.editor,t=e.t,o=e.plugins.get(De),n=e.config.get("table.contentToolbar"),l=e.config.get("table.tableToolbar");n&&o.register("tableContent",{ariaLabel:t("Table toolbar"),items:n,getRelatedElement:de}),l&&o.register("table",{ariaLabel:t("Table toolbar"),items:l,getRelatedElement:Ft})}}I(".ck.ck-input-color{display:flex;flex-direction:row-reverse;width:100%}.ck.ck-input-color>input.ck.ck-input-text{flex-grow:1;min-width:auto}.ck.ck-input-color>div.ck.ck-dropdown{min-width:auto}.ck.ck-input-color>div.ck.ck-dropdown>.ck-input-color__button .ck-dropdown__arrow{display:none}.ck.ck-input-color .ck.ck-input-color__button{display:flex}.ck.ck-input-color .ck.ck-input-color__button .ck.ck-input-color__button__preview{overflow:hidden;position:relative}.ck.ck-input-color .ck.ck-input-color__button .ck.ck-input-color__button__preview>.ck.ck-input-color__button__preview__no-color-indicator{display:block;position:absolute}[dir=ltr] .ck.ck-input-color>.ck.ck-input-text{border-bottom-right-radius:0;border-top-right-radius:0}[dir=rtl] .ck.ck-input-color>.ck.ck-input-text{border-bottom-left-radius:0;border-top-left-radius:0}.ck.ck-input-color>.ck.ck-input-text:focus{z-index:0}.ck.ck-input-color>.ck.ck-dropdown>.ck.ck-button.ck-input-color__button{padding:0}[dir=ltr] .ck.ck-input-color>.ck.ck-dropdown>.ck.ck-button.ck-input-color__button{border-bottom-left-radius:0;border-top-left-radius:0}[dir=ltr] .ck.ck-input-color>.ck.ck-dropdown>.ck.ck-button.ck-input-color__button:not(:focus){border-left:1px solid transparent}[dir=rtl] .ck.ck-input-color>.ck.ck-dropdown>.ck.ck-button.ck-input-color__button{border-bottom-right-radius:0;border-top-right-radius:0}[dir=rtl] .ck.ck-input-color>.ck.ck-dropdown>.ck.ck-button.ck-input-color__button:not(:focus){border-right:1px solid transparent}.ck.ck-input-color>.ck.ck-dropdown>.ck.ck-button.ck-input-color__button.ck-disabled{background:var(--ck-color-input-disabled-background)}.ck.ck-input-color>.ck.ck-dropdown>.ck.ck-button.ck-input-color__button>.ck.ck-input-color__button__preview{border:1px solid var(--ck-color-input-border);border-radius:0;height:20px;width:20px}.ck-rounded-corners .ck.ck-input-color>.ck.ck-dropdown>.ck.ck-button.ck-input-color__button>.ck.ck-input-color__button__preview,.ck.ck-input-color>.ck.ck-dropdown>.ck.ck-button.ck-input-color__button>.ck.ck-input-color__button__preview.ck-rounded-corners{border-radius:var(--ck-border-radius)}.ck.ck-input-color>.ck.ck-dropdown>.ck.ck-button.ck-input-color__button>.ck.ck-input-color__button__preview>.ck.ck-input-color__button__preview__no-color-indicator{background:red;border-radius:2px;height:150%;left:50%;top:-30%;transform:rotate(45deg);transform-origin:50%;width:8%}.ck.ck-input-color .ck.ck-input-color__remove-color{border-bottom-left-radius:0;border-bottom-right-radius:0;padding:calc(var(--ck-spacing-standard)/2) var(--ck-spacing-standard);width:100%}.ck.ck-input-color .ck.ck-input-color__remove-color:not(:focus){border-bottom:1px solid var(--ck-color-input-border)}[dir=ltr] .ck.ck-input-color .ck.ck-input-color__remove-color{border-top-right-radius:0}[dir=rtl] .ck.ck-input-color .ck.ck-input-color__remove-color{border-top-left-radius:0}.ck.ck-input-color .ck.ck-input-color__remove-color .ck.ck-icon{margin-right:var(--ck-spacing-standard)}[dir=rtl] .ck.ck-input-color .ck.ck-input-color__remove-color .ck.ck-icon{margin-left:var(--ck-spacing-standard);margin-right:0}");/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class Yn extends z{constructor(e,t){super(e),this.set("value",""),this.set("isReadOnly",!1),this.set("isFocused",!1),this.set("isEmpty",!0),this.options=t,this.focusTracker=new te,this._focusables=new pe,this.dropdownView=this._createDropdownView(),this.inputView=this._createInputTextView(),this.keystrokes=new ee,this._stillTyping=!1,this.focusCycler=new we({focusables:this._focusables,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"shift + tab",focusNext:"tab"}}),this.setTemplate({tag:"div",attributes:{class:["ck","ck-input-color"]},children:[this.dropdownView,this.inputView]}),this.on("change:value",(o,n,l)=>this._setInputValue(l))}render(){super.render(),[this.inputView,this.dropdownView.buttonView].forEach(e=>{this.focusTracker.add(e.element),this._focusables.add(e)}),this.keystrokes.listenTo(this.element)}focus(e){e===-1?this.focusCycler.focusLast():this.focusCycler.focusFirst()}destroy(){super.destroy(),this.focusTracker.destroy(),this.keystrokes.destroy()}_createDropdownView(){const e=this.locale,t=e.t,o=this.bindTemplate,n=this._createColorSelector(e),l=oe(e),r=new z;return r.setTemplate({tag:"span",attributes:{class:["ck","ck-input-color__button__preview"],style:{backgroundColor:o.to("value")}},children:[{tag:"span",attributes:{class:["ck","ck-input-color__button__preview__no-color-indicator",o.if("value","ck-hidden",s=>s!="")]}}]}),l.buttonView.extendTemplate({attributes:{class:"ck-input-color__button"}}),l.buttonView.children.add(r),l.buttonView.label=t("Color picker"),l.buttonView.tooltip=!0,l.panelPosition=e.uiLanguageDirection==="rtl"?"se":"sw",l.panelView.children.add(n),l.bind("isEnabled").to(this,"isReadOnly",s=>!s),l.on("change:isOpen",(s,a,c)=>{c&&(n.updateSelectedColors(),n.showColorGridsFragment())}),l}_createInputTextView(){const e=this.locale,t=new vo(e);return t.extendTemplate({on:{blur:t.bindTemplate.to("blur")}}),t.value=this.value,t.bind("isReadOnly","hasError").to(this),this.bind("isFocused","isEmpty").to(t),t.on("input",()=>{const o=t.element.value,n=this.options.colorDefinitions.find(l=>o===l.label);this._stillTyping=!0,this.value=n&&n.color||o}),t.on("blur",()=>{this._stillTyping=!1,this._setInputValue(t.element.value)}),t.delegate("input").to(this),t}_createColorSelector(e){const t=e.t,o=this.options.defaultColorValue||"",n=t(o?"Restore default":"Remove color"),l=new To(e,{colors:this.options.colorDefinitions,columns:this.options.columns,removeButtonLabel:n,colorPickerLabel:t("Color picker"),colorPickerViewConfig:this.options.colorPickerConfig===!1?!1:{...this.options.colorPickerConfig,hideInput:!0}});l.appendUI(),l.on("execute",(s,a)=>{if(a.source==="colorPickerSaveButton"){this.dropdownView.isOpen=!1;return}this.value=a.value||o,this.fire("input"),a.source!=="colorPicker"&&(this.dropdownView.isOpen=!1)});let r=this.value;return l.on("colorPicker:cancel",()=>{this.value=r,this.fire("input"),this.dropdownView.isOpen=!1}),l.colorGridsFragmentView.colorPickerButtonView.on("execute",()=>{r=this.value}),l.bind("selectedColor").to(this,"value"),l}_setInputValue(e){if(!this._stillTyping){const t=Ht(e),o=this.options.colorDefinitions.find(n=>t===Ht(n.color));o?this.inputView.value=o.label:this.inputView.value=e||""}}}function Ht(i){return i.replace(/([(,])\s+/g,"$1").replace(/^\s+|\s+(?=[),\s]|$)/g,"").replace(/,|\s/g," ")}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/const Be=i=>i==="";function We(i){return{none:i("None"),solid:i("Solid"),dotted:i("Dotted"),dashed:i("Dashed"),double:i("Double"),groove:i("Groove"),ridge:i("Ridge"),inset:i("Inset"),outset:i("Outset")}}function Ot(i){return i('The color is invalid. Try "#FF0000" or "rgb(255,0,0)" or "red".')}function Dt(i){return i('The value is invalid. Try "10px" or "2em" or simply "2".')}function ue(i){return i=i.trim().toLowerCase(),Be(i)||So(i)}function Q(i){return i=i.trim(),Be(i)||$t(i)||Qe(i)||xo(i)}function Ut(i){return i=i.trim(),Be(i)||$t(i)||Qe(i)}function Gt(i,e){const t=new $e,o=We(i.t);for(const n in o){const l={type:"button",model:new qe({_borderStyleValue:n,label:o[n],role:"menuitemradio",withText:!0})};n==="none"?l.model.bind("isOn").to(i,"borderStyle",r=>e==="none"?!r:r===n):l.model.bind("isOn").to(i,"borderStyle",r=>r===n),t.add(l)}return t}function Le(i){const{view:e,icons:t,toolbar:o,labels:n,propertyName:l,nameToValue:r,defaultValue:s}=i;for(const a in n){const c=new P(e.locale);c.set({label:n[a],icon:t[a],tooltip:n[a]});const d=r?r(a):a;c.bind("isOn").to(e,l,u=>{let h=u;return u===""&&s&&(h=s),d===h}),c.on("execute",()=>{e[l]=d}),o.items.add(c)}}const he=[{color:"hsl(0, 0%, 0%)",label:"Black"},{color:"hsl(0, 0%, 30%)",label:"Dim grey"},{color:"hsl(0, 0%, 60%)",label:"Grey"},{color:"hsl(0, 0%, 90%)",label:"Light grey"},{color:"hsl(0, 0%, 100%)",label:"White",hasBorder:!0},{color:"hsl(0, 75%, 60%)",label:"Red"},{color:"hsl(30, 75%, 60%)",label:"Orange"},{color:"hsl(60, 75%, 60%)",label:"Yellow"},{color:"hsl(90, 75%, 60%)",label:"Light green"},{color:"hsl(120, 75%, 60%)",label:"Green"},{color:"hsl(150, 75%, 60%)",label:"Aquamarine"},{color:"hsl(180, 75%, 60%)",label:"Turquoise"},{color:"hsl(210, 75%, 60%)",label:"Light blue"},{color:"hsl(240, 75%, 60%)",label:"Blue"},{color:"hsl(270, 75%, 60%)",label:"Purple"}];function me(i){return(e,t,o)=>{const n=new Yn(e.locale,{colorDefinitions:Qn(i.colorConfig),columns:i.columns,defaultColorValue:i.defaultColorValue,colorPickerConfig:i.colorPickerConfig});return n.inputView.set({id:t,ariaDescribedById:o}),n.bind("isReadOnly").to(e,"isEnabled",l=>!l),n.bind("hasError").to(e,"errorText",l=>!!l),n.on("input",()=>{e.errorText=null}),e.bind("isEmpty","isFocused").to(n),n}}function $t(i){const e=parseFloat(i);return!Number.isNaN(e)&&i===String(e)}function Qn(i){return i.map(e=>({color:e.model,label:e.label,options:{hasBorder:e.hasBorder}}))}I(".ck.ck-form__row{display:flex;flex-direction:row;flex-wrap:nowrap;justify-content:space-between}.ck.ck-form__row>:not(.ck-label){flex-grow:1}.ck.ck-form__row.ck-table-form__action-row .ck-button-cancel,.ck.ck-form__row.ck-table-form__action-row .ck-button-save{justify-content:center}.ck.ck-form__row{padding:var(--ck-spacing-standard) var(--ck-spacing-large) 0}[dir=ltr] .ck.ck-form__row>:not(.ck-label)+*{margin-left:var(--ck-spacing-large)}[dir=rtl] .ck.ck-form__row>:not(.ck-label)+*{margin-right:var(--ck-spacing-large)}.ck.ck-form__row>.ck-label{min-width:100%;width:100%}.ck.ck-form__row.ck-table-form__action-row{margin-top:var(--ck-spacing-large)}.ck.ck-form__row.ck-table-form__action-row .ck-button .ck-button__label{color:var(--ck-color-text)}");/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class V extends z{constructor(e,t={}){super(e);const o=this.bindTemplate;this.set("class",t.class||null),this.children=this.createCollection(),t.children&&t.children.forEach(n=>this.children.add(n)),this.set("_role",null),this.set("_ariaLabelledBy",null),t.labelView&&this.set({_role:"group",_ariaLabelledBy:t.labelView.id}),this.setTemplate({tag:"div",attributes:{class:["ck","ck-form__row",o.to("class")],role:o.to("_role"),"aria-labelledby":o.to("_ariaLabelledBy")},children:this.children})}}I(".ck.ck-form{padding:0 0 var(--ck-spacing-large)}.ck.ck-form:focus{outline:none}.ck.ck-form .ck.ck-input-text{min-width:100%;width:0}.ck.ck-form .ck.ck-dropdown{min-width:100%}.ck.ck-form .ck.ck-dropdown .ck-dropdown__button:not(:focus){border:1px solid var(--ck-color-base-border)}.ck.ck-form .ck.ck-dropdown .ck-dropdown__button .ck-button__label{width:100%}"),I('.ck.ck-table-form .ck-form__row.ck-table-form__background-row,.ck.ck-table-form .ck-form__row.ck-table-form__border-row{flex-wrap:wrap}.ck.ck-table-form .ck-form__row.ck-table-form__dimensions-row{align-items:center;flex-wrap:wrap}.ck.ck-table-form .ck-form__row.ck-table-form__dimensions-row .ck-labeled-field-view{align-items:center;display:flex;flex-direction:column-reverse}.ck.ck-table-form .ck-form__row.ck-table-form__dimensions-row .ck-labeled-field-view .ck.ck-dropdown,.ck.ck-table-form .ck-form__row.ck-table-form__dimensions-row .ck-table-form__dimension-operator{flex-grow:0}.ck.ck-table-form .ck.ck-labeled-field-view{position:relative}.ck.ck-table-form .ck.ck-labeled-field-view .ck.ck-labeled-field-view__status{bottom:calc(var(--ck-table-properties-error-arrow-size)*-1);left:50%;position:absolute;transform:translate(-50%,100%);z-index:1}.ck.ck-table-form .ck.ck-labeled-field-view .ck.ck-labeled-field-view__status:after{content:"";left:50%;position:absolute;top:calc(var(--ck-table-properties-error-arrow-size)*-1);transform:translateX(-50%)}:root{--ck-table-properties-error-arrow-size:6px;--ck-table-properties-min-error-width:150px}.ck.ck-table-form .ck-form__row.ck-table-form__border-row .ck-labeled-field-view>.ck-label{font-size:var(--ck-font-size-tiny);text-align:center}.ck.ck-table-form .ck-form__row.ck-table-form__border-row .ck-table-form__border-style,.ck.ck-table-form .ck-form__row.ck-table-form__border-row .ck-table-form__border-width{max-width:80px;min-width:80px;width:80px}.ck.ck-table-form .ck-form__row.ck-table-form__dimensions-row{padding:0}.ck.ck-table-form .ck-form__row.ck-table-form__dimensions-row .ck-table-form__dimensions-row__height,.ck.ck-table-form .ck-form__row.ck-table-form__dimensions-row .ck-table-form__dimensions-row__width{margin:0}.ck.ck-table-form .ck-form__row.ck-table-form__dimensions-row .ck-table-form__dimension-operator{align-self:flex-end;display:inline-block;height:var(--ck-ui-component-min-height);line-height:var(--ck-ui-component-min-height);margin:0 var(--ck-spacing-small)}.ck.ck-table-form .ck.ck-labeled-field-view{padding-top:var(--ck-spacing-standard)}.ck.ck-table-form .ck.ck-labeled-field-view .ck.ck-labeled-field-view__status{animation:ck-table-form-labeled-view-status-appear .15s ease both;background:var(--ck-color-base-error);border-radius:0;color:var(--ck-color-base-background);min-width:var(--ck-table-properties-min-error-width);padding:var(--ck-spacing-small) var(--ck-spacing-medium);text-align:center}.ck-rounded-corners .ck.ck-table-form .ck.ck-labeled-field-view .ck.ck-labeled-field-view__status,.ck.ck-table-form .ck.ck-labeled-field-view .ck.ck-labeled-field-view__status.ck-rounded-corners{border-radius:var(--ck-border-radius)}.ck.ck-table-form .ck.ck-labeled-field-view .ck.ck-labeled-field-view__status:after{border-color:transparent transparent var(--ck-color-base-error) transparent;border-style:solid;border-width:0 var(--ck-table-properties-error-arrow-size) var(--ck-table-properties-error-arrow-size) var(--ck-table-properties-error-arrow-size)}@media (prefers-reduced-motion:reduce){.ck.ck-table-form .ck.ck-labeled-field-view .ck.ck-labeled-field-view__status{animation:none}}.ck.ck-table-form .ck.ck-labeled-field-view .ck-input.ck-error:not(:focus)+.ck.ck-labeled-field-view__status{display:none}@keyframes ck-table-form-labeled-view-status-appear{0%{opacity:0}to{opacity:1}}'),I(".ck.ck-table-cell-properties-form .ck-form__row.ck-table-cell-properties-form__alignment-row{flex-wrap:wrap}.ck.ck-table-cell-properties-form .ck-form__row.ck-table-cell-properties-form__alignment-row .ck.ck-toolbar:first-of-type{flex-grow:0.57}.ck.ck-table-cell-properties-form .ck-form__row.ck-table-cell-properties-form__alignment-row .ck.ck-toolbar:last-of-type{flex-grow:0.43}.ck.ck-table-cell-properties-form .ck-form__row.ck-table-cell-properties-form__alignment-row .ck.ck-toolbar .ck-button{flex-grow:1}.ck.ck-table-cell-properties-form{width:320px}.ck.ck-table-cell-properties-form .ck-form__row.ck-table-cell-properties-form__padding-row{align-self:flex-end;padding:0;width:25%}.ck.ck-table-cell-properties-form .ck-form__row.ck-table-cell-properties-form__alignment-row .ck.ck-toolbar{background:none;margin-top:var(--ck-spacing-standard)}");/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class Zn extends z{constructor(e,t){super(e),this.set({borderStyle:"",borderWidth:"",borderColor:"",padding:"",backgroundColor:"",width:"",height:"",horizontalAlignment:"",verticalAlignment:""}),this.options=t;const{borderStyleDropdown:o,borderWidthInput:n,borderColorInput:l,borderRowLabel:r}=this._createBorderFields(),{backgroundRowLabel:s,backgroundInput:a}=this._createBackgroundFields(),{widthInput:c,operatorLabel:d,heightInput:u,dimensionsLabel:h}=this._createDimensionFields(),{horizontalAlignmentToolbar:b,verticalAlignmentToolbar:g,alignmentLabel:m}=this._createAlignmentFields();this.focusTracker=new te,this.keystrokes=new ee,this.children=this.createCollection(),this.borderStyleDropdown=o,this.borderWidthInput=n,this.borderColorInput=l,this.backgroundInput=a,this.paddingInput=this._createPaddingField(),this.widthInput=c,this.heightInput=u,this.horizontalAlignmentToolbar=b,this.verticalAlignmentToolbar=g;const{saveButtonView:f,cancelButtonView:p}=this._createActionButtons();this.saveButtonView=f,this.cancelButtonView=p,this._focusables=new pe,this._focusCycler=new we({focusables:this._focusables,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"shift + tab",focusNext:"tab"}}),this.children.add(new Ke(e,{label:this.t("Cell properties")})),this.children.add(new V(e,{labelView:r,children:[r,o,l,n],class:"ck-table-form__border-row"})),this.children.add(new V(e,{labelView:s,children:[s,a],class:"ck-table-form__background-row"})),this.children.add(new V(e,{children:[new V(e,{labelView:h,children:[h,c,d,u],class:"ck-table-form__dimensions-row"}),new V(e,{children:[this.paddingInput],class:"ck-table-cell-properties-form__padding-row"})]})),this.children.add(new V(e,{labelView:m,children:[m,b,g],class:"ck-table-cell-properties-form__alignment-row"})),this.children.add(new V(e,{children:[this.saveButtonView,this.cancelButtonView],class:"ck-table-form__action-row"})),this.setTemplate({tag:"form",attributes:{class:["ck","ck-form","ck-table-form","ck-table-cell-properties-form"],tabindex:"-1"},children:this.children})}render(){super.render(),Xe({view:this}),[this.borderColorInput,this.backgroundInput].forEach(e=>{this._focusCycler.chain(e.fieldView.focusCycler)}),[this.borderStyleDropdown,this.borderColorInput,this.borderWidthInput,this.backgroundInput,this.widthInput,this.heightInput,this.paddingInput,this.horizontalAlignmentToolbar,this.verticalAlignmentToolbar,this.saveButtonView,this.cancelButtonView].forEach(e=>{this._focusables.add(e),this.focusTracker.add(e.element)}),this.keystrokes.listenTo(this.element)}destroy(){super.destroy(),this.focusTracker.destroy(),this.keystrokes.destroy()}focus(){this._focusCycler.focusFirst()}_createBorderFields(){const e=this.options.defaultTableCellProperties,t={style:e.borderStyle,width:e.borderWidth,color:e.borderColor},o=me({colorConfig:this.options.borderColors,columns:5,defaultColorValue:t.color,colorPickerConfig:this.options.colorPickerConfig}),n=this.locale,l=this.t,r=l("Style"),s=new B(n);s.text=l("Border");const a=We(l),c=new R(n,Je);c.set({label:r,class:"ck-table-form__border-style"}),c.fieldView.buttonView.set({ariaLabel:r,ariaLabelledBy:void 0,isOn:!1,withText:!0,tooltip:r}),c.fieldView.buttonView.bind("label").to(this,"borderStyle",h=>a[h||"none"]),c.fieldView.on("execute",h=>{this.borderStyle=h.source._borderStyleValue}),c.bind("isEmpty").to(this,"borderStyle",h=>!h),fe(c.fieldView,Gt(this,t.style),{role:"menu",ariaLabel:r});const d=new R(n,L);d.set({label:l("Width"),class:"ck-table-form__border-width"}),d.fieldView.bind("value").to(this,"borderWidth"),d.bind("isEnabled").to(this,"borderStyle",be),d.fieldView.on("input",()=>{this.borderWidth=d.fieldView.element.value});const u=new R(n,o);return u.set({label:l("Color"),class:"ck-table-form__border-color"}),u.fieldView.bind("value").to(this,"borderColor"),u.bind("isEnabled").to(this,"borderStyle",be),u.fieldView.on("input",()=>{this.borderColor=u.fieldView.value}),this.on("change:borderStyle",(h,b,g,m)=>{be(g)||(this.borderColor="",this.borderWidth=""),be(m)||(this.borderColor=t.color,this.borderWidth=t.width)}),{borderRowLabel:s,borderStyleDropdown:c,borderColorInput:u,borderWidthInput:d}}_createBackgroundFields(){const e=this.locale,t=this.t,o=new B(e);o.text=t("Background");const n=me({colorConfig:this.options.backgroundColors,columns:5,defaultColorValue:this.options.defaultTableCellProperties.backgroundColor,colorPickerConfig:this.options.colorPickerConfig}),l=new R(e,n);return l.set({label:t("Color"),class:"ck-table-cell-properties-form__background"}),l.fieldView.bind("value").to(this,"backgroundColor"),l.fieldView.on("input",()=>{this.backgroundColor=l.fieldView.value}),{backgroundRowLabel:o,backgroundInput:l}}_createDimensionFields(){const e=this.locale,t=this.t,o=new B(e);o.text=t("Dimensions");const n=new R(e,L);n.set({label:t("Width"),class:"ck-table-form__dimensions-row__width"}),n.fieldView.bind("value").to(this,"width"),n.fieldView.on("input",()=>{this.width=n.fieldView.element.value});const l=new z(e);l.setTemplate({tag:"span",attributes:{class:["ck-table-form__dimension-operator"]},children:[{text:"\xD7"}]});const r=new R(e,L);return r.set({label:t("Height"),class:"ck-table-form__dimensions-row__height"}),r.fieldView.bind("value").to(this,"height"),r.fieldView.on("input",()=>{this.height=r.fieldView.element.value}),{dimensionsLabel:o,widthInput:n,operatorLabel:l,heightInput:r}}_createPaddingField(){const e=this.locale,t=this.t,o=new R(e,L);return o.set({label:t("Padding"),class:"ck-table-cell-properties-form__padding"}),o.fieldView.bind("value").to(this,"padding"),o.fieldView.on("input",()=>{this.padding=o.fieldView.element.value}),o}_createAlignmentFields(){const e=this.locale,t=this.t,o=new B(e),n={left:y.alignLeft,center:y.alignCenter,right:y.alignRight,justify:y.alignJustify,top:y.alignTop,middle:y.alignMiddle,bottom:y.alignBottom};o.text=t("Table cell text alignment");const l=new Ce(e),r=e.contentLanguageDirection==="rtl";l.set({isCompact:!0,ariaLabel:t("Horizontal text alignment toolbar")}),Le({view:this,icons:n,toolbar:l,labels:this._horizontalAlignmentLabels,propertyName:"horizontalAlignment",nameToValue:a=>{if(r){if(a==="left")return"right";if(a==="right")return"left"}return a},defaultValue:this.options.defaultTableCellProperties.horizontalAlignment});const s=new Ce(e);return s.set({isCompact:!0,ariaLabel:t("Vertical text alignment toolbar")}),Le({view:this,icons:n,toolbar:s,labels:this._verticalAlignmentLabels,propertyName:"verticalAlignment",defaultValue:this.options.defaultTableCellProperties.verticalAlignment}),{horizontalAlignmentToolbar:l,verticalAlignmentToolbar:s,alignmentLabel:o}}_createActionButtons(){const e=this.locale,t=this.t,o=new P(e),n=new P(e),l=[this.borderWidthInput,this.borderColorInput,this.backgroundInput,this.paddingInput];return o.set({label:t("Save"),icon:y.check,class:"ck-button-save",type:"submit",withText:!0}),o.bind("isEnabled").toMany(l,"errorText",(...r)=>r.every(s=>!s)),n.set({label:t("Cancel"),icon:y.cancel,class:"ck-button-cancel",withText:!0}),n.delegate("execute").to(this,"cancel"),{saveButtonView:o,cancelButtonView:n}}get _horizontalAlignmentLabels(){const e=this.locale,t=this.t,o=t("Align cell text to the left"),n=t("Align cell text to the center"),l=t("Align cell text to the right"),r=t("Justify cell text");return e.uiLanguageDirection==="rtl"?{right:l,center:n,left:o,justify:r}:{left:o,center:n,right:l,justify:r}}get _verticalAlignmentLabels(){const e=this.t;return{top:e("Align cell text to the top"),middle:e("Align cell text to the middle"),bottom:e("Align cell text to the bottom")}}}function be(i){return i!=="none"}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/const Ne=[N.defaultPositions.northArrowSouth,N.defaultPositions.northArrowSouthWest,N.defaultPositions.northArrowSouthEast,N.defaultPositions.southArrowNorth,N.defaultPositions.southArrowNorthWest,N.defaultPositions.southArrowNorthEast,N.defaultPositions.viewportStickyNorth];function jt(i,e){const t=i.plugins.get("ContextualBalloon"),o=i.editing.view.document.selection;let n;e==="cell"?de(o)&&(n=Kt(i)):Nt(o)&&(n=qt(i)),n&&t.updatePosition(n)}function qt(i){const e=i.model.document.selection,t=M(e),o=i.editing.mapper.toViewElement(t);return{target:i.editing.view.domConverter.mapViewToDom(o),positions:Ne}}function Kt(i){const e=i.editing.mapper,t=i.editing.view.domConverter,o=i.model.document.selection;if(o.rangeCount>1)return{target:()=>el(o.getRanges(),i),positions:Ne};const n=Xt(o.getFirstPosition()),l=e.toViewElement(n);return{target:t.mapViewToDom(l),positions:Ne}}function Xt(i){return i.nodeAfter&&i.nodeAfter.is("element","tableCell")?i.nodeAfter:i.findAncestor("tableCell")}function el(i,e){const t=e.editing.mapper,o=e.editing.view.domConverter,n=Array.from(i).map(l=>{const r=Xt(l.start),s=t.toViewElement(r);return new je(o.mapViewToDom(s))});return je.getBoundingRect(n)}var tl='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="m11.105 18-.17 1H2.5A1.5 1.5 0 0 1 1 17.5v-15A1.5 1.5 0 0 1 2.5 1h15A1.5 1.5 0 0 1 19 2.5v9.975l-.85-.124-.15-.302V8h-5v4h.021l-.172.351-1.916.28-.151.027c-.287.063-.54.182-.755.341L8 13v5h3.105zM2 12h5V8H2v4zm10-4H8v4h4V8zM2 2v5h5V2H2zm0 16h5v-5H2v5zM13 7h5V2h-5v5zM8 2v5h4V2H8z" opacity=".6"/><path d="m15.5 11.5 1.323 2.68 2.957.43-2.14 2.085.505 2.946L15.5 18.25l-2.645 1.39.505-2.945-2.14-2.086 2.957-.43L15.5 11.5zM13 6a1 1 0 0 1 1 1v3.172a2.047 2.047 0 0 0-.293.443l-.858 1.736-1.916.28-.151.027A1.976 1.976 0 0 0 9.315 14H7a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1h6zm-1 2H8v4h4V8z"/></svg>';/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */function H(i){if(!i||!Po(i))return i;const{top:e,right:t,bottom:o,left:n}=i;if(e==t&&t==o&&o==n)return e}function O(i,e){const t=parseFloat(i);return Number.isNaN(t)||String(t)!==String(i)?i:`${t}${e}`}function Jt(i,e={}){const t={borderStyle:"none",borderWidth:"",borderColor:"",backgroundColor:"",width:"",height:"",...i};return e.includeAlignmentProperty&&!t.alignment&&(t.alignment="center"),e.includePaddingProperty&&!t.padding&&(t.padding=""),e.includeVerticalAlignmentProperty&&!t.verticalAlignment&&(t.verticalAlignment="middle"),e.includeHorizontalAlignmentProperty&&!t.horizontalAlignment&&(t.horizontalAlignment=e.isRightToLeftContent?"right":"left"),t}function Yt(i,e){return Jt({borderStyle:"double",borderColor:"hsl(0, 0%, 70%)",borderWidth:"1px",...i},e)}function Fe(i,e){return Jt({borderStyle:"solid",borderColor:"hsl(0, 0%, 75%)",borderWidth:"1px",...i},e)}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/const ol=500,Qt={borderStyle:"tableCellBorderStyle",borderColor:"tableCellBorderColor",borderWidth:"tableCellBorderWidth",height:"tableCellHeight",width:"tableCellWidth",padding:"tableCellPadding",backgroundColor:"tableCellBackgroundColor",horizontalAlignment:"tableCellHorizontalAlignment",verticalAlignment:"tableCellVerticalAlignment"};class Zt extends k{static get requires(){return[ne]}static get pluginName(){return"TableCellPropertiesUI"}static get isOfficialPlugin(){return!0}constructor(e){super(e),e.config.define("table.tableCellProperties",{borderColors:he,backgroundColors:he})}init(){const e=this.editor,t=e.t;this._defaultTableCellProperties=Fe(e.config.get("table.tableCellProperties.defaultProperties"),{includeVerticalAlignmentProperty:!0,includeHorizontalAlignmentProperty:!0,includePaddingProperty:!0,isRightToLeftContent:e.locale.contentLanguageDirection==="rtl"}),this._balloon=e.plugins.get(ne),this.view=null,this._isReady=!1,e.ui.componentFactory.add("tableCellProperties",o=>{const n=new P(o);n.set({label:t("Cell properties"),icon:tl,tooltip:!0}),this.listenTo(n,"execute",()=>this._showView());const l=Object.values(Qt).map(r=>e.commands.get(r));return n.bind("isEnabled").toMany(l,"isEnabled",(...r)=>r.some(s=>s)),n})}destroy(){super.destroy(),this.view&&this.view.destroy()}_createPropertiesView(){const e=this.editor,t=e.config.get("table.tableCellProperties"),o=le(t.borderColors),n=ie(e.locale,o),l=le(t.backgroundColors),r=ie(e.locale,l),s=t.colorPicker!==!1,a=new Zn(e.locale,{borderColors:n,backgroundColors:r,defaultTableCellProperties:this._defaultTableCellProperties,colorPickerConfig:s?t.colorPicker||{}:!1}),c=e.t;a.render(),this.listenTo(a,"submit",()=>{this._hideView()}),this.listenTo(a,"cancel",()=>{this._undoStepBatch.operations.length&&e.execute("undo",this._undoStepBatch),this._hideView()}),a.keystrokes.set("Esc",(h,b)=>{this._hideView(),b()}),Ye({emitter:a,activator:()=>this._isViewInBalloon,contextElements:[this._balloon.view.element],callback:()=>this._hideView()});const d=Ot(c),u=Dt(c);return a.on("change:borderStyle",this._getPropertyChangeCallback("tableCellBorderStyle")),a.on("change:borderColor",this._getValidatedPropertyChangeCallback({viewField:a.borderColorInput,commandName:"tableCellBorderColor",errorText:d,validator:ue})),a.on("change:borderWidth",this._getValidatedPropertyChangeCallback({viewField:a.borderWidthInput,commandName:"tableCellBorderWidth",errorText:u,validator:Ut})),a.on("change:padding",this._getValidatedPropertyChangeCallback({viewField:a.paddingInput,commandName:"tableCellPadding",errorText:u,validator:Q})),a.on("change:width",this._getValidatedPropertyChangeCallback({viewField:a.widthInput,commandName:"tableCellWidth",errorText:u,validator:Q})),a.on("change:height",this._getValidatedPropertyChangeCallback({viewField:a.heightInput,commandName:"tableCellHeight",errorText:u,validator:Q})),a.on("change:backgroundColor",this._getValidatedPropertyChangeCallback({viewField:a.backgroundInput,commandName:"tableCellBackgroundColor",errorText:d,validator:ue})),a.on("change:horizontalAlignment",this._getPropertyChangeCallback("tableCellHorizontalAlignment")),a.on("change:verticalAlignment",this._getPropertyChangeCallback("tableCellVerticalAlignment")),a}_fillViewFormFromCommandValues(){const e=this.editor.commands,t=e.get("tableCellBorderStyle");Object.entries(Qt).map(([o,n])=>{const l=this._defaultTableCellProperties[o]||"";return[o,e.get(n).value||l]}).forEach(([o,n])=>{(o==="borderColor"||o==="borderWidth")&&t.value==="none"||this.view.set(o,n)}),this._isReady=!0}_showView(){const e=this.editor;this.view||(this.view=this._createPropertiesView()),this.listenTo(e.ui,"update",()=>{this._updateView()}),this._fillViewFormFromCommandValues(),this._balloon.add({view:this.view,position:Kt(e)}),this._undoStepBatch=e.model.createBatch(),this.view.focus()}_hideView(){const e=this.editor;this.stopListening(e.ui,"update"),this._isReady=!1,this.view.saveButtonView.focus(),this._balloon.remove(this.view),this.editor.editing.view.focus()}_updateView(){const e=this.editor,t=e.editing.view.document;de(t.selection)?this._isViewVisible&&jt(e,"cell"):this._hideView()}get _isViewVisible(){return!!this.view&&this._balloon.visibleView===this.view}get _isViewInBalloon(){return!!this.view&&this._balloon.hasView(this.view)}_getPropertyChangeCallback(e){return(t,o,n)=>{this._isReady&&this.editor.execute(e,{value:n,batch:this._undoStepBatch})}}_getValidatedPropertyChangeCallback(e){const{commandName:t,viewField:o,validator:n,errorText:l}=e,r=tt(()=>{o.errorText=l},ol);return(s,a,c)=>{r.cancel(),this._isReady&&(n(c)?(this.editor.execute(t,{value:c,batch:this._undoStepBatch}),o.errorText=null):r())}}}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class E extends S{constructor(e,t,o){super(e),this.attributeName=t,this._defaultValue=o}refresh(){const e=this.editor,o=this.editor.plugins.get("TableUtils").getSelectionAffectedTableCells(e.model.document.selection);this.isEnabled=!!o.length,this.value=this._getSingleValue(o)}execute(e={}){const{value:t,batch:o}=e,n=this.editor.model,r=this.editor.plugins.get("TableUtils").getSelectionAffectedTableCells(n.document.selection),s=this._getValueToSet(t);n.enqueueChange(o,a=>{s?r.forEach(c=>a.setAttribute(this.attributeName,s,c)):r.forEach(c=>a.removeAttribute(this.attributeName,c))})}_getAttribute(e){if(!e)return;const t=e.getAttribute(this.attributeName);if(t!==this._defaultValue)return t}_getValueToSet(e){if(e!==this._defaultValue)return e}_getSingleValue(e){const t=this._getAttribute(e[0]);return e.every(n=>this._getAttribute(n)===t)?t:void 0}}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class nl extends E{constructor(e,t){super(e,"tableCellWidth",t)}_getValueToSet(e){if(e=O(e,"px"),e!==this._defaultValue)return e}}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class Me extends k{static get pluginName(){return"TableCellWidthEditing"}static get isOfficialPlugin(){return!0}static get requires(){return[j]}init(){const e=this.editor,t=Fe(e.config.get("table.tableCellProperties.defaultProperties"));ae(e.model.schema,e.conversion,{modelAttribute:"tableCellWidth",styleName:"width",defaultValue:t.width}),e.commands.add("tableCellWidth",new nl(e,t.width))}}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class ll extends E{constructor(e,t){super(e,"tableCellPadding",t)}_getAttribute(e){if(!e)return;const t=H(e.getAttribute(this.attributeName));if(t!==this._defaultValue)return t}_getValueToSet(e){const t=O(e,"px");if(t!==this._defaultValue)return t}}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class il extends E{constructor(e,t){super(e,"tableCellHeight",t)}_getValueToSet(e){const t=O(e,"px");if(t!==this._defaultValue)return t}}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class rl extends E{constructor(e,t){super(e,"tableCellBackgroundColor",t)}}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class sl extends E{constructor(e,t){super(e,"tableCellVerticalAlignment",t)}}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class al extends E{constructor(e,t){super(e,"tableCellHorizontalAlignment",t)}}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class cl extends E{constructor(e,t){super(e,"tableCellBorderStyle",t)}_getAttribute(e){if(!e)return;const t=H(e.getAttribute(this.attributeName));if(t!==this._defaultValue)return t}}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class dl extends E{constructor(e,t){super(e,"tableCellBorderColor",t)}_getAttribute(e){if(!e)return;const t=H(e.getAttribute(this.attributeName));if(t!==this._defaultValue)return t}}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class ul extends E{constructor(e,t){super(e,"tableCellBorderWidth",t)}_getAttribute(e){if(!e)return;const t=H(e.getAttribute(this.attributeName));if(t!==this._defaultValue)return t}_getValueToSet(e){const t=O(e,"px");if(t!==this._defaultValue)return t}}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/const eo=/^(top|middle|bottom)$/,to=/^(left|center|right|justify)$/;class oo extends k{static get pluginName(){return"TableCellPropertiesEditing"}static get isOfficialPlugin(){return!0}static get requires(){return[j,Me]}init(){const e=this.editor,t=e.model.schema,o=e.conversion;e.config.define("table.tableCellProperties.defaultProperties",{});const n=Fe(e.config.get("table.tableCellProperties.defaultProperties"),{includeVerticalAlignmentProperty:!0,includeHorizontalAlignmentProperty:!0,includePaddingProperty:!0,isRightToLeftContent:e.locale.contentLanguageDirection==="rtl"});e.data.addStyleProcessorRules(Ze),hl(t,o,{color:n.borderColor,style:n.borderStyle,width:n.borderWidth}),e.commands.add("tableCellBorderStyle",new cl(e,n.borderStyle)),e.commands.add("tableCellBorderColor",new dl(e,n.borderColor)),e.commands.add("tableCellBorderWidth",new ul(e,n.borderWidth)),ae(t,o,{modelAttribute:"tableCellHeight",styleName:"height",defaultValue:n.height}),e.commands.add("tableCellHeight",new il(e,n.height)),e.data.addStyleProcessorRules(Ro),ae(t,o,{modelAttribute:"tableCellPadding",styleName:"padding",reduceBoxSides:!0,defaultValue:n.padding}),e.commands.add("tableCellPadding",new ll(e,n.padding)),e.data.addStyleProcessorRules(et),ae(t,o,{modelAttribute:"tableCellBackgroundColor",styleName:"background-color",defaultValue:n.backgroundColor}),e.commands.add("tableCellBackgroundColor",new rl(e,n.backgroundColor)),ml(t,o,n.horizontalAlignment),e.commands.add("tableCellHorizontalAlignment",new al(e,n.horizontalAlignment)),bl(t,o,n.verticalAlignment),e.commands.add("tableCellVerticalAlignment",new sl(e,n.verticalAlignment))}}function hl(i,e,t){const o={width:"tableCellBorderWidth",color:"tableCellBorderColor",style:"tableCellBorderStyle"};i.extend("tableCell",{allowAttributes:Object.values(o)}),ve(e,"td",o,t),ve(e,"th",o,t),K(e,{modelElement:"tableCell",modelAttribute:o.style,styleName:"border-style"}),K(e,{modelElement:"tableCell",modelAttribute:o.color,styleName:"border-color"}),K(e,{modelElement:"tableCell",modelAttribute:o.width,styleName:"border-width"})}function ml(i,e,t){i.extend("tableCell",{allowAttributes:["tableCellHorizontalAlignment"]}),e.for("downcast").attributeToAttribute({model:{name:"tableCell",key:"tableCellHorizontalAlignment"},view:o=>({key:"style",value:{"text-align":o}})}),e.for("upcast").attributeToAttribute({view:{name:/^(td|th)$/,styles:{"text-align":to}},model:{key:"tableCellHorizontalAlignment",value:o=>{const n=o.getStyle("text-align");return n===t?null:n}}}).attributeToAttribute({view:{name:/^(td|th)$/,attributes:{align:to}},model:{key:"tableCellHorizontalAlignment",value:o=>{const n=o.getAttribute("align");return n===t?null:n}}})}function bl(i,e,t){i.extend("tableCell",{allowAttributes:["tableCellVerticalAlignment"]}),e.for("downcast").attributeToAttribute({model:{name:"tableCell",key:"tableCellVerticalAlignment"},view:o=>({key:"style",value:{"vertical-align":o}})}),e.for("upcast").attributeToAttribute({view:{name:/^(td|th)$/,styles:{"vertical-align":eo}},model:{key:"tableCellVerticalAlignment",value:o=>{const n=o.getStyle("vertical-align");return n===t?null:n}}}).attributeToAttribute({view:{name:/^(td|th)$/,attributes:{valign:eo}},model:{key:"tableCellVerticalAlignment",value:o=>{const n=o.getAttribute("valign");return n===t?null:n}}})}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class gl extends k{static get pluginName(){return"TableCellProperties"}static get isOfficialPlugin(){return!0}static get requires(){return[oo,Zt]}}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class D extends S{constructor(e,t,o){super(e),this.attributeName=t,this._defaultValue=o}refresh(){const t=this.editor.model.document.selection,o=M(t);this.isEnabled=!!o,this.value=this._getValue(o)}execute(e={}){const t=this.editor.model,o=t.document.selection,{value:n,batch:l}=e,r=M(o),s=this._getValueToSet(n);t.enqueueChange(l,a=>{s?a.setAttribute(this.attributeName,s,r):a.removeAttribute(this.attributeName,r)})}_getValue(e){if(!e)return;const t=e.getAttribute(this.attributeName);if(t!==this._defaultValue)return t}_getValueToSet(e){if(e!==this._defaultValue)return e}}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class fl extends D{constructor(e,t){super(e,"tableBackgroundColor",t)}}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class pl extends D{constructor(e,t){super(e,"tableBorderColor",t)}_getValue(e){if(!e)return;const t=H(e.getAttribute(this.attributeName));if(t!==this._defaultValue)return t}}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class wl extends D{constructor(e,t){super(e,"tableBorderStyle",t)}_getValue(e){if(!e)return;const t=H(e.getAttribute(this.attributeName));if(t!==this._defaultValue)return t}}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class Cl extends D{constructor(e,t){super(e,"tableBorderWidth",t)}_getValue(e){if(!e)return;const t=H(e.getAttribute(this.attributeName));if(t!==this._defaultValue)return t}_getValueToSet(e){const t=O(e,"px");if(t!==this._defaultValue)return t}}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class kl extends D{constructor(e,t){super(e,"tableWidth",t)}_getValueToSet(e){if(e=O(e,"px"),e!==this._defaultValue)return e}}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class _l extends D{constructor(e,t){super(e,"tableHeight",t)}_getValueToSet(e){if(e=O(e,"px"),e!==this._defaultValue)return e}}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class vl extends D{constructor(e,t){super(e,"tableAlignment",t)}}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/const Tl=/^(left|center|right)$/,yl=/^(left|none|right)$/;class no extends k{static get pluginName(){return"TablePropertiesEditing"}static get isOfficialPlugin(){return!0}static get requires(){return[j]}init(){const e=this.editor,t=e.model.schema,o=e.conversion;e.config.define("table.tableProperties.defaultProperties",{});const n=Yt(e.config.get("table.tableProperties.defaultProperties"),{includeAlignmentProperty:!0});e.data.addStyleProcessorRules(Ze),Al(t,o,{color:n.borderColor,style:n.borderStyle,width:n.borderWidth}),e.commands.add("tableBorderColor",new pl(e,n.borderColor)),e.commands.add("tableBorderStyle",new wl(e,n.borderStyle)),e.commands.add("tableBorderWidth",new Cl(e,n.borderWidth)),Sl(t,o,n.alignment),e.commands.add("tableAlignment",new vl(e,n.alignment)),lo(t,o,{modelAttribute:"tableWidth",styleName:"width",defaultValue:n.width}),e.commands.add("tableWidth",new kl(e,n.width)),lo(t,o,{modelAttribute:"tableHeight",styleName:"height",defaultValue:n.height}),e.commands.add("tableHeight",new _l(e,n.height)),e.data.addStyleProcessorRules(et),xl(t,o,{modelAttribute:"tableBackgroundColor",styleName:"background-color",defaultValue:n.backgroundColor}),e.commands.add("tableBackgroundColor",new fl(e,n.backgroundColor))}}function Al(i,e,t){const o={width:"tableBorderWidth",color:"tableBorderColor",style:"tableBorderStyle"};i.extend("table",{allowAttributes:Object.values(o)}),ve(e,"table",o,t),re(e,{modelAttribute:o.color,styleName:"border-color"}),re(e,{modelAttribute:o.style,styleName:"border-style"}),re(e,{modelAttribute:o.width,styleName:"border-width"})}function Sl(i,e,t){i.extend("table",{allowAttributes:["tableAlignment"]}),e.for("downcast").attributeToAttribute({model:{name:"table",key:"tableAlignment"},view:o=>({key:"style",value:{float:o==="center"?"none":o}}),converterPriority:"high"}),e.for("upcast").attributeToAttribute({view:{name:/^(table|figure)$/,styles:{float:yl}},model:{key:"tableAlignment",value:o=>{let n=o.getStyle("float");return n==="none"&&(n="center"),n===t?null:n}}}).attributeToAttribute({view:{attributes:{align:Tl}},model:{name:"table",key:"tableAlignment",value:o=>{const n=o.getAttribute("align");return n===t?null:n}}})}function xl(i,e,t){const{modelAttribute:o}=t;i.extend("table",{allowAttributes:[o]}),_e(e,{viewElement:"table",...t}),re(e,t)}function lo(i,e,t){const{modelAttribute:o}=t;i.extend("table",{allowAttributes:[o]}),_e(e,{viewElement:/^(table|figure)$/,shouldUpcast:n=>!(n.name=="table"&&n.parent.name=="figure"),...t}),K(e,{modelElement:"table",...t})}I(".ck.ck-table-properties-form .ck-form__row.ck-table-properties-form__alignment-row{align-content:baseline;flex-basis:0;flex-wrap:wrap}.ck.ck-table-properties-form .ck-form__row.ck-table-properties-form__alignment-row .ck.ck-toolbar .ck-toolbar__items{flex-wrap:nowrap}.ck.ck-table-properties-form{width:320px}.ck.ck-table-properties-form .ck-form__row.ck-table-properties-form__alignment-row{align-self:flex-end;padding:0}.ck.ck-table-properties-form .ck-form__row.ck-table-properties-form__alignment-row .ck.ck-toolbar{background:none;margin-top:var(--ck-spacing-standard)}.ck.ck-table-properties-form .ck-form__row.ck-table-properties-form__alignment-row .ck.ck-toolbar .ck-toolbar__items>*{width:40px}");/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class Rl extends z{constructor(e,t){super(e),this.set({borderStyle:"",borderWidth:"",borderColor:"",backgroundColor:"",width:"",height:"",alignment:""}),this.options=t;const{borderStyleDropdown:o,borderWidthInput:n,borderColorInput:l,borderRowLabel:r}=this._createBorderFields(),{backgroundRowLabel:s,backgroundInput:a}=this._createBackgroundFields(),{widthInput:c,operatorLabel:d,heightInput:u,dimensionsLabel:h}=this._createDimensionFields(),{alignmentToolbar:b,alignmentLabel:g}=this._createAlignmentFields();this.focusTracker=new te,this.keystrokes=new ee,this.children=this.createCollection(),this.borderStyleDropdown=o,this.borderWidthInput=n,this.borderColorInput=l,this.backgroundInput=a,this.widthInput=c,this.heightInput=u,this.alignmentToolbar=b;const{saveButtonView:m,cancelButtonView:f}=this._createActionButtons();this.saveButtonView=m,this.cancelButtonView=f,this._focusables=new pe,this._focusCycler=new we({focusables:this._focusables,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"shift + tab",focusNext:"tab"}}),this.children.add(new Ke(e,{label:this.t("Table properties")})),this.children.add(new V(e,{labelView:r,children:[r,o,l,n],class:"ck-table-form__border-row"})),this.children.add(new V(e,{labelView:s,children:[s,a],class:"ck-table-form__background-row"})),this.children.add(new V(e,{children:[new V(e,{labelView:h,children:[h,c,d,u],class:"ck-table-form__dimensions-row"}),new V(e,{labelView:g,children:[g,b],class:"ck-table-properties-form__alignment-row"})]})),this.children.add(new V(e,{children:[this.saveButtonView,this.cancelButtonView],class:"ck-table-form__action-row"})),this.setTemplate({tag:"form",attributes:{class:["ck","ck-form","ck-table-form","ck-table-properties-form"],tabindex:"-1"},children:this.children})}render(){super.render(),Xe({view:this}),[this.borderColorInput,this.backgroundInput].forEach(e=>{this._focusCycler.chain(e.fieldView.focusCycler)}),[this.borderStyleDropdown,this.borderColorInput,this.borderWidthInput,this.backgroundInput,this.widthInput,this.heightInput,this.alignmentToolbar,this.saveButtonView,this.cancelButtonView].forEach(e=>{this._focusables.add(e),this.focusTracker.add(e.element)}),this.keystrokes.listenTo(this.element)}destroy(){super.destroy(),this.focusTracker.destroy(),this.keystrokes.destroy()}focus(){this._focusCycler.focusFirst()}_createBorderFields(){const e=this.options.defaultTableProperties,t={style:e.borderStyle,width:e.borderWidth,color:e.borderColor},o=me({colorConfig:this.options.borderColors,columns:5,defaultColorValue:t.color,colorPickerConfig:this.options.colorPickerConfig}),n=this.locale,l=this.t,r=l("Style"),s=new B(n);s.text=l("Border");const a=We(l),c=new R(n,Je);c.set({label:r,class:"ck-table-form__border-style"}),c.fieldView.buttonView.set({ariaLabel:r,ariaLabelledBy:void 0,isOn:!1,withText:!0,tooltip:r}),c.fieldView.buttonView.bind("label").to(this,"borderStyle",h=>a[h||"none"]),c.fieldView.on("execute",h=>{this.borderStyle=h.source._borderStyleValue}),c.bind("isEmpty").to(this,"borderStyle",h=>!h),fe(c.fieldView,Gt(this,t.style),{role:"menu",ariaLabel:r});const d=new R(n,L);d.set({label:l("Width"),class:"ck-table-form__border-width"}),d.fieldView.bind("value").to(this,"borderWidth"),d.bind("isEnabled").to(this,"borderStyle",ge),d.fieldView.on("input",()=>{this.borderWidth=d.fieldView.element.value});const u=new R(n,o);return u.set({label:l("Color"),class:"ck-table-form__border-color"}),u.fieldView.bind("value").to(this,"borderColor"),u.bind("isEnabled").to(this,"borderStyle",ge),u.fieldView.on("input",()=>{this.borderColor=u.fieldView.value}),this.on("change:borderStyle",(h,b,g,m)=>{ge(g)||(this.borderColor="",this.borderWidth=""),ge(m)||(this.borderColor=t.color,this.borderWidth=t.width)}),{borderRowLabel:s,borderStyleDropdown:c,borderColorInput:u,borderWidthInput:d}}_createBackgroundFields(){const e=this.locale,t=this.t,o=new B(e);o.text=t("Background");const n=me({colorConfig:this.options.backgroundColors,columns:5,defaultColorValue:this.options.defaultTableProperties.backgroundColor,colorPickerConfig:this.options.colorPickerConfig}),l=new R(e,n);return l.set({label:t("Color"),class:"ck-table-properties-form__background"}),l.fieldView.bind("value").to(this,"backgroundColor"),l.fieldView.on("input",()=>{this.backgroundColor=l.fieldView.value}),{backgroundRowLabel:o,backgroundInput:l}}_createDimensionFields(){const e=this.locale,t=this.t,o=new B(e);o.text=t("Dimensions");const n=new R(e,L);n.set({label:t("Width"),class:"ck-table-form__dimensions-row__width"}),n.fieldView.bind("value").to(this,"width"),n.fieldView.on("input",()=>{this.width=n.fieldView.element.value});const l=new z(e);l.setTemplate({tag:"span",attributes:{class:["ck-table-form__dimension-operator"]},children:[{text:"\xD7"}]});const r=new R(e,L);return r.set({label:t("Height"),class:"ck-table-form__dimensions-row__height"}),r.fieldView.bind("value").to(this,"height"),r.fieldView.on("input",()=>{this.height=r.fieldView.element.value}),{dimensionsLabel:o,widthInput:n,operatorLabel:l,heightInput:r}}_createAlignmentFields(){const e=this.locale,t=this.t,o=new B(e);o.text=t("Alignment");const n=new Ce(e);return n.set({isCompact:!0,ariaLabel:t("Table alignment toolbar")}),Le({view:this,icons:{left:y.objectLeft,center:y.objectCenter,right:y.objectRight},toolbar:n,labels:this._alignmentLabels,propertyName:"alignment",defaultValue:this.options.defaultTableProperties.alignment}),{alignmentLabel:o,alignmentToolbar:n}}_createActionButtons(){const e=this.locale,t=this.t,o=new P(e),n=new P(e),l=[this.borderWidthInput,this.borderColorInput,this.backgroundInput,this.widthInput,this.heightInput];return o.set({label:t("Save"),icon:y.check,class:"ck-button-save",type:"submit",withText:!0}),o.bind("isEnabled").toMany(l,"errorText",(...r)=>r.every(s=>!s)),n.set({label:t("Cancel"),icon:y.cancel,class:"ck-button-cancel",withText:!0}),n.delegate("execute").to(this,"cancel"),{saveButtonView:o,cancelButtonView:n}}get _alignmentLabels(){const e=this.locale,t=this.t,o=t("Align table to the left"),n=t("Center table"),l=t("Align table to the right");return e.uiLanguageDirection==="rtl"?{right:l,center:n,left:o}:{left:o,center:n,right:l}}}function ge(i){return i!=="none"}var Vl='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M8 2v5h4V2h1v5h5v1h-5v4h.021l-.172.351-1.916.28-.151.027c-.287.063-.54.182-.755.341L8 13v5H7v-5H2v-1h5V8H2V7h5V2h1zm4 6H8v4h4V8z" opacity=".6"/><path d="m15.5 11.5 1.323 2.68 2.957.43-2.14 2.085.505 2.946L15.5 18.25l-2.645 1.39.505-2.945-2.14-2.086 2.957-.43L15.5 11.5zM17 1a2 2 0 0 1 2 2v9.475l-.85-.124-.857-1.736a2.048 2.048 0 0 0-.292-.44L17 3H3v14h7.808l.402.392L10.935 19H3a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h14z"/></svg>';/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */const Il=500,io={borderStyle:"tableBorderStyle",borderColor:"tableBorderColor",borderWidth:"tableBorderWidth",backgroundColor:"tableBackgroundColor",width:"tableWidth",height:"tableHeight",alignment:"tableAlignment"};class ro extends k{static get requires(){return[ne]}static get pluginName(){return"TablePropertiesUI"}static get isOfficialPlugin(){return!0}constructor(e){super(e),this.view=null,e.config.define("table.tableProperties",{borderColors:he,backgroundColors:he})}init(){const e=this.editor,t=e.t;this._defaultTableProperties=Yt(e.config.get("table.tableProperties.defaultProperties"),{includeAlignmentProperty:!0}),this._balloon=e.plugins.get(ne),e.ui.componentFactory.add("tableProperties",o=>{const n=new P(o);n.set({label:t("Table properties"),icon:Vl,tooltip:!0}),this.listenTo(n,"execute",()=>this._showView());const l=Object.values(io).map(r=>e.commands.get(r));return n.bind("isEnabled").toMany(l,"isEnabled",(...r)=>r.some(s=>s)),n})}destroy(){super.destroy(),this.view&&this.view.destroy()}_createPropertiesView(){const e=this.editor,t=e.config.get("table.tableProperties"),o=le(t.borderColors),n=ie(e.locale,o),l=le(t.backgroundColors),r=ie(e.locale,l),s=t.colorPicker!==!1,a=new Rl(e.locale,{borderColors:n,backgroundColors:r,defaultTableProperties:this._defaultTableProperties,colorPickerConfig:s?t.colorPicker||{}:!1}),c=e.t;a.render(),this.listenTo(a,"submit",()=>{this._hideView()}),this.listenTo(a,"cancel",()=>{this._undoStepBatch.operations.length&&e.execute("undo",this._undoStepBatch),this._hideView()}),a.keystrokes.set("Esc",(h,b)=>{this._hideView(),b()}),Ye({emitter:a,activator:()=>this._isViewInBalloon,contextElements:[this._balloon.view.element],callback:()=>this._hideView()});const d=Ot(c),u=Dt(c);return a.on("change:borderStyle",this._getPropertyChangeCallback("tableBorderStyle")),a.on("change:borderColor",this._getValidatedPropertyChangeCallback({viewField:a.borderColorInput,commandName:"tableBorderColor",errorText:d,validator:ue})),a.on("change:borderWidth",this._getValidatedPropertyChangeCallback({viewField:a.borderWidthInput,commandName:"tableBorderWidth",errorText:u,validator:Ut})),a.on("change:backgroundColor",this._getValidatedPropertyChangeCallback({viewField:a.backgroundInput,commandName:"tableBackgroundColor",errorText:d,validator:ue})),a.on("change:width",this._getValidatedPropertyChangeCallback({viewField:a.widthInput,commandName:"tableWidth",errorText:u,validator:Q})),a.on("change:height",this._getValidatedPropertyChangeCallback({viewField:a.heightInput,commandName:"tableHeight",errorText:u,validator:Q})),a.on("change:alignment",this._getPropertyChangeCallback("tableAlignment")),a}_fillViewFormFromCommandValues(){const e=this.editor.commands,t=e.get("tableBorderStyle");Object.entries(io).map(([o,n])=>{const l=o,r=this._defaultTableProperties[l]||"";return[l,e.get(n).value||r]}).forEach(([o,n])=>{(o==="borderColor"||o==="borderWidth")&&t.value==="none"||this.view.set(o,n)}),this._isReady=!0}_showView(){const e=this.editor;this.view||(this.view=this._createPropertiesView()),this.listenTo(e.ui,"update",()=>{this._updateView()}),this._fillViewFormFromCommandValues(),this._balloon.add({view:this.view,position:qt(e)}),this._undoStepBatch=e.model.createBatch(),this.view.focus()}_hideView(){const e=this.editor;this.stopListening(e.ui,"update"),this._isReady=!1,this.view.saveButtonView.focus(),this._balloon.remove(this.view),this.editor.editing.view.focus()}_updateView(){const e=this.editor,t=e.editing.view.document;Nt(t.selection)?this._isViewVisible&&jt(e,"table"):this._hideView()}get _isViewVisible(){return!!this.view&&this._balloon.visibleView===this.view}get _isViewInBalloon(){return!!this.view&&this._balloon.hasView(this.view)}_getPropertyChangeCallback(e){return(t,o,n)=>{this._isReady&&this.editor.execute(e,{value:n,batch:this._undoStepBatch})}}_getValidatedPropertyChangeCallback(e){const{commandName:t,viewField:o,validator:n,errorText:l}=e,r=tt(()=>{o.errorText=l},Il);return(s,a,c)=>{r.cancel(),this._isReady&&(n(c)?(this.editor.execute(t,{value:c,batch:this._undoStepBatch}),o.errorText=null):r())}}}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class Pl extends k{static get pluginName(){return"TableProperties"}static get isOfficialPlugin(){return!0}static get requires(){return[no,ro]}}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/function El(i){i.document.registerPostFixer(e=>zl(e,i))}function zl(i,e){const t=e.document.differ.getChanges();let o=!1;for(const n of t){if(n.type!="insert")continue;const l=n.position.parent;if(l.is("element","table")||n.name=="table"){const r=n.name=="table"?n.position.nodeAfter:l,s=Array.from(r.getChildren()).filter(c=>c.is("element","caption")),a=s.shift();if(!a)continue;for(const c of s)i.move(i.createRangeIn(c),a,"end"),i.remove(c);a.nextSibling&&(i.move(i.createRangeOn(a),r,"end"),o=!0),o=!!s.length||o}}return o}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/function so(i){return!!i&&i.is("element","table")}function He(i){for(const e of i.getChildren())if(e.is("element","caption"))return e;return null}function Bl(i){const e=M(i);return e?He(e):null}function Wl(i){const e=i.parent;return i.name=="figcaption"&&e&&e.is("element","figure")&&e.hasClass("table")?{name:!0}:i.name=="caption"&&e&&e.is("element","table")?{name:!0}:null}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class Ll extends S{refresh(){const e=this.editor,t=M(e.model.document.selection);this.isEnabled=!!t,this.isEnabled?this.value=!!He(t):this.value=!1}execute({focusCaptionOnShow:e=!1}={}){this.editor.model.change(t=>{this.value?this._hideTableCaption(t):this._showTableCaption(t,e)})}_showTableCaption(e,t){const o=this.editor.model,n=M(o.document.selection),s=this.editor.plugins.get("TableCaptionEditing")._getSavedCaption(n)||e.createElement("caption");o.insertContent(s,n,"end"),t&&e.setSelection(s,"in")}_hideTableCaption(e){const t=this.editor.model,o=M(t.document.selection),n=this.editor.plugins.get("TableCaptionEditing"),l=He(o);n._saveCaption(o,l),t.deleteContent(e.createSelection(l,"on"))}}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class ao extends k{static get pluginName(){return"TableCaptionEditing"}static get isOfficialPlugin(){return!0}constructor(e){super(e),this._savedCaptionsMap=new WeakMap}init(){const e=this.editor,t=e.model.schema,o=e.editing.view,n=e.t;t.isRegistered("caption")?t.extend("caption",{allowIn:"table"}):t.register("caption",{allowIn:"table",allowContentOf:"$block",isLimit:!0}),e.commands.add("toggleTableCaption",new Ll(this.editor)),e.conversion.for("upcast").elementToElement({view:Wl,model:"caption"}),e.conversion.for("dataDowncast").elementToElement({model:"caption",view:(l,{writer:r})=>so(l.parent)?r.createContainerElement("figcaption"):null}),e.conversion.for("editingDowncast").elementToElement({model:"caption",view:(l,{writer:r})=>{if(!so(l.parent))return null;const s=r.createEditableElement("figcaption");return r.setCustomProperty("tableCaption",!0,s),s.placeholder=n("Enter table caption"),Vo({view:o,element:s,keepOnFocus:!0}),Oe(s,r)}}),El(e.model)}_getSavedCaption(e){const t=this._savedCaptionsMap.get(e);return t?Io.fromJSON(t):null}_saveCaption(e,t){this._savedCaptionsMap.set(e,t.toJSON())}}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class co extends k{static get pluginName(){return"TableCaptionUI"}static get isOfficialPlugin(){return!0}init(){const e=this.editor,t=e.editing.view,o=e.t;e.ui.componentFactory.add("toggleTableCaption",n=>{const l=e.commands.get("toggleTableCaption"),r=new P(n);return r.set({icon:y.caption,tooltip:!0,isToggleable:!0}),r.bind("isOn","isEnabled").to(l,"value","isEnabled"),r.bind("label").to(l,"value",s=>o(s?"Toggle caption off":"Toggle caption on")),this.listenTo(r,"execute",()=>{if(e.execute("toggleTableCaption",{focusCaptionOnShow:!0}),l.value){const s=Bl(e.model.document.selection),a=e.editing.mapper.toViewElement(s);if(!a)return;t.scrollToTheSelection(),t.change(c=>{c.addClass("table__caption_highlighted",a)})}e.editing.view.focus()}),r})}}I(":root{--ck-color-selector-caption-background:#f7f7f7;--ck-color-selector-caption-text:#333;--ck-color-selector-caption-highlighted-background:#fd0}.ck-content .table>figcaption{background-color:var(--ck-color-selector-caption-background);caption-side:top;color:var(--ck-color-selector-caption-text);display:table-caption;font-size:.75em;outline-offset:-1px;padding:.6em;text-align:center;word-break:break-word}@media (forced-colors:active){.ck-content .table>figcaption{background-color:unset;color:unset}}@media (forced-colors:none){.ck.ck-editor__editable .table>figcaption.table__caption_highlighted{animation:ck-table-caption-highlight .6s ease-out}}.ck.ck-editor__editable .table>figcaption.ck-placeholder:before{overflow:hidden;padding-left:inherit;padding-right:inherit;text-overflow:ellipsis;white-space:nowrap}@keyframes ck-table-caption-highlight{0%{background-color:var(--ck-color-selector-caption-highlighted-background)}to{background-color:var(--ck-color-selector-caption-background)}}");/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class Nl extends k{static get pluginName(){return"TableCaption"}static get isOfficialPlugin(){return!0}static get requires(){return[ao,co]}}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class Fl extends S{refresh(){this.isEnabled=!0}execute(e={}){const{model:t,plugins:o}=this.editor;let{table:n=t.document.selection.getSelectedElement(),columnWidths:l,tableWidth:r}=e;l&&(l=Array.isArray(l)?l:l.split(",")),t.change(s=>{r?s.setAttribute("tableWidth",r,n):s.removeAttribute("tableWidth",n);const a=o.get("TableColumnResizeEditing").getColumnGroupElement(n);if(!l&&!a)return;if(!l)return s.remove(a);const c=Ve(l);if(a)Array.from(a.getChildren()).forEach((d,u)=>s.setAttribute("columnWidth",c[u],d));else{const d=s.createElement("tableColumnGroup");c.forEach(u=>s.appendElement("tableColumn",{columnWidth:u},d)),s.append(d,n)}})}}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/function Ml(i){return e=>e.on("element:colgroup",(t,o,n)=>{const l=o.modelCursor.findAncestor("table"),r=J(l);if(!r)return;const s=Y(r),a=i.getColumns(l);let c=mn(r,n.writer);c=Array.from({length:a},(d,u)=>c[u]||"auto"),(c.length!=s.length||c.includes("auto"))&&vt(s,r,Ve(c),n.writer)},{priority:"low"})}function Hl(){return i=>i.on("insert:table",(e,t,o)=>{const n=o.writer,l=t.item,r=o.mapper.toViewElement(l),s=r.is("element","table")?r:Array.from(r.getChildren()).find(c=>c.is("element","table"));J(l)?n.addClass("ck-table-resized",s):n.removeClass("ck-table-resized",s)},{priority:"low"})}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class uo extends k{static get requires(){return[j,T]}static get pluginName(){return"TableColumnResizeEditing"}static get isOfficialPlugin(){return!0}constructor(e){super(e),this._isResizingActive=!1,this.set("_isResizingAllowed",!0),this._resizingData=null,this._domEmitter=new(po()),this._tableUtilsPlugin=e.plugins.get("TableUtils"),this.on("change:_isResizingAllowed",(t,o,n)=>{const l=n?"removeClass":"addClass";e.editing.view.change(r=>{for(const s of e.editing.view.document.roots)r[l]("ck-column-resize_disabled",e.editing.view.document.getRoot(s.rootName))})})}init(){this._extendSchema(),this._registerPostFixer(),this._registerConverters(),this._registerResizingListeners(),this._registerResizerInserter();const e=this.editor,t=e.plugins.get("TableColumnResize");e.plugins.get("TableEditing").registerAdditionalSlot({filter:l=>l.is("element","tableColumnGroup"),positionOffset:0});const n=new Fl(e);e.commands.add("resizeTableWidth",n),e.commands.add("resizeColumnWidths",n),this.bind("_isResizingAllowed").to(e,"isReadOnly",t,"isEnabled",n,"isEnabled",(l,r,s)=>!l&&r&&s)}destroy(){this._domEmitter.stopListening(),super.destroy()}getColumnGroupElement(e){return J(e)}getTableColumnElements(e){return Y(e)}getTableColumnsWidths(e){return hn(e)}_extendSchema(){this.editor.model.schema.extend("table",{allowAttributes:["tableWidth"]}),this.editor.model.schema.register("tableColumnGroup",{allowIn:"table",isLimit:!0}),this.editor.model.schema.register("tableColumn",{allowIn:"tableColumnGroup",allowAttributes:["columnWidth","colSpan"],isLimit:!0})}_registerPostFixer(){const t=this.editor.model;t.document.registerPostFixer(l=>{let r=!1;for(const s of ln(t)){const a=this.getColumnGroupElement(s),c=this.getTableColumnElements(a),d=this.getTableColumnsWidths(a);let u=Ve(d);u=o(u,s,this),!ot(d,u)&&(vt(c,a,u,l),r=!0)}return r});function o(l,r,s){const a=s._tableUtilsPlugin.getColumns(r);if(a-l.length===0)return l;const d=l.map(h=>Number(h.replace("%",""))),u=n(s.editor.model.document.differ,r);for(const h of u){const b=a-d.length;if(b===0)continue;const g=b>0,m=s._tableUtilsPlugin.getCellLocation(h).column;if(g){const f=rn(r,s.editor),p=cn(b,f);d.splice(m,0,...p)}else{const f=d.splice(m,Math.abs(b));d[m]+=X(f)}}return d.map(h=>h+"%")}function n(l,r){const s=new Set;for(const a of l.getChanges())if(a.type=="insert"&&a.position.nodeAfter&&a.position.nodeAfter.name=="tableCell"&&a.position.nodeAfter.getAncestors().includes(r))s.add(a.position.nodeAfter);else if(a.type=="remove"){const c=a.position.nodeBefore||a.position.nodeAfter;c.name=="tableCell"&&c.getAncestors().includes(r)&&s.add(c)}return s}}_registerConverters(){const t=this.editor.conversion;t.for("upcast").attributeToAttribute({view:{name:"figure",key:"style",value:{width:/[\s\S]+/}},model:{name:"table",key:"tableWidth",value:o=>o.getStyle("width")}}),t.for("downcast").attributeToAttribute({model:{name:"table",key:"tableWidth"},view:o=>({name:"figure",key:"style",value:{width:o}})}),t.elementToElement({model:"tableColumnGroup",view:"colgroup"}),t.elementToElement({model:"tableColumn",view:"col"}),t.for("downcast").add(Hl()),t.for("upcast").add(Ml(this._tableUtilsPlugin)),t.for("upcast").attributeToAttribute({view:{name:"col",styles:{width:/.*/}},model:{key:"columnWidth",value:o=>{const n=o.getStyle("width");return!n||!n.endsWith("%")&&!n.endsWith("pt")?"auto":n}}}),t.for("upcast").attributeToAttribute({view:{name:"col",key:"span"},model:"colSpan"}),t.for("downcast").attributeToAttribute({model:{name:"tableColumn",key:"columnWidth"},view:o=>({key:"style",value:{width:o}})})}_registerResizingListeners(){const e=this.editor.editing.view;e.addObserver(zt),e.document.on("mousedown",this._onMouseDownHandler.bind(this),{priority:"high"}),this._domEmitter.listenTo(Z.window.document,"mousemove",Eo(this._onMouseMoveHandler.bind(this),50)),this._domEmitter.listenTo(Z.window.document,"mouseup",this._onMouseUpHandler.bind(this))}_onMouseDownHandler(e,t){const o=t.target;if(!o.hasClass("ck-table-column-resizer")||!this._isResizingAllowed)return;const n=this.editor,l=n.editing.mapper.toModelElement(o.findAncestor("figure"));if(!n.model.canEditAt(l))return;t.preventDefault(),e.stop();const r=c(l,this._tableUtilsPlugin,n),s=o.findAncestor("table"),a=n.editing.view;Array.from(s.getChildren()).find(h=>h.is("element","colgroup"))||a.change(h=>{d(h,r,s)}),this._isResizingActive=!0,this._resizingData=this._getResizingData(t,r),a.change(h=>u(h,s,this._resizingData));function c(h,b,g){const m=Array(b.getColumns(h)),f=new C(h);for(const p of f){const w=g.editing.mapper.toViewElement(p.cell),v=g.editing.view.domConverter.mapViewToDom(w),A=un(v);(!m[p.column]||A<m[p.column])&&(m[p.column]=x(A))}return m}function d(h,b,g){const m=h.createContainerElement("colgroup");for(let f=0;f<b.length;f++){const p=h.createEmptyElement("col"),w=`${x(b[f]/X(b)*100)}%`;h.setStyle("width",w,p),h.insert(h.createPositionAt(m,"end"),p)}h.insert(h.createPositionAt(g,0),m)}function u(h,b,g){const m=g.widths.viewFigureWidth/g.widths.viewFigureParentWidth;h.addClass("ck-table-resized",b),h.addClass("ck-table-column-resizer__active",g.elements.viewResizer),h.setStyle("width",`${x(m*100)}%`,b.findAncestor("figure"))}}_onMouseMoveHandler(e,t){if(!this._isResizingActive)return;if(!this._isResizingAllowed){this._onMouseUpHandler();return}const{columnPosition:o,flags:{isRightEdge:n,isTableCentered:l,isLtrContent:r},elements:{viewFigure:s,viewLeftColumn:a,viewRightColumn:c},widths:{viewFigureParentWidth:d,tableWidth:u,leftColumnWidth:h,rightColumnWidth:b}}=this._resizingData,g=-h+xe,m=n?d-u:b-xe,f=(r?1:-1)*(n&&l?2:1),p=an((t.clientX-o)*f,Math.min(g,0),Math.max(m,0));p!==0&&this.editor.editing.view.change(w=>{const v=x((h+p)*100/u);if(w.setStyle("width",`${v}%`,a),n){const A=x((u+p)*100/d);w.setStyle("width",`${A}%`,s)}else{const A=x((b-p)*100/u);w.setStyle("width",`${A}%`,c)}})}_onMouseUpHandler(){if(!this._isResizingActive)return;const{viewResizer:e,modelTable:t,viewFigure:o,viewColgroup:n}=this._resizingData.elements,l=this.editor,r=l.editing.view,s=this.getColumnGroupElement(t),a=Array.from(n.getChildren()).filter(m=>m.is("view:element")),c=s?this.getTableColumnsWidths(s):null,d=a.map(m=>m.getStyle("width")),u=!ot(c,d),h=t.getAttribute("tableWidth"),b=o.getStyle("width"),g=h!==b;(u||g)&&(this._isResizingAllowed?l.execute("resizeTableWidth",{table:t,tableWidth:`${x(b)}%`,columnWidths:d}):r.change(m=>{if(c)for(const f of a)m.setStyle("width",c.shift(),f);else m.remove(n);g&&(h?m.setStyle("width",h,o):m.removeStyle("width",o)),!c&&!h&&m.removeClass("ck-table-resized",[...o.getChildren()].find(f=>f.name==="table"))})),r.change(m=>{m.removeClass("ck-table-column-resizer__active",e)}),this._isResizingActive=!1,this._resizingData=null}_getResizingData(e,t){const o=this.editor,n=e.domEvent.clientX,l=e.target,r=l.findAncestor("td")||l.findAncestor("th"),s=o.editing.mapper.toModelElement(r),a=s.findAncestor("table"),c=sn(s,this._tableUtilsPlugin).rightEdge,d=this._tableUtilsPlugin.getColumns(a)-1,u=c===d,h=!a.hasAttribute("tableAlignment"),b=o.locale.contentLanguageDirection!=="rtl",g=r.findAncestor("table"),m=g.findAncestor("figure"),f=[...g.getChildren()].find(ho=>ho.is("element","colgroup")),p=f.getChild(c),w=u?void 0:f.getChild(c+1),v=Re(o.editing.view.domConverter.mapViewToDom(m.parent)),A=Re(o.editing.view.domConverter.mapViewToDom(m)),U=kt(a,o),q=t[c],G=u?void 0:t[c+1];return{columnPosition:n,flags:{isRightEdge:u,isTableCentered:h,isLtrContent:b},elements:{viewResizer:l,modelTable:a,viewFigure:m,viewColgroup:f,viewLeftColumn:p,viewRightColumn:w},widths:{viewFigureParentWidth:v,viewFigureWidth:A,tableWidth:U,leftColumnWidth:q,rightColumnWidth:G}}}_registerResizerInserter(){this.editor.conversion.for("editingDowncast").add(e=>{e.on("insert:tableCell",(t,o,n)=>{const l=o.item,r=n.mapper.toViewElement(l),s=n.writer;s.insert(s.createPositionAt(r,"end"),s.createUIElement("div",{class:"ck-table-column-resizer"}))},{priority:"lowest"})})}}I(":root{--ck-color-selector-column-resizer-hover:var(--ck-color-base-active);--ck-table-column-resizer-width:7px;--ck-table-column-resizer-position-offset:calc(var(--ck-table-column-resizer-width)*-0.5 - 0.5px)}.ck-content .table .ck-table-resized{table-layout:fixed}.ck-content .table table{overflow:hidden}.ck-content .table td,.ck-content .table th{overflow-wrap:break-word;position:relative}.ck.ck-editor__editable .table .ck-table-column-resizer{bottom:0;cursor:col-resize;position:absolute;right:var(--ck-table-column-resizer-position-offset);top:0;user-select:none;width:var(--ck-table-column-resizer-width);z-index:var(--ck-z-default)}.ck.ck-editor__editable .table[draggable] .ck-table-column-resizer,.ck.ck-editor__editable.ck-column-resize_disabled .table .ck-table-column-resizer{display:none}.ck.ck-editor__editable .table .ck-table-column-resizer:hover,.ck.ck-editor__editable .table .ck-table-column-resizer__active{background-color:var(--ck-color-selector-column-resizer-hover);bottom:-999999px;opacity:.25;top:-999999px}.ck.ck-editor__editable[dir=rtl] .table .ck-table-column-resizer{left:var(--ck-table-column-resizer-position-offset);right:unset}");/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class Ol extends k{static get requires(){return[uo,Me]}static get pluginName(){return"TableColumnResize"}static get isOfficialPlugin(){return!0}}export{qn as PlainTableOutput,Lt as Table,Nl as TableCaption,ao as TableCaptionEditing,co as TableCaptionUI,gl as TableCellProperties,oo as TableCellPropertiesEditing,Zt as TableCellPropertiesUI,Me as TableCellWidthEditing,It as TableClipboard,Ol as TableColumnResize,uo as TableColumnResizeEditing,j as TableEditing,Et as TableKeyboard,Bt as TableMouse,Pl as TableProperties,no as TablePropertiesEditing,ro as TablePropertiesUI,W as TableSelection,Jn as TableToolbar,Vt as TableUI,T as TableUtils};
