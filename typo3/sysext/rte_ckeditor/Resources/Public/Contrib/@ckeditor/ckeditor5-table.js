import{Command as e,Plugin as t,icons as o}from"@ckeditor/ckeditor5-core";import{toWidgetEditable as i,toWidget as n,Widget as r,isWidget as l,WidgetToolbarRepository as s}from"@ckeditor/ckeditor5-widget";import{first as a,global as c,CKEditorError as d,KeystrokeHandler as u,FocusTracker as h,Collection as b,getLocalizedArrowKeyCodeDirection as m,Rect as g,DomEmitterMixin as p}from"@ckeditor/ckeditor5-utils";import{View as f,addKeyboardHandlingForGrid as w,ButtonView as k,createDropdown as _,MenuBarMenuView as C,SwitchButtonView as v,SplitButtonView as y,addListToDropdown as A,ViewModel as T,ViewCollection as x,FocusCycler as S,InputTextView as V,ColorSelectorView as R,FormHeaderView as I,submitHandler as P,LabelView as E,LabeledFieldView as z,createLabeledDropdown as B,createLabeledInputText as W,ToolbarView as N,BalloonPanelView as L,ContextualBalloon as F,normalizeColorOptions as D,getLocalizedColorOptions as H,clickOutsideHandler as O}from"@ckeditor/ckeditor5-ui";import{ClipboardMarkersUtils as M,ClipboardPipeline as U}from"@ckeditor/ckeditor5-clipboard";import{DomEventObserver as $,isColor as j,isLength as q,isPercentage as G,addBorderRules as K,addPaddingRules as J,addBackgroundRules as X,enablePlaceholder as Y,Element as Q}from"@ckeditor/ckeditor5-engine";import{isObject as Z,debounce as ee,isEqual as te,throttle as oe}from"lodash-es";
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */function ie(e,t){const{modelAttribute:o,styleName:i,viewElement:n,defaultValue:r,reduceBoxSides:l=!1,shouldUpcast:s=()=>!0}=t;e.for("upcast").attributeToAttribute({view:{name:n,styles:{[i]:/[\s\S]+/}},model:{key:o,value:e=>{if(!s(e))return;const t=e.getNormalizedStyle(i),o=l?se(t):t;return r!==o?o:void 0}}})}function ne(e,t,o,i){e.for("upcast").add(e=>e.on("element:"+t,(e,t,n)=>{if(!t.modelRange)return;const r=["border-top-width","border-top-color","border-top-style","border-bottom-width","border-bottom-color","border-bottom-style","border-right-width","border-right-color","border-right-style","border-left-width","border-left-color","border-left-style"].filter(e=>t.viewItem.hasStyle(e));if(!r.length)return;const l={styles:r};if(!n.consumable.test(t.viewItem,l))return;const s=[...t.modelRange.getItems({shallow:!0})].pop();n.consumable.consume(t.viewItem,l);const a={style:t.viewItem.getNormalizedStyle("border-style"),color:t.viewItem.getNormalizedStyle("border-color"),width:t.viewItem.getNormalizedStyle("border-width")},c={style:se(a.style),color:se(a.color),width:se(a.width)};c.style!==i.style&&n.writer.setAttribute(o.style,c.style,s),c.color!==i.color&&n.writer.setAttribute(o.color,c.color,s),c.width!==i.width&&n.writer.setAttribute(o.width,c.width,s)}))}function re(e,t){const{modelElement:o,modelAttribute:i,styleName:n}=t;e.for("downcast").attributeToAttribute({model:{name:o,key:i},view:e=>({key:"style",value:{[n]:e}})})}function le(e,t){const{modelAttribute:o,styleName:i}=t;e.for("downcast").add(e=>e.on(`attribute:${o}:table`,(e,t,o)=>{const{item:n,attributeNewValue:r}=t,{mapper:l,writer:s}=o;if(!o.consumable.consume(t.item,e.name))return;const a=[...l.toViewElement(n).getChildren()].find(e=>e.is("element","table"));r?s.setStyle(i,r,a):s.removeStyle(i,a)}))}function se(e){if(!e)return;const t=["top","right","bottom","left"];if(!t.every(t=>e[t]))return e;const o=e.top;return t.every(t=>e[t]===o)?o:e}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */function ae(e,t,o,i,n=1){null!=t&&null!=n&&t>n?i.setAttribute(e,t,o):i.removeAttribute(e,o)}function ce(e,t,o={}){const i=e.createElement("tableCell",o);return e.insertElement("paragraph",i),e.insert(i,t),i}function de(e,t){const o=t.parent.parent,i=parseInt(o.getAttribute("headingColumns")||"0"),{column:n}=e.getCellLocation(t);return!!i&&n<i}function ue(e,t,o){const{modelAttribute:i}=o;e.extend("tableCell",{allowAttributes:[i]}),ie(t,{viewElement:/^(td|th)$/,...o}),re(t,{modelElement:"tableCell",...o})}function he(e){const t=e.getSelectedElement();return t&&t.is("element","table")?t:e.getFirstPosition().findAncestor("table")}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */function be(){return e=>{e.on("element:table",(e,t,o)=>{const i=t.viewItem;if(!o.consumable.test(i,{name:!0}))return;const{rows:n,headingRows:r,headingColumns:l}=function(e){let t,o=0;const i=[],n=[];let r;for(const l of Array.from(e.getChildren())){if("tbody"!==l.name&&"thead"!==l.name&&"tfoot"!==l.name)continue;"thead"!==l.name||r||(r=l);const e=Array.from(l.getChildren()).filter(e=>e.is("element","tr"));for(const s of e)if(r&&l===r||"tbody"===l.name&&Array.from(s.getChildren()).length&&Array.from(s.getChildren()).every(e=>e.is("element","th")))o++,i.push(s);else{n.push(s);const e=ge(s);(!t||e<t)&&(t=e)}}return{headingRows:o,headingColumns:t||0,rows:[...i,...n]}}(i),s={};l&&(s.headingColumns=l),r&&(s.headingRows=r);const a=o.writer.createElement("table",s);if(o.safeInsert(a,t.modelCursor)){if(o.consumable.consume(i,{name:!0}),n.forEach(e=>o.convertItem(e,o.writer.createPositionAt(a,"end"))),o.convertChildren(i,o.writer.createPositionAt(a,"end")),a.isEmpty){const e=o.writer.createElement("tableRow");o.writer.insert(e,o.writer.createPositionAt(a,"end")),ce(o.writer,o.writer.createPositionAt(e,"end"))}o.updateConversionResult(a,t)}})}}function me(e){return t=>{t.on(`element:${e}`,(e,t,{writer:o})=>{if(!t.modelRange)return;const i=t.modelRange.start.nodeAfter,n=o.createPositionAt(i,0);if(t.viewItem.isEmpty)return void o.insertElement("paragraph",n);const r=Array.from(i.getChildren());if(r.every(e=>e.is("element","$marker"))){const e=o.createElement("paragraph");o.insert(e,o.createPositionAt(i,0));for(const t of r)o.move(o.createRangeOn(t),o.createPositionAt(e,"end"))}},{priority:"low"})}}function ge(e){let t=0,o=0;const i=Array.from(e.getChildren()).filter(e=>"th"===e.name||"td"===e.name);for(;o<i.length&&"th"===i[o].name;){const e=i[o];t+=parseInt(e.getAttribute("colspan")||"1"),o++}return t}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class pe{constructor(e,t={}){this._jumpedToStartRow=!1,this._table=e,this._startRow=void 0!==t.row?t.row:t.startRow||0,this._endRow=void 0!==t.row?t.row:t.endRow,this._startColumn=void 0!==t.column?t.column:t.startColumn||0,this._endColumn=void 0!==t.column?t.column:t.endColumn,this._includeAllSlots=!!t.includeAllSlots,this._skipRows=new Set,this._row=0,this._rowIndex=0,this._column=0,this._cellIndex=0,this._spannedCells=new Map,this._nextCellAtColumn=-1}[Symbol.iterator](){return this}next(){this._canJumpToStartRow()&&this._jumpToNonSpannedRowClosestToStartRow();const e=this._table.getChild(this._rowIndex);if(!e||this._isOverEndRow())return{done:!0,value:void 0};if(!e.is("element","tableRow"))return this._rowIndex++,this.next();if(this._isOverEndColumn())return this._advanceToNextRow();let t=null;const o=this._getSpanned();if(o)this._includeAllSlots&&!this._shouldSkipSlot()&&(t=this._formatOutValue(o.cell,o.row,o.column));else{const o=e.getChild(this._cellIndex);if(!o)return this._advanceToNextRow();const i=parseInt(o.getAttribute("colspan")||"1"),n=parseInt(o.getAttribute("rowspan")||"1");(i>1||n>1)&&this._recordSpans(o,n,i),this._shouldSkipSlot()||(t=this._formatOutValue(o)),this._nextCellAtColumn=this._column+i}return this._column++,this._column==this._nextCellAtColumn&&this._cellIndex++,t||this.next()}skipRow(e){this._skipRows.add(e)}_advanceToNextRow(){return this._row++,this._rowIndex++,this._column=0,this._cellIndex=0,this._nextCellAtColumn=-1,this.next()}_isOverEndRow(){return void 0!==this._endRow&&this._row>this._endRow}_isOverEndColumn(){return void 0!==this._endColumn&&this._column>this._endColumn}_formatOutValue(e,t=this._row,o=this._column){return{done:!1,value:new fe(this,e,t,o)}}_shouldSkipSlot(){const e=this._skipRows.has(this._row),t=this._row<this._startRow,o=this._column<this._startColumn,i=void 0!==this._endColumn&&this._column>this._endColumn;return e||t||o||i}_getSpanned(){const e=this._spannedCells.get(this._row);return e&&e.get(this._column)||null}_recordSpans(e,t,o){const i={cell:e,row:this._row,column:this._column};for(let e=this._row;e<this._row+t;e++)for(let t=this._column;t<this._column+o;t++)e==this._row&&t==this._column||this._markSpannedCell(e,t,i)}_markSpannedCell(e,t,o){this._spannedCells.has(e)||this._spannedCells.set(e,new Map);this._spannedCells.get(e).set(t,o)}_canJumpToStartRow(){return!!this._startRow&&this._startRow>0&&!this._jumpedToStartRow}_jumpToNonSpannedRowClosestToStartRow(){const e=this._getRowLength(0);for(let t=this._startRow;!this._jumpedToStartRow;t--)e===this._getRowLength(t)&&(this._row=t,this._rowIndex=t,this._jumpedToStartRow=!0)}_getRowLength(e){return[...this._table.getChild(e).getChildren()].reduce((e,t)=>e+parseInt(t.getAttribute("colspan")||"1"),0)}}class fe{constructor(e,t,o,i){this.cell=t,this.row=e._row,this.column=e._column,this.cellAnchorRow=o,this.cellAnchorColumn=i,this._cellIndex=e._cellIndex,this._rowIndex=e._rowIndex,this._table=e._table}get isAnchor(){return this.row===this.cellAnchorRow&&this.column===this.cellAnchorColumn}get cellWidth(){return parseInt(this.cell.getAttribute("colspan")||"1")}get cellHeight(){return parseInt(this.cell.getAttribute("rowspan")||"1")}get rowIndex(){return this._rowIndex}getPositionBefore(){return this._table.root.document.model.createPositionAt(this._table.getChild(this.row),this._cellIndex)}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */function we(e,t){return(o,{writer:i})=>{const r=o.getAttribute("headingRows")||0,l=i.createContainerElement("table",null,[]),s=i.createContainerElement("figure",{class:"table"},l);r>0&&i.insert(i.createPositionAt(l,"end"),i.createContainerElement("thead",null,i.createSlot(e=>e.is("element","tableRow")&&e.index<r))),r<e.getRows(o)&&i.insert(i.createPositionAt(l,"end"),i.createContainerElement("tbody",null,i.createSlot(e=>e.is("element","tableRow")&&e.index>=r)));for(const{positionOffset:e,filter:o}of t.additionalSlots)i.insert(i.createPositionAt(l,e),i.createSlot(o));return i.insert(i.createPositionAt(l,"after"),i.createSlot(e=>!e.is("element","tableRow")&&!t.additionalSlots.some(({filter:t})=>t(e)))),t.asWidget?function(e,t){return t.setCustomProperty("table",!0,e),n(e,t,{hasSelectionHandle:!0})}(s,i):s}}function ke(e={}){return(t,{writer:o})=>{const n=t.parent,r=n.parent,l=r.getChildIndex(n),s=new pe(r,{row:l}),a=r.getAttribute("headingRows")||0,c=r.getAttribute("headingColumns")||0;let d=null;for(const n of s)if(n.cell==t){const t=n.row<a||n.column<c?"th":"td";d=e.asWidget?i(o.createEditableElement(t),o):o.createContainerElement(t);break}return d}}function _e(e={}){return(t,{writer:o})=>{if(!t.parent.is("element","tableCell"))return null;if(!Ce(t))return null;if(e.asWidget)return o.createContainerElement("span",{class:"ck-table-bogus-paragraph"});{const e=o.createContainerElement("p");return o.setCustomProperty("dataPipeline:transparentRendering",!0,e),e}}}function Ce(e){return 1==e.parent.childCount&&!!e.getAttributeKeys().next().done}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */
class ve extends e{refresh(){const e=this.editor.model,t=e.document.selection,o=e.schema;this.isEnabled=function(e,t){const o=e.getFirstPosition().parent,i=o===o.root?o:o.parent;return t.checkChild(i,"table")}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */(t,o)}execute(e={}){const t=this.editor,o=t.model,i=t.plugins.get("TableUtils"),n=t.config.get("table.defaultHeadings.rows"),r=t.config.get("table.defaultHeadings.columns");void 0===e.headingRows&&n&&(e.headingRows=n),void 0===e.headingColumns&&r&&(e.headingColumns=r),o.change(t=>{const n=i.createTable(t,e);o.insertObject(n,null,null,{findOptimalPosition:"auto"}),t.setSelection(t.createPositionAt(n.getNodeByPath([0,0,0]),0))})}}class ye extends e{constructor(e,t={}){super(e),this.order=t.order||"below"}refresh(){const e=this.editor.model.document.selection,t=!!this.editor.plugins.get("TableUtils").getSelectionAffectedTableCells(e).length;this.isEnabled=t}execute(){const e=this.editor,t=e.model.document.selection,o=e.plugins.get("TableUtils"),i="above"===this.order,n=o.getSelectionAffectedTableCells(t),r=o.getRowIndexes(n),l=i?r.first:r.last,s=n[0].findAncestor("table");o.insertRows(s,{at:i?l:l+1,copyStructureFromAbove:!i})}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class Ae extends e{constructor(e,t={}){super(e),this.order=t.order||"right"}refresh(){const e=this.editor.model.document.selection,t=!!this.editor.plugins.get("TableUtils").getSelectionAffectedTableCells(e).length;this.isEnabled=t}execute(){const e=this.editor,t=e.model.document.selection,o=e.plugins.get("TableUtils"),i="left"===this.order,n=o.getSelectionAffectedTableCells(t),r=o.getColumnIndexes(n),l=i?r.first:r.last,s=n[0].findAncestor("table");o.insertColumns(s,{columns:1,at:i?l:l+1})}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class Te extends e{constructor(e,t={}){super(e),this.direction=t.direction||"horizontally"}refresh(){const e=this.editor.plugins.get("TableUtils").getSelectionAffectedTableCells(this.editor.model.document.selection);this.isEnabled=1===e.length}execute(){const e=this.editor.plugins.get("TableUtils"),t=e.getSelectionAffectedTableCells(this.editor.model.document.selection)[0];"horizontally"===this.direction?e.splitCellHorizontally(t,2):e.splitCellVertically(t,2)}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */function xe(e,t,o){const{startRow:i,startColumn:n,endRow:r,endColumn:l}=t,s=o.createElement("table"),a=r-i+1;for(let e=0;e<a;e++)o.insertElement("tableRow",s,"end");const c=[...new pe(e,{startRow:i,endRow:r,startColumn:n,endColumn:l,includeAllSlots:!0})];for(const{row:e,column:t,cell:a,isAnchor:d,cellAnchorRow:u,cellAnchorColumn:h}of c){const c=e-i,b=s.getChild(c);if(d){const i=o.cloneElement(a);o.append(i,b),Pe(i,e,t,r,l,o)}else(u<i||h<n)&&ce(o,o.createPositionAt(b,"end"))}return function(e,t,o,i,n){const r=parseInt(t.getAttribute("headingRows")||"0");if(r>0){ae("headingRows",r-o,e,n,0)}const l=parseInt(t.getAttribute("headingColumns")||"0");if(l>0){ae("headingColumns",l-i,e,n,0)}}(s,e,i,n,o),s}function Se(e,t,o=0){const i=[],n=new pe(e,{startRow:o,endRow:t-1});for(const e of n){const{row:o,cellHeight:n}=e;o<t&&t<=o+n-1&&i.push(e)}return i}function Ve(e,t,o){const i=e.parent,n=i.parent,r=i.index,l=t-r,s={},a=parseInt(e.getAttribute("rowspan"))-l;a>1&&(s.rowspan=a);const c=parseInt(e.getAttribute("colspan")||"1");c>1&&(s.colspan=c);const d=r+l,u=[...new pe(n,{startRow:r,endRow:d,includeAllSlots:!0})];let h,b=null;for(const t of u){const{row:i,column:n,cell:r}=t;r===e&&void 0===h&&(h=n),void 0!==h&&h===n&&i===d&&(b=ce(o,t.getPositionBefore(),s))}return ae("rowspan",l,e,o),b}function Re(e,t){const o=[],i=new pe(e);for(const e of i){const{column:i,cellWidth:n}=e;i<t&&t<=i+n-1&&o.push(e)}return o}function Ie(e,t,o,i){const n=o-t,r={},l=parseInt(e.getAttribute("colspan"))-n;l>1&&(r.colspan=l);const s=parseInt(e.getAttribute("rowspan")||"1");s>1&&(r.rowspan=s);const a=ce(i,i.createPositionAfter(e),r);return ae("colspan",n,e,i),a}function Pe(e,t,o,i,n,r){const l=parseInt(e.getAttribute("colspan")||"1"),s=parseInt(e.getAttribute("rowspan")||"1");if(o+l-1>n){ae("colspan",n-o+1,e,r,1)}if(t+s-1>i){ae("rowspan",i-t+1,e,r,1)}}function Ee(e,t){const o=t.getColumns(e),i=new Array(o).fill(0);for(const{column:t}of new pe(e))i[t]++;const n=i.reduce((e,t,o)=>t?e:[...e,o],[]);if(n.length>0){const o=n[n.length-1];return t.removeColumns(e,{at:o}),!0}return!1}function ze(e,t){const o=[],i=t.getRows(e);for(let t=0;t<i;t++){e.getChild(t).isEmpty&&o.push(t)}if(o.length>0){const i=o[o.length-1];return t.removeRows(e,{at:i}),!0}return!1}function Be(e,t){Ee(e,t)||ze(e,t)}function We(e,t){const o=Array.from(new pe(e,{startColumn:t.firstColumn,endColumn:t.lastColumn,row:t.lastRow}));if(o.every(({cellHeight:e})=>1===e))return t.lastRow;const i=o[0].cellHeight-1;return t.lastRow+i}function Ne(e,t){const o=Array.from(new pe(e,{startRow:t.firstRow,endRow:t.lastRow,column:t.lastColumn}));if(o.every(({cellWidth:e})=>1===e))return t.lastColumn;const i=o[0].cellWidth-1;return t.lastColumn+i}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class Le extends e{constructor(e,t){super(e),this.direction=t.direction,this.isHorizontal="right"==this.direction||"left"==this.direction}refresh(){const e=this._getMergeableCell();this.value=e,this.isEnabled=!!e}execute(){const e=this.editor.model,t=e.document,o=this.editor.plugins.get("TableUtils").getTableCellsContainingSelection(t.selection)[0],i=this.value,n=this.direction;e.change(e=>{const t="right"==n||"down"==n,r=t?o:i,l=t?i:o,s=l.parent;!function(e,t,o){Fe(e)||(Fe(t)&&o.remove(o.createRangeIn(t)),o.move(o.createRangeIn(e),o.createPositionAt(t,"end")));o.remove(e)}(l,r,e);const a=this.isHorizontal?"colspan":"rowspan",c=parseInt(o.getAttribute(a)||"1"),d=parseInt(i.getAttribute(a)||"1");e.setAttribute(a,c+d,r),e.setSelection(e.createRangeIn(r));const u=this.editor.plugins.get("TableUtils");Be(s.findAncestor("table"),u)})}_getMergeableCell(){const e=this.editor.model.document,t=this.editor.plugins.get("TableUtils"),o=t.getTableCellsContainingSelection(e.selection)[0];if(!o)return;const i=this.isHorizontal?function(e,t,o){const i=e.parent,n=i.parent,r="right"==t?e.nextSibling:e.previousSibling,l=(n.getAttribute("headingColumns")||0)>0;if(!r)return;const s="right"==t?e:r,a="right"==t?r:e,{column:c}=o.getCellLocation(s),{column:d}=o.getCellLocation(a),u=parseInt(s.getAttribute("colspan")||"1"),h=de(o,s),b=de(o,a);if(l&&h!=b)return;return c+u===d?r:void 0}(o,this.direction,t):function(e,t,o){const i=e.parent,n=i.parent,r=n.getChildIndex(i);if("down"==t&&r===o.getRows(n)-1||"up"==t&&0===r)return null;const l=parseInt(e.getAttribute("rowspan")||"1"),s=n.getAttribute("headingRows")||0,a="down"==t&&r+l===s,c="up"==t&&r===s;if(s&&(a||c))return null;const d=parseInt(e.getAttribute("rowspan")||"1"),u="down"==t?r+d:r,h=[...new pe(n,{endRow:u})],b=h.find(t=>t.cell===e),m=b.column,g=h.find(({row:e,cellHeight:o,column:i})=>i===m&&("down"==t?e===u:u===e+o));return g&&g.cell?g.cell:null}(o,this.direction,t);if(!i)return;const n=this.isHorizontal?"rowspan":"colspan",r=parseInt(o.getAttribute(n)||"1");return parseInt(i.getAttribute(n)||"1")===r?i:void 0}}function Fe(e){const t=e.getChild(0);return 1==e.childCount&&t.is("element","paragraph")&&t.isEmpty}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class De extends e{refresh(){const e=this.editor.plugins.get("TableUtils"),t=e.getSelectionAffectedTableCells(this.editor.model.document.selection),o=t[0];if(o){const i=o.findAncestor("table"),n=e.getRows(i)-1,r=e.getRowIndexes(t),l=0===r.first&&r.last===n;this.isEnabled=!l}else this.isEnabled=!1}execute(){const e=this.editor.model,t=this.editor.plugins.get("TableUtils"),o=t.getSelectionAffectedTableCells(e.document.selection),i=t.getRowIndexes(o),n=o[0],r=n.findAncestor("table"),l=t.getCellLocation(n).column;e.change(e=>{const o=i.last-i.first+1;t.removeRows(r,{at:i.first,rows:o});const n=function(e,t,o,i){const n=e.getChild(Math.min(t,i-1));let r=n.getChild(0),l=0;for(const e of n.getChildren()){if(l>o)return r;r=e,l+=parseInt(e.getAttribute("colspan")||"1")}return r}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */(r,i.first,l,t.getRows(r));e.setSelection(e.createPositionAt(n,0))})}}class He extends e{refresh(){const e=this.editor.plugins.get("TableUtils"),t=e.getSelectionAffectedTableCells(this.editor.model.document.selection),o=t[0];if(o){const i=o.findAncestor("table"),n=e.getColumns(i),{first:r,last:l}=e.getColumnIndexes(t);this.isEnabled=l-r<n-1}else this.isEnabled=!1}execute(){const e=this.editor.plugins.get("TableUtils"),[t,o]=function(e,t){const o=t.getSelectionAffectedTableCells(e),i=o[0],n=o.pop(),r=[i,n];return i.isBefore(n)?r:r.reverse()}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */(this.editor.model.document.selection,e),i=t.parent.parent,n=[...new pe(i)],r={first:n.find(e=>e.cell===t).column,last:n.find(e=>e.cell===o).column},l=function(e,t,o,i){const n=parseInt(o.getAttribute("colspan")||"1");return n>1?o:t.previousSibling||o.nextSibling?o.nextSibling||t.previousSibling:i.first?e.reverse().find(({column:e})=>e<i.first).cell:e.reverse().find(({column:e})=>e>i.last).cell}(n,t,o,r);this.editor.model.change(t=>{const o=r.last-r.first+1;e.removeColumns(i,{at:r.first,columns:o}),t.setSelection(t.createPositionAt(l,0))})}}class Oe extends e{refresh(){const e=this.editor.plugins.get("TableUtils"),t=this.editor.model,o=e.getSelectionAffectedTableCells(t.document.selection),i=o.length>0;this.isEnabled=i,this.value=i&&o.every(e=>this._isInHeading(e,e.parent.parent))}execute(e={}){if(e.forceValue===this.value)return;const t=this.editor.plugins.get("TableUtils"),o=this.editor.model,i=t.getSelectionAffectedTableCells(o.document.selection),n=i[0].findAncestor("table"),{first:r,last:l}=t.getRowIndexes(i),s=this.value?r:l+1,a=n.getAttribute("headingRows")||0;o.change(e=>{if(s){const t=Se(n,s,s>a?a:0);for(const{cell:o}of t)Ve(o,s,e)}ae("headingRows",s,n,e,0)})}_isInHeading(e,t){const o=parseInt(t.getAttribute("headingRows")||"0");return!!o&&e.parent.index<o}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class Me extends e{refresh(){const e=this.editor.model,t=this.editor.plugins.get("TableUtils"),o=t.getSelectionAffectedTableCells(e.document.selection),i=o.length>0;this.isEnabled=i,this.value=i&&o.every(e=>de(t,e))}execute(e={}){if(e.forceValue===this.value)return;const t=this.editor.plugins.get("TableUtils"),o=this.editor.model,i=t.getSelectionAffectedTableCells(o.document.selection),n=i[0].findAncestor("table"),{first:r,last:l}=t.getColumnIndexes(i),s=this.value?r:l+1;o.change(e=>{if(s){const t=Re(n,s);for(const{cell:o,column:i}of t)Ie(o,i,s,e)}ae("headingColumns",s,n,e,0)})}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */function Ue(e,t){return 4e3/$e(e,t)}function $e(e,t){const o=je(e,"tbody",t)||je(e,"thead",t);return qe(t.editing.view.domConverter.mapViewToDom(o))}function je(e,t,o){return[...[...o.editing.mapper.toViewElement(e).getChildren()].find(e=>e.is("element","table")).getChildren()].find(e=>e.is("element",t))}function qe(e){const t=c.window.getComputedStyle(e);return"border-box"===t.boxSizing?parseFloat(t.width)-parseFloat(t.paddingLeft)-parseFloat(t.paddingRight)-parseFloat(t.borderLeftWidth)-parseFloat(t.borderRightWidth):parseFloat(t.width)}function Ge(e){const t=Math.pow(10,2),o="number"==typeof e?e:parseFloat(e);return Math.round(o*t)/t}function Ke(e,t){return Array(e).fill(t)}function Je(e){return e.map(e=>"number"==typeof e?e:parseFloat(e)).filter(e=>!Number.isNaN(e)).reduce((e,t)=>e+t,0)}function Xe(e){let t=function(e){const t=e.filter(e=>"auto"===e).length;if(0===t)return e.map(e=>Ge(e));const o=Je(e),i=Math.max((100-o)/t,5);return e.map(e=>"auto"===e?i:e).map(e=>Ge(e))}(e.map(e=>"auto"===e?e:parseFloat(e.replace("%",""))));const o=Je(t);return 100!==o&&(t=t.map(e=>Ge(100*e/o)).map((e,t,o)=>{if(!(t===o.length-1))return e;return Ge(e+100-Je(o))})),t.map(e=>e+"%")}function Ye(e){const t=c.window.getComputedStyle(e);return"border-box"===t.boxSizing?parseInt(t.width):parseFloat(t.width)+parseFloat(t.paddingLeft)+parseFloat(t.paddingRight)+parseFloat(t.borderWidth)}function Qe(e,t,o,i){for(let n=0;n<Math.max(o.length,e.length);n++){const r=e[n],l=o[n];l?r?i.setAttribute("columnWidth",l,r):i.appendElement("tableColumn",{columnWidth:l},t):i.remove(r)}}function Ze(e){if(e.is("element","tableColumnGroup"))return e;const t=e.getChildren();return Array.from(t).find(e=>e.is("element","tableColumnGroup"))}function et(e){const t=Ze(e);return t?Array.from(t.getChildren()):[]}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */
class tt extends t{static get pluginName(){return"TableUtils"}static get isOfficialPlugin(){return!0}init(){this.decorate("insertColumns"),this.decorate("insertRows")}getCellLocation(e){const t=e.parent,o=t.parent,i=o.getChildIndex(t),n=new pe(o,{row:i});for(const{cell:t,row:o,column:i}of n)if(t===e)return{row:o,column:i};
/* istanbul ignore next -- @preserve */}createTable(e,t){const o=e.createElement("table"),i=t.rows||2,n=t.columns||2;return ot(e,o,0,i,n),t.headingRows&&ae("headingRows",Math.min(t.headingRows,i),o,e,0),t.headingColumns&&ae("headingColumns",Math.min(t.headingColumns,n),o,e,0),o}insertRows(e,t={}){const o=this.editor.model,i=t.at||0,n=t.rows||1,r=void 0!==t.copyStructureFromAbove,l=t.copyStructureFromAbove?i-1:i,s=this.getRows(e),a=this.getColumns(e);if(i>s)throw new d("tableutils-insertrows-insert-out-of-range",this,{options:t});o.change(t=>{const o=e.getAttribute("headingRows")||0;if(o>i&&ae("headingRows",o+n,e,t,0),!r&&(0===i||i===s))return void ot(t,e,i,n,a);const c=r?Math.max(i,l):i,d=new pe(e,{endRow:c}),u=new Array(a).fill(1);for(const{row:e,column:o,cellHeight:s,cellWidth:a,cell:c}of d){const d=e+s-1,h=e<=l&&l<=d;e<i&&i<=d?(t.setAttribute("rowspan",s+n,c),u[o]=-a):r&&h&&(u[o]=a)}for(let o=0;o<n;o++){const o=t.createElement("tableRow");t.insert(o,e,i);for(let e=0;e<u.length;e++){const i=u[e],n=t.createPositionAt(o,"end");i>0&&ce(t,n,i>1?{colspan:i}:void 0),e+=Math.abs(i)-1}}})}insertColumns(e,t={}){const o=this.editor.model,i=t.at||0,n=t.columns||1;o.change(t=>{const o=e.getAttribute("headingColumns");i<o&&t.setAttribute("headingColumns",o+n,e);const r=this.getColumns(e);if(0===i||r===i){for(const o of e.getChildren())o.is("element","tableRow")&&it(n,t,t.createPositionAt(o,i?"end":0));return}const l=new pe(e,{column:i,includeAllSlots:!0});for(const e of l){const{row:o,cell:r,cellAnchorColumn:s,cellAnchorRow:a,cellWidth:c,cellHeight:d}=e;if(s<i){t.setAttribute("colspan",c+n,r);const e=a+d-1;for(let t=o;t<=e;t++)l.skipRow(t)}else it(n,t,e.getPositionBefore())}})}removeRows(e,t){const o=this.editor.model,i=t.rows||1,n=this.getRows(e),r=t.at,l=r+i-1;if(l>n-1)throw new d("tableutils-removerows-row-index-out-of-range",this,{table:e,options:t});o.change(t=>{const o={first:r,last:l},{cellsToMove:i,cellsToTrim:n}=function(e,{first:t,last:o}){const i=new Map,n=[];for(const{row:r,column:l,cellHeight:s,cell:a}of new pe(e,{endRow:o})){const e=r+s-1;if(r>=t&&r<=o&&e>o){const e=s-(o-r+1);i.set(l,{cell:a,rowspan:e})}if(r<t&&e>=t){let i;i=e>=o?o-t+1:e-t+1,n.push({cell:a,rowspan:s-i})}}return{cellsToMove:i,cellsToTrim:n}}(e,o);if(i.size){!function(e,t,o,i){const n=new pe(e,{includeAllSlots:!0,row:t}),r=[...n],l=e.getChild(t);let s;for(const{column:e,cell:t,isAnchor:n}of r)if(o.has(e)){const{cell:t,rowspan:n}=o.get(e),r=s?i.createPositionAfter(s):i.createPositionAt(l,0);i.move(i.createRangeOn(t),r),ae("rowspan",n,t,i),s=t}else n&&(s=t)}(e,l+1,i,t)}for(let o=l;o>=r;o--)t.remove(e.getChild(o));for(const{rowspan:e,cell:o}of n)ae("rowspan",e,o,t);!function(e,{first:t,last:o},i){const n=e.getAttribute("headingRows")||0;if(t<n){ae("headingRows",o<n?n-(o-t+1):t,e,i,0)}}(e,o,t),Ee(e,this)||ze(e,this)})}removeColumns(e,t){const o=this.editor.model,i=t.at,n=t.columns||1,r=t.at+n-1;o.change(t=>{!function(e,t,o){const i=e.getAttribute("headingColumns")||0;if(i&&t.first<i){const n=Math.min(i-1,t.last)-t.first+1;o.setAttribute("headingColumns",i-n,e)}}(e,{first:i,last:r},t);const o=et(e);for(let n=r;n>=i;n--){for(const{cell:o,column:i,cellWidth:r}of[...new pe(e)])i<=n&&r>1&&i+r>n?ae("colspan",r-1,o,t):i===n&&t.remove(o);if(o[n]){const e=0===n?o[1]:o[n-1],i=parseFloat(o[n].getAttribute("columnWidth")),r=parseFloat(e.getAttribute("columnWidth"));t.remove(o[n]),t.setAttribute("columnWidth",i+r+"%",e)}}ze(e,this)||Ee(e,this)})}splitCellVertically(e,t=2){const o=this.editor.model,i=e.parent.parent,n=parseInt(e.getAttribute("rowspan")||"1"),r=parseInt(e.getAttribute("colspan")||"1");o.change(o=>{if(r>1){const{newCellsSpan:i,updatedSpan:l}=nt(r,t);ae("colspan",l,e,o);const s={};i>1&&(s.colspan=i),n>1&&(s.rowspan=n);it(r>t?t-1:r-1,o,o.createPositionAfter(e),s)}if(r<t){const l=t-r,s=[...new pe(i)],{column:a}=s.find(({cell:t})=>t===e),c=s.filter(({cell:t,cellWidth:o,column:i})=>t!==e&&i===a||i<a&&i+o>a);for(const{cell:e,cellWidth:t}of c)o.setAttribute("colspan",t+l,e);const d={};n>1&&(d.rowspan=n),it(l,o,o.createPositionAfter(e),d);const u=i.getAttribute("headingColumns")||0;u>a&&ae("headingColumns",u+l,i,o)}})}splitCellHorizontally(e,t=2){const o=this.editor.model,i=e.parent,n=i.parent,r=n.getChildIndex(i),l=parseInt(e.getAttribute("rowspan")||"1"),s=parseInt(e.getAttribute("colspan")||"1");o.change(o=>{if(l>1){const i=[...new pe(n,{startRow:r,endRow:r+l-1,includeAllSlots:!0})],{newCellsSpan:a,updatedSpan:c}=nt(l,t);ae("rowspan",c,e,o);const{column:d}=i.find(({cell:t})=>t===e),u={};a>1&&(u.rowspan=a),s>1&&(u.colspan=s);let h=0;for(const e of i){const{column:t,row:i}=e,n=t===d;h>=a&&n&&(h=0),i>=r+c&&n&&(h||it(1,o,e.getPositionBefore(),u),h++)}}if(l<t){const i=t-l,a=[...new pe(n,{startRow:0,endRow:r})];for(const{cell:t,cellHeight:n,row:l}of a)if(t!==e&&l+n>r){const e=n+i;o.setAttribute("rowspan",e,t)}const c={};s>1&&(c.colspan=s),ot(o,n,r+1,i,1,c);const d=n.getAttribute("headingRows")||0;d>r&&ae("headingRows",d+i,n,o)}})}getColumns(e){return[...e.getChild(0).getChildren()].filter(e=>e.is("element","tableCell")).reduce((e,t)=>e+parseInt(t.getAttribute("colspan")||"1"),0)}getRows(e){return Array.from(e.getChildren()).reduce((e,t)=>t.is("element","tableRow")?e+1:e,0)}createTableWalker(e,t={}){return new pe(e,t)}getSelectedTableCells(e){const t=[];for(const o of this.sortRanges(e.getRanges())){const e=o.getContainedElement();e&&e.is("element","tableCell")&&t.push(e)}return t}getTableCellsContainingSelection(e){const t=[];for(const o of e.getRanges()){const e=o.start.findAncestor("tableCell");e&&t.push(e)}return t}getSelectionAffectedTableCells(e){const t=this.getSelectedTableCells(e);return t.length?t:this.getTableCellsContainingSelection(e)}getRowIndexes(e){const t=e.map(e=>e.parent.index);return this._getFirstLastIndexesObject(t)}getColumnIndexes(e){const t=e[0].findAncestor("table"),o=[...new pe(t)].filter(t=>e.includes(t.cell)).map(e=>e.column);return this._getFirstLastIndexesObject(o)}isSelectionRectangular(e){if(e.length<2||!this._areCellInTheSameTableSection(e))return!1;const t=new Set,o=new Set;let i=0;for(const n of e){const{row:e,column:r}=this.getCellLocation(n),l=parseInt(n.getAttribute("rowspan"))||1,s=parseInt(n.getAttribute("colspan"))||1;t.add(e),o.add(r),l>1&&t.add(e+l-1),s>1&&o.add(r+s-1),i+=l*s}const n=function(e,t){const o=Array.from(e.values()),i=Array.from(t.values()),n=Math.max(...o),r=Math.min(...o),l=Math.max(...i),s=Math.min(...i);return(n-r+1)*(l-s+1)}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */(t,o);return n==i}sortRanges(e){return Array.from(e).sort(rt)}_getFirstLastIndexesObject(e){const t=e.sort((e,t)=>e-t);return{first:t[0],last:t[t.length-1]}}_areCellInTheSameTableSection(e){const t=e[0].findAncestor("table"),o=this.getRowIndexes(e),i=parseInt(t.getAttribute("headingRows"))||0;if(!this._areIndexesInSameSection(o,i))return!1;const n=this.getColumnIndexes(e),r=parseInt(t.getAttribute("headingColumns"))||0;return this._areIndexesInSameSection(n,r)}_areIndexesInSameSection({first:e,last:t},o){return e<o===t<o}}function ot(e,t,o,i,n,r={}){for(let l=0;l<i;l++){const i=e.createElement("tableRow");e.insert(i,t,o),it(n,e,e.createPositionAt(i,"end"),r)}}function it(e,t,o,i={}){for(let n=0;n<e;n++)ce(t,o,i)}function nt(e,t){if(e<t)return{newCellsSpan:1,updatedSpan:1};const o=Math.floor(e/t);return{newCellsSpan:o,updatedSpan:e-o*t+o}}function rt(e,t){const o=e.start,i=t.start;return o.isBefore(i)?-1:1}class lt extends e{refresh(){const e=this.editor.plugins.get(tt),t=e.getSelectedTableCells(this.editor.model.document.selection);this.isEnabled=e.isSelectionRectangular(t)}execute(){const e=this.editor.model,t=this.editor.plugins.get(tt);e.change(o=>{const i=t.getSelectedTableCells(e.document.selection),n=i.shift(),{mergeWidth:r,mergeHeight:l}=function(e,t,o){let i=0,n=0;for(const e of t){const{row:t,column:r}=o.getCellLocation(e);i=ct(e,r,i,"colspan"),n=ct(e,t,n,"rowspan")}const{row:r,column:l}=o.getCellLocation(e),s=i-l,a=n-r;return{mergeWidth:s,mergeHeight:a}}(n,i,t);ae("colspan",r,n,o),ae("rowspan",l,n,o);for(const e of i)st(e,n,o);Be(n.findAncestor("table"),t),o.setSelection(n,"in")})}}function st(e,t,o){at(e)||(at(t)&&o.remove(o.createRangeIn(t)),o.move(o.createRangeIn(e),o.createPositionAt(t,"end"))),o.remove(e)}function at(e){const t=e.getChild(0);return 1==e.childCount&&t.is("element","paragraph")&&t.isEmpty}function ct(e,t,o,i){const n=parseInt(e.getAttribute(i)||"1");return Math.max(o,t+n)}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class dt extends e{constructor(e){super(e),this.affectsData=!1}refresh(){const e=this.editor.plugins.get("TableUtils").getSelectionAffectedTableCells(this.editor.model.document.selection);this.isEnabled=e.length>0}execute(){const e=this.editor.model,t=this.editor.plugins.get("TableUtils"),o=t.getSelectionAffectedTableCells(e.document.selection),i=t.getRowIndexes(o),n=o[0].findAncestor("table"),r=[];for(let t=i.first;t<=i.last;t++)for(const o of n.getChild(t).getChildren())r.push(e.createRangeOn(o));e.change(e=>{e.setSelection(r)})}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class ut extends e{constructor(e){super(e),this.affectsData=!1}refresh(){const e=this.editor.plugins.get("TableUtils").getSelectionAffectedTableCells(this.editor.model.document.selection);this.isEnabled=e.length>0}execute(){const e=this.editor.plugins.get("TableUtils"),t=this.editor.model,o=e.getSelectionAffectedTableCells(t.document.selection),i=o[0],n=o.pop(),r=i.findAncestor("table"),l=e.getCellLocation(i),s=e.getCellLocation(n),a=Math.min(l.column,s.column),c=Math.max(l.column,s.column),d=[];for(const e of new pe(r,{startColumn:a,endColumn:c}))d.push(t.createRangeOn(e.cell));t.change(e=>{e.setSelection(d)})}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */function ht(e){e.document.registerPostFixer(t=>function(e,t){const o=t.document.differ.getChanges();let i=!1;const n=new Set;for(const t of o){let o=null;"insert"==t.type&&"table"==t.name&&(o=t.position.nodeAfter),"insert"!=t.type&&"remove"!=t.type||"tableRow"!=t.name&&"tableCell"!=t.name||(o=t.position.findAncestor("table")),gt(t)&&(o=t.range.start.findAncestor("table")),o&&!n.has(o)&&(i=bt(o,e)||i,i=mt(o,e)||i,n.add(o))}return i}(t,e))}function bt(e,t){let o=!1;const i=function(e){const t=parseInt(e.getAttribute("headingRows")||"0"),o=Array.from(e.getChildren()).reduce((e,t)=>t.is("element","tableRow")?e+1:e,0),i=[];for(const{row:n,cell:r,cellHeight:l}of new pe(e)){if(l<2)continue;const e=n<t?t:o;if(n+l>e){const t=e-n;i.push({cell:r,rowspan:t})}}return i}(e);if(i.length){o=!0;for(const e of i)ae("rowspan",e.rowspan,e.cell,t,1)}return o}function mt(e,t){let o=!1;const i=function(e){const t=new Array(e.childCount).fill(0);for(const{rowIndex:o}of new pe(e,{includeAllSlots:!0}))t[o]++;return t}(e),n=[];for(const[t,o]of i.entries())!o&&e.getChild(t).is("element","tableRow")&&n.push(t);if(n.length){o=!0;for(const o of n.reverse())t.remove(e.getChild(o)),i.splice(o,1)}const r=i.filter((t,o)=>e.getChild(o).is("element","tableRow")),l=r[0];if(!r.every(e=>e===l)){const i=r.reduce((e,t)=>t>e?t:e,0);for(const[n,l]of r.entries()){const r=i-l;if(r){for(let o=0;o<r;o++)ce(t,t.createPositionAt(e.getChild(n),"end"));o=!0}}}return o}function gt(e){if("attribute"!==e.type)return!1;const t=e.attributeKey;return"headingRows"===t||"colspan"===t||"rowspan"===t}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */function pt(e){e.document.registerPostFixer(t=>function(e,t){const o=t.document.differ.getChanges();let i=!1;for(const t of o)"insert"==t.type&&"table"==t.name&&(i=ft(t.position.nodeAfter,e)||i),"insert"==t.type&&"tableRow"==t.name&&(i=wt(t.position.nodeAfter,e)||i),"insert"==t.type&&"tableCell"==t.name&&(i=kt(t.position.nodeAfter,e)||i),"remove"!=t.type&&"insert"!=t.type||!_t(t)||(i=kt(t.position.parent,e)||i);return i}(t,e))}function ft(e,t){let o=!1;for(const i of e.getChildren())i.is("element","tableRow")&&(o=wt(i,t)||o);return o}function wt(e,t){let o=!1;for(const i of e.getChildren())o=kt(i,t)||o;return o}function kt(e,t){if(0==e.childCount)return t.insertElement("paragraph",e),!0;const o=Array.from(e.getChildren()).filter(e=>e.is("$text"));for(const e of o)t.wrap(t.createRangeOn(e),"paragraph");return!!o.length}function _t(e){return!!e.position.parent.is("element","tableCell")&&("insert"==e.type&&"$text"==e.name||"remove"==e.type)}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */function Ct(e,t){if(!e.is("element","paragraph"))return!1;const o=t.toViewElement(e);return!!o&&Ce(e)!==o.is("element","span")}function vt(e,{insertAt:t}={}){if(!e||"undefined"==typeof document)return;const o=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css",window.litNonce&&i.setAttribute("nonce",window.litNonce),"top"===t&&o.firstChild?o.insertBefore(i,o.firstChild):o.appendChild(i),i.styleSheet?i.styleSheet.cssText=e:i.appendChild(document.createTextNode(e))}vt(":root{--ck-color-selector-focused-cell-background:rgba(158,201,250,.3)}.ck-widget.table td.ck-editor__nested-editable.ck-editor__nested-editable_focused,.ck-widget.table td.ck-editor__nested-editable:focus,.ck-widget.table th.ck-editor__nested-editable.ck-editor__nested-editable_focused,.ck-widget.table th.ck-editor__nested-editable:focus{background:var(--ck-color-selector-focused-cell-background);outline:1px solid var(--ck-color-focus-border);outline-offset:-1px}");
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */
class yt extends t{static get pluginName(){return"TableEditing"}static get isOfficialPlugin(){return!0}static get requires(){return[tt]}constructor(e){super(e),this._additionalSlots=[]}init(){const e=this.editor,t=e.model,o=t.schema,i=e.conversion,n=e.plugins.get(tt);o.register("table",{inheritAllFrom:"$blockObject",allowAttributes:["headingRows","headingColumns"]}),o.register("tableRow",{allowIn:"table",isLimit:!0}),o.register("tableCell",{allowContentOf:"$container",allowIn:"tableRow",allowAttributes:["colspan","rowspan"],isLimit:!0,isSelectable:!0}),i.for("upcast").add(e=>{e.on("element:figure",(e,t,o)=>{if(!o.consumable.test(t.viewItem,{name:!0,classes:"table"}))return;const i=function(e){for(const t of e.getChildren())if(t.is("element","table"))return t}(t.viewItem);if(!i||!o.consumable.test(i,{name:!0}))return;o.consumable.consume(t.viewItem,{name:!0,classes:"table"});const n=o.convertItem(i,t.modelCursor),r=a(n.modelRange.getItems());r?(o.convertChildren(t.viewItem,o.writer.createPositionAt(r,"end")),o.updateConversionResult(r,t)):o.consumable.revert(t.viewItem,{name:!0,classes:"table"})})}),i.for("upcast").add(be()),i.for("editingDowncast").elementToStructure({model:{name:"table",attributes:["headingRows"]},view:we(n,{asWidget:!0,additionalSlots:this._additionalSlots})}),i.for("dataDowncast").elementToStructure({model:{name:"table",attributes:["headingRows"]},view:we(n,{additionalSlots:this._additionalSlots})}),i.for("upcast").elementToElement({model:"tableRow",view:"tr"}),i.for("upcast").add(e=>{e.on("element:tr",(e,t)=>{t.viewItem.isEmpty&&0==t.modelCursor.index&&e.stop()},{priority:"high"})}),i.for("downcast").elementToElement({model:"tableRow",view:(e,{writer:t})=>e.isEmpty?t.createEmptyElement("tr"):t.createContainerElement("tr")}),i.for("upcast").elementToElement({model:"tableCell",view:"td"}),i.for("upcast").elementToElement({model:"tableCell",view:"th"}),i.for("upcast").add(me("td")),i.for("upcast").add(me("th")),i.for("editingDowncast").elementToElement({model:"tableCell",view:ke({asWidget:!0})}),i.for("dataDowncast").elementToElement({model:"tableCell",view:ke()}),i.for("editingDowncast").elementToElement({model:"paragraph",view:_e({asWidget:!0}),converterPriority:"high"}),i.for("dataDowncast").elementToElement({model:"paragraph",view:_e(),converterPriority:"high"}),i.for("downcast").attributeToAttribute({model:"colspan",view:"colspan"}),i.for("upcast").attributeToAttribute({model:{key:"colspan",value:At("colspan")},view:"colspan"}),i.for("downcast").attributeToAttribute({model:"rowspan",view:"rowspan"}),i.for("upcast").attributeToAttribute({model:{key:"rowspan",value:At("rowspan")},view:"rowspan"}),e.config.define("table.defaultHeadings.rows",0),e.config.define("table.defaultHeadings.columns",0),e.commands.add("insertTable",new ve(e)),e.commands.add("insertTableRowAbove",new ye(e,{order:"above"})),e.commands.add("insertTableRowBelow",new ye(e,{order:"below"})),e.commands.add("insertTableColumnLeft",new Ae(e,{order:"left"})),e.commands.add("insertTableColumnRight",new Ae(e,{order:"right"})),e.commands.add("removeTableRow",new De(e)),e.commands.add("removeTableColumn",new He(e)),e.commands.add("splitTableCellVertically",new Te(e,{direction:"vertically"})),e.commands.add("splitTableCellHorizontally",new Te(e,{direction:"horizontally"})),e.commands.add("mergeTableCells",new lt(e)),e.commands.add("mergeTableCellRight",new Le(e,{direction:"right"})),e.commands.add("mergeTableCellLeft",new Le(e,{direction:"left"})),e.commands.add("mergeTableCellDown",new Le(e,{direction:"down"})),e.commands.add("mergeTableCellUp",new Le(e,{direction:"up"})),e.commands.add("setTableColumnHeader",new Me(e)),e.commands.add("setTableRowHeader",new Oe(e)),e.commands.add("selectTableRow",new dt(e)),e.commands.add("selectTableColumn",new ut(e)),ht(t),pt(t),this.listenTo(t.document,"change:data",()=>{!function(e,t){const o=e.document.differ;for(const e of o.getChanges()){let o,i=!1;if("attribute"==e.type){const t=e.range.start.nodeAfter;if(!t||!t.is("element","table"))continue;if("headingRows"!=e.attributeKey&&"headingColumns"!=e.attributeKey)continue;o=t,i="headingRows"==e.attributeKey}else"tableRow"!=e.name&&"tableCell"!=e.name||(o=e.position.findAncestor("table"),i="tableRow"==e.name);if(!o)continue;const n=o.getAttribute("headingRows")||0,r=o.getAttribute("headingColumns")||0,l=new pe(o);for(const e of l){const o=e.row<n||e.column<r?"th":"td",l=t.mapper.toViewElement(e.cell);l&&l.is("element")&&l.name!=o&&t.reconvertItem(i?e.cell.parent:e.cell)}}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */(t,e.editing),function(e,t){const o=e.document.differ,i=new Set;for(const e of o.getChanges()){const t="attribute"==e.type?e.range.start.parent:e.position.parent;t.is("element","tableCell")&&i.add(t)}for(const e of i.values()){const o=Array.from(e.getChildren()).filter(e=>Ct(e,t.mapper));for(const e of o)t.reconvertItem(e)}}(t,e.editing)})}registerAdditionalSlot(e){this._additionalSlots.push(e)}}function At(e){return t=>{const o=parseInt(t.getAttribute(e));return Number.isNaN(o)||o<=0?null:o}}vt(".ck .ck-insert-table-dropdown__grid{display:flex;flex-direction:row;flex-wrap:wrap}:root{--ck-insert-table-dropdown-padding:10px;--ck-insert-table-dropdown-box-height:11px;--ck-insert-table-dropdown-box-width:12px;--ck-insert-table-dropdown-box-margin:1px}.ck .ck-insert-table-dropdown__grid{padding:var(--ck-insert-table-dropdown-padding) var(--ck-insert-table-dropdown-padding) 0;width:calc(var(--ck-insert-table-dropdown-box-width)*10 + var(--ck-insert-table-dropdown-box-margin)*20 + var(--ck-insert-table-dropdown-padding)*2)}.ck .ck-insert-table-dropdown__label,.ck[dir=rtl] .ck-insert-table-dropdown__label{text-align:center}.ck .ck-insert-table-dropdown-grid-box{border:1px solid var(--ck-color-base-border);border-radius:1px;margin:var(--ck-insert-table-dropdown-box-margin);min-height:var(--ck-insert-table-dropdown-box-height);min-width:var(--ck-insert-table-dropdown-box-width);outline:none;transition:none}@media (prefers-reduced-motion:reduce){.ck .ck-insert-table-dropdown-grid-box{transition:none}}.ck .ck-insert-table-dropdown-grid-box:focus{box-shadow:none}.ck .ck-insert-table-dropdown-grid-box.ck-on{background:var(--ck-color-focus-outer-shadow);border-color:var(--ck-color-focus-border)}");
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */
class Tt extends f{constructor(e){super(e);const t=this.bindTemplate;this.items=this._createGridCollection(),this.keystrokes=new u,this.focusTracker=new h,this.set("rows",0),this.set("columns",0),this.bind("label").to(this,"columns",this,"rows",(e,t)=>`${t} × ${e}`),this.setTemplate({tag:"div",attributes:{class:["ck"]},children:[{tag:"div",attributes:{class:["ck-insert-table-dropdown__grid"]},on:{"mouseover@.ck-insert-table-dropdown-grid-box":t.to("boxover")},children:this.items},{tag:"div",attributes:{class:["ck","ck-insert-table-dropdown__label"],"aria-hidden":!0},children:[{text:t.to("label")}]}],on:{mousedown:t.to(e=>{e.preventDefault()}),click:t.to(()=>{this.fire("execute")})}}),this.on("boxover",(e,t)=>{const{row:o,column:i}=t.target.dataset;this.items.get(10*(parseInt(o,10)-1)+(parseInt(i,10)-1)).focus()}),this.focusTracker.on("change:focusedElement",(e,t,o)=>{if(!o)return;const{row:i,column:n}=o.dataset;this.set({rows:parseInt(i),columns:parseInt(n)})}),this.on("change:columns",()=>this._highlightGridBoxes()),this.on("change:rows",()=>this._highlightGridBoxes())}render(){super.render(),w({keystrokeHandler:this.keystrokes,focusTracker:this.focusTracker,gridItems:this.items,numberOfColumns:10,uiLanguageDirection:this.locale&&this.locale.uiLanguageDirection});for(const e of this.items)this.focusTracker.add(e.element);this.keystrokes.listenTo(this.element)}reset(){this.set({rows:1,columns:1})}focus(){this.items.get(0).focus()}focusLast(){this.items.get(0).focus()}_highlightGridBoxes(){const e=this.rows,t=this.columns;this.items.map((o,i)=>{const n=Math.floor(i/10)<e&&i%10<t;o.set("isOn",n)})}_createGridButton(e,t,o,i){const n=new k(e);return n.set({label:i,class:"ck-insert-table-dropdown-grid-box"}),n.extendTemplate({attributes:{"data-row":t,"data-column":o}}),n}_createGridCollection(){const e=[];for(let t=0;t<100;t++){const o=Math.floor(t/10),i=t%10,n=`${o+1} × ${i+1}`;e.push(this._createGridButton(this.locale,o+1,i+1,n))}return this.createCollection(e)}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */
class xt extends t{static get pluginName(){return"TableUI"}static get isOfficialPlugin(){return!0}init(){const e=this.editor,t=this.editor.t,i="ltr"===e.locale.contentLanguageDirection;e.ui.componentFactory.add("insertTable",i=>{const n=e.commands.get("insertTable"),r=_(i);let l;return r.bind("isEnabled").to(n),r.buttonView.set({icon:o.table,label:t("Insert table"),tooltip:!0}),r.on("change:isOpen",()=>{l||(l=new Tt(i),r.panelView.children.add(l),l.delegate("execute").to(r),r.on("execute",()=>{e.execute("insertTable",{rows:l.rows,columns:l.columns}),e.editing.view.focus()}))}),r}),e.ui.componentFactory.add("menuBar:insertTable",i=>{const n=e.commands.get("insertTable"),r=new C(i),l=new Tt(i);return l.delegate("execute").to(r),r.on("change:isOpen",(e,t,o)=>{o||l.reset()}),l.on("execute",()=>{e.execute("insertTable",{rows:l.rows,columns:l.columns}),e.editing.view.focus()}),r.buttonView.set({label:t("Table"),icon:o.table}),r.panelView.children.add(l),r.bind("isEnabled").to(n),r}),e.ui.componentFactory.add("tableColumn",e=>{const o=[{type:"switchbutton",model:{commandName:"setTableColumnHeader",label:t("Header column"),bindIsOn:!0}},{type:"separator"},{type:"button",model:{commandName:i?"insertTableColumnLeft":"insertTableColumnRight",label:t("Insert column left")}},{type:"button",model:{commandName:i?"insertTableColumnRight":"insertTableColumnLeft",label:t("Insert column right")}},{type:"button",model:{commandName:"removeTableColumn",label:t("Delete column")}},{type:"button",model:{commandName:"selectTableColumn",label:t("Select column")}}];return this._prepareDropdown(t("Column"),'<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M2.5 1h15A1.5 1.5 0 0 1 19 2.5v15a1.5 1.5 0 0 1-1.5 1.5h-15A1.5 1.5 0 0 1 1 17.5v-15A1.5 1.5 0 0 1 2.5 1zM2 2v16h16V2H2z" opacity=".6"/><path d="M18 7v1H2V7h16zm0 5v1H2v-1h16z" opacity=".6"/><path d="M14 1v18a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1V1a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1zm-2 1H8v4h4V2zm0 6H8v4h4V8zm0 6H8v4h4v-4z"/></svg>',o,e)}),e.ui.componentFactory.add("tableRow",e=>{const o=[{type:"switchbutton",model:{commandName:"setTableRowHeader",label:t("Header row"),bindIsOn:!0}},{type:"separator"},{type:"button",model:{commandName:"insertTableRowAbove",label:t("Insert row above")}},{type:"button",model:{commandName:"insertTableRowBelow",label:t("Insert row below")}},{type:"button",model:{commandName:"removeTableRow",label:t("Delete row")}},{type:"button",model:{commandName:"selectTableRow",label:t("Select row")}}];return this._prepareDropdown(t("Row"),'<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M2.5 1h15A1.5 1.5 0 0 1 19 2.5v15a1.5 1.5 0 0 1-1.5 1.5h-15A1.5 1.5 0 0 1 1 17.5v-15A1.5 1.5 0 0 1 2.5 1zM2 2v16h16V2H2z" opacity=".6"/><path d="M7 2h1v16H7V2zm5 0h1v16h-1V2z" opacity=".6"/><path d="M1 6h18a1 1 0 0 1 1 1v6a1 1 0 0 1-1 1H1a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1zm1 2v4h4V8H2zm6 0v4h4V8H8zm6 0v4h4V8h-4z"/></svg>',o,e)}),e.ui.componentFactory.add("mergeTableCells",e=>{const o=[{type:"button",model:{commandName:"mergeTableCellUp",label:t("Merge cell up")}},{type:"button",model:{commandName:i?"mergeTableCellRight":"mergeTableCellLeft",label:t("Merge cell right")}},{type:"button",model:{commandName:"mergeTableCellDown",label:t("Merge cell down")}},{type:"button",model:{commandName:i?"mergeTableCellLeft":"mergeTableCellRight",label:t("Merge cell left")}},{type:"separator"},{type:"button",model:{commandName:"splitTableCellVertically",label:t("Split cell vertically")}},{type:"button",model:{commandName:"splitTableCellHorizontally",label:t("Split cell horizontally")}}];return this._prepareMergeSplitButtonDropdown(t("Merge cells"),'<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M2.5 1h15A1.5 1.5 0 0 1 19 2.5v15a1.5 1.5 0 0 1-1.5 1.5h-15A1.5 1.5 0 0 1 1 17.5v-15A1.5 1.5 0 0 1 2.5 1zM2 2v16h16V2H2z" opacity=".6"/><path d="M7 2h1v16H7V2zm5 0h1v7h-1V2zm6 5v1H2V7h16zM8 12v1H2v-1h6z" opacity=".6"/><path d="M7 7h12a1 1 0 0 1 1 1v11a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1V8a1 1 0 0 1 1-1zm1 2v9h10V9H8z"/></svg>',o,e)})}_prepareDropdown(e,t,o,i){const n=this.editor,r=_(i),l=this._fillDropdownWithListOptions(r,o);return r.buttonView.set({label:e,icon:t,tooltip:!0}),r.bind("isEnabled").toMany(l,"isEnabled",(...e)=>e.some(e=>e)),this.listenTo(r,"execute",e=>{n.execute(e.source.commandName),e.source instanceof v||n.editing.view.focus()}),r}_prepareMergeSplitButtonDropdown(e,t,o,i){const n=this.editor,r=_(i,y),l="mergeTableCells",s=n.commands.get(l),a=this._fillDropdownWithListOptions(r,o);return r.buttonView.set({label:e,icon:t,tooltip:!0,isEnabled:!0}),r.bind("isEnabled").toMany([s,...a],"isEnabled",(...e)=>e.some(e=>e)),this.listenTo(r.buttonView,"execute",()=>{n.execute(l),n.editing.view.focus()}),this.listenTo(r,"execute",e=>{n.execute(e.source.commandName),n.editing.view.focus()}),r}_fillDropdownWithListOptions(e,t){const o=this.editor,i=[],n=new b;for(const e of t)St(e,o,i,n);return A(e,n),i}}function St(e,t,o,i){if("button"===e.type||"switchbutton"===e.type){const i=e.model=new T(e.model),{commandName:n,bindIsOn:r}=e.model,l=t.commands.get(n);o.push(l),i.set({commandName:n}),i.bind("isEnabled").to(l),r&&i.bind("isOn").to(l,"value"),i.set({withText:!0})}i.add(e)}vt(':root{--ck-table-selected-cell-background:rgba(158,207,250,.3)}.ck.ck-editor__editable .table table td.ck-editor__editable_selected,.ck.ck-editor__editable .table table th.ck-editor__editable_selected{box-shadow:unset;caret-color:transparent;outline:unset;position:relative}.ck.ck-editor__editable .table table td.ck-editor__editable_selected:after,.ck.ck-editor__editable .table table th.ck-editor__editable_selected:after{background-color:var(--ck-table-selected-cell-background);bottom:0;content:"";left:0;pointer-events:none;position:absolute;right:0;top:0}.ck.ck-editor__editable .table table td.ck-editor__editable_selected ::selection,.ck.ck-editor__editable .table table td.ck-editor__editable_selected:focus,.ck.ck-editor__editable .table table th.ck-editor__editable_selected ::selection,.ck.ck-editor__editable .table table th.ck-editor__editable_selected:focus{background-color:transparent}.ck.ck-editor__editable .table table td.ck-editor__editable_selected .ck-widget,.ck.ck-editor__editable .table table th.ck-editor__editable_selected .ck-widget{outline:unset}.ck.ck-editor__editable .table table td.ck-editor__editable_selected .ck-widget>.ck-widget__selection-handle,.ck.ck-editor__editable .table table th.ck-editor__editable_selected .ck-widget>.ck-widget__selection-handle{display:none}');
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */
class Vt extends t{static get pluginName(){return"TableSelection"}static get isOfficialPlugin(){return!0}static get requires(){return[tt,tt]}init(){const e=this.editor,t=e.model,o=e.editing.view;this.listenTo(t,"deleteContent",(e,t)=>this._handleDeleteContent(e,t),{priority:"high"}),this.listenTo(o.document,"insertText",(e,t)=>this._handleInsertTextEvent(e,t),{priority:"high"}),this._defineSelectionConverter(),this._enablePluginDisabling()}getSelectedTableCells(){const e=this.editor.plugins.get(tt),t=this.editor.model.document.selection,o=e.getSelectedTableCells(t);return 0==o.length?null:o}getSelectionAsFragment(){const e=this.editor.plugins.get(tt),t=this.getSelectedTableCells();return t?this.editor.model.change(o=>{const i=o.createDocumentFragment(),{first:n,last:r}=e.getColumnIndexes(t),{first:l,last:s}=e.getRowIndexes(t),a=t[0].findAncestor("table");let c=s,d=r;if(e.isSelectionRectangular(t)){const e={firstColumn:n,lastColumn:r,firstRow:l,lastRow:s};c=We(a,e),d=Ne(a,e)}const u=xe(a,{startRow:l,startColumn:n,endRow:c,endColumn:d},o);return o.insert(u,i,0),i}):null}setCellSelection(e,t){const o=this._getCellsToSelect(e,t);this.editor.model.change(e=>{e.setSelection(o.cells.map(t=>e.createRangeOn(t)),{backward:o.backward})})}getFocusCell(){const e=[...this.editor.model.document.selection.getRanges()].pop().getContainedElement();return e&&e.is("element","tableCell")?e:null}getAnchorCell(){const e=this.editor.model.document.selection,t=a(e.getRanges()).getContainedElement();return t&&t.is("element","tableCell")?t:null}_defineSelectionConverter(){const e=this.editor,t=new Set;e.conversion.for("editingDowncast").add(e=>e.on("selection",(e,o,i)=>{const n=i.writer;!function(e){for(const o of t)e.removeClass("ck-editor__editable_selected",o);t.clear()}(n);const r=this.getSelectedTableCells();if(!r)return;for(const e of r){const o=i.mapper.toViewElement(e);n.addClass("ck-editor__editable_selected",o),t.add(o)}const l=i.mapper.toViewElement(r[r.length-1]);n.setSelection(l,0)},{priority:"lowest"}))}_enablePluginDisabling(){const e=this.editor;this.on("change:isEnabled",()=>{if(!this.isEnabled){const t=this.getSelectedTableCells();if(!t)return;e.model.change(o=>{const i=o.createPositionAt(t[0],0),n=e.model.schema.getNearestSelectionRange(i);o.setSelection(n)})}})}_handleDeleteContent(e,t){const o=this.editor.plugins.get(tt),i=t[0],n=t[1],r=this.editor.model,l=!n||"backward"==n.direction,s=o.getSelectedTableCells(i);s.length&&(e.stop(),r.change(e=>{const t=s[l?s.length-1:0];r.change(e=>{for(const t of s)r.deleteContent(e.createSelection(t,"in"))});const o=r.schema.getNearestSelectionRange(e.createPositionAt(t,0));i.is("documentSelection")?e.setSelection(o):i.setTo(o)}))}_handleInsertTextEvent(e,t){const o=this.editor,i=this.getSelectedTableCells();if(!i)return;const n=o.editing.view,r=o.editing.mapper,l=i.map(e=>n.createRangeOn(r.toViewElement(e)));t.selection=n.createSelection(l)}_getCellsToSelect(e,t){const o=this.editor.plugins.get("TableUtils"),i=o.getCellLocation(e),n=o.getCellLocation(t),r=Math.min(i.row,n.row),l=Math.max(i.row,n.row),s=Math.min(i.column,n.column),a=Math.max(i.column,n.column),c=new Array(l-r+1).fill(null).map(()=>[]),d={startRow:r,endRow:l,startColumn:s,endColumn:a};for(const{row:t,cell:o}of new pe(e.findAncestor("table"),d))c[t-r].push(o);const u=n.row<i.row,h=n.column<i.column;return u&&c.reverse(),h&&c.forEach(e=>e.reverse()),{cells:c.flat(),backward:u||h}}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class Rt extends t{static get pluginName(){return"TableClipboard"}static get isOfficialPlugin(){return!0}static get requires(){return[M,U,Vt,tt]}init(){const e=this.editor,t=e.editing.view.document;this.listenTo(t,"copy",(e,t)=>this._onCopyCut(e,t)),this.listenTo(t,"cut",(e,t)=>this._onCopyCut(e,t)),this.listenTo(e.model,"insertContent",(e,[t,o])=>this._onInsertContent(e,t,o),{priority:"high"}),this.decorate("_replaceTableSlotCell")}_onCopyCut(e,t){const o=this.editor.editing.view,i=this.editor.plugins.get(Vt),n=this.editor.plugins.get(M);i.getSelectedTableCells()&&("cut"!=e.name||this.editor.model.canEditAt(this.editor.model.document.selection))&&(t.preventDefault(),e.stop(),this.editor.model.enqueueChange({isUndoable:"cut"===e.name},()=>{const r=n._copySelectedFragmentWithMarkers(e.name,this.editor.model.document.selection,()=>i.getSelectionAsFragment());o.document.fire("clipboardOutput",{dataTransfer:t.dataTransfer,content:this.editor.data.toView(r),method:e.name})}))}_onInsertContent(e,t,o){if(o&&!o.is("documentSelection"))return;const i=this.editor.model,n=this.editor.plugins.get(tt),r=this.editor.plugins.get(M),l=this.getTableIfOnlyTableInContent(t,i);if(!l)return;const s=n.getSelectionAffectedTableCells(i.document.selection);s.length?(e.stop(),t.is("documentFragment")?r._pasteMarkersIntoTransformedElement(t.markers,e=>this._replaceSelectedCells(l,s,e)):this.editor.model.change(e=>{this._replaceSelectedCells(l,s,e)})):Be(l,n)}_replaceSelectedCells(e,t,o){const i=this.editor.plugins.get(tt),n={width:i.getColumns(e),height:i.getRows(e)},r=function(e,t,o,i){const n=e[0].findAncestor("table"),r=i.getColumnIndexes(e),l=i.getRowIndexes(e),s={firstColumn:r.first,lastColumn:r.last,firstRow:l.first,lastRow:l.last},a=1===e.length;a&&(s.lastRow+=t.height-1,s.lastColumn+=t.width-1,function(e,t,o,i){const n=i.getColumns(e),r=i.getRows(e);o>n&&i.insertColumns(e,{at:n,columns:o-n});t>r&&i.insertRows(e,{at:r,rows:t-r})}(n,s.lastRow+1,s.lastColumn+1,i));a||!i.isSelectionRectangular(e)?function(e,t,o){const{firstRow:i,lastRow:n,firstColumn:r,lastColumn:l}=t,s={first:i,last:n},a={first:r,last:l};Pt(e,r,s,o),Pt(e,l+1,s,o),It(e,i,a,o),It(e,n+1,a,o,i)}(n,s,o):(s.lastRow=We(n,s),s.lastColumn=Ne(n,s));return s}(t,n,o,i),l=r.lastRow-r.firstRow+1,s=r.lastColumn-r.firstColumn+1;e=xe(e,{startRow:0,startColumn:0,endRow:Math.min(l,n.height)-1,endColumn:Math.min(s,n.width)-1},o);const a=t[0].findAncestor("table"),c=this._replaceSelectedCellsWithPasted(e,n,a,r,o);if(this.editor.plugins.get("TableSelection").isEnabled){const e=i.sortRanges(c.map(e=>o.createRangeOn(e)));o.setSelection(e)}else o.setSelection(c[0],0);return a}_replaceSelectedCellsWithPasted(e,t,o,i,n){const{width:r,height:l}=t,s=function(e,t,o){const i=new Array(o).fill(null).map(()=>new Array(t).fill(null));for(const{column:t,row:o,cell:n}of new pe(e))i[o][t]=n;return i}(e,r,l),a=[...new pe(o,{startRow:i.firstRow,endRow:i.lastRow,startColumn:i.firstColumn,endColumn:i.lastColumn,includeAllSlots:!0})],c=[];let d;for(const e of a){const{row:t,column:o}=e;o===i.firstColumn&&(d=e.getPositionBefore());const a=t-i.firstRow,u=o-i.firstColumn,h=s[a%l][u%r],b=h?n.cloneElement(h):null,m=this._replaceTableSlotCell(e,b,d,n);m&&(Pe(m,t,o,i.lastRow,i.lastColumn,n),c.push(m),d=n.createPositionAfter(m))}const u=parseInt(o.getAttribute("headingRows")||"0"),h=parseInt(o.getAttribute("headingColumns")||"0"),b=i.firstRow<u&&u<=i.lastRow,m=i.firstColumn<h&&h<=i.lastColumn;if(b){const e=It(o,u,{first:i.firstColumn,last:i.lastColumn},n,i.firstRow);c.push(...e)}if(m){const e=Pt(o,h,{first:i.firstRow,last:i.lastRow},n);c.push(...e)}return c}_replaceTableSlotCell(e,t,o,i){const{cell:n,isAnchor:r}=e;return r&&i.remove(n),t?(i.insert(t,o),t):null}getTableIfOnlyTableInContent(e,t){if(!e.is("documentFragment")&&!e.is("element"))return null;if(e.is("element","table"))return e;if(1==e.childCount&&e.getChild(0).is("element","table"))return e.getChild(0);const o=t.createRangeIn(e);for(const e of o.getItems())if(e.is("element","table")){const i=t.createRange(o.start,t.createPositionBefore(e));if(t.hasContent(i,{ignoreWhitespaces:!0}))return null;const n=t.createRange(t.createPositionAfter(e),o.end);return t.hasContent(n,{ignoreWhitespaces:!0})?null:e}return null}}function It(e,t,o,i,n=0){if(t<1)return;return Se(e,t,n).filter(({column:e,cellWidth:t})=>Et(e,t,o)).map(({cell:e})=>Ve(e,t,i))}function Pt(e,t,o,i){if(t<1)return;return Re(e,t).filter(({row:e,cellHeight:t})=>Et(e,t,o)).map(({cell:e,column:o})=>Ie(e,o,t,i))}function Et(e,t,o){const i=e+t-1,{first:n,last:r}=o;return e>=n&&e<=r||e<n&&i>=n}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class zt extends t{static get pluginName(){return"TableKeyboard"}static get isOfficialPlugin(){return!0}static get requires(){return[Vt,tt]}init(){const e=this.editor,t=e.editing.view.document,o=e.t;this.listenTo(t,"arrowKey",(...e)=>this._onArrowKey(...e),{context:"table"}),this.listenTo(t,"tab",(...e)=>this._handleTabOnSelectedTable(...e),{context:"figure"}),this.listenTo(t,"tab",(...e)=>this._handleTab(...e),{context:["th","td"]}),e.accessibility.addKeystrokeInfoGroup({id:"table",label:o("Keystrokes that can be used in a table cell"),keystrokes:[{label:o("Move the selection to the next cell"),keystroke:"Tab"},{label:o("Move the selection to the previous cell"),keystroke:"Shift+Tab"},{label:o("Insert a new table row (when in the last cell of a table)"),keystroke:"Tab"},{label:o("Navigate through the table"),keystroke:[["arrowup"],["arrowright"],["arrowdown"],["arrowleft"]]}]})}_handleTabOnSelectedTable(e,t){const o=this.editor,i=o.model.document.selection.getSelectedElement();i&&i.is("element","table")&&(t.preventDefault(),t.stopPropagation(),e.stop(),o.model.change(e=>{e.setSelection(e.createRangeIn(i.getChild(0).getChild(0)))}))}_handleTab(e,t){const o=this.editor,i=this.editor.plugins.get(tt),n=this.editor.plugins.get("TableSelection"),r=o.model.document.selection,l=!t.shiftKey;let s=i.getTableCellsContainingSelection(r)[0];if(s||(s=n.getFocusCell()),!s)return;t.preventDefault(),t.stopPropagation(),e.stop();const a=s.parent,c=a.parent,d=c.getChildIndex(a),u=a.getChildIndex(s),h=0===u;if(!l&&h&&0===d)return void o.model.change(e=>{e.setSelection(e.createRangeOn(c))});const b=u===a.childCount-1,m=d===i.getRows(c)-1;if(l&&m&&b&&(o.execute("insertTableRowBelow"),d===i.getRows(c)-1))return void o.model.change(e=>{e.setSelection(e.createRangeOn(c))});let g;if(l&&b){const e=c.getChild(d+1);g=e.getChild(0)}else if(!l&&h){const e=c.getChild(d-1);g=e.getChild(e.childCount-1)}else g=a.getChild(u+(l?1:-1));o.model.change(e=>{e.setSelection(e.createRangeIn(g))})}_onArrowKey(e,t){const o=this.editor,i=t.keyCode,n=m(i,o.locale.contentLanguageDirection);this._handleArrowKeys(n,t.shiftKey)&&(t.preventDefault(),t.stopPropagation(),e.stop())}_handleArrowKeys(e,t){const o=this.editor.plugins.get(tt),i=this.editor.plugins.get("TableSelection"),n=this.editor.model,r=n.document.selection,l=["right","down"].includes(e),s=o.getSelectedTableCells(r);if(s.length){let o;return o=t?i.getFocusCell():l?s[s.length-1]:s[0],this._navigateFromCellInDirection(o,e,t),!0}const a=r.focus.findAncestor("tableCell");
/* istanbul ignore if: paranoid check -- @preserve */if(!a)return!1;if(!r.isCollapsed)if(t){if(r.isBackward==l&&!r.containsEntireContent(a))return!1}else{const e=r.getSelectedElement();if(!e||!n.schema.isObject(e))return!1}return!!this._isSelectionAtCellEdge(r,a,l)&&(this._navigateFromCellInDirection(a,e,t),!0)}_isSelectionAtCellEdge(e,t,o){const i=this.editor.model,n=this.editor.model.schema,r=o?e.getLastPosition():e.getFirstPosition();if(!n.getLimitElement(r).is("element","tableCell")){return i.createPositionAt(t,o?"end":0).isTouching(r)}const l=i.createSelection(r);return i.modifySelection(l,{direction:o?"forward":"backward"}),r.isEqual(l.focus)}_navigateFromCellInDirection(e,t,o=!1){const i=this.editor.model,n=e.findAncestor("table"),r=[...new pe(n,{includeAllSlots:!0})],{row:l,column:s}=r[r.length-1],a=r.find(({cell:t})=>t==e);let{row:c,column:d}=a;switch(t){case"left":d--;break;case"up":c--;break;case"right":d+=a.cellWidth;break;case"down":c+=a.cellHeight}if(c<0||c>l||d<0&&c<=0||d>s&&c>=l)return void i.change(e=>{e.setSelection(e.createRangeOn(n))});d<0?(d=o?0:s,c--):d>s&&(d=o?s:0,c++);const u=r.find(e=>e.row==c&&e.column==d).cell,h=["right","down"].includes(t),b=this.editor.plugins.get("TableSelection");if(o&&b.isEnabled){const t=b.getAnchorCell()||e;b.setCellSelection(t,u)}else{const e=i.createPositionAt(u,h?0:"end");i.change(t=>{t.setSelection(e)})}}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class Bt extends ${constructor(){super(...arguments),this.domEventType=["mousemove","mouseleave"]}onDomEvent(e){this.fire(e.type,e)}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class Wt extends t{static get pluginName(){return"TableMouse"}static get isOfficialPlugin(){return!0}static get requires(){return[Vt,tt]}init(){this.editor.editing.view.addObserver(Bt),this._enableShiftClickSelection(),this._enableMouseDragSelection()}_enableShiftClickSelection(){const e=this.editor,t=e.plugins.get(tt);let o=!1;const i=e.plugins.get(Vt);this.listenTo(e.editing.view.document,"mousedown",(n,r)=>{const l=e.model.document.selection;if(!this.isEnabled||!i.isEnabled)return;if(!r.domEvent.shiftKey)return;const s=i.getAnchorCell()||t.getTableCellsContainingSelection(l)[0];if(!s)return;const a=this._getModelTableCellFromDomEvent(r);a&&Nt(s,a)&&(o=!0,i.setCellSelection(s,a),r.preventDefault())}),this.listenTo(e.editing.view.document,"mouseup",()=>{o=!1}),this.listenTo(e.editing.view.document,"selectionChange",e=>{o&&e.stop()},{priority:"highest"})}_enableMouseDragSelection(){const e=this.editor;let t,o,i=!1,n=!1;const r=e.plugins.get(Vt);this.listenTo(e.editing.view.document,"mousedown",(e,o)=>{this.isEnabled&&r.isEnabled&&(o.domEvent.shiftKey||o.domEvent.ctrlKey||o.domEvent.altKey||(t=this._getModelTableCellFromDomEvent(o)))}),this.listenTo(e.editing.view.document,"mousemove",(e,l)=>{if(!l.domEvent.buttons)return;if(!t)return;const s=this._getModelTableCellFromDomEvent(l);s&&Nt(t,s)&&(o=s,i||o==t||(i=!0)),i&&(n=!0,r.setCellSelection(t,o),l.preventDefault())}),this.listenTo(e.editing.view.document,"mouseup",()=>{i=!1,n=!1,t=null,o=null}),this.listenTo(e.editing.view.document,"selectionChange",e=>{n&&e.stop()},{priority:"highest"})}_getModelTableCellFromDomEvent(e){const t=e.target,o=this.editor.editing.view.createPositionAt(t,0);return this.editor.editing.mapper.toModelPosition(o).parent.findAncestor("tableCell",{includeSelf:!0})}}function Nt(e,t){return e.parent.parent==t.parent.parent}vt(".ck-content .table{display:table;margin:.9em auto}.ck-content .table table{border:1px double #b3b3b3;border-collapse:collapse;border-spacing:0;height:100%;width:100%}.ck-content .table table td,.ck-content .table table th{border:1px solid #bfbfbf;min-width:2em;padding:.4em}.ck-content .table table th{background:rgba(0,0,0,.05);font-weight:700}@media print{.ck-content .table table{height:auto}}.ck-content[dir=rtl] .table th{text-align:right}.ck-content[dir=ltr] .table th{text-align:left}.ck-editor__editable .ck-table-bogus-paragraph{display:inline-block;width:100%}");
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */
class Lt extends t{static get requires(){return[yt,xt,Vt,Wt,zt,Rt,r]}static get pluginName(){return"Table"}static get isOfficialPlugin(){return!0}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class Ft extends t{static get pluginName(){return"PlainTableOutput"}static get isOfficialPlugin(){return!0}static get requires(){return[Lt]}init(){const e=this.editor;e.conversion.for("dataDowncast").elementToStructure({model:"table",view:Dt,converterPriority:"high"}),e.plugins.has("TableCaption")&&e.conversion.for("dataDowncast").elementToElement({model:"caption",view:(e,{writer:t})=>{if("table"===e.parent.name)return t.createContainerElement("caption")},converterPriority:"high"}),e.plugins.has("TableProperties")&&function(e){const t={"border-width":"tableBorderWidth","border-color":"tableBorderColor","border-style":"tableBorderStyle","background-color":"tableBackgroundColor"};for(const[o,i]of Object.entries(t))e.conversion.for("dataDowncast").add(e=>e.on(`attribute:${i}:table`,(e,t,i)=>{const{item:n,attributeNewValue:r}=t,{mapper:l,writer:s}=i;if(!i.consumable.consume(n,e.name))return;const a=l.toViewElement(n);r?s.setStyle(o,r,a):s.removeStyle(o,a)},{priority:"high"}))}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */(e)}}function Dt(e,{writer:t}){const o=e.getAttribute("headingRows")||0,i=t.createSlot(e=>e.is("element","tableRow")&&e.index<o),n=t.createSlot(e=>e.is("element","tableRow")&&e.index>=o),r=t.createSlot(e=>!e.is("element","tableRow")),l=t.createContainerElement("thead",null,i),s=t.createContainerElement("tbody",null,n),a=[];return o&&a.push(l),o<e.childCount&&a.push(s),t.createContainerElement("table",null,[r,...a])}function Ht(e){const t=Ot(e);return t||Mt(e)}function Ot(e){const t=e.getSelectedElement();return t&&Ut(t)?t:null}function Mt(e){const t=e.getFirstPosition();if(!t)return null;let o=t.parent;for(;o;){if(o.is("element")&&Ut(o))return o;o=o.parent}return null}function Ut(e){return!!e.getCustomProperty("table")&&l(e)}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class $t extends t{static get requires(){return[s]}static get pluginName(){return"TableToolbar"}static get isOfficialPlugin(){return!0}afterInit(){const e=this.editor,t=e.t,o=e.plugins.get(s),i=e.config.get("table.contentToolbar"),n=e.config.get("table.tableToolbar");i&&o.register("tableContent",{ariaLabel:t("Table toolbar"),items:i,getRelatedElement:Mt}),n&&o.register("table",{ariaLabel:t("Table toolbar"),items:n,getRelatedElement:Ot})}}vt(".ck.ck-input-color{display:flex;flex-direction:row-reverse;width:100%}.ck.ck-input-color>input.ck.ck-input-text{flex-grow:1;min-width:auto}.ck.ck-input-color>div.ck.ck-dropdown{min-width:auto}.ck.ck-input-color>div.ck.ck-dropdown>.ck-input-color__button .ck-dropdown__arrow{display:none}.ck.ck-input-color .ck.ck-input-color__button{display:flex}.ck.ck-input-color .ck.ck-input-color__button .ck.ck-input-color__button__preview{overflow:hidden;position:relative}.ck.ck-input-color .ck.ck-input-color__button .ck.ck-input-color__button__preview>.ck.ck-input-color__button__preview__no-color-indicator{display:block;position:absolute}.ck.ck-input-color>.ck.ck-input-text{[dir=ltr] &{border-bottom-right-radius:0;border-top-right-radius:0}[dir=rtl] &{border-bottom-left-radius:0;border-top-left-radius:0}}.ck.ck-input-color>.ck.ck-input-text:focus{z-index:0}.ck.ck-input-color>.ck.ck-dropdown>.ck.ck-button.ck-input-color__button{padding:0;[dir=ltr] &{border-bottom-left-radius:0;border-top-left-radius:0}[dir=ltr] &:not(:focus){border-left:1px solid transparent}[dir=rtl] &{border-bottom-right-radius:0;border-top-right-radius:0}[dir=rtl] &:not(:focus){border-right:1px solid transparent}}.ck.ck-input-color>.ck.ck-dropdown>.ck.ck-button.ck-input-color__button.ck-disabled{background:var(--ck-color-input-disabled-background)}.ck.ck-input-color>.ck.ck-dropdown>.ck.ck-button.ck-input-color__button>.ck.ck-input-color__button__preview{border:1px solid var(--ck-color-input-border);border-radius:0;height:20px;width:20px;&.ck-rounded-corners,.ck-rounded-corners &{border-radius:var(--ck-border-radius)}}.ck.ck-input-color>.ck.ck-dropdown>.ck.ck-button.ck-input-color__button>.ck.ck-input-color__button__preview>.ck.ck-input-color__button__preview__no-color-indicator{background:red;border-radius:2px;height:150%;left:50%;top:-30%;transform:rotate(45deg);transform-origin:50%;width:8%}.ck.ck-input-color .ck.ck-input-color__remove-color{border-bottom-left-radius:0;border-bottom-right-radius:0;padding:calc(var(--ck-spacing-standard)/2) var(--ck-spacing-standard);width:100%}.ck.ck-input-color .ck.ck-input-color__remove-color:not(:focus){border-bottom:1px solid var(--ck-color-input-border)}.ck.ck-input-color .ck.ck-input-color__remove-color{[dir=ltr] &{border-top-right-radius:0}[dir=rtl] &{border-top-left-radius:0}}.ck.ck-input-color .ck.ck-input-color__remove-color .ck.ck-icon{margin-right:var(--ck-spacing-standard);[dir=rtl] &{margin-left:var(--ck-spacing-standard);margin-right:0}}");
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */
class jt extends f{constructor(e,t){super(e),this.set("value",""),this.set("isReadOnly",!1),this.set("isFocused",!1),this.set("isEmpty",!0),this.options=t,this.focusTracker=new h,this._focusables=new x,this.dropdownView=this._createDropdownView(),this.inputView=this._createInputTextView(),this.keystrokes=new u,this._stillTyping=!1,this.focusCycler=new S({focusables:this._focusables,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"shift + tab",focusNext:"tab"}}),this.setTemplate({tag:"div",attributes:{class:["ck","ck-input-color"]},children:[this.dropdownView,this.inputView]}),this.on("change:value",(e,t,o)=>this._setInputValue(o))}render(){super.render(),[this.inputView,this.dropdownView.buttonView].forEach(e=>{this.focusTracker.add(e.element),this._focusables.add(e)}),this.keystrokes.listenTo(this.element)}focus(e){-1===e?this.focusCycler.focusLast():this.focusCycler.focusFirst()}destroy(){super.destroy(),this.focusTracker.destroy(),this.keystrokes.destroy()}_createDropdownView(){const e=this.locale,t=e.t,o=this.bindTemplate,i=this._createColorSelector(e),n=_(e),r=new f;return r.setTemplate({tag:"span",attributes:{class:["ck","ck-input-color__button__preview"],style:{backgroundColor:o.to("value")}},children:[{tag:"span",attributes:{class:["ck","ck-input-color__button__preview__no-color-indicator",o.if("value","ck-hidden",e=>""!=e)]}}]}),n.buttonView.extendTemplate({attributes:{class:"ck-input-color__button"}}),n.buttonView.children.add(r),n.buttonView.label=t("Color picker"),n.buttonView.tooltip=!0,n.panelPosition="rtl"===e.uiLanguageDirection?"se":"sw",n.panelView.children.add(i),n.bind("isEnabled").to(this,"isReadOnly",e=>!e),n.on("change:isOpen",(e,t,o)=>{o&&(i.updateSelectedColors(),i.showColorGridsFragment())}),n}_createInputTextView(){const e=this.locale,t=new V(e);return t.extendTemplate({on:{blur:t.bindTemplate.to("blur")}}),t.value=this.value,t.bind("isReadOnly","hasError").to(this),this.bind("isFocused","isEmpty").to(t),t.on("input",()=>{const e=t.element.value,o=this.options.colorDefinitions.find(t=>e===t.label);this._stillTyping=!0,this.value=o&&o.color||e}),t.on("blur",()=>{this._stillTyping=!1,this._setInputValue(t.element.value)}),t.delegate("input").to(this),t}_createColorSelector(e){const t=e.t,o=this.options.defaultColorValue||"",i=t(o?"Restore default":"Remove color"),n=new R(e,{colors:this.options.colorDefinitions,columns:this.options.columns,removeButtonLabel:i,colorPickerLabel:t("Color picker"),colorPickerViewConfig:!1!==this.options.colorPickerConfig&&{...this.options.colorPickerConfig,hideInput:!0}});n.appendUI(),n.on("execute",(e,t)=>{"colorPickerSaveButton"!==t.source?(this.value=t.value||o,this.fire("input"),"colorPicker"!==t.source&&(this.dropdownView.isOpen=!1)):this.dropdownView.isOpen=!1});let r=this.value;return n.on("colorPicker:cancel",()=>{this.value=r,this.fire("input"),this.dropdownView.isOpen=!1}),n.colorGridsFragmentView.colorPickerButtonView.on("execute",()=>{r=this.value}),n.bind("selectedColor").to(this,"value"),n}_setInputValue(e){if(!this._stillTyping){const t=qt(e),o=this.options.colorDefinitions.find(e=>t===qt(e.color));this.inputView.value=o?o.label:e||""}}}function qt(e){return e.replace(/([(,])\s+/g,"$1").replace(/^\s+|\s+(?=[),\s]|$)/g,"").replace(/,|\s/g," ")}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */const Gt=e=>""===e;function Kt(e){return{none:e("None"),solid:e("Solid"),dotted:e("Dotted"),dashed:e("Dashed"),double:e("Double"),groove:e("Groove"),ridge:e("Ridge"),inset:e("Inset"),outset:e("Outset")}}function Jt(e){return e('The color is invalid. Try "#FF0000" or "rgb(255,0,0)" or "red".')}function Xt(e){return e('The value is invalid. Try "10px" or "2em" or simply "2".')}function Yt(e){return e=e.trim().toLowerCase(),Gt(e)||j(e)}function Qt(e){return e=e.trim(),Gt(e)||no(e)||q(e)||G(e)}function Zt(e){return e=e.trim(),Gt(e)||no(e)||q(e)}function eo(e,t){const o=new b,i=Kt(e.t);for(const n in i){const r={type:"button",model:new T({_borderStyleValue:n,label:i[n],role:"menuitemradio",withText:!0})};"none"===n?r.model.bind("isOn").to(e,"borderStyle",e=>"none"===t?!e:e===n):r.model.bind("isOn").to(e,"borderStyle",e=>e===n),o.add(r)}return o}function to(e){const{view:t,icons:o,toolbar:i,labels:n,propertyName:r,nameToValue:l,defaultValue:s}=e;for(const e in n){const a=new k(t.locale);a.set({label:n[e],icon:o[e],tooltip:n[e]});const c=l?l(e):e;a.bind("isOn").to(t,r,e=>{let t=e;return""===e&&s&&(t=s),c===t}),a.on("execute",()=>{t[r]=c}),i.items.add(a)}}const oo=[{color:"hsl(0, 0%, 0%)",label:"Black"},{color:"hsl(0, 0%, 30%)",label:"Dim grey"},{color:"hsl(0, 0%, 60%)",label:"Grey"},{color:"hsl(0, 0%, 90%)",label:"Light grey"},{color:"hsl(0, 0%, 100%)",label:"White",hasBorder:!0},{color:"hsl(0, 75%, 60%)",label:"Red"},{color:"hsl(30, 75%, 60%)",label:"Orange"},{color:"hsl(60, 75%, 60%)",label:"Yellow"},{color:"hsl(90, 75%, 60%)",label:"Light green"},{color:"hsl(120, 75%, 60%)",label:"Green"},{color:"hsl(150, 75%, 60%)",label:"Aquamarine"},{color:"hsl(180, 75%, 60%)",label:"Turquoise"},{color:"hsl(210, 75%, 60%)",label:"Light blue"},{color:"hsl(240, 75%, 60%)",label:"Blue"},{color:"hsl(270, 75%, 60%)",label:"Purple"}];function io(e){return(t,o,i)=>{const n=new jt(t.locale,{colorDefinitions:(r=e.colorConfig,r.map(e=>({color:e.model,label:e.label,options:{hasBorder:e.hasBorder}}))),columns:e.columns,defaultColorValue:e.defaultColorValue,colorPickerConfig:e.colorPickerConfig});var r;return n.inputView.set({id:o,ariaDescribedById:i}),n.bind("isReadOnly").to(t,"isEnabled",e=>!e),n.bind("hasError").to(t,"errorText",e=>!!e),n.on("input",()=>{t.errorText=null}),t.bind("isEmpty","isFocused").to(n),n}}function no(e){const t=parseFloat(e);return!Number.isNaN(t)&&e===String(t)}vt(".ck.ck-form__row{display:flex;flex-direction:row;flex-wrap:nowrap;justify-content:space-between}.ck.ck-form__row>:not(.ck-label){flex-grow:1}.ck.ck-form__row.ck-table-form__action-row .ck-button-cancel,.ck.ck-form__row.ck-table-form__action-row .ck-button-save{justify-content:center}.ck.ck-form__row{padding:var(--ck-spacing-standard) var(--ck-spacing-large) 0}.ck.ck-form__row>:not(.ck-label)+*{[dir=ltr] &{margin-left:var(--ck-spacing-large)}[dir=rtl] &{margin-right:var(--ck-spacing-large)}}.ck.ck-form__row>.ck-label{min-width:100%;width:100%}.ck.ck-form__row.ck-table-form__action-row{margin-top:var(--ck-spacing-large)}.ck.ck-form__row.ck-table-form__action-row .ck-button .ck-button__label{color:var(--ck-color-text)}");
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */
class ro extends f{constructor(e,t={}){super(e);const o=this.bindTemplate;this.set("class",t.class||null),this.children=this.createCollection(),t.children&&t.children.forEach(e=>this.children.add(e)),this.set("_role",null),this.set("_ariaLabelledBy",null),t.labelView&&this.set({_role:"group",_ariaLabelledBy:t.labelView.id}),this.setTemplate({tag:"div",attributes:{class:["ck","ck-form__row",o.to("class")],role:o.to("_role"),"aria-labelledby":o.to("_ariaLabelledBy")},children:this.children})}}vt(".ck.ck-form{padding:0 0 var(--ck-spacing-large)}.ck.ck-form:focus{outline:none}.ck.ck-form .ck.ck-input-text{min-width:100%;width:0}.ck.ck-form .ck.ck-dropdown{min-width:100%}.ck.ck-form .ck.ck-dropdown .ck-dropdown__button:not(:focus){border:1px solid var(--ck-color-base-border)}.ck.ck-form .ck.ck-dropdown .ck-dropdown__button .ck-button__label{width:100%}");vt('.ck.ck-table-form .ck-form__row.ck-table-form__background-row,.ck.ck-table-form .ck-form__row.ck-table-form__border-row{flex-wrap:wrap}.ck.ck-table-form .ck-form__row.ck-table-form__dimensions-row{align-items:center;flex-wrap:wrap}.ck.ck-table-form .ck-form__row.ck-table-form__dimensions-row .ck-labeled-field-view{align-items:center;display:flex;flex-direction:column-reverse}.ck.ck-table-form .ck-form__row.ck-table-form__dimensions-row .ck-labeled-field-view .ck.ck-dropdown,.ck.ck-table-form .ck-form__row.ck-table-form__dimensions-row .ck-table-form__dimension-operator{flex-grow:0}.ck.ck-table-form .ck.ck-labeled-field-view{position:relative}.ck.ck-table-form .ck.ck-labeled-field-view .ck.ck-labeled-field-view__status{bottom:calc(var(--ck-table-properties-error-arrow-size)*-1);left:50%;position:absolute;transform:translate(-50%,100%);z-index:1}.ck.ck-table-form .ck.ck-labeled-field-view .ck.ck-labeled-field-view__status:after{content:"";left:50%;position:absolute;top:calc(var(--ck-table-properties-error-arrow-size)*-1);transform:translateX(-50%)}:root{--ck-table-properties-error-arrow-size:6px;--ck-table-properties-min-error-width:150px}.ck.ck-table-form .ck-form__row.ck-table-form__border-row .ck-labeled-field-view>.ck-label{font-size:var(--ck-font-size-tiny);text-align:center}.ck.ck-table-form .ck-form__row.ck-table-form__border-row .ck-table-form__border-style,.ck.ck-table-form .ck-form__row.ck-table-form__border-row .ck-table-form__border-width{max-width:80px;min-width:80px;width:80px}.ck.ck-table-form .ck-form__row.ck-table-form__dimensions-row{padding:0}.ck.ck-table-form .ck-form__row.ck-table-form__dimensions-row .ck-table-form__dimensions-row__height,.ck.ck-table-form .ck-form__row.ck-table-form__dimensions-row .ck-table-form__dimensions-row__width{margin:0}.ck.ck-table-form .ck-form__row.ck-table-form__dimensions-row .ck-table-form__dimension-operator{align-self:flex-end;display:inline-block;height:var(--ck-ui-component-min-height);line-height:var(--ck-ui-component-min-height);margin:0 var(--ck-spacing-small)}.ck.ck-table-form .ck.ck-labeled-field-view{padding-top:var(--ck-spacing-standard)}.ck.ck-table-form .ck.ck-labeled-field-view .ck.ck-labeled-field-view__status{background:var(--ck-color-base-error);border-radius:0;color:var(--ck-color-base-background);min-width:var(--ck-table-properties-min-error-width);padding:var(--ck-spacing-small) var(--ck-spacing-medium);text-align:center;&.ck-rounded-corners,.ck-rounded-corners &{border-radius:var(--ck-border-radius)}}.ck.ck-table-form .ck.ck-labeled-field-view .ck.ck-labeled-field-view__status:after{border-color:transparent transparent var(--ck-color-base-error) transparent;border-style:solid;border-width:0 var(--ck-table-properties-error-arrow-size) var(--ck-table-properties-error-arrow-size) var(--ck-table-properties-error-arrow-size)}.ck.ck-table-form .ck.ck-labeled-field-view .ck.ck-labeled-field-view__status{animation:ck-table-form-labeled-view-status-appear .15s ease both}@media (prefers-reduced-motion:reduce){.ck.ck-table-form .ck.ck-labeled-field-view .ck.ck-labeled-field-view__status{animation:none}}.ck.ck-table-form .ck.ck-labeled-field-view .ck-input.ck-error:not(:focus)+.ck.ck-labeled-field-view__status{display:none}@keyframes ck-table-form-labeled-view-status-appear{0%{opacity:0}to{opacity:1}}');vt(".ck.ck-table-cell-properties-form .ck-form__row.ck-table-cell-properties-form__alignment-row{flex-wrap:wrap}.ck.ck-table-cell-properties-form .ck-form__row.ck-table-cell-properties-form__alignment-row .ck.ck-toolbar:first-of-type{flex-grow:0.57}.ck.ck-table-cell-properties-form .ck-form__row.ck-table-cell-properties-form__alignment-row .ck.ck-toolbar:last-of-type{flex-grow:0.43}.ck.ck-table-cell-properties-form .ck-form__row.ck-table-cell-properties-form__alignment-row .ck.ck-toolbar .ck-button{flex-grow:1}.ck.ck-table-cell-properties-form{width:320px}.ck.ck-table-cell-properties-form .ck-form__row.ck-table-cell-properties-form__padding-row{align-self:flex-end;padding:0;width:25%}.ck.ck-table-cell-properties-form .ck-form__row.ck-table-cell-properties-form__alignment-row .ck.ck-toolbar{background:none;margin-top:var(--ck-spacing-standard)}");
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */
class lo extends f{constructor(e,t){super(e),this.set({borderStyle:"",borderWidth:"",borderColor:"",padding:"",backgroundColor:"",width:"",height:"",horizontalAlignment:"",verticalAlignment:""}),this.options=t;const{borderStyleDropdown:o,borderWidthInput:i,borderColorInput:n,borderRowLabel:r}=this._createBorderFields(),{backgroundRowLabel:l,backgroundInput:s}=this._createBackgroundFields(),{widthInput:a,operatorLabel:c,heightInput:d,dimensionsLabel:b}=this._createDimensionFields(),{horizontalAlignmentToolbar:m,verticalAlignmentToolbar:g,alignmentLabel:p}=this._createAlignmentFields();this.focusTracker=new h,this.keystrokes=new u,this.children=this.createCollection(),this.borderStyleDropdown=o,this.borderWidthInput=i,this.borderColorInput=n,this.backgroundInput=s,this.paddingInput=this._createPaddingField(),this.widthInput=a,this.heightInput=d,this.horizontalAlignmentToolbar=m,this.verticalAlignmentToolbar=g;const{saveButtonView:f,cancelButtonView:w}=this._createActionButtons();this.saveButtonView=f,this.cancelButtonView=w,this._focusables=new x,this._focusCycler=new S({focusables:this._focusables,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"shift + tab",focusNext:"tab"}}),this.children.add(new I(e,{label:this.t("Cell properties")})),this.children.add(new ro(e,{labelView:r,children:[r,o,n,i],class:"ck-table-form__border-row"})),this.children.add(new ro(e,{labelView:l,children:[l,s],class:"ck-table-form__background-row"})),this.children.add(new ro(e,{children:[new ro(e,{labelView:b,children:[b,a,c,d],class:"ck-table-form__dimensions-row"}),new ro(e,{children:[this.paddingInput],class:"ck-table-cell-properties-form__padding-row"})]})),this.children.add(new ro(e,{labelView:p,children:[p,m,g],class:"ck-table-cell-properties-form__alignment-row"})),this.children.add(new ro(e,{children:[this.saveButtonView,this.cancelButtonView],class:"ck-table-form__action-row"})),this.setTemplate({tag:"form",attributes:{class:["ck","ck-form","ck-table-form","ck-table-cell-properties-form"],tabindex:"-1"},children:this.children})}render(){super.render(),P({view:this}),[this.borderColorInput,this.backgroundInput].forEach(e=>{this._focusCycler.chain(e.fieldView.focusCycler)}),[this.borderStyleDropdown,this.borderColorInput,this.borderWidthInput,this.backgroundInput,this.widthInput,this.heightInput,this.paddingInput,this.horizontalAlignmentToolbar,this.verticalAlignmentToolbar,this.saveButtonView,this.cancelButtonView].forEach(e=>{this._focusables.add(e),this.focusTracker.add(e.element)}),this.keystrokes.listenTo(this.element)}destroy(){super.destroy(),this.focusTracker.destroy(),this.keystrokes.destroy()}focus(){this._focusCycler.focusFirst()}_createBorderFields(){const e=this.options.defaultTableCellProperties,t={style:e.borderStyle,width:e.borderWidth,color:e.borderColor},o=io({colorConfig:this.options.borderColors,columns:5,defaultColorValue:t.color,colorPickerConfig:this.options.colorPickerConfig}),i=this.locale,n=this.t,r=n("Style"),l=new E(i);l.text=n("Border");const s=Kt(n),a=new z(i,B);a.set({label:r,class:"ck-table-form__border-style"}),a.fieldView.buttonView.set({ariaLabel:r,ariaLabelledBy:void 0,isOn:!1,withText:!0,tooltip:r}),a.fieldView.buttonView.bind("label").to(this,"borderStyle",e=>s[e||"none"]),a.fieldView.on("execute",e=>{this.borderStyle=e.source._borderStyleValue}),a.bind("isEmpty").to(this,"borderStyle",e=>!e),A(a.fieldView,eo(this,t.style),{role:"menu",ariaLabel:r});const c=new z(i,W);c.set({label:n("Width"),class:"ck-table-form__border-width"}),c.fieldView.bind("value").to(this,"borderWidth"),c.bind("isEnabled").to(this,"borderStyle",so),c.fieldView.on("input",()=>{this.borderWidth=c.fieldView.element.value});const d=new z(i,o);return d.set({label:n("Color"),class:"ck-table-form__border-color"}),d.fieldView.bind("value").to(this,"borderColor"),d.bind("isEnabled").to(this,"borderStyle",so),d.fieldView.on("input",()=>{this.borderColor=d.fieldView.value}),this.on("change:borderStyle",(e,o,i,n)=>{so(i)||(this.borderColor="",this.borderWidth=""),so(n)||(this.borderColor=t.color,this.borderWidth=t.width)}),{borderRowLabel:l,borderStyleDropdown:a,borderColorInput:d,borderWidthInput:c}}_createBackgroundFields(){const e=this.locale,t=this.t,o=new E(e);o.text=t("Background");const i=io({colorConfig:this.options.backgroundColors,columns:5,defaultColorValue:this.options.defaultTableCellProperties.backgroundColor,colorPickerConfig:this.options.colorPickerConfig}),n=new z(e,i);return n.set({label:t("Color"),class:"ck-table-cell-properties-form__background"}),n.fieldView.bind("value").to(this,"backgroundColor"),n.fieldView.on("input",()=>{this.backgroundColor=n.fieldView.value}),{backgroundRowLabel:o,backgroundInput:n}}_createDimensionFields(){const e=this.locale,t=this.t,o=new E(e);o.text=t("Dimensions");const i=new z(e,W);i.set({label:t("Width"),class:"ck-table-form__dimensions-row__width"}),i.fieldView.bind("value").to(this,"width"),i.fieldView.on("input",()=>{this.width=i.fieldView.element.value});const n=new f(e);n.setTemplate({tag:"span",attributes:{class:["ck-table-form__dimension-operator"]},children:[{text:"×"}]});const r=new z(e,W);return r.set({label:t("Height"),class:"ck-table-form__dimensions-row__height"}),r.fieldView.bind("value").to(this,"height"),r.fieldView.on("input",()=>{this.height=r.fieldView.element.value}),{dimensionsLabel:o,widthInput:i,operatorLabel:n,heightInput:r}}_createPaddingField(){const e=this.locale,t=this.t,o=new z(e,W);return o.set({label:t("Padding"),class:"ck-table-cell-properties-form__padding"}),o.fieldView.bind("value").to(this,"padding"),o.fieldView.on("input",()=>{this.padding=o.fieldView.element.value}),o}_createAlignmentFields(){const e=this.locale,t=this.t,i=new E(e),n={left:o.alignLeft,center:o.alignCenter,right:o.alignRight,justify:o.alignJustify,top:o.alignTop,middle:o.alignMiddle,bottom:o.alignBottom};i.text=t("Table cell text alignment");const r=new N(e),l="rtl"===e.contentLanguageDirection;r.set({isCompact:!0,ariaLabel:t("Horizontal text alignment toolbar")}),to({view:this,icons:n,toolbar:r,labels:this._horizontalAlignmentLabels,propertyName:"horizontalAlignment",nameToValue:e=>{if(l){if("left"===e)return"right";if("right"===e)return"left"}return e},defaultValue:this.options.defaultTableCellProperties.horizontalAlignment});const s=new N(e);return s.set({isCompact:!0,ariaLabel:t("Vertical text alignment toolbar")}),to({view:this,icons:n,toolbar:s,labels:this._verticalAlignmentLabels,propertyName:"verticalAlignment",defaultValue:this.options.defaultTableCellProperties.verticalAlignment}),{horizontalAlignmentToolbar:r,verticalAlignmentToolbar:s,alignmentLabel:i}}_createActionButtons(){const e=this.locale,t=this.t,i=new k(e),n=new k(e),r=[this.borderWidthInput,this.borderColorInput,this.backgroundInput,this.paddingInput];return i.set({label:t("Save"),icon:o.check,class:"ck-button-save",type:"submit",withText:!0}),i.bind("isEnabled").toMany(r,"errorText",(...e)=>e.every(e=>!e)),n.set({label:t("Cancel"),icon:o.cancel,class:"ck-button-cancel",withText:!0}),n.delegate("execute").to(this,"cancel"),{saveButtonView:i,cancelButtonView:n}}get _horizontalAlignmentLabels(){const e=this.locale,t=this.t,o=t("Align cell text to the left"),i=t("Align cell text to the center"),n=t("Align cell text to the right"),r=t("Justify cell text");return"rtl"===e.uiLanguageDirection?{right:n,center:i,left:o,justify:r}:{left:o,center:i,right:n,justify:r}}get _verticalAlignmentLabels(){const e=this.t;return{top:e("Align cell text to the top"),middle:e("Align cell text to the middle"),bottom:e("Align cell text to the bottom")}}}function so(e){return"none"!==e}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */const ao=(()=>[L.defaultPositions.northArrowSouth,L.defaultPositions.northArrowSouthWest,L.defaultPositions.northArrowSouthEast,L.defaultPositions.southArrowNorth,L.defaultPositions.southArrowNorthWest,L.defaultPositions.southArrowNorthEast,L.defaultPositions.viewportStickyNorth])();function co(e,t){const o=e.plugins.get("ContextualBalloon"),i=e.editing.view.document.selection;let n;"cell"===t?Mt(i)&&(n=ho(e)):Ht(i)&&(n=uo(e)),n&&o.updatePosition(n)}function uo(e){const t=he(e.model.document.selection),o=e.editing.mapper.toViewElement(t);return{target:e.editing.view.domConverter.mapViewToDom(o),positions:ao}}function ho(e){const t=e.editing.mapper,o=e.editing.view.domConverter,i=e.model.document.selection;if(i.rangeCount>1)return{target:()=>function(e,t){const o=t.editing.mapper,i=t.editing.view.domConverter,n=Array.from(e).map(e=>{const t=bo(e.start),n=o.toViewElement(t);return new g(i.mapViewToDom(n))});return g.getBoundingRect(n)}(i.getRanges(),e),positions:ao};const n=bo(i.getFirstPosition()),r=t.toViewElement(n);return{target:o.mapViewToDom(r),positions:ao}}function bo(e){return e.nodeAfter&&e.nodeAfter.is("element","tableCell")?e.nodeAfter:e.findAncestor("tableCell")}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */
function mo(e){if(!e||!Z(e))return e;const{top:t,right:o,bottom:i,left:n}=e;return t==o&&o==i&&i==n?t:void 0}function go(e,t){const o=parseFloat(e);return Number.isNaN(o)||String(o)!==String(e)?e:`${o}${t}`}function po(e,t={}){const o={borderStyle:"none",borderWidth:"",borderColor:"",backgroundColor:"",width:"",height:"",...e};return t.includeAlignmentProperty&&!o.alignment&&(o.alignment="center"),t.includePaddingProperty&&!o.padding&&(o.padding=""),t.includeVerticalAlignmentProperty&&!o.verticalAlignment&&(o.verticalAlignment="middle"),t.includeHorizontalAlignmentProperty&&!o.horizontalAlignment&&(o.horizontalAlignment=t.isRightToLeftContent?"right":"left"),o}function fo(e,t){return po({borderStyle:"double",borderColor:"hsl(0, 0%, 70%)",borderWidth:"1px",...e},t)}function wo(e,t){return po({borderStyle:"solid",borderColor:"hsl(0, 0%, 75%)",borderWidth:"1px",...e},t)}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */const ko={borderStyle:"tableCellBorderStyle",borderColor:"tableCellBorderColor",borderWidth:"tableCellBorderWidth",height:"tableCellHeight",width:"tableCellWidth",padding:"tableCellPadding",backgroundColor:"tableCellBackgroundColor",horizontalAlignment:"tableCellHorizontalAlignment",verticalAlignment:"tableCellVerticalAlignment"};class _o extends t{static get requires(){return[F]}static get pluginName(){return"TableCellPropertiesUI"}static get isOfficialPlugin(){return!0}constructor(e){super(e),e.config.define("table.tableCellProperties",{borderColors:oo,backgroundColors:oo})}init(){const e=this.editor,t=e.t;this._defaultTableCellProperties=wo(e.config.get("table.tableCellProperties.defaultProperties"),{includeVerticalAlignmentProperty:!0,includeHorizontalAlignmentProperty:!0,includePaddingProperty:!0,isRightToLeftContent:"rtl"===e.locale.contentLanguageDirection}),this._balloon=e.plugins.get(F),this.view=null,this._isReady=!1,e.ui.componentFactory.add("tableCellProperties",o=>{const i=new k(o);i.set({label:t("Cell properties"),icon:'<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="m11.105 18-.17 1H2.5A1.5 1.5 0 0 1 1 17.5v-15A1.5 1.5 0 0 1 2.5 1h15A1.5 1.5 0 0 1 19 2.5v9.975l-.85-.124-.15-.302V8h-5v4h.021l-.172.351-1.916.28-.151.027c-.287.063-.54.182-.755.341L8 13v5h3.105zM2 12h5V8H2v4zm10-4H8v4h4V8zM2 2v5h5V2H2zm0 16h5v-5H2v5zM13 7h5V2h-5v5zM8 2v5h4V2H8z" opacity=".6"/><path d="m15.5 11.5 1.323 2.68 2.957.43-2.14 2.085.505 2.946L15.5 18.25l-2.645 1.39.505-2.945-2.14-2.086 2.957-.43L15.5 11.5zM13 6a1 1 0 0 1 1 1v3.172a2.047 2.047 0 0 0-.293.443l-.858 1.736-1.916.28-.151.027A1.976 1.976 0 0 0 9.315 14H7a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1h6zm-1 2H8v4h4V8z"/></svg>',tooltip:!0}),this.listenTo(i,"execute",()=>this._showView());const n=Object.values(ko).map(t=>e.commands.get(t));return i.bind("isEnabled").toMany(n,"isEnabled",(...e)=>e.some(e=>e)),i})}destroy(){super.destroy(),this.view&&this.view.destroy()}_createPropertiesView(){const e=this.editor,t=e.config.get("table.tableCellProperties"),o=D(t.borderColors),i=H(e.locale,o),n=D(t.backgroundColors),r=H(e.locale,n),l=!1!==t.colorPicker,s=new lo(e.locale,{borderColors:i,backgroundColors:r,defaultTableCellProperties:this._defaultTableCellProperties,colorPickerConfig:!!l&&(t.colorPicker||{})}),a=e.t;s.render(),this.listenTo(s,"submit",()=>{this._hideView()}),this.listenTo(s,"cancel",()=>{this._undoStepBatch.operations.length&&e.execute("undo",this._undoStepBatch),this._hideView()}),s.keystrokes.set("Esc",(e,t)=>{this._hideView(),t()}),O({emitter:s,activator:()=>this._isViewInBalloon,contextElements:[this._balloon.view.element],callback:()=>this._hideView()});const c=Jt(a),d=Xt(a);return s.on("change:borderStyle",this._getPropertyChangeCallback("tableCellBorderStyle")),s.on("change:borderColor",this._getValidatedPropertyChangeCallback({viewField:s.borderColorInput,commandName:"tableCellBorderColor",errorText:c,validator:Yt})),s.on("change:borderWidth",this._getValidatedPropertyChangeCallback({viewField:s.borderWidthInput,commandName:"tableCellBorderWidth",errorText:d,validator:Zt})),s.on("change:padding",this._getValidatedPropertyChangeCallback({viewField:s.paddingInput,commandName:"tableCellPadding",errorText:d,validator:Qt})),s.on("change:width",this._getValidatedPropertyChangeCallback({viewField:s.widthInput,commandName:"tableCellWidth",errorText:d,validator:Qt})),s.on("change:height",this._getValidatedPropertyChangeCallback({viewField:s.heightInput,commandName:"tableCellHeight",errorText:d,validator:Qt})),s.on("change:backgroundColor",this._getValidatedPropertyChangeCallback({viewField:s.backgroundInput,commandName:"tableCellBackgroundColor",errorText:c,validator:Yt})),s.on("change:horizontalAlignment",this._getPropertyChangeCallback("tableCellHorizontalAlignment")),s.on("change:verticalAlignment",this._getPropertyChangeCallback("tableCellVerticalAlignment")),s}_fillViewFormFromCommandValues(){const e=this.editor.commands,t=e.get("tableCellBorderStyle");Object.entries(ko).map(([t,o])=>{const i=this._defaultTableCellProperties[t]||"";return[t,e.get(o).value||i]}).forEach(([e,o])=>{("borderColor"!==e&&"borderWidth"!==e||"none"!==t.value)&&this.view.set(e,o)}),this._isReady=!0}_showView(){const e=this.editor;this.view||(this.view=this._createPropertiesView()),this.listenTo(e.ui,"update",()=>{this._updateView()}),this._fillViewFormFromCommandValues(),this._balloon.add({view:this.view,position:ho(e)}),this._undoStepBatch=e.model.createBatch(),this.view.focus()}_hideView(){const e=this.editor;this.stopListening(e.ui,"update"),this._isReady=!1,this.view.saveButtonView.focus(),this._balloon.remove(this.view),this.editor.editing.view.focus()}_updateView(){const e=this.editor;Mt(e.editing.view.document.selection)?this._isViewVisible&&co(e,"cell"):this._hideView()}get _isViewVisible(){return!!this.view&&this._balloon.visibleView===this.view}get _isViewInBalloon(){return!!this.view&&this._balloon.hasView(this.view)}_getPropertyChangeCallback(e){return(t,o,i)=>{this._isReady&&this.editor.execute(e,{value:i,batch:this._undoStepBatch})}}_getValidatedPropertyChangeCallback(e){const{commandName:t,viewField:o,validator:i,errorText:n}=e,r=ee(()=>{o.errorText=n},500);return(e,n,l)=>{r.cancel(),this._isReady&&(i(l)?(this.editor.execute(t,{value:l,batch:this._undoStepBatch}),o.errorText=null):r())}}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class Co extends e{constructor(e,t,o){super(e),this.attributeName=t,this._defaultValue=o}refresh(){const e=this.editor,t=this.editor.plugins.get("TableUtils").getSelectionAffectedTableCells(e.model.document.selection);this.isEnabled=!!t.length,this.value=this._getSingleValue(t)}execute(e={}){const{value:t,batch:o}=e,i=this.editor.model,n=this.editor.plugins.get("TableUtils").getSelectionAffectedTableCells(i.document.selection),r=this._getValueToSet(t);i.enqueueChange(o,e=>{r?n.forEach(t=>e.setAttribute(this.attributeName,r,t)):n.forEach(t=>e.removeAttribute(this.attributeName,t))})}_getAttribute(e){if(!e)return;const t=e.getAttribute(this.attributeName);return t!==this._defaultValue?t:void 0}_getValueToSet(e){if(e!==this._defaultValue)return e}_getSingleValue(e){const t=this._getAttribute(e[0]);return e.every(e=>this._getAttribute(e)===t)?t:void 0}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class vo extends Co{constructor(e,t){super(e,"tableCellWidth",t)}_getValueToSet(e){if((e=go(e,"px"))!==this._defaultValue)return e}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class yo extends t{static get pluginName(){return"TableCellWidthEditing"}static get isOfficialPlugin(){return!0}static get requires(){return[yt]}init(){const e=this.editor,t=wo(e.config.get("table.tableCellProperties.defaultProperties"));ue(e.model.schema,e.conversion,{modelAttribute:"tableCellWidth",styleName:"width",defaultValue:t.width}),e.commands.add("tableCellWidth",new vo(e,t.width))}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class Ao extends Co{constructor(e,t){super(e,"tableCellPadding",t)}_getAttribute(e){if(!e)return;const t=mo(e.getAttribute(this.attributeName));return t!==this._defaultValue?t:void 0}_getValueToSet(e){const t=go(e,"px");if(t!==this._defaultValue)return t}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class To extends Co{constructor(e,t){super(e,"tableCellHeight",t)}_getValueToSet(e){const t=go(e,"px");if(t!==this._defaultValue)return t}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class xo extends Co{constructor(e,t){super(e,"tableCellBackgroundColor",t)}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class So extends Co{constructor(e,t){super(e,"tableCellVerticalAlignment",t)}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class Vo extends Co{constructor(e,t){super(e,"tableCellHorizontalAlignment",t)}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class Ro extends Co{constructor(e,t){super(e,"tableCellBorderStyle",t)}_getAttribute(e){if(!e)return;const t=mo(e.getAttribute(this.attributeName));return t!==this._defaultValue?t:void 0}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class Io extends Co{constructor(e,t){super(e,"tableCellBorderColor",t)}_getAttribute(e){if(!e)return;const t=mo(e.getAttribute(this.attributeName));return t!==this._defaultValue?t:void 0}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class Po extends Co{constructor(e,t){super(e,"tableCellBorderWidth",t)}_getAttribute(e){if(!e)return;const t=mo(e.getAttribute(this.attributeName));return t!==this._defaultValue?t:void 0}_getValueToSet(e){const t=go(e,"px");if(t!==this._defaultValue)return t}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */const Eo=/^(top|middle|bottom)$/,zo=/^(left|center|right|justify)$/;class Bo extends t{static get pluginName(){return"TableCellPropertiesEditing"}static get isOfficialPlugin(){return!0}static get requires(){return[yt,yo]}init(){const e=this.editor,t=e.model.schema,o=e.conversion;e.config.define("table.tableCellProperties.defaultProperties",{});const i=wo(e.config.get("table.tableCellProperties.defaultProperties"),{includeVerticalAlignmentProperty:!0,includeHorizontalAlignmentProperty:!0,includePaddingProperty:!0,isRightToLeftContent:"rtl"===e.locale.contentLanguageDirection});e.data.addStyleProcessorRules(K),function(e,t,o){const i={width:"tableCellBorderWidth",color:"tableCellBorderColor",style:"tableCellBorderStyle"};e.extend("tableCell",{allowAttributes:Object.values(i)}),ne(t,"td",i,o),ne(t,"th",i,o),re(t,{modelElement:"tableCell",modelAttribute:i.style,styleName:"border-style"}),re(t,{modelElement:"tableCell",modelAttribute:i.color,styleName:"border-color"}),re(t,{modelElement:"tableCell",modelAttribute:i.width,styleName:"border-width"})}(t,o,{color:i.borderColor,style:i.borderStyle,width:i.borderWidth}),e.commands.add("tableCellBorderStyle",new Ro(e,i.borderStyle)),e.commands.add("tableCellBorderColor",new Io(e,i.borderColor)),e.commands.add("tableCellBorderWidth",new Po(e,i.borderWidth)),ue(t,o,{modelAttribute:"tableCellHeight",styleName:"height",defaultValue:i.height}),e.commands.add("tableCellHeight",new To(e,i.height)),e.data.addStyleProcessorRules(J),ue(t,o,{modelAttribute:"tableCellPadding",styleName:"padding",reduceBoxSides:!0,defaultValue:i.padding}),e.commands.add("tableCellPadding",new Ao(e,i.padding)),e.data.addStyleProcessorRules(X),ue(t,o,{modelAttribute:"tableCellBackgroundColor",styleName:"background-color",defaultValue:i.backgroundColor}),e.commands.add("tableCellBackgroundColor",new xo(e,i.backgroundColor)),function(e,t,o){e.extend("tableCell",{allowAttributes:["tableCellHorizontalAlignment"]}),t.for("downcast").attributeToAttribute({model:{name:"tableCell",key:"tableCellHorizontalAlignment"},view:e=>({key:"style",value:{"text-align":e}})}),t.for("upcast").attributeToAttribute({view:{name:/^(td|th)$/,styles:{"text-align":zo}},model:{key:"tableCellHorizontalAlignment",value:e=>{const t=e.getStyle("text-align");return t===o?null:t}}}).attributeToAttribute({view:{name:/^(td|th)$/,attributes:{align:zo}},model:{key:"tableCellHorizontalAlignment",value:e=>{const t=e.getAttribute("align");return t===o?null:t}}})}(t,o,i.horizontalAlignment),e.commands.add("tableCellHorizontalAlignment",new Vo(e,i.horizontalAlignment)),function(e,t,o){e.extend("tableCell",{allowAttributes:["tableCellVerticalAlignment"]}),t.for("downcast").attributeToAttribute({model:{name:"tableCell",key:"tableCellVerticalAlignment"},view:e=>({key:"style",value:{"vertical-align":e}})}),t.for("upcast").attributeToAttribute({view:{name:/^(td|th)$/,styles:{"vertical-align":Eo}},model:{key:"tableCellVerticalAlignment",value:e=>{const t=e.getStyle("vertical-align");return t===o?null:t}}}).attributeToAttribute({view:{name:/^(td|th)$/,attributes:{valign:Eo}},model:{key:"tableCellVerticalAlignment",value:e=>{const t=e.getAttribute("valign");return t===o?null:t}}})}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */(t,o,i.verticalAlignment),e.commands.add("tableCellVerticalAlignment",new So(e,i.verticalAlignment))}}class Wo extends t{static get pluginName(){return"TableCellProperties"}static get isOfficialPlugin(){return!0}static get requires(){return[Bo,_o]}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class No extends e{constructor(e,t,o){super(e),this.attributeName=t,this._defaultValue=o}refresh(){const e=he(this.editor.model.document.selection);this.isEnabled=!!e,this.value=this._getValue(e)}execute(e={}){const t=this.editor.model,o=t.document.selection,{value:i,batch:n}=e,r=he(o),l=this._getValueToSet(i);t.enqueueChange(n,e=>{l?e.setAttribute(this.attributeName,l,r):e.removeAttribute(this.attributeName,r)})}_getValue(e){if(!e)return;const t=e.getAttribute(this.attributeName);return t!==this._defaultValue?t:void 0}_getValueToSet(e){if(e!==this._defaultValue)return e}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class Lo extends No{constructor(e,t){super(e,"tableBackgroundColor",t)}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class Fo extends No{constructor(e,t){super(e,"tableBorderColor",t)}_getValue(e){if(!e)return;const t=mo(e.getAttribute(this.attributeName));return t!==this._defaultValue?t:void 0}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class Do extends No{constructor(e,t){super(e,"tableBorderStyle",t)}_getValue(e){if(!e)return;const t=mo(e.getAttribute(this.attributeName));return t!==this._defaultValue?t:void 0}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class Ho extends No{constructor(e,t){super(e,"tableBorderWidth",t)}_getValue(e){if(!e)return;const t=mo(e.getAttribute(this.attributeName));return t!==this._defaultValue?t:void 0}_getValueToSet(e){const t=go(e,"px");if(t!==this._defaultValue)return t}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class Oo extends No{constructor(e,t){super(e,"tableWidth",t)}_getValueToSet(e){if((e=go(e,"px"))!==this._defaultValue)return e}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class Mo extends No{constructor(e,t){super(e,"tableHeight",t)}_getValueToSet(e){if((e=go(e,"px"))!==this._defaultValue)return e}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class Uo extends No{constructor(e,t){super(e,"tableAlignment",t)}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */const $o=/^(left|center|right)$/,jo=/^(left|none|right)$/;class qo extends t{static get pluginName(){return"TablePropertiesEditing"}static get isOfficialPlugin(){return!0}static get requires(){return[yt]}init(){const e=this.editor,t=e.model.schema,o=e.conversion;e.config.define("table.tableProperties.defaultProperties",{});const i=fo(e.config.get("table.tableProperties.defaultProperties"),{includeAlignmentProperty:!0});e.data.addStyleProcessorRules(K),function(e,t,o){const i={width:"tableBorderWidth",color:"tableBorderColor",style:"tableBorderStyle"};e.extend("table",{allowAttributes:Object.values(i)}),ne(t,"table",i,o),le(t,{modelAttribute:i.color,styleName:"border-color"}),le(t,{modelAttribute:i.style,styleName:"border-style"}),le(t,{modelAttribute:i.width,styleName:"border-width"})}(t,o,{color:i.borderColor,style:i.borderStyle,width:i.borderWidth}),e.commands.add("tableBorderColor",new Fo(e,i.borderColor)),e.commands.add("tableBorderStyle",new Do(e,i.borderStyle)),e.commands.add("tableBorderWidth",new Ho(e,i.borderWidth)),function(e,t,o){e.extend("table",{allowAttributes:["tableAlignment"]}),t.for("downcast").attributeToAttribute({model:{name:"table",key:"tableAlignment"},view:e=>({key:"style",value:{float:"center"===e?"none":e}}),converterPriority:"high"}),t.for("upcast").attributeToAttribute({view:{name:/^(table|figure)$/,styles:{float:jo}},model:{key:"tableAlignment",value:e=>{let t=e.getStyle("float");return"none"===t&&(t="center"),t===o?null:t}}}).attributeToAttribute({view:{attributes:{align:$o}},model:{name:"table",key:"tableAlignment",value:e=>{const t=e.getAttribute("align");return t===o?null:t}}})}(t,o,i.alignment),e.commands.add("tableAlignment",new Uo(e,i.alignment)),Go(t,o,{modelAttribute:"tableWidth",styleName:"width",defaultValue:i.width}),e.commands.add("tableWidth",new Oo(e,i.width)),Go(t,o,{modelAttribute:"tableHeight",styleName:"height",defaultValue:i.height}),e.commands.add("tableHeight",new Mo(e,i.height)),e.data.addStyleProcessorRules(X),function(e,t,o){const{modelAttribute:i}=o;e.extend("table",{allowAttributes:[i]}),ie(t,{viewElement:"table",...o}),le(t,o)}(t,o,{modelAttribute:"tableBackgroundColor",styleName:"background-color",defaultValue:i.backgroundColor}),e.commands.add("tableBackgroundColor",new Lo(e,i.backgroundColor))}}function Go(e,t,o){const{modelAttribute:i}=o;e.extend("table",{allowAttributes:[i]}),ie(t,{viewElement:/^(table|figure)$/,shouldUpcast:e=>!("table"==e.name&&"figure"==e.parent.name),...o}),re(t,{modelElement:"table",...o})}vt(".ck.ck-table-properties-form .ck-form__row.ck-table-properties-form__alignment-row{align-content:baseline;flex-basis:0;flex-wrap:wrap}.ck.ck-table-properties-form .ck-form__row.ck-table-properties-form__alignment-row .ck.ck-toolbar .ck-toolbar__items{flex-wrap:nowrap}.ck.ck-table-properties-form{width:320px}.ck.ck-table-properties-form .ck-form__row.ck-table-properties-form__alignment-row{align-self:flex-end;padding:0}.ck.ck-table-properties-form .ck-form__row.ck-table-properties-form__alignment-row .ck.ck-toolbar{background:none;margin-top:var(--ck-spacing-standard)}.ck.ck-table-properties-form .ck-form__row.ck-table-properties-form__alignment-row .ck.ck-toolbar .ck-toolbar__items>*{width:40px}");
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */
class Ko extends f{constructor(e,t){super(e),this.set({borderStyle:"",borderWidth:"",borderColor:"",backgroundColor:"",width:"",height:"",alignment:""}),this.options=t;const{borderStyleDropdown:o,borderWidthInput:i,borderColorInput:n,borderRowLabel:r}=this._createBorderFields(),{backgroundRowLabel:l,backgroundInput:s}=this._createBackgroundFields(),{widthInput:a,operatorLabel:c,heightInput:d,dimensionsLabel:b}=this._createDimensionFields(),{alignmentToolbar:m,alignmentLabel:g}=this._createAlignmentFields();this.focusTracker=new h,this.keystrokes=new u,this.children=this.createCollection(),this.borderStyleDropdown=o,this.borderWidthInput=i,this.borderColorInput=n,this.backgroundInput=s,this.widthInput=a,this.heightInput=d,this.alignmentToolbar=m;const{saveButtonView:p,cancelButtonView:f}=this._createActionButtons();this.saveButtonView=p,this.cancelButtonView=f,this._focusables=new x,this._focusCycler=new S({focusables:this._focusables,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"shift + tab",focusNext:"tab"}}),this.children.add(new I(e,{label:this.t("Table properties")})),this.children.add(new ro(e,{labelView:r,children:[r,o,n,i],class:"ck-table-form__border-row"})),this.children.add(new ro(e,{labelView:l,children:[l,s],class:"ck-table-form__background-row"})),this.children.add(new ro(e,{children:[new ro(e,{labelView:b,children:[b,a,c,d],class:"ck-table-form__dimensions-row"}),new ro(e,{labelView:g,children:[g,m],class:"ck-table-properties-form__alignment-row"})]})),this.children.add(new ro(e,{children:[this.saveButtonView,this.cancelButtonView],class:"ck-table-form__action-row"})),this.setTemplate({tag:"form",attributes:{class:["ck","ck-form","ck-table-form","ck-table-properties-form"],tabindex:"-1"},children:this.children})}render(){super.render(),P({view:this}),[this.borderColorInput,this.backgroundInput].forEach(e=>{this._focusCycler.chain(e.fieldView.focusCycler)}),[this.borderStyleDropdown,this.borderColorInput,this.borderWidthInput,this.backgroundInput,this.widthInput,this.heightInput,this.alignmentToolbar,this.saveButtonView,this.cancelButtonView].forEach(e=>{this._focusables.add(e),this.focusTracker.add(e.element)}),this.keystrokes.listenTo(this.element)}destroy(){super.destroy(),this.focusTracker.destroy(),this.keystrokes.destroy()}focus(){this._focusCycler.focusFirst()}_createBorderFields(){const e=this.options.defaultTableProperties,t={style:e.borderStyle,width:e.borderWidth,color:e.borderColor},o=io({colorConfig:this.options.borderColors,columns:5,defaultColorValue:t.color,colorPickerConfig:this.options.colorPickerConfig}),i=this.locale,n=this.t,r=n("Style"),l=new E(i);l.text=n("Border");const s=Kt(n),a=new z(i,B);a.set({label:r,class:"ck-table-form__border-style"}),a.fieldView.buttonView.set({ariaLabel:r,ariaLabelledBy:void 0,isOn:!1,withText:!0,tooltip:r}),a.fieldView.buttonView.bind("label").to(this,"borderStyle",e=>s[e||"none"]),a.fieldView.on("execute",e=>{this.borderStyle=e.source._borderStyleValue}),a.bind("isEmpty").to(this,"borderStyle",e=>!e),A(a.fieldView,eo(this,t.style),{role:"menu",ariaLabel:r});const c=new z(i,W);c.set({label:n("Width"),class:"ck-table-form__border-width"}),c.fieldView.bind("value").to(this,"borderWidth"),c.bind("isEnabled").to(this,"borderStyle",Jo),c.fieldView.on("input",()=>{this.borderWidth=c.fieldView.element.value});const d=new z(i,o);return d.set({label:n("Color"),class:"ck-table-form__border-color"}),d.fieldView.bind("value").to(this,"borderColor"),d.bind("isEnabled").to(this,"borderStyle",Jo),d.fieldView.on("input",()=>{this.borderColor=d.fieldView.value}),this.on("change:borderStyle",(e,o,i,n)=>{Jo(i)||(this.borderColor="",this.borderWidth=""),Jo(n)||(this.borderColor=t.color,this.borderWidth=t.width)}),{borderRowLabel:l,borderStyleDropdown:a,borderColorInput:d,borderWidthInput:c}}_createBackgroundFields(){const e=this.locale,t=this.t,o=new E(e);o.text=t("Background");const i=io({colorConfig:this.options.backgroundColors,columns:5,defaultColorValue:this.options.defaultTableProperties.backgroundColor,colorPickerConfig:this.options.colorPickerConfig}),n=new z(e,i);return n.set({label:t("Color"),class:"ck-table-properties-form__background"}),n.fieldView.bind("value").to(this,"backgroundColor"),n.fieldView.on("input",()=>{this.backgroundColor=n.fieldView.value}),{backgroundRowLabel:o,backgroundInput:n}}_createDimensionFields(){const e=this.locale,t=this.t,o=new E(e);o.text=t("Dimensions");const i=new z(e,W);i.set({label:t("Width"),class:"ck-table-form__dimensions-row__width"}),i.fieldView.bind("value").to(this,"width"),i.fieldView.on("input",()=>{this.width=i.fieldView.element.value});const n=new f(e);n.setTemplate({tag:"span",attributes:{class:["ck-table-form__dimension-operator"]},children:[{text:"×"}]});const r=new z(e,W);return r.set({label:t("Height"),class:"ck-table-form__dimensions-row__height"}),r.fieldView.bind("value").to(this,"height"),r.fieldView.on("input",()=>{this.height=r.fieldView.element.value}),{dimensionsLabel:o,widthInput:i,operatorLabel:n,heightInput:r}}_createAlignmentFields(){const e=this.locale,t=this.t,i=new E(e);i.text=t("Alignment");const n=new N(e);return n.set({isCompact:!0,ariaLabel:t("Table alignment toolbar")}),to({view:this,icons:{left:o.objectLeft,center:o.objectCenter,right:o.objectRight},toolbar:n,labels:this._alignmentLabels,propertyName:"alignment",defaultValue:this.options.defaultTableProperties.alignment}),{alignmentLabel:i,alignmentToolbar:n}}_createActionButtons(){const e=this.locale,t=this.t,i=new k(e),n=new k(e),r=[this.borderWidthInput,this.borderColorInput,this.backgroundInput,this.widthInput,this.heightInput];return i.set({label:t("Save"),icon:o.check,class:"ck-button-save",type:"submit",withText:!0}),i.bind("isEnabled").toMany(r,"errorText",(...e)=>e.every(e=>!e)),n.set({label:t("Cancel"),icon:o.cancel,class:"ck-button-cancel",withText:!0}),n.delegate("execute").to(this,"cancel"),{saveButtonView:i,cancelButtonView:n}}get _alignmentLabels(){const e=this.locale,t=this.t,o=t("Align table to the left"),i=t("Center table"),n=t("Align table to the right");return"rtl"===e.uiLanguageDirection?{right:n,center:i,left:o}:{left:o,center:i,right:n}}}function Jo(e){return"none"!==e}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */
const Xo={borderStyle:"tableBorderStyle",borderColor:"tableBorderColor",borderWidth:"tableBorderWidth",backgroundColor:"tableBackgroundColor",width:"tableWidth",height:"tableHeight",alignment:"tableAlignment"};class Yo extends t{static get requires(){return[F]}static get pluginName(){return"TablePropertiesUI"}static get isOfficialPlugin(){return!0}constructor(e){super(e),this.view=null,e.config.define("table.tableProperties",{borderColors:oo,backgroundColors:oo})}init(){const e=this.editor,t=e.t;this._defaultTableProperties=fo(e.config.get("table.tableProperties.defaultProperties"),{includeAlignmentProperty:!0}),this._balloon=e.plugins.get(F),e.ui.componentFactory.add("tableProperties",o=>{const i=new k(o);i.set({label:t("Table properties"),icon:'<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M8 2v5h4V2h1v5h5v1h-5v4h.021l-.172.351-1.916.28-.151.027c-.287.063-.54.182-.755.341L8 13v5H7v-5H2v-1h5V8H2V7h5V2h1zm4 6H8v4h4V8z" opacity=".6"/><path d="m15.5 11.5 1.323 2.68 2.957.43-2.14 2.085.505 2.946L15.5 18.25l-2.645 1.39.505-2.945-2.14-2.086 2.957-.43L15.5 11.5zM17 1a2 2 0 0 1 2 2v9.475l-.85-.124-.857-1.736a2.048 2.048 0 0 0-.292-.44L17 3H3v14h7.808l.402.392L10.935 19H3a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h14z"/></svg>',tooltip:!0}),this.listenTo(i,"execute",()=>this._showView());const n=Object.values(Xo).map(t=>e.commands.get(t));return i.bind("isEnabled").toMany(n,"isEnabled",(...e)=>e.some(e=>e)),i})}destroy(){super.destroy(),this.view&&this.view.destroy()}_createPropertiesView(){const e=this.editor,t=e.config.get("table.tableProperties"),o=D(t.borderColors),i=H(e.locale,o),n=D(t.backgroundColors),r=H(e.locale,n),l=!1!==t.colorPicker,s=new Ko(e.locale,{borderColors:i,backgroundColors:r,defaultTableProperties:this._defaultTableProperties,colorPickerConfig:!!l&&(t.colorPicker||{})}),a=e.t;s.render(),this.listenTo(s,"submit",()=>{this._hideView()}),this.listenTo(s,"cancel",()=>{this._undoStepBatch.operations.length&&e.execute("undo",this._undoStepBatch),this._hideView()}),s.keystrokes.set("Esc",(e,t)=>{this._hideView(),t()}),O({emitter:s,activator:()=>this._isViewInBalloon,contextElements:[this._balloon.view.element],callback:()=>this._hideView()});const c=Jt(a),d=Xt(a);return s.on("change:borderStyle",this._getPropertyChangeCallback("tableBorderStyle")),s.on("change:borderColor",this._getValidatedPropertyChangeCallback({viewField:s.borderColorInput,commandName:"tableBorderColor",errorText:c,validator:Yt})),s.on("change:borderWidth",this._getValidatedPropertyChangeCallback({viewField:s.borderWidthInput,commandName:"tableBorderWidth",errorText:d,validator:Zt})),s.on("change:backgroundColor",this._getValidatedPropertyChangeCallback({viewField:s.backgroundInput,commandName:"tableBackgroundColor",errorText:c,validator:Yt})),s.on("change:width",this._getValidatedPropertyChangeCallback({viewField:s.widthInput,commandName:"tableWidth",errorText:d,validator:Qt})),s.on("change:height",this._getValidatedPropertyChangeCallback({viewField:s.heightInput,commandName:"tableHeight",errorText:d,validator:Qt})),s.on("change:alignment",this._getPropertyChangeCallback("tableAlignment")),s}_fillViewFormFromCommandValues(){const e=this.editor.commands,t=e.get("tableBorderStyle");Object.entries(Xo).map(([t,o])=>{const i=t,n=this._defaultTableProperties[i]||"";return[i,e.get(o).value||n]}).forEach(([e,o])=>{("borderColor"!==e&&"borderWidth"!==e||"none"!==t.value)&&this.view.set(e,o)}),this._isReady=!0}_showView(){const e=this.editor;this.view||(this.view=this._createPropertiesView()),this.listenTo(e.ui,"update",()=>{this._updateView()}),this._fillViewFormFromCommandValues(),this._balloon.add({view:this.view,position:uo(e)}),this._undoStepBatch=e.model.createBatch(),this.view.focus()}_hideView(){const e=this.editor;this.stopListening(e.ui,"update"),this._isReady=!1,this.view.saveButtonView.focus(),this._balloon.remove(this.view),this.editor.editing.view.focus()}_updateView(){const e=this.editor;Ht(e.editing.view.document.selection)?this._isViewVisible&&co(e,"table"):this._hideView()}get _isViewVisible(){return!!this.view&&this._balloon.visibleView===this.view}get _isViewInBalloon(){return!!this.view&&this._balloon.hasView(this.view)}_getPropertyChangeCallback(e){return(t,o,i)=>{this._isReady&&this.editor.execute(e,{value:i,batch:this._undoStepBatch})}}_getValidatedPropertyChangeCallback(e){const{commandName:t,viewField:o,validator:i,errorText:n}=e,r=ee(()=>{o.errorText=n},500);return(e,n,l)=>{r.cancel(),this._isReady&&(i(l)?(this.editor.execute(t,{value:l,batch:this._undoStepBatch}),o.errorText=null):r())}}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class Qo extends t{static get pluginName(){return"TableProperties"}static get isOfficialPlugin(){return!0}static get requires(){return[qo,Yo]}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */function Zo(e){e.document.registerPostFixer(t=>function(e,t){const o=t.document.differ.getChanges();let i=!1;for(const t of o){if("insert"!=t.type)continue;const o=t.position.parent;if(o.is("element","table")||"table"==t.name){const n="table"==t.name?t.position.nodeAfter:o,r=Array.from(n.getChildren()).filter(e=>e.is("element","caption")),l=r.shift();if(!l)continue;for(const t of r)e.move(e.createRangeIn(t),l,"end"),e.remove(t);l.nextSibling&&(e.move(e.createRangeOn(l),n,"end"),i=!0),i=!!r.length||i}}return i}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */(t,e))}function ei(e){return!!e&&e.is("element","table")}function ti(e){for(const t of e.getChildren())if(t.is("element","caption"))return t;return null}function oi(e){const t=e.parent;return"figcaption"==e.name&&t&&t.is("element","figure")&&t.hasClass("table")||"caption"==e.name&&t&&t.is("element","table")?{name:!0}:null}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class ii extends e{refresh(){const e=he(this.editor.model.document.selection);this.isEnabled=!!e,this.isEnabled?this.value=!!ti(e):this.value=!1}execute({focusCaptionOnShow:e=!1}={}){this.editor.model.change(t=>{this.value?this._hideTableCaption(t):this._showTableCaption(t,e)})}_showTableCaption(e,t){const o=this.editor.model,i=he(o.document.selection),n=this.editor.plugins.get("TableCaptionEditing")._getSavedCaption(i)||e.createElement("caption");o.insertContent(n,i,"end"),t&&e.setSelection(n,"in")}_hideTableCaption(e){const t=this.editor.model,o=he(t.document.selection),i=this.editor.plugins.get("TableCaptionEditing"),n=ti(o);i._saveCaption(o,n),t.deleteContent(e.createSelection(n,"on"))}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class ni extends t{static get pluginName(){return"TableCaptionEditing"}static get isOfficialPlugin(){return!0}constructor(e){super(e),this._savedCaptionsMap=new WeakMap}init(){const e=this.editor,t=e.model.schema,o=e.editing.view,n=e.t;t.isRegistered("caption")?t.extend("caption",{allowIn:"table"}):t.register("caption",{allowIn:"table",allowContentOf:"$block",isLimit:!0}),e.commands.add("toggleTableCaption",new ii(this.editor)),e.conversion.for("upcast").elementToElement({view:oi,model:"caption"}),e.conversion.for("dataDowncast").elementToElement({model:"caption",view:(e,{writer:t})=>ei(e.parent)?t.createContainerElement("figcaption"):null}),e.conversion.for("editingDowncast").elementToElement({model:"caption",view:(e,{writer:t})=>{if(!ei(e.parent))return null;const r=t.createEditableElement("figcaption");return t.setCustomProperty("tableCaption",!0,r),r.placeholder=n("Enter table caption"),Y({view:o,element:r,keepOnFocus:!0}),i(r,t)}}),Zo(e.model)}_getSavedCaption(e){const t=this._savedCaptionsMap.get(e);return t?Q.fromJSON(t):null}_saveCaption(e,t){this._savedCaptionsMap.set(e,t.toJSON())}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class ri extends t{static get pluginName(){return"TableCaptionUI"}static get isOfficialPlugin(){return!0}init(){const e=this.editor,t=e.editing.view,i=e.t;e.ui.componentFactory.add("toggleTableCaption",n=>{const r=e.commands.get("toggleTableCaption"),l=new k(n);return l.set({icon:o.caption,tooltip:!0,isToggleable:!0}),l.bind("isOn","isEnabled").to(r,"value","isEnabled"),l.bind("label").to(r,"value",e=>i(e?"Toggle caption off":"Toggle caption on")),this.listenTo(l,"execute",()=>{if(e.execute("toggleTableCaption",{focusCaptionOnShow:!0}),r.value){const o=function(e){const t=he(e);return t?ti(t):null}(e.model.document.selection),i=e.editing.mapper.toViewElement(o);if(!i)return;t.scrollToTheSelection(),t.change(e=>{e.addClass("table__caption_highlighted",i)})}e.editing.view.focus()}),l})}}vt(":root{--ck-color-selector-caption-background:#f7f7f7;--ck-color-selector-caption-text:#333;--ck-color-selector-caption-highlighted-background:#fd0}.ck-content .table>figcaption{background-color:var(--ck-color-selector-caption-background);caption-side:top;color:var(--ck-color-selector-caption-text);display:table-caption;font-size:.75em;outline-offset:-1px;padding:.6em;text-align:center;word-break:break-word}@media (forced-colors:active){.ck-content .table>figcaption{background-color:unset;color:unset}}@media (forced-colors:none){.ck.ck-editor__editable .table>figcaption.table__caption_highlighted{animation:ck-table-caption-highlight .6s ease-out}}.ck.ck-editor__editable .table>figcaption.ck-placeholder:before{overflow:hidden;padding-left:inherit;padding-right:inherit;text-overflow:ellipsis;white-space:nowrap}@keyframes ck-table-caption-highlight{0%{background-color:var(--ck-color-selector-caption-highlighted-background)}to{background-color:var(--ck-color-selector-caption-background)}}");
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */
class li extends t{static get pluginName(){return"TableCaption"}static get isOfficialPlugin(){return!0}static get requires(){return[ni,ri]}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class si extends e{refresh(){this.isEnabled=!0}execute(e={}){const{model:t,plugins:o}=this.editor;let{table:i=t.document.selection.getSelectedElement(),columnWidths:n,tableWidth:r}=e;n&&(n=Array.isArray(n)?n:n.split(",")),t.change(e=>{r?e.setAttribute("tableWidth",r,i):e.removeAttribute("tableWidth",i);const t=o.get("TableColumnResizeEditing").getColumnGroupElement(i);if(!n&&!t)return;if(!n)return e.remove(t);const l=Xe(n);if(t)Array.from(t.getChildren()).forEach((t,o)=>e.setAttribute("columnWidth",l[o],t));else{const t=e.createElement("tableColumnGroup");l.forEach(o=>e.appendElement("tableColumn",{columnWidth:o},t)),e.append(t,i)}})}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */function ai(e){return t=>t.on("element:colgroup",(t,o,i)=>{const n=o.modelCursor.findAncestor("table"),r=Ze(n);if(!r)return;const l=et(r),s=e.getColumns(n);let a=(c=r,d=i.writer,et(c).reduce((e,t)=>{const o=t.getAttribute("columnWidth"),i=t.getAttribute("colSpan");if(!i)return e.push(o),e;for(let t=0;t<i;t++)e.push(o);return d.removeAttribute("colSpan",t),e},[]));var c,d;a=Array.from({length:s},(e,t)=>a[t]||"auto"),(a.length!=l.length||a.includes("auto"))&&Qe(l,r,Xe(a),i.writer)},{priority:"low"})}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */
class ci extends t{static get requires(){return[yt,tt]}static get pluginName(){return"TableColumnResizeEditing"}static get isOfficialPlugin(){return!0}constructor(e){super(e),this._isResizingActive=!1,this.set("_isResizingAllowed",!0),this._resizingData=null,this._domEmitter=new(p()),this._tableUtilsPlugin=e.plugins.get("TableUtils"),this.on("change:_isResizingAllowed",(t,o,i)=>{const n=i?"removeClass":"addClass";e.editing.view.change(t=>{for(const o of e.editing.view.document.roots)t[n]("ck-column-resize_disabled",e.editing.view.document.getRoot(o.rootName))})})}init(){this._extendSchema(),this._registerPostFixer(),this._registerConverters(),this._registerResizingListeners(),this._registerResizerInserter();const e=this.editor,t=e.plugins.get("TableColumnResize");e.plugins.get("TableEditing").registerAdditionalSlot({filter:e=>e.is("element","tableColumnGroup"),positionOffset:0});const o=new si(e);e.commands.add("resizeTableWidth",o),e.commands.add("resizeColumnWidths",o),this.bind("_isResizingAllowed").to(e,"isReadOnly",t,"isEnabled",o,"isEnabled",(e,t,o)=>!e&&t&&o)}destroy(){this._domEmitter.stopListening(),super.destroy()}getColumnGroupElement(e){return Ze(e)}getTableColumnElements(e){return et(e)}getTableColumnsWidths(e){return function(e){return et(e).map(e=>e.getAttribute("columnWidth"))}(e)}_extendSchema(){this.editor.model.schema.extend("table",{allowAttributes:["tableWidth"]}),this.editor.model.schema.register("tableColumnGroup",{allowIn:"table",isLimit:!0}),this.editor.model.schema.register("tableColumn",{allowIn:"tableColumnGroup",allowAttributes:["columnWidth","colSpan"],isLimit:!0})}_registerPostFixer(){const e=this.editor.model;function t(e,t,o){const i=o._tableUtilsPlugin.getColumns(t);if(0===i-e.length)return e;const n=e.map(e=>Number(e.replace("%",""))),r=function(e,t){const o=new Set;for(const i of e.getChanges())if("insert"==i.type&&i.position.nodeAfter&&"tableCell"==i.position.nodeAfter.name&&i.position.nodeAfter.getAncestors().includes(t))o.add(i.position.nodeAfter);else if("remove"==i.type){const e=i.position.nodeBefore||i.position.nodeAfter;"tableCell"==e.name&&e.getAncestors().includes(t)&&o.add(e)}return o}(o.editor.model.document.differ,t);for(const e of r){const r=i-n.length;if(0===r)continue;const l=r>0,s=o._tableUtilsPlugin.getCellLocation(e).column;if(l){const e=Ke(r,Ue(t,o.editor));n.splice(s,0,...e)}else{const e=n.splice(s,Math.abs(r));n[s]+=Je(e)}}return n.map(e=>e+"%")}e.document.registerPostFixer(o=>{let i=!1;for(const n of
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */
function(e){const t=new Set;for(const o of e.document.differ.getChanges()){let i=null;switch(o.type){case"insert":i=["table","tableRow","tableCell"].includes(o.name)?o.position:null;break;case"remove":i=["tableRow","tableCell"].includes(o.name)?o.position:null;break;case"attribute":o.range.start.nodeAfter&&(i=["table","tableRow","tableCell"].includes(o.range.start.nodeAfter.name)?o.range.start:null)}if(!i)continue;const n=i.nodeAfter&&i.nodeAfter.is("element","table")?i.nodeAfter:i.findAncestor("table");for(const o of e.createRangeOn(n).getItems())o.is("element","table")&&Ze(o)&&t.add(o)}return t}(e)){const e=this.getColumnGroupElement(n),r=this.getTableColumnElements(e),l=this.getTableColumnsWidths(e);let s=Xe(l);s=t(s,n,this),te(l,s)||(Qe(r,e,s,o),i=!0)}return i})}_registerConverters(){const e=this.editor.conversion;e.for("upcast").attributeToAttribute({view:{name:"figure",key:"style",value:{width:/[\s\S]+/}},model:{name:"table",key:"tableWidth",value:e=>e.getStyle("width")}}),e.for("downcast").attributeToAttribute({model:{name:"table",key:"tableWidth"},view:e=>({name:"figure",key:"style",value:{width:e}})}),e.elementToElement({model:"tableColumnGroup",view:"colgroup"}),e.elementToElement({model:"tableColumn",view:"col"}),e.for("downcast").add(e=>e.on("insert:table",(e,t,o)=>{const i=o.writer,n=t.item,r=o.mapper.toViewElement(n),l=r.is("element","table")?r:Array.from(r.getChildren()).find(e=>e.is("element","table"));Ze(n)?i.addClass("ck-table-resized",l):i.removeClass("ck-table-resized",l)},{priority:"low"})),e.for("upcast").add(ai(this._tableUtilsPlugin)),e.for("upcast").attributeToAttribute({view:{name:"col",styles:{width:/.*/}},model:{key:"columnWidth",value:e=>{const t=e.getStyle("width");return t&&(t.endsWith("%")||t.endsWith("pt"))?t:"auto"}}}),e.for("upcast").attributeToAttribute({view:{name:"col",key:"span"},model:"colSpan"}),e.for("downcast").attributeToAttribute({model:{name:"tableColumn",key:"columnWidth"},view:e=>({key:"style",value:{width:e}})})}_registerResizingListeners(){const e=this.editor.editing.view;e.addObserver(Bt),e.document.on("mousedown",this._onMouseDownHandler.bind(this),{priority:"high"}),this._domEmitter.listenTo(c.window.document,"mousemove",oe(this._onMouseMoveHandler.bind(this),50)),this._domEmitter.listenTo(c.window.document,"mouseup",this._onMouseUpHandler.bind(this))}_onMouseDownHandler(e,t){const o=t.target;if(!o.hasClass("ck-table-column-resizer"))return;if(!this._isResizingAllowed)return;const i=this.editor,n=i.editing.mapper.toModelElement(o.findAncestor("figure"));if(!i.model.canEditAt(n))return;t.preventDefault(),e.stop();const r=function(e,t,o){const i=Array(t.getColumns(e)),n=new pe(e);for(const e of n){const t=o.editing.mapper.toViewElement(e.cell),n=Ye(o.editing.view.domConverter.mapViewToDom(t));(!i[e.column]||n<i[e.column])&&(i[e.column]=Ge(n))}return i}(n,this._tableUtilsPlugin,i),l=o.findAncestor("table"),s=i.editing.view;Array.from(l.getChildren()).find(e=>e.is("element","colgroup"))||s.change(e=>{!function(e,t,o){const i=e.createContainerElement("colgroup");for(let o=0;o<t.length;o++){const n=e.createEmptyElement("col"),r=`${Ge(t[o]/Je(t)*100)}%`;e.setStyle("width",r,n),e.insert(e.createPositionAt(i,"end"),n)}e.insert(e.createPositionAt(o,0),i)}(e,r,l)}),this._isResizingActive=!0,this._resizingData=this._getResizingData(t,r),s.change(e=>function(e,t,o){const i=o.widths.viewFigureWidth/o.widths.viewFigureParentWidth;e.addClass("ck-table-resized",t),e.addClass("ck-table-column-resizer__active",o.elements.viewResizer),e.setStyle("width",`${Ge(100*i)}%`,t.findAncestor("figure"))}(e,l,this._resizingData))}_onMouseMoveHandler(e,t){if(!this._isResizingActive)return;if(!this._isResizingAllowed)return void this._onMouseUpHandler();const{columnPosition:o,flags:{isRightEdge:i,isTableCentered:n,isLtrContent:r},elements:{viewFigure:l,viewLeftColumn:s,viewRightColumn:a},widths:{viewFigureParentWidth:c,tableWidth:d,leftColumnWidth:u,rightColumnWidth:h}}=this._resizingData,b=40-u,m=i?c-d:h-40,g=(r?1:-1)*(i&&n?2:1),p=(f=(t.clientX-o)*g,w=Math.min(b,0),k=Math.max(m,0),Ge(f<=w?w:f>=k?k:f));var f,w,k;0!==p&&this.editor.editing.view.change(e=>{const t=Ge(100*(u+p)/d);if(e.setStyle("width",`${t}%`,s),i){const t=Ge(100*(d+p)/c);e.setStyle("width",`${t}%`,l)}else{const t=Ge(100*(h-p)/d);e.setStyle("width",`${t}%`,a)}})}_onMouseUpHandler(){if(!this._isResizingActive)return;const{viewResizer:e,modelTable:t,viewFigure:o,viewColgroup:i}=this._resizingData.elements,n=this.editor,r=n.editing.view,l=this.getColumnGroupElement(t),s=Array.from(i.getChildren()).filter(e=>e.is("view:element")),a=l?this.getTableColumnsWidths(l):null,c=s.map(e=>e.getStyle("width")),d=!te(a,c),u=t.getAttribute("tableWidth"),h=o.getStyle("width"),b=u!==h;(d||b)&&(this._isResizingAllowed?n.execute("resizeTableWidth",{table:t,tableWidth:`${Ge(h)}%`,columnWidths:c}):r.change(e=>{if(a)for(const t of s)e.setStyle("width",a.shift(),t);else e.remove(i);b&&(u?e.setStyle("width",u,o):e.removeStyle("width",o)),a||u||e.removeClass("ck-table-resized",[...o.getChildren()].find(e=>"table"===e.name))})),r.change(t=>{t.removeClass("ck-table-column-resizer__active",e)}),this._isResizingActive=!1,this._resizingData=null}_getResizingData(e,t){const o=this.editor,i=e.domEvent.clientX,n=e.target,r=n.findAncestor("td")||n.findAncestor("th"),l=o.editing.mapper.toModelElement(r),s=l.findAncestor("table"),a=function(e,t){const o=t.getCellLocation(e).column;return{leftEdge:o,rightEdge:o+(e.getAttribute("colspan")||1)-1}}(l,this._tableUtilsPlugin).rightEdge,c=a===this._tableUtilsPlugin.getColumns(s)-1,d=!s.hasAttribute("tableAlignment"),u="rtl"!==o.locale.contentLanguageDirection,h=r.findAncestor("table"),b=h.findAncestor("figure"),m=[...h.getChildren()].find(e=>e.is("element","colgroup")),g=m.getChild(a),p=c?void 0:m.getChild(a+1);return{columnPosition:i,flags:{isRightEdge:c,isTableCentered:d,isLtrContent:u},elements:{viewResizer:n,modelTable:s,viewFigure:b,viewColgroup:m,viewLeftColumn:g,viewRightColumn:p},widths:{viewFigureParentWidth:qe(o.editing.view.domConverter.mapViewToDom(b.parent)),viewFigureWidth:qe(o.editing.view.domConverter.mapViewToDom(b)),tableWidth:$e(s,o),leftColumnWidth:t[a],rightColumnWidth:c?void 0:t[a+1]}}}_registerResizerInserter(){this.editor.conversion.for("editingDowncast").add(e=>{e.on("insert:tableCell",(e,t,o)=>{const i=t.item,n=o.mapper.toViewElement(i),r=o.writer;r.insert(r.createPositionAt(n,"end"),r.createUIElement("div",{class:"ck-table-column-resizer"}))},{priority:"lowest"})})}}vt(":root{--ck-color-selector-column-resizer-hover:var(--ck-color-base-active);--ck-table-column-resizer-width:7px;--ck-table-column-resizer-position-offset:calc(var(--ck-table-column-resizer-width)*-0.5 - 0.5px)}.ck-content .table .ck-table-resized{table-layout:fixed}.ck-content .table table{overflow:hidden}.ck-content .table td,.ck-content .table th{overflow-wrap:break-word;position:relative}.ck.ck-editor__editable .table .ck-table-column-resizer{bottom:0;cursor:col-resize;position:absolute;right:var(--ck-table-column-resizer-position-offset);top:0;user-select:none;width:var(--ck-table-column-resizer-width);z-index:var(--ck-z-default)}.ck.ck-editor__editable .table[draggable] .ck-table-column-resizer,.ck.ck-editor__editable.ck-column-resize_disabled .table .ck-table-column-resizer{display:none}.ck.ck-editor__editable .table .ck-table-column-resizer:hover,.ck.ck-editor__editable .table .ck-table-column-resizer__active{background-color:var(--ck-color-selector-column-resizer-hover);bottom:-999999px;opacity:.25;top:-999999px}.ck.ck-editor__editable[dir=rtl] .table .ck-table-column-resizer{left:var(--ck-table-column-resizer-position-offset);right:unset}");
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */
class di extends t{static get requires(){return[ci,yo]}static get pluginName(){return"TableColumnResize"}static get isOfficialPlugin(){return!0}}export{Ft as PlainTableOutput,Lt as Table,li as TableCaption,ni as TableCaptionEditing,ri as TableCaptionUI,Wo as TableCellProperties,Bo as TableCellPropertiesEditing,_o as TableCellPropertiesUI,yo as TableCellWidthEditing,Rt as TableClipboard,di as TableColumnResize,ci as TableColumnResizeEditing,yt as TableEditing,zt as TableKeyboard,Wt as TableMouse,Qo as TableProperties,qo as TablePropertiesEditing,Yo as TablePropertiesUI,Vt as TableSelection,$t as TableToolbar,xt as TableUI,tt as TableUtils};