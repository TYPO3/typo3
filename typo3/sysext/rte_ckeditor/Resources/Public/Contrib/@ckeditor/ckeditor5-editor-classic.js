import{EditorUI as f,normalizeToolbarConfig as p,DialogView as u,BoxedEditorUIView as g,StickyPanelView as m,ToolbarView as b,MenuBarView as w,InlineEditableUIView as y}from"@ckeditor/ckeditor5-ui";import{enablePlaceholder as _}from"@ckeditor/ckeditor5-engine";import{ElementReplacer as v,Rect as l,CKEditorError as P,getDataFromElement as T}from"@ckeditor/ckeditor5-utils";import{ElementApiMixin as C,Editor as x,attachToForm as B}from"@ckeditor/ckeditor5-core";import{isElement as V}from"lodash-es";/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class E extends f{constructor(e,i){super(e),this.view=i,this._toolbarConfig=p(e.config.get("toolbar")),this._elementReplacer=new v,this.listenTo(e.editing.view,"scrollToTheSelection",this._handleScrollToTheSelectionWithStickyPanel.bind(this))}get element(){return this.view.element}init(e){const i=this.editor,t=this.view,n=i.editing.view,o=t.editable,r=n.document.getRoot();o.name=r.rootName,t.render();const c=o.element;this.setEditableElement(o.name,c),t.editable.bind("isFocused").to(this.focusTracker),n.attachDomRoot(c),e&&this._elementReplacer.replace(e,this.element),this._initPlaceholder(),this._initToolbar(),t.menuBarView&&this._initMenuBar(t.menuBarView),this._initDialogPluginIntegration(),this._initContextualBalloonIntegration(),this.fire("ready")}destroy(){super.destroy();const e=this.view,i=this.editor.editing.view;this._elementReplacer.restore(),i.getDomRoot(e.editable.name)&&i.detachDomRoot(e.editable.name),e.destroy()}_initToolbar(){const e=this.view;e.stickyPanel.bind("isActive").to(this.focusTracker,"isFocused"),e.stickyPanel.limiterElement=e.element,e.stickyPanel.bind("viewportTopOffset").to(this,"viewportOffset",({top:i})=>i||0),e.toolbar.fillFromConfig(this._toolbarConfig,this.componentFactory),this.addToolbar(e.toolbar)}_initPlaceholder(){const e=this.editor,i=e.editing.view,t=i.document.getRoot(),n=e.sourceElement;let o;const r=e.config.get("placeholder");r&&(o=typeof r=="string"?r:r[this.view.editable.name]),!o&&n&&n.tagName.toLowerCase()==="textarea"&&(o=n.getAttribute("placeholder")),o&&(t.placeholder=o),_({view:i,element:t,isDirectHost:!1,keepOnFocus:!0})}_initContextualBalloonIntegration(){if(!this.editor.plugins.has("ContextualBalloon"))return;const{stickyPanel:e}=this.view,i=this.editor.plugins.get("ContextualBalloon");i.on("getPositionOptions",n=>{const o=n.return;if(!o||!e.isSticky||!e.element)return;const r=new l(e.element).height,c=typeof o.target=="function"?o.target():o.target,d=typeof o.limiter=="function"?o.limiter():o.limiter;if(c&&d&&new l(c).height>=new l(d).height-r)return;const h={...o.viewportOffsetConfig},k=(h.top||0)+r;n.return={...o,viewportOffsetConfig:{...h,top:k}}},{priority:"low"});const t=()=>{i.visibleView&&i.updatePosition()};this.listenTo(e,"change:isSticky",t),this.listenTo(this.editor.ui,"change:viewportOffset",t)}_handleScrollToTheSelectionWithStickyPanel(e,i,t){const n=this.view.stickyPanel;if(n.isSticky){const o=new l(n.element).height;i.viewportOffset.top+=o}else{const o=()=>{this.editor.editing.view.scrollToTheSelection(t)};this.listenTo(n,"change:isSticky",o),setTimeout(()=>{this.stopListening(n,"change:isSticky",o)},20)}}_initDialogPluginIntegration(){if(!this.editor.plugins.has("Dialog"))return;const e=this.view.stickyPanel,i=this.editor.plugins.get("Dialog");i.on("show",()=>{const t=i.view;t.on("moveTo",(n,o)=>{if(!e.isSticky||t.wasMoved||t.isModal)return;const r=new l(e.contentPanelElement);o[1]<r.bottom+u.defaultOffset&&(o[1]=r.bottom+u.defaultOffset)},{priority:"high"})},{priority:"low"})}}function S(s,{insertAt:e}={}){if(typeof document>"u")return;const i=document.head||document.getElementsByTagName("head")[0],t=document.createElement("style");t.type="text/css",window.litNonce&&t.setAttribute("nonce",window.litNonce),e==="top"&&i.firstChild?i.insertBefore(t,i.firstChild):i.appendChild(t),t.styleSheet?t.styleSheet.cssText=s:t.appendChild(document.createTextNode(s))}S(".ck.ck-editor{position:relative}.ck.ck-editor .ck-editor__top .ck-sticky-panel .ck-toolbar{z-index:var(--ck-z-panel)}.ck.ck-editor__top .ck-sticky-panel .ck-sticky-panel__content{border:solid var(--ck-color-base-border);border-radius:0;border-width:1px 1px 0}.ck-rounded-corners .ck.ck-editor__top .ck-sticky-panel .ck-sticky-panel__content,.ck.ck-editor__top .ck-sticky-panel .ck-sticky-panel__content.ck-rounded-corners{border-radius:var(--ck-border-radius);border-bottom-left-radius:0;border-bottom-right-radius:0}.ck.ck-editor__top .ck-sticky-panel .ck-sticky-panel__content.ck-sticky-panel__content_sticky{border-bottom-width:1px}.ck.ck-editor__top .ck-sticky-panel .ck-sticky-panel__content .ck-menu-bar{border:0;border-bottom:1px solid var(--ck-color-base-border)}.ck.ck-editor__top .ck-sticky-panel .ck-sticky-panel__content .ck-toolbar{border:0}.ck.ck-editor__main>.ck-editor__editable{background:var(--ck-color-base-background);border-radius:0}.ck-rounded-corners .ck.ck-editor__main>.ck-editor__editable,.ck.ck-editor__main>.ck-editor__editable.ck-rounded-corners{border-radius:var(--ck-border-radius);border-top-left-radius:0;border-top-right-radius:0}.ck.ck-editor__main>.ck-editor__editable:not(.ck-focused){border-color:var(--ck-color-base-border)}");/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class R extends g{constructor(e,i,t={}){super(e),this.stickyPanel=new m(e),this.toolbar=new b(e,{shouldGroupWhenFull:t.shouldToolbarGroupWhenFull}),t.useMenuBar&&(this.menuBarView=new w(e)),this.editable=new y(e,i,void 0,{label:t.label})}render(){super.render(),this.menuBarView?this.stickyPanel.content.addMany([this.menuBarView,this.toolbar]):this.stickyPanel.content.add(this.toolbar),this.top.add(this.stickyPanel),this.main.add(this.editable)}}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class I extends C(x){static get editorName(){return"ClassicEditor"}constructor(e,i={}){if(!a(e)&&i.initialData!==void 0)throw new P("editor-create-initial-data",null);super(i),this.config.define("menuBar.isVisible",!1),this.config.get("initialData")===void 0&&this.config.set("initialData",F(e)),a(e)&&(this.sourceElement=e),this.model.document.createRoot();const t=!this.config.get("toolbar.shouldNotGroupWhenFull"),n=this.config.get("menuBar"),o=new R(this.locale,this.editing.view,{shouldToolbarGroupWhenFull:t,useMenuBar:n.isVisible,label:this.config.get("label")});this.ui=new E(this,o),B(this)}destroy(){return this.sourceElement&&this.updateSourceElement(),this.ui.destroy(),super.destroy()}static create(e,i={}){return new Promise(t=>{const n=new this(e,i);t(n.initPlugins().then(()=>n.ui.init(a(e)?e:null)).then(()=>n.data.init(n.config.get("initialData"))).then(()=>n.fire("ready")).then(()=>n))})}}function F(s){return a(s)?T(s):s}function a(s){return V(s)}export{I as ClassicEditor};
