/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class E{crashes=[];state="initializing";_crashNumberLimit;_now=Date.now;_minimumNonErrorTimePeriod;_boundErrorHandler;_listeners;constructor(e){if(this.crashes=[],this._crashNumberLimit=typeof e.crashNumberLimit=="number"?e.crashNumberLimit:3,this._minimumNonErrorTimePeriod=typeof e.minimumNonErrorTimePeriod=="number"?e.minimumNonErrorTimePeriod:5e3,this._boundErrorHandler=r=>{const s="error"in r?r.error:r.reason;s instanceof Error&&this._handleError(s,r)},this._listeners={},!this._restart)throw new Error("The Watchdog class was split into the abstract `Watchdog` class and the `EditorWatchdog` class. Please, use `EditorWatchdog` if you have used the `Watchdog` class previously.")}destroy(){this._stopErrorHandling(),this._listeners={}}on(e,r){this._listeners[e]||(this._listeners[e]=[]),this._listeners[e].push(r)}off(e,r){this._listeners[e]=this._listeners[e].filter(s=>s!==r)}_fire(e,...r){const s=this._listeners[e]||[];for(const i of s)i.apply(this,[null,...r])}_startErrorHandling(){window.addEventListener("error",this._boundErrorHandler),window.addEventListener("unhandledrejection",this._boundErrorHandler)}_stopErrorHandling(){window.removeEventListener("error",this._boundErrorHandler),window.removeEventListener("unhandledrejection",this._boundErrorHandler)}_handleError(e,r){if(this._shouldReactToError(e)){this.crashes.push({message:e.message,stack:e.stack,filename:r instanceof ErrorEvent?r.filename:void 0,lineno:r instanceof ErrorEvent?r.lineno:void 0,colno:r instanceof ErrorEvent?r.colno:void 0,date:this._now()});const s=this._shouldRestart();this.state="crashed",this._fire("stateChange"),this._fire("error",{error:e,causesRestart:s}),s?this._restart():(this.state="crashedPermanently",this._fire("stateChange"))}}_shouldReactToError(e){return e.is&&e.is("CKEditorError")&&e.context!==void 0&&e.context!==null&&this.state==="ready"&&this._isErrorComingFromThisItem(e)}_shouldRestart(){if(this.crashes.length<=this._crashNumberLimit)return!0;const e=this.crashes[this.crashes.length-1].date,r=this.crashes[this.crashes.length-1-this._crashNumberLimit].date;return(e-r)/this._crashNumberLimit>this._minimumNonErrorTimePeriod}}function W(t){return t==null||typeof t!="object"&&typeof t!="function"}function I(t){return Object.getOwnPropertySymbols(t).filter(e=>Object.prototype.propertyIsEnumerable.call(t,e))}function K(t){return t==null?t===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(t)}const J="[object RegExp]",S="[object String]",x="[object Number]",O="[object Boolean]",P="[object Arguments]",L="[object Symbol]",H="[object Date]",B="[object Map]",V="[object Set]",$="[object Array]",q="[object ArrayBuffer]",Q="[object Object]",U="[object DataView]",z="[object Uint8Array]",C="[object Uint8ClampedArray]",T="[object Uint16Array]",Y="[object Uint32Array]",G="[object Int8Array]",X="[object Int16Array]",Z="[object Int32Array]",v="[object Float32Array]",tt="[object Float64Array]";function et(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function rt(t,e){return _(t,void 0,t,new Map,e)}function _(t,e,r,s=new Map,i=void 0){const a=i?.(t,e,r,s);if(a!=null)return a;if(W(t))return t;if(s.has(t))return s.get(t);if(Array.isArray(t)){const n=new Array(t.length);s.set(t,n);for(let o=0;o<t.length;o++)n[o]=_(t[o],o,r,s,i);return Object.hasOwn(t,"index")&&(n.index=t.index),Object.hasOwn(t,"input")&&(n.input=t.input),n}if(t instanceof Date)return new Date(t.getTime());if(t instanceof RegExp){const n=new RegExp(t.source,t.flags);return n.lastIndex=t.lastIndex,n}if(t instanceof Map){const n=new Map;s.set(t,n);for(const[o,c]of t)n.set(o,_(c,o,r,s,i));return n}if(t instanceof Set){const n=new Set;s.set(t,n);for(const o of t)n.add(_(o,void 0,r,s,i));return n}if(typeof Buffer<"u"&&Buffer.isBuffer(t))return t.subarray();if(et(t)){const n=new(Object.getPrototypeOf(t)).constructor(t.length);s.set(t,n);for(let o=0;o<t.length;o++)n[o]=_(t[o],o,r,s,i);return n}if(t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer)return t.slice(0);if(t instanceof DataView){const n=new DataView(t.buffer.slice(0),t.byteOffset,t.byteLength);return s.set(t,n),l(n,t,r,s,i),n}if(typeof File<"u"&&t instanceof File){const n=new File([t],t.name,{type:t.type});return s.set(t,n),l(n,t,r,s,i),n}if(t instanceof Blob){const n=new Blob([t],{type:t.type});return s.set(t,n),l(n,t,r,s,i),n}if(t instanceof Error){const n=new t.constructor;return s.set(t,n),n.message=t.message,n.name=t.name,n.stack=t.stack,n.cause=t.cause,l(n,t,r,s,i),n}if(typeof t=="object"&&st(t)){const n=Object.create(Object.getPrototypeOf(t));return s.set(t,n),l(n,t,r,s,i),n}return t}function l(t,e,r=t,s,i){const a=[...Object.keys(e),...I(e)];for(let n=0;n<a.length;n++){const o=a[n],c=Object.getOwnPropertyDescriptor(t,o);(c==null||c.writable)&&(t[o]=_(e[o],o,r,s,i))}}function st(t){switch(K(t)){case P:case $:case q:case U:case O:case H:case v:case tt:case G:case X:case Z:case B:case x:case Q:case J:case V:case S:case L:case z:case C:case T:case Y:return!0;default:return!1}}function it(t,e){return rt(t,(r,s,i,a)=>{const n=e?.(r,s,i,a);if(n!=null)return n;if(typeof t=="object")switch(Object.prototype.toString.call(t)){case x:case S:case O:{const o=new t.constructor(t?.valueOf());return l(o,t),o}case P:{const o={};return l(o,t),o.length=t.length,o[Symbol.iterator]=t[Symbol.iterator],o}default:return}})}function nt(t){return typeof t=="object"&&t!==null}function ot(t,e,{signal:r,edges:s}={}){let i,a=null;const n=s!=null&&s.includes("leading"),o=s==null||s.includes("trailing"),c=()=>{a!==null&&(t.apply(i,a),i=void 0,a=null)},h=()=>{o&&c(),b()};let d=null;const m=()=>{d!=null&&clearTimeout(d),d=setTimeout(()=>{d=null,h()},e)},u=()=>{d!==null&&(clearTimeout(d),d=null)},b=()=>{u(),i=void 0,a=null},j=()=>{u(),c()},y=function(...R){if(r?.aborted)return;i=this,a=R;const M=d==null;m(),n&&M&&c()};return y.schedule=m,y.cancel=b,y.flush=j,r?.addEventListener("abort",b,{once:!0}),y}function at(t,e=0,r={}){typeof r!="object"&&(r={});const{leading:s=!1,trailing:i=!0,maxWait:a}=r,n=Array(2);s&&(n[0]="leading"),i&&(n[1]="trailing");let o,c=null;const h=ot(function(...u){o=t.apply(this,u),c=null},e,{edges:n}),d=function(...u){return a!=null&&(c===null&&(c=Date.now()),Date.now()-c>=a)?(o=t.apply(this,u),c=Date.now(),h.cancel(),h.schedule(),o):(h.apply(this,u),o)},m=()=>(h.flush(),o);return d.cancel=h.cancel,d.flush=m,d}function ct(t,e=0,r={}){typeof r!="object"&&(r={});const{leading:s=!0,trailing:i=!0}=r;return at(t,e,{leading:s,trailing:i,maxWait:e})}function A(t){if(typeof t!="object"||t==null)return!1;if(Object.getPrototypeOf(t)===null)return!0;if(Object.prototype.toString.call(t)!=="[object Object]"){const r=t[Symbol.toStringTag];return r==null||!Object.getOwnPropertyDescriptor(t,Symbol.toStringTag)?.writable?!1:t.toString()===`[object ${r}]`}let e=t;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e}function F(t){return nt(t)&&t.nodeType===1&&!A(t)}/**
* @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/function w(t,e=new Set){const r=[t],s=new Set;let i=0;for(;r.length>i;){const a=r[i++];if(!(s.has(a)||!dt(a)||e.has(a)))if(s.add(a),Symbol.iterator in a)try{for(const n of a)r.push(n)}catch{}else for(const n in a)n!=="defaultValue"&&r.push(a[n])}return s}function dt(t){const e=Object.prototype.toString.call(t),r=typeof t;return!(r==="number"||r==="boolean"||r==="string"||r==="symbol"||r==="function"||e==="[object Date]"||e==="[object RegExp]"||e==="[object Module]"||t===void 0||t===null||t._watchdogExcluded||t instanceof EventTarget||t instanceof Event)}/**
* @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/function D(t,e,r=new Set){if(t===e&&ht(t))return!0;const s=w(t,r),i=w(e,r);for(const a of s)if(i.has(a))return!0;return!1}function ht(t){return typeof t=="object"&&t!==null}/**
* @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class k extends E{_editor=null;_lifecyclePromise=null;_throttledSave;_data;_lastDocumentVersion;_elementOrData;_initUsingData=!0;_editables={};_config;_excludedProps;constructor(e,r={}){super(r),this._throttledSave=ct(this._save.bind(this),typeof r.saveInterval=="number"?r.saveInterval:5e3),e&&(this._creator=(s,i)=>e.create(s,i)),this._destructor=s=>s.destroy()}get editor(){return this._editor}get _item(){return this._editor}setCreator(e){this._creator=e}setDestructor(e){this._destructor=e}_restart(){return Promise.resolve().then(()=>(this.state="initializing",this._fire("stateChange"),this._destroy())).catch(e=>{console.error("An error happened during the editor destroying.",e)}).then(()=>{const e={},r=[],s=this._config.rootsAttributes||{},i={};for(const[n,o]of Object.entries(this._data.roots))o.isLoaded?(e[n]="",i[n]=s[n]||{}):r.push(n);const a={...this._config,extraPlugins:this._config.extraPlugins||[],lazyRoots:r,rootsAttributes:i,_watchdogInitialData:this._data};return delete a.initialData,a.extraPlugins.push(ft),this._initUsingData?this.create(e,a,a.context):F(this._elementOrData)?this.create(this._elementOrData,a,a.context):this.create(this._editables,a,a.context)}).then(()=>{this._fire("restart")})}create(e=this._elementOrData,r=this._config,s){return this._lifecyclePromise=Promise.resolve(this._lifecyclePromise).then(()=>(super._startErrorHandling(),this._elementOrData=e,this._initUsingData=typeof e=="string"||Object.keys(e).length>0&&typeof Object.values(e)[0]=="string",this._config=this._cloneEditorConfiguration(r)||{},this._config.context=s,this._creator(e,this._config))).then(i=>{this._editor=i,i.model.document.on("change:data",this._throttledSave),this._lastDocumentVersion=i.model.document.version,this._data=this._getData(),this._initUsingData||(this._editables=this._getEditables()),this.state="ready",this._fire("stateChange")}).finally(()=>{this._lifecyclePromise=null}),this._lifecyclePromise}destroy(){return this._lifecyclePromise=Promise.resolve(this._lifecyclePromise).then(()=>(this.state="destroyed",this._fire("stateChange"),super.destroy(),this._destroy())).finally(()=>{this._lifecyclePromise=null}),this._lifecyclePromise}_destroy(){return Promise.resolve().then(()=>{this._stopErrorHandling(),this._throttledSave.cancel();const e=this._editor;return this._editor=null,e.model.document.off("change:data",this._throttledSave),this._destructor(e)})}_save(){const e=this._editor.model.document.version;try{this._data=this._getData(),this._initUsingData||(this._editables=this._getEditables()),this._lastDocumentVersion=e}catch(r){console.error(r,"An error happened during restoring editor data. Editor will be restored from the previously saved data.")}}_setExcludedProperties(e){this._excludedProps=e}_getData(){const e=this._editor,r=e.model.document.roots.filter(o=>o.isAttached()&&o.rootName!="$graveyard"),{plugins:s}=e,i=s.has("CommentsRepository")&&s.get("CommentsRepository"),a=s.has("TrackChanges")&&s.get("TrackChanges"),n={roots:{},markers:{},commentThreads:JSON.stringify([]),suggestions:JSON.stringify([])};r.forEach(o=>{n.roots[o.rootName]={content:JSON.stringify(Array.from(o.getChildren())),attributes:JSON.stringify(Array.from(o.getAttributes())),isLoaded:o._isLoaded}});for(const o of e.model.markers)o._affectsData&&(n.markers[o.name]={rangeJSON:o.getRange().toJSON(),usingOperation:o._managedUsingOperations,affectsData:o._affectsData});return i&&(n.commentThreads=JSON.stringify(i.getCommentThreads({toJSON:!0,skipNotAttached:!0}))),a&&(n.suggestions=JSON.stringify(a.getSuggestions({toJSON:!0,skipNotAttached:!0}))),n}_getEditables(){const e={};for(const r of this.editor.model.document.getRootNames()){const s=this.editor.ui.getEditableElement(r);s&&(e[r]=s)}return e}_isErrorComingFromThisItem(e){return D(this._editor,e.context,this._excludedProps)}_cloneEditorConfiguration(e){return it(e,(r,s)=>{if(F(r)||s==="context")return r})}}class ft{editor;_data;constructor(e){this.editor=e,this._data=e.config.get("_watchdogInitialData")}init(){this.editor.data.on("init",e=>{e.stop(),this.editor.model.enqueueChange({isUndoable:!1},r=>{this._restoreCollaborationData(),this._restoreEditorData(r)}),this.editor.data.fire("ready")},{priority:999})}_createNode(e,r){if("name"in r){const s=e.createElement(r.name,r.attributes);if(r.children)for(const i of r.children)s._appendChild(this._createNode(e,i));return s}else return e.createText(r.data,r.attributes)}_restoreEditorData(e){const r=this.editor;Object.entries(this._data.roots).forEach(([s,{content:i,attributes:a}])=>{const n=JSON.parse(i),o=JSON.parse(a),c=r.model.document.getRoot(s);for(const[h,d]of o)e.setAttribute(h,d,c);for(const h of n){const d=this._createNode(e,h);e.insert(d,c,"end")}}),Object.entries(this._data.markers).forEach(([s,i])=>{const{document:a}=r.model,{rangeJSON:{start:n,end:o},...c}=i,h=a.getRoot(n.root),d=e.createPositionFromPath(h,n.path,n.stickiness),m=e.createPositionFromPath(h,o.path,o.stickiness),u=e.createRange(d,m);e.addMarker(s,{range:u,...c})})}_restoreCollaborationData(){const e=JSON.parse(this._data.commentThreads),r=JSON.parse(this._data.suggestions);if(this.editor.plugins.has("CommentsRepository")){const s=this.editor.plugins.get("CommentsRepository");for(const i of s.getCommentThreads())s._removeCommentThread({threadId:i.id});e.forEach(i=>{const a=this.editor.config.get("collaboration.channelId");this.editor.plugins.get("CommentsRepository").addCommentThread({channelId:a,...i})})}if(this.editor.plugins.has("TrackChangesEditing")){const s=this.editor.plugins.get("TrackChangesEditing");for(const i of s.getSuggestions())s._removeSuggestion(i);r.forEach(i=>{s.addSuggestionData(i)})}}}/**
* @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/const p=Symbol("MainQueueId");class ut extends E{_watchdogs=new Map;_watchdogConfig;_context=null;_contextProps=new Set;_actionQueues=new lt;_contextConfig;_item;constructor(e,r={}){super(r),this._watchdogConfig=r,this._creator=s=>e.create(s),this._destructor=s=>s.destroy(),this._actionQueues.onEmpty(()=>{this.state==="initializing"&&(this.state="ready",this._fire("stateChange"))})}setCreator(e){this._creator=e}setDestructor(e){this._destructor=e}get context(){return this._context}create(e={}){return this._actionQueues.enqueue(p,()=>(this._contextConfig=e,this._create()))}getItem(e){return this._getWatchdog(e)._item}getItemState(e){return this._getWatchdog(e).state}add(e){const r=N(e);return Promise.all(r.map(s=>this._actionQueues.enqueue(s.id,()=>{if(this.state==="destroyed")throw new Error("Cannot add items to destroyed watchdog.");if(!this._context)throw new Error("Context was not created yet. You should call the `ContextWatchdog#create()` method first.");let i;if(this._watchdogs.has(s.id))throw new Error(`Item with the given id is already added: '${s.id}'.`);if(s.type==="editor")return i=new k(null,this._watchdogConfig),i.setCreator(s.creator),i._setExcludedProperties(this._contextProps),s.destructor&&i.setDestructor(s.destructor),this._watchdogs.set(s.id,i),i.on("error",(a,{error:n,causesRestart:o})=>{this._fire("itemError",{itemId:s.id,error:n}),o&&this._actionQueues.enqueue(s.id,()=>new Promise(c=>{const h=()=>{i.off("restart",h),this._fire("itemRestart",{itemId:s.id}),c()};i.on("restart",h)}))}),i.create(s.sourceElementOrData,s.config,this._context);throw new Error(`Not supported item type: '${s.type}'.`)})))}remove(e){const r=N(e);return Promise.all(r.map(s=>this._actionQueues.enqueue(s,()=>{const i=this._getWatchdog(s);return this._watchdogs.delete(s),i.destroy()})))}destroy(){return this._actionQueues.enqueue(p,()=>(this.state="destroyed",this._fire("stateChange"),super.destroy(),this._destroy()))}_restart(){return this._actionQueues.enqueue(p,()=>(this.state="initializing",this._fire("stateChange"),this._destroy().catch(e=>{console.error("An error happened during destroying the context or items.",e)}).then(()=>this._create()).then(()=>this._fire("restart"))))}_create(){return Promise.resolve().then(()=>(this._startErrorHandling(),this._creator(this._contextConfig))).then(e=>(this._context=e,this._contextProps=w(this._context),Promise.all(Array.from(this._watchdogs.values()).map(r=>(r._setExcludedProperties(this._contextProps),r.create(void 0,void 0,this._context))))))}_destroy(){return Promise.resolve().then(()=>{this._stopErrorHandling();const e=this._context;return this._context=null,this._contextProps=new Set,Promise.all(Array.from(this._watchdogs.values()).map(r=>r.destroy())).then(()=>this._destructor(e))})}_getWatchdog(e){const r=this._watchdogs.get(e);if(!r)throw new Error(`Item with the given id was not registered: ${e}.`);return r}_isErrorComingFromThisItem(e){for(const r of this._watchdogs.values())if(r._isErrorComingFromThisItem(e))return!1;return D(this._context,e.context)}}class lt{_onEmptyCallbacks=[];_queues=new Map;_activeActions=0;onEmpty(e){this._onEmptyCallbacks.push(e)}enqueue(e,r){const s=e===p;this._activeActions++,this._queues.get(e)||this._queues.set(e,Promise.resolve());const a=(s?Promise.all(this._queues.values()):Promise.all([this._queues.get(p),this._queues.get(e)])).then(r),n=a.catch(()=>{});return this._queues.set(e,n),a.finally(()=>{this._activeActions--,this._queues.get(e)===n&&this._activeActions===0&&this._onEmptyCallbacks.forEach(o=>o())})}}function N(t){return Array.isArray(t)?t:[t]}/**
* @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class mt{editor;_entries=[];_frameStack=[];_errors=new Set;_maxEntries;_errorCallback;_filterCallback;_maxEntriesCallback;static get pluginName(){return"ActionsRecorder"}static get isOfficialPlugin(){return!0}constructor(e){this.editor=e,e.config.define("actionsRecorder.maxEntries",1e3);const r=e.config.get("actionsRecorder");this._maxEntries=r.maxEntries,this._filterCallback=r.onFilter,this._errorCallback=r.onError,this._maxEntriesCallback=r.onMaxEntries||this._maxEntriesDefaultHandler,this._tapCommands(),this._tapOperationApply(),this._tapModelMethods(),this._tapModelSelection(),this._tapComponentFactory(),this._tapViewDocumentEvents()}getEntries(){return this._entries.slice()}flushEntries(){this._entries=[]}_enterFrame(e,r){const s={timeStamp:new Date().toISOString(),...this._frameStack.length&&{parentEntry:this._frameStack.at(-1)},action:e,params:r?.map(i=>f(i)),before:this._buildStateSnapshot()};return(!this._filterCallback||this._filterCallback(s,this._entries))&&this._entries.push(s),this._frameStack.push(s),s}_leaveFrame(e,r,s){const i=this._frameStack.pop();!i||i!==e||(r!==void 0&&(i.result=f(r)),s&&(i.error=f(s)),i.after=this._buildStateSnapshot(),s&&this._callErrorCallback(s),this._frameStack.length==0&&this._errors.clear(),this._entries.length>=this._maxEntries&&this._maxEntriesCallback())}_buildStateSnapshot(){const{model:e,isReadOnly:r,editing:s}=this.editor;return{documentVersion:e.document.version,editorReadOnly:r,editorFocused:s.view.document.isFocused,modelSelection:f(e.document.selection)}}_tapCommands(){for(const[e,r]of this.editor.commands)this._tapCommand(e,r);g(this.editor.commands,"add",{before:(e,[r,s])=>(this._tapCommand(r,s),!1)})}_tapOperationApply(){g(this.editor.model,"applyOperation",{before:(e,[r])=>r.baseVersion===null?!1:(e.callFrame=this._enterFrame("model.applyOperation",[r]),!0),after:e=>{this._leaveFrame(e.callFrame)},error:(e,r)=>{this._leaveFrame(e.callFrame,void 0,r)}})}_tapModelMethods(){for(const e of["insertContent","insertObject","deleteContent"])g(this.editor.model,e,{before:(r,...s)=>(r.callFrame=this._enterFrame(`model.${e}`,s),!0),after:(r,s)=>{this._leaveFrame(r.callFrame,s)},error:(r,s)=>{this._leaveFrame(r.callFrame,void 0,s)}})}_tapModelSelection(){const e=["change:range","change:attribute","change:marker"];this._tapFireMethod(this.editor.model.document.selection,e,{eventSource:"model-selection"})}_tapCommand(e,r){g(r,"execute",{before:(s,i)=>(s.callFrame=this._enterFrame(`commands.${e}:execute`,i),!0),after:(s,i)=>{this._leaveFrame(s.callFrame,i)},error:(s,i)=>{this._leaveFrame(s.callFrame,void 0,i)}})}_tapComponentFactory(){g(this.editor.ui.componentFactory,"create",{before:(e,[r])=>(e.componentName=r,e.callFrame=this._enterFrame(`component-factory.create:${r}`),!0),after:(e,r)=>{const s={...e,eventSource:`component.${e.componentName}`};typeof r.fire=="function"&&this._tapFireMethod(r,["execute"],s),typeof r.panelView?.fire=="function"&&this._tapFireMethod(r.panelView,["execute"],s),typeof r.buttonView?.actionView?.fire=="function"&&this._tapFireMethod(r.buttonView.actionView,["execute"],s),this._leaveFrame(e.callFrame)},error:(e,r)=>{this._leaveFrame(e.callFrame,void 0,r)}})}_tapViewDocumentEvents(){const e=["click","mousedown","mouseup","pointerdown","pointerup","focus","blur","keydown","keyup","selectionChange","compositionstart","compositionend","beforeinput","mutations","enter","delete","insertText","paste","copy","cut","dragstart","drop"];this._tapFireMethod(this.editor.editing.view.document,e,{eventSource:"observers"})}_tapFireMethod(e,r,s={}){g(e,"fire",{before:(i,[a,...n])=>{const o=typeof a=="string"?a:a.name;return r.includes(o)?(i.callFrame=this._enterFrame(`${i.eventSource}:${o}`,n),!0):!1},after:(i,a)=>{this._leaveFrame(i.callFrame,a)},error:(i,a)=>{this._leaveFrame(i.callFrame,void 0,a)}},s)}_callErrorCallback(e){if(!(!this._errorCallback||this._errors.has(e))){this._errors.add(e);try{this._errorCallback(e,this.getEntries())}catch(r){console.error("ActionsRecorder onError callback error:",r)}}}_maxEntriesDefaultHandler(){this._entries.shift()}}function g(t,e,r,s={}){const i=t[e];i[Symbol.for("Tapped method")]||(t[e]=(...a)=>{const n=Object.assign({},s);let o;try{o=r.before?.(n,a);const c=i.apply(t,a);return o&&r.after?.(n,c),c}catch(c){throw o&&r.error?.(n,c),c}},t[e][Symbol.for("Tapped method")]=i)}function f(t,e=new WeakSet){if(!t||["boolean","number","string"].includes(typeof t))return t;if(typeof t.toJSON=="function"){const i=t.toJSON();if(A(i)||Array.isArray(i)||["string","number","boolean"].includes(typeof i))return f(i,e)}if(t instanceof Error)return{name:t.name,message:t.message,stack:t.stack};if(gt(t)||typeof t!="object")return{type:typeof t,constructor:t.constructor?.name||"unknown",string:String(t)};if(t instanceof File||t instanceof Blob||t instanceof FormData||t instanceof DataTransfer)return String(t);if(e.has(t))return;if(e.add(t),Array.isArray(t))return t.length?t.map(i=>f(i,e)):void 0;const r={},s=[];t.domEvent&&(s.push("domEvent","domTarget","view","document"),r.domEvent=_t(t.domEvent),r.target=f(t.target),t.dataTransfer&&(r.dataTransfer={types:t.dataTransfer.types,htmlData:t.dataTransfer.getData("text/html"),files:f(t.dataTransfer.files)}));for(const[i,a]of Object.entries(t)){if(i.startsWith("_")||s.includes(i)||typeof a=="function")continue;const n=f(a,e);n!==void 0&&(r[i]=n)}if(Symbol.iterator in t){const i=Array.from(t[Symbol.iterator]()).map(a=>f(a,e));i.length&&(r._items=i)}return Object.keys(r).length?r:void 0}function _t(t){let e={type:t.type,target:r(t.target)};t instanceof MouseEvent&&(e={...e,button:t.button,buttons:t.buttons,ctrlKey:t.ctrlKey,shiftKey:t.shiftKey,altKey:t.altKey,metaKey:t.metaKey}),t instanceof KeyboardEvent&&(e={...e,key:t.key,code:t.code,keyCode:t.keyCode,ctrlKey:t.ctrlKey,shiftKey:t.shiftKey,altKey:t.altKey,metaKey:t.metaKey,repeat:t.repeat}),t instanceof InputEvent&&(e={...e,data:t.data,inputType:t.inputType,isComposing:t.isComposing}),t instanceof PointerEvent&&(e={...e,isPrimary:t.isPrimary});function r(s){return s?s instanceof Element?{tagName:s.tagName,className:s.className,id:s.id}:s instanceof Window||s instanceof Document?{type:s.constructor.name}:{}:null}return e}function gt(t){return t&&typeof t.is=="function"}export{mt as ActionsRecorder,ut as ContextWatchdog,k as EditorWatchdog,E as Watchdog};
