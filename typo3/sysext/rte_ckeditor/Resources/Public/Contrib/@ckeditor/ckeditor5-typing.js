import{Command as I,Plugin as x}from"@ckeditor/ckeditor5-core";import{env as p,EventInfo as ee,count as te,isInsideSurrogatePair as ne,isInsideCombinedSymbol as ie,isInsideEmojiSequence as oe,keyCodes as E,ObservableMixin as se}from"@ckeditor/ckeditor5-utils";import{Observer as F,FocusObserver as re,DomEventData as k,LiveRange as ce,BubblingEventInfo as q,MouseObserver as le}from"@ckeditor/ckeditor5-engine";import{debounce as ae,escapeRegExp as ue}from"lodash-es";/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class L{constructor(e,t=20){this._batch=null,this.model=e,this._size=0,this.limit=t,this._isLocked=!1,this._changeCallback=(n,o)=>{o.isLocal&&o.isUndoable&&o!==this._batch&&this._reset(!0)},this._selectionChangeCallback=()=>{this._reset()},this.model.document.on("change",this._changeCallback),this.model.document.selection.on("change:range",this._selectionChangeCallback),this.model.document.selection.on("change:attribute",this._selectionChangeCallback)}get batch(){return this._batch||(this._batch=this.model.createBatch({isTyping:!0})),this._batch}get size(){return this._size}input(e){this._size+=e,this._size>=this.limit&&this._reset(!0)}get isLocked(){return this._isLocked}lock(){this._isLocked=!0}unlock(){this._isLocked=!1}destroy(){this.model.document.off("change",this._changeCallback),this.model.document.selection.off("change:range",this._selectionChangeCallback),this.model.document.selection.off("change:attribute",this._selectionChangeCallback)}_reset(e=!1){(!this.isLocked||e)&&(this._batch=null,this._size=0)}}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class N extends I{constructor(e,t){super(e),this._buffer=new L(e.model,t),this._isEnabledBasedOnSelection=!1}get buffer(){return this._buffer}destroy(){super.destroy(),this._buffer.destroy()}execute(e={}){const t=this.editor.model,n=t.document,o=e.text||"",i=o.length;let c=n.selection;if(e.selection?c=e.selection:e.range&&(c=t.createSelection(e.range)),!t.canEditAt(c))return;const r=e.resultRange;t.enqueueChange(this._buffer.batch,l=>{this._buffer.lock();const a=Array.from(n.selection.getAttributes());t.deleteContent(c),o&&t.insertContent(l.createText(o,a),c),r?l.setSelection(r):c.is("documentSelection")||l.setSelection(c),this._buffer.unlock(),this._buffer.input(i)})}}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/const M=["insertText","insertReplacementText"],de=[...M,"insertCompositionText"];class he extends F{constructor(e){super(e),this.focusObserver=e.getObserver(re);const t=p.isAndroid?de:M,n=e.document;n.on("beforeinput",(o,i)=>{if(!this.isEnabled)return;const{data:c,targetRanges:r,inputType:l,domEvent:a}=i;if(!t.includes(l))return;this.focusObserver.flush();const u=new ee(n,"insertText");n.fire(u,new k(e,a,{text:c,selection:e.createSelection(r)})),u.stop.called&&o.stop()}),p.isAndroid||n.on("compositionend",(o,{data:i,domEvent:c})=>{this.isEnabled&&i&&n.fire("insertText",new k(e,c,{text:i}))},{priority:"lowest"})}observe(){}stopObserving(){}}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class G extends x{static get pluginName(){return"Input"}static get isOfficialPlugin(){return!0}init(){const e=this.editor,t=e.model,n=e.editing.view,o=e.editing.mapper,i=t.document.selection;this._compositionQueue=new fe(e),n.addObserver(he);const c=new N(e,e.config.get("typing.undoStep")||20);e.commands.add("insertText",c),e.commands.add("input",c),this.listenTo(n.document,"insertText",(r,l)=>{n.document.isComposing||l.preventDefault(),p.isAndroid&&n.document.isComposing&&this._compositionQueue.flush("next beforeinput");const{text:a,selection:u}=l;let d;u?d=Array.from(u.getRanges()).map(h=>o.toModelRange(h)):d=Array.from(i.getRanges());let f=a;if(p.isAndroid){const h=Array.from(d[0].getItems()).reduce((C,v)=>C+(v.is("$textProxy")?v.data:""),"");if(h&&(h.length<=f.length?f.startsWith(h)&&(f=f.substring(h.length),d[0].start=d[0].start.getShiftedBy(h.length)):h.startsWith(f)&&(d[0].start=d[0].start.getShiftedBy(f.length),f="")),f.length==0&&d[0].isCollapsed)return}const g={text:f,selection:t.createSelection(d)};p.isAndroid&&n.document.isComposing?this._compositionQueue.push(g):(e.execute("insertText",g),n.scrollToTheSelection())}),p.isAndroid?this.listenTo(n.document,"keydown",(r,l)=>{i.isCollapsed||l.keyCode!=229||!n.document.isComposing||z(t,c)}):this.listenTo(n.document,"compositionstart",()=>{i.isCollapsed||z(t,c)}),p.isAndroid?(this.listenTo(n.document,"mutations",(r,{mutations:l})=>{if(n.document.isComposing)for(const{node:a}of l){const u=ge(a,o),d=o.toModelElement(u);if(this._compositionQueue.isComposedElement(d)){this._compositionQueue.flush("mutations");return}}}),this.listenTo(n.document,"compositionend",()=>{this._compositionQueue.flush("composition end")}),this.listenTo(n.document,"compositionend",()=>{const r=[];for(const l of this._compositionQueue.flushComposedElements()){const a=o.toViewElement(l);a&&r.push({type:"children",node:a})}r.length&&n.document.fire("mutations",{mutations:r})},{priority:"lowest"})):this.listenTo(n.document,"compositionend",()=>{n.document.fire("mutations",{mutations:[]})},{priority:"lowest"})}destroy(){super.destroy(),this._compositionQueue.destroy()}}class fe{constructor(e){this.flushDebounced=ae(()=>this.flush("timeout"),50),this._queue=[],this._compositionElements=new Set,this.editor=e}destroy(){for(this.flushDebounced.cancel(),this._compositionElements.clear();this._queue.length;)this.shift()}get length(){return this._queue.length}push(e){const t={text:e.text};if(e.selection){t.selectionRanges=[];for(const n of e.selection.getRanges())t.selectionRanges.push(ce.fromRange(n)),this._compositionElements.add(n.start.parent)}this._queue.push(t),this.flushDebounced()}shift(){const e=this._queue.shift(),t={text:e.text};if(e.selectionRanges){const n=e.selectionRanges.map(o=>me(o)).filter(o=>!!o);n.length&&(t.selection=this.editor.model.createSelection(n))}return t}flush(e){const t=this.editor,n=t.model,o=t.editing.view;if(this.flushDebounced.cancel(),!this._queue.length)return;const c=t.commands.get("insertText").buffer;n.enqueueChange(c.batch,()=>{for(c.lock();this._queue.length;){const r=this.shift();t.execute("insertText",r)}c.unlock()}),o.scrollToTheSelection()}isComposedElement(e){return this._compositionElements.has(e)}flushComposedElements(){const e=Array.from(this._compositionElements);return this._compositionElements.clear(),e}}function z(s,e){if(!e.isEnabled)return;const t=e.buffer;t.lock(),s.enqueueChange(t.batch,()=>{s.deleteContent(s.document.selection)}),t.unlock()}function me(s){const e=s.toRange();return s.detach(),e.root.rootName=="$graveyard"?null:e}function ge(s,e){let t=s.is("$text")?s.parent:s;for(;!e.toModelElement(t);)t=t.parent;return t}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class $ extends I{constructor(e,t){super(e),this.direction=t,this._buffer=new L(e.model,e.config.get("typing.undoStep")),this._isEnabledBasedOnSelection=!1}get buffer(){return this._buffer}execute(e={}){const t=this.editor.model,n=t.document;t.enqueueChange(this._buffer.batch,o=>{this._buffer.lock();const i=o.createSelection(e.selection||n.selection);if(!t.canEditAt(i))return;const c=e.sequence||1,r=i.isCollapsed;if(i.isCollapsed&&t.modifySelection(i,{direction:this.direction,unit:e.unit,treatEmojiAsSingleUnit:!0}),this._shouldEntireContentBeReplacedWithParagraph(c)){this._replaceEntireContentWithParagraph(o);return}if(this._shouldReplaceFirstBlockWithParagraph(i,c)){this.editor.execute("paragraph",{selection:i});return}if(i.isCollapsed)return;let l=0;i.getFirstRange().getMinimalFlatRanges().forEach(a=>{l+=te(a.getWalker({singleCharacters:!0,ignoreElementEnd:!0,shallow:!0}))}),t.deleteContent(i,{doNotResetEntireContent:r,direction:this.direction}),this._buffer.input(l),o.setSelection(i),this._buffer.unlock()})}_shouldEntireContentBeReplacedWithParagraph(e){if(e>1)return!1;const t=this.editor.model,o=t.document.selection,i=t.schema.getLimitElement(o);if(!(o.isCollapsed&&o.containsEntireContent(i))||!t.schema.checkChild(i,"paragraph"))return!1;const r=i.getChild(0);return!(r&&r.is("element","paragraph"))}_replaceEntireContentWithParagraph(e){const t=this.editor.model,o=t.document.selection,i=t.schema.getLimitElement(o),c=e.createElement("paragraph");e.remove(e.createRangeIn(i)),e.insert(c,i),e.setSelection(c,0)}_shouldReplaceFirstBlockWithParagraph(e,t){const n=this.editor.model;if(t>1||this.direction!="backward"||!e.isCollapsed)return!1;const o=e.getFirstPosition(),i=n.schema.getLimitElement(o),c=i.getChild(0);return!(o.parent!=c||!e.containsEntireContent(c)||!n.schema.checkChild(i,"paragraph")||c.name=="paragraph")}}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/const pe="character",W="word",be="codePoint",_="selection",y="backward",w="forward",U={deleteContent:{unit:_,direction:y},deleteContentBackward:{unit:be,direction:y},deleteWordBackward:{unit:W,direction:y},deleteHardLineBackward:{unit:_,direction:y},deleteSoftLineBackward:{unit:_,direction:y},deleteContentForward:{unit:pe,direction:w},deleteWordForward:{unit:W,direction:w},deleteHardLineForward:{unit:_,direction:w},deleteSoftLineForward:{unit:_,direction:w}};class _e extends F{constructor(e){super(e);const t=e.document;let n=0;t.on("keydown",()=>{n++}),t.on("keyup",()=>{n=0}),t.on("beforeinput",(o,i)=>{if(!this.isEnabled)return;const{targetRanges:c,domEvent:r,inputType:l}=i,a=U[l];if(!a)return;const u={direction:a.direction,unit:a.unit,sequence:n};u.unit==_&&(u.selectionToRemove=e.createSelection(c[0])),l==="deleteContentBackward"&&(p.isAndroid&&(u.sequence=1),Ee(c)&&(u.unit=_,u.selectionToRemove=e.createSelection(c)));const d=new q(t,"delete",c[0]);t.fire(d,new k(e,r,u)),d.stop.called&&o.stop()}),p.isBlink&&ve(this)}observe(){}stopObserving(){}}function ve(s){const e=s.view,t=e.document;let n=null,o=!1;t.on("keydown",(r,{keyCode:l})=>{n=l,o=!1}),t.on("keyup",(r,{keyCode:l,domEvent:a})=>{const u=t.selection,d=s.isEnabled&&l==n&&i(l)&&!u.isCollapsed&&!o;if(n=null,d){const f=u.getFirstRange(),g=new q(t,"delete",f),h={unit:_,direction:c(l),selectionToRemove:u};t.fire(g,new k(e,a,h))}}),t.on("beforeinput",(r,{inputType:l})=>{const a=U[l];i(n)&&a&&a.direction==c(n)&&(o=!0)},{priority:"high"}),t.on("beforeinput",(r,{inputType:l,data:a})=>{n==E.delete&&l=="insertText"&&a=="\x7F"&&r.stop()},{priority:"high"});function i(r){return r==E.backspace||r==E.delete}function c(r){return r==E.backspace?y:w}}function Ee(s){if(s.length!=1||s[0].isCollapsed)return!1;const e=s[0].getWalker({direction:"backward",singleCharacters:!0,ignoreElementEnd:!0});let t=0;for(const{nextPosition:n,item:o}of e){if(n.parent.is("$text")){const i=n.parent.data,c=n.offset;if(ne(i,c)||ie(i,c)||oe(i,c))continue;t++}else(o.is("containerElement")||o.is("emptyElement"))&&t++;if(t>1)return!0}return!1}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class Q extends x{static get pluginName(){return"Delete"}static get isOfficialPlugin(){return!0}init(){const e=this.editor,t=e.editing.view,n=t.document,o=e.model.document;t.addObserver(_e),this._undoOnBackspace=!1;const i=new $(e,"forward");e.commands.add("deleteForward",i),e.commands.add("forwardDelete",i),e.commands.add("delete",new $(e,"backward")),this.listenTo(n,"delete",(c,r)=>{n.isComposing||r.preventDefault();const{direction:l,sequence:a,selectionToRemove:u,unit:d}=r,f=l==="forward"?"deleteForward":"delete",g={sequence:a};if(d=="selection"){const h=Array.from(u.getRanges()).map(C=>e.editing.mapper.toModelRange(C));g.selection=e.model.createSelection(h)}else g.unit=d;e.execute(f,g),t.scrollToTheSelection()},{priority:"low"}),this.editor.plugins.has("UndoEditing")&&(this.listenTo(n,"delete",(c,r)=>{this._undoOnBackspace&&r.direction=="backward"&&r.sequence==1&&r.unit=="codePoint"&&(this._undoOnBackspace=!1,e.execute("undo"),r.preventDefault(),c.stop())},{context:"$capture"}),this.listenTo(o,"change",()=>{this._undoOnBackspace=!1}))}requestUndoOnBackspace(){this.editor.plugins.has("UndoEditing")&&(this._undoOnBackspace=!0)}}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class ye extends x{static get requires(){return[G,Q]}static get pluginName(){return"Typing"}static get isOfficialPlugin(){return!0}}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/function j(s,e){let t=s.start;return{text:Array.from(s.getWalker({ignoreElementEnd:!1})).reduce((o,{item:i})=>i.is("$text")||i.is("$textProxy")?o+i.data:(t=e.createPositionAfter(i),""),""),range:e.createRange(t,s.end)}}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class H extends se(){constructor(e,t){super(),this.model=e,this.testCallback=t,this._hasMatch=!1,this.set("isEnabled",!0),this.on("change:isEnabled",()=>{this.isEnabled?this._startListening():(this.stopListening(e.document.selection),this.stopListening(e.document))}),this._startListening()}get hasMatch(){return this._hasMatch}_startListening(){const t=this.model.document;this.listenTo(t.selection,"change:range",(n,{directChange:o})=>{if(o){if(!t.selection.isCollapsed){this.hasMatch&&(this.fire("unmatched"),this._hasMatch=!1);return}this._evaluateTextBeforeSelection("selection")}}),this.listenTo(t,"change:data",(n,o)=>{o.isUndo||!o.isLocal||this._evaluateTextBeforeSelection("data",{batch:o})})}_evaluateTextBeforeSelection(e,t={}){const n=this.model,i=n.document.selection,c=n.createRange(n.createPositionAt(i.focus.parent,0),i.focus),{text:r,range:l}=j(c,n),a=this.testCallback(r);if(!a&&this.hasMatch&&this.fire("unmatched"),this._hasMatch=!!a,a){const u=Object.assign(t,{text:r,range:l});typeof a=="object"&&Object.assign(u,a),this.fire(`matched:${e}`,u)}}}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class Te extends x{static get pluginName(){return"TwoStepCaretMovement"}static get isOfficialPlugin(){return!0}constructor(e){super(e),this._isNextGravityRestorationSkipped=!1,this.attributes=new Set,this._overrideUid=null}init(){const e=this.editor,t=e.model,n=e.editing.view,o=e.locale,i=t.document.selection;this.listenTo(n.document,"arrowKey",(c,r)=>{if(!i.isCollapsed||r.shiftKey||r.altKey||r.ctrlKey)return;const l=r.keyCode==E.arrowright,a=r.keyCode==E.arrowleft;if(!l&&!a)return;const u=o.contentLanguageDirection;let d=!1;u==="ltr"&&l||u==="rtl"&&a?d=this._handleForwardMovement(r):d=this._handleBackwardMovement(r),d===!0&&c.stop()},{context:"$text",priority:"highest"}),this.listenTo(i,"change:range",(c,r)=>{if(this._isNextGravityRestorationSkipped){this._isNextGravityRestorationSkipped=!1;return}this._isGravityOverridden&&(!r.directChange&&m(i.getFirstPosition(),this.attributes)||this._restoreGravity())}),this._enableClickingAfterNode(),this._enableInsertContentSelectionAttributesFixer(),this._handleDeleteContentAfterNode()}registerAttribute(e){this.attributes.add(e)}_handleForwardMovement(e){const t=this.attributes,n=this.editor.model,o=n.document.selection,i=o.getFirstPosition();return this._isGravityOverridden||i.isAtStart&&b(o,t)?!1:m(i,t)?(S(e),b(o,t)&&m(i,t,!0)?A(n,t):this._overrideGravity(),!0):!1}_handleBackwardMovement(e){const t=this.attributes,n=this.editor.model,o=n.document.selection,i=o.getFirstPosition();return this._isGravityOverridden?(S(e),this._restoreGravity(),m(i,t,!0)?A(n,t):R(n,t,i),!0):i.isAtStart?b(o,t)?(S(e),R(n,t,i),!0):!1:!b(o,t)&&m(i,t,!0)?(S(e),R(n,t,i),!0):K(i,t)?i.isAtEnd&&!b(o,t)&&m(i,t)?(S(e),R(n,t,i),!0):(this._isNextGravityRestorationSkipped=!0,this._overrideGravity(),!1):!1}_enableClickingAfterNode(){const e=this.editor,t=e.model,n=t.document.selection,o=e.editing.view.document;e.editing.view.addObserver(le);let i=!1;this.listenTo(o,"mousedown",()=>{i=!0}),this.listenTo(o,"selectionChange",()=>{const c=this.attributes;if(!i||(i=!1,!n.isCollapsed)||!b(n,c))return;const r=n.getFirstPosition();m(r,c)&&(r.isAtStart||m(r,c,!0)?A(t,c):this._isGravityOverridden||this._overrideGravity())})}_enableInsertContentSelectionAttributesFixer(){const t=this.editor.model,n=t.document.selection,o=this.attributes;this.listenTo(t,"insertContent",()=>{const i=n.getFirstPosition();b(n,o)&&m(i,o)&&A(t,o)},{priority:"low"})}_handleDeleteContentAfterNode(){const e=this.editor,t=e.model,n=t.document.selection,o=e.editing.view;let i=!1,c=!1;this.listenTo(o.document,"delete",(r,l)=>{i=l.direction==="backward"},{priority:"high"}),this.listenTo(t,"deleteContent",()=>{if(!i)return;const r=n.getFirstPosition();c=b(n,this.attributes)&&!K(r,this.attributes)},{priority:"high"}),this.listenTo(t,"deleteContent",()=>{i&&(i=!1,!c&&e.model.enqueueChange(()=>{const r=n.getFirstPosition();b(n,this.attributes)&&m(r,this.attributes)&&(r.isAtStart||m(r,this.attributes,!0)?A(t,this.attributes):this._isGravityOverridden||this._overrideGravity())}))},{priority:"low"})}get _isGravityOverridden(){return!!this._overrideUid}_overrideGravity(){this._overrideUid=this.editor.model.change(e=>e.overrideSelectionGravity())}_restoreGravity(){this.editor.model.change(e=>{e.restoreSelectionGravity(this._overrideUid),this._overrideUid=null})}}function b(s,e){for(const t of e)if(s.hasAttribute(t))return!0;return!1}function R(s,e,t){const n=t.nodeBefore;s.change(o=>{if(n){const i=[],c=s.schema.isObject(n)&&s.schema.isInline(n);for(const[r,l]of n.getAttributes())s.schema.checkAttribute("$text",r)&&(!c||s.schema.getAttributeProperties(r).copyFromObject!==!1)&&i.push([r,l]);o.setSelectionAttribute(i)}else o.removeSelectionAttribute(e)})}function A(s,e){s.change(t=>{t.removeSelectionAttribute(e)})}function S(s){s.preventDefault()}function K(s,e){const t=s.getShiftedBy(-1);return m(t,e)}function m(s,e,t=!1){const{nodeBefore:n,nodeAfter:o}=s;for(const i of e){const c=n?n.getAttribute(i):void 0,r=o?o.getAttribute(i):void 0;if(!(t&&(c===void 0||r===void 0))&&r!==c)return!0}return!1}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/const Y={copyright:{from:"(c)",to:"\xA9"},registeredTrademark:{from:"(r)",to:"\xAE"},trademark:{from:"(tm)",to:"\u2122"},oneHalf:{from:/(^|[^/a-z0-9])(1\/2)([^/a-z0-9])$/i,to:[null,"\xBD",null]},oneThird:{from:/(^|[^/a-z0-9])(1\/3)([^/a-z0-9])$/i,to:[null,"\u2153",null]},twoThirds:{from:/(^|[^/a-z0-9])(2\/3)([^/a-z0-9])$/i,to:[null,"\u2154",null]},oneForth:{from:/(^|[^/a-z0-9])(1\/4)([^/a-z0-9])$/i,to:[null,"\xBC",null]},threeQuarters:{from:/(^|[^/a-z0-9])(3\/4)([^/a-z0-9])$/i,to:[null,"\xBE",null]},lessThanOrEqual:{from:"<=",to:"\u2264"},greaterThanOrEqual:{from:">=",to:"\u2265"},notEqual:{from:"!=",to:"\u2260"},arrowLeft:{from:"<-",to:"\u2190"},arrowRight:{from:"->",to:"\u2192"},horizontalEllipsis:{from:"...",to:"\u2026"},enDash:{from:/(^| )(--)( )$/,to:[null,"\u2013",null]},emDash:{from:/(^| )(---)( )$/,to:[null,"\u2014",null]},quotesPrimary:{from:T('"'),to:[null,"\u201C",null,"\u201D"]},quotesSecondary:{from:T("'"),to:[null,"\u2018",null,"\u2019"]},quotesPrimaryEnGb:{from:T("'"),to:[null,"\u2018",null,"\u2019"]},quotesSecondaryEnGb:{from:T('"'),to:[null,"\u201C",null,"\u201D"]},quotesPrimaryPl:{from:T('"'),to:[null,"\u201E",null,"\u201D"]},quotesSecondaryPl:{from:T("'"),to:[null,"\u201A",null,"\u2019"]}},V={symbols:["copyright","registeredTrademark","trademark"],mathematical:["oneHalf","oneThird","twoThirds","oneForth","threeQuarters","lessThanOrEqual","greaterThanOrEqual","notEqual","arrowLeft","arrowRight"],typography:["horizontalEllipsis","enDash","emDash"],quotes:["quotesPrimary","quotesSecondary"]},Ce=["symbols","mathematical","typography","quotes"];class xe extends x{static get requires(){return["Delete","Input"]}static get pluginName(){return"TextTransformation"}static get isOfficialPlugin(){return!0}constructor(e){super(e),e.config.define("typing",{transformations:{include:Ce}})}init(){const t=this.editor.model.document.selection;t.on("change:range",()=>{this.isEnabled=!t.anchor.parent.is("element","codeBlock")}),this._enableTransformationWatchers()}_enableTransformationWatchers(){const e=this.editor,t=e.model,n=e.plugins.get("Delete"),o=ke(e.config.get("typing.transformations")),i=r=>{for(const l of o)if(l.from.test(r))return{normalizedTransformation:l}},c=new H(e.model,i);c.on("matched:data",(r,l)=>{if(!l.batch.isTyping)return;const{from:a,to:u}=l.normalizedTransformation,d=a.exec(l.text),f=u(d.slice(1)),g=l.range;let h=d.index;t.enqueueChange(C=>{for(let v=1;v<d.length;v++){const B=d[v],O=f[v-1];if(O==null){h+=B.length;continue}const D=g.start.getShiftedBy(h),X=t.createRange(D,D.getShiftedBy(B.length)),Z=Se(D);t.insertContent(C.createText(O,Z),X),h+=O.length}t.enqueueChange(()=>{n.requestUndoOnBackspace()})})}),c.bind("isEnabled").to(this)}}function we(s){return typeof s=="string"?new RegExp(`(${ue(s)})$`):s}function Ae(s){return typeof s=="string"?()=>[s]:s instanceof Array?()=>s:s}function Se(s){return(s.textNode?s.textNode:s.nodeAfter).getAttributes()}function T(s){return new RegExp(`(^|\\s)(${s})([^${s}]*)(${s})$`)}function ke(s){const e=s.extra||[],t=s.remove||[],n=i=>!t.includes(i),o=s.include.concat(e).filter(n);return Re(o).filter(n).map(i=>typeof i=="string"&&Y[i]?Y[i]:i).filter(i=>typeof i=="object").map(i=>({from:we(i.from),to:Ae(i.to)}))}function Re(s){const e=new Set;for(const t of s)if(typeof t=="string"&&V[t])for(const n of V[t])e.add(n);else e.add(t);return Array.from(e)}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/function J(s,e,t,n){return n.createRange(P(s,e,t,!0,n),P(s,e,t,!1,n))}function P(s,e,t,n,o){let i=s.textNode||(n?s.nodeBefore:s.nodeAfter),c=null;for(;i&&i.getAttribute(e)==t;)c=i,i=n?i.previousSibling:i.nextSibling;return c?o.createPositionAt(c,n?"before":"after"):s}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/function Oe(s,e,t,n){const o=s.editing.view,i=new Set;o.document.registerPostFixer(c=>{const r=s.model.document.selection;let l=!1;if(r.hasAttribute(e)){const a=J(r.getFirstPosition(),e,r.getAttribute(e),s.model),u=s.editing.mapper.toViewRange(a);for(const d of u.getItems())d.is("element",t)&&!d.hasClass(n)&&(c.addClass(n,d),i.add(d),l=!0)}return l}),s.conversion.for("editingDowncast").add(c=>{c.on("insert",r,{priority:"highest"}),c.on("remove",r,{priority:"highest"}),c.on("attribute",r,{priority:"highest"}),c.on("selection",r,{priority:"highest"});function r(){o.change(l=>{for(const a of i.values())l.removeClass(n,a),i.delete(a)})}})}export{Q as Delete,G as Input,N as InsertTextCommand,xe as TextTransformation,H as TextWatcher,Te as TwoStepCaretMovement,ye as Typing,J as findAttributeRange,P as findAttributeRangeBound,j as getLastTextLine,Oe as inlineHighlight};
