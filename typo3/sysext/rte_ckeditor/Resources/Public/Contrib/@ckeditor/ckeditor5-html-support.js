import{Plugin as t}from"@ckeditor/ckeditor5-core";import{toArray as e,priorities as i,CKEditorError as o,isValidAttributeName as r,uid as l}from"@ckeditor/ckeditor5-utils";import{Matcher as n,StylesMap as s,UpcastWriter as m,HtmlDataProcessor as a}from"@ckeditor/ckeditor5-engine";import{toWidget as c,Widget as d}from"@ckeditor/ckeditor5-widget";import{cloneDeep as u,startCase as h,mergeWith as b,isPlainObject as g,isEqual as p}from"lodash-es";import{Enter as w}from"@ckeditor/ckeditor5-enter";
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function f(t,e,i,o){e&&function(t,e,i){if(e.attributes)for(const[o]of Object.entries(e.attributes))t.removeAttribute(o,i);if(e.styles)for(const o of Object.keys(e.styles))t.removeStyle(o,i);e.classes&&t.removeClass(e.classes,i)}(t,e,o),i&&A(t,i,o)}function A(t,e,i){if(e.attributes)for(const[o,r]of Object.entries(e.attributes))t.setAttribute(o,r,i);e.styles&&t.setStyle(e.styles,i),e.classes&&t.addClass(e.classes,i)}function v(t,e,i,o,r){const l=e.getAttribute(i),n={};for(const t of["attributes","styles","classes"]){if(t!=o){l&&l[t]&&(n[t]=l[t]);continue}if("classes"==o){const e=new Set(l&&l.classes||[]);r(e),e.size&&(n[t]=Array.from(e));continue}const e=new Map(Object.entries(l&&l[t]||{}));r(e),e.size&&(n[t]=Object.fromEntries(e))}Object.keys(n).length?e.is("documentSelection")?t.setSelectionAttribute(i,n):t.setAttribute(i,n,e):l&&(e.is("documentSelection")?t.removeSelectionAttribute(i):t.removeAttribute(i,e))}function y(t){return`html${e=t,h(e).replace(/ /g,"")}Attributes`;var e}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function E({model:t}){return(e,i)=>i.writer.createElement(t,{htmlContent:e.getCustomProperty("$rawContent")})}function k(t,{view:e,isInline:i}){const o=t.t;return(t,{writer:r})=>{const l=o("HTML object"),n=C(e,t,r),s=t.getAttribute(y(e));r.addClass("html-object-embed__content",n),s&&A(r,s,n);const m=r.createContainerElement(i?"span":"div",{class:"html-object-embed","data-html-object-embed-label":l},n);return c(m,r,{label:l})}}function C(t,e,i){return i.createRawElement(t,null,((t,i)=>{i.setContentOf(t,e.getAttribute("htmlContent"))}))}function S({view:t,model:e,allowEmpty:i},o){return e=>{e.on(`element:${t}`,((t,e,l)=>{let n=o.processViewAttributes(e.viewItem,l);if(n||l.consumable.test(e.viewItem,{name:!0})){if(n=n||{},l.consumable.consume(e.viewItem,{name:!0}),e.modelRange||(e=Object.assign(e,l.convertChildren(e.viewItem,e.modelCursor))),i&&e.modelRange.isCollapsed&&Object.keys(n).length){const t=l.writer.createElement("htmlEmptyElement");if(!l.safeInsert(t,e.modelCursor))return;const i=l.getSplitParts(t);return e.modelRange=l.writer.createRange(e.modelRange.start,l.writer.createPositionAfter(i[i.length-1])),l.updateConversionResult(t,e),void r(t,n,l)}for(const t of e.modelRange.getItems())r(t,n,l)}}),{priority:"low"})};function r(t,i,o){if(o.schema.checkAttribute(t,e)){const r=function(t,e){const i=u(t);let o="attributes";for(o in e)i[o]="classes"==o?Array.from(new Set([...t[o]||[],...e[o]])):{...t[o],...e[o]};return i}(i,t.getAttribute(e)||{});o.writer.setAttribute(e,r,t)}}}function F({model:t,view:e},i){return(o,{writer:r,consumable:l})=>{if(!o.hasAttribute(t))return null;const n=r.createContainerElement(e),s=o.getAttribute(t);return l.consume(o,`attribute:${t}`),A(r,s,n),n.getFillerOffset=()=>null,i?c(n,r):n}}function $({priority:t,view:e}){return(i,o)=>{if(!i)return;const{writer:r}=o,l=r.createAttributeElement(e,null,{priority:t});return A(r,i,l),l}}function O({view:t},e){return i=>{i.on(`element:${t}`,((t,i,o)=>{if(!i.modelRange||i.modelRange.isCollapsed)return;const r=e.processViewAttributes(i.viewItem,o);r&&o.writer.setAttribute(y(i.viewItem.name),r,i.modelRange)}),{priority:"low"})}}function I({view:t,model:e}){return i=>{i.on(`attribute:${y(t)}:${e}`,((t,e,i)=>{if(!i.consumable.consume(e.item,t.name))return;const{attributeOldValue:o,attributeNewValue:r}=e;f(i.writer,o,r,i.mapper.toViewElement(e.item))}))}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */var _=[{model:"codeBlock",view:"pre"},{model:"paragraph",view:"p"},{model:"blockQuote",view:"blockquote"},{model:"listItem",view:"li"},{model:"pageBreak",view:"div"},{model:"rawHtml",view:"div"},{model:"table",view:"table"},{model:"tableRow",view:"tr"},{model:"tableCell",view:"td"},{model:"tableCell",view:"th"},{model:"tableColumnGroup",view:"colgroup"},{model:"tableColumn",view:"col"},{model:"caption",view:"caption"},{model:"caption",view:"figcaption"},{model:"imageBlock",view:"img"},{model:"imageInline",view:"img"},{model:"htmlP",view:"p",modelSchema:{inheritAllFrom:"$block"}},{model:"htmlBlockquote",view:"blockquote",modelSchema:{inheritAllFrom:"$container"}},{model:"htmlTable",view:"table",modelSchema:{allowWhere:"$block",isBlock:!0}},{model:"htmlTbody",view:"tbody",modelSchema:{allowIn:"htmlTable",isBlock:!1}},{model:"htmlThead",view:"thead",modelSchema:{allowIn:"htmlTable",isBlock:!1}},{model:"htmlTfoot",view:"tfoot",modelSchema:{allowIn:"htmlTable",isBlock:!1}},{model:"htmlCaption",view:"caption",modelSchema:{allowIn:"htmlTable",allowChildren:"$text",isBlock:!1}},{model:"htmlColgroup",view:"colgroup",modelSchema:{allowIn:"htmlTable",allowChildren:"col",isBlock:!1}},{model:"htmlCol",view:"col",modelSchema:{allowIn:"htmlColgroup",isBlock:!1}},{model:"htmlTr",view:"tr",modelSchema:{allowIn:["htmlTable","htmlThead","htmlTbody"],isLimit:!0}},{model:"htmlTd",view:"td",modelSchema:{allowIn:"htmlTr",allowContentOf:"$container",isLimit:!0,isBlock:!1}},{model:"htmlTh",view:"th",modelSchema:{allowIn:"htmlTr",allowContentOf:"$container",isLimit:!0,isBlock:!1}},{model:"htmlFigure",view:"figure",modelSchema:{inheritAllFrom:"$container",isBlock:!1}},{model:"htmlFigcaption",view:"figcaption",modelSchema:{allowIn:"htmlFigure",allowChildren:"$text",isBlock:!1}},{model:"htmlAddress",view:"address",modelSchema:{inheritAllFrom:"$container",isBlock:!1}},{model:"htmlAside",view:"aside",modelSchema:{inheritAllFrom:"$container",isBlock:!1}},{model:"htmlMain",view:"main",modelSchema:{inheritAllFrom:"$container",isBlock:!1}},{model:"htmlDetails",view:"details",modelSchema:{inheritAllFrom:"$container",isBlock:!1}},{model:"htmlSummary",view:"summary",modelSchema:{allowChildren:["htmlH1","htmlH2","htmlH3","htmlH4","htmlH5","htmlH6","$text"],allowIn:"htmlDetails",isBlock:!1}},{model:"htmlDiv",view:"div",paragraphLikeModel:"htmlDivParagraph",modelSchema:{inheritAllFrom:"$container"}},{model:"htmlFieldset",view:"fieldset",modelSchema:{inheritAllFrom:"$container",isBlock:!1}},{model:"htmlLegend",view:"legend",modelSchema:{allowIn:"htmlFieldset",allowChildren:"$text"}},{model:"htmlHeader",view:"header",modelSchema:{inheritAllFrom:"$container",isBlock:!1}},{model:"htmlFooter",view:"footer",modelSchema:{inheritAllFrom:"$container",isBlock:!1}},{model:"htmlForm",view:"form",modelSchema:{inheritAllFrom:"$container",isBlock:!0}},{model:"htmlHgroup",view:"hgroup",modelSchema:{allowIn:["$root","$container"],allowChildren:["paragraph","htmlP","htmlH1","htmlH2","htmlH3","htmlH4","htmlH5","htmlH6"],isBlock:!1}},{model:"htmlH1",view:"h1",modelSchema:{inheritAllFrom:"$block"}},{model:"htmlH2",view:"h2",modelSchema:{inheritAllFrom:"$block"}},{model:"htmlH3",view:"h3",modelSchema:{inheritAllFrom:"$block"}},{model:"htmlH4",view:"h4",modelSchema:{inheritAllFrom:"$block"}},{model:"htmlH5",view:"h5",modelSchema:{inheritAllFrom:"$block"}},{model:"htmlH6",view:"h6",modelSchema:{inheritAllFrom:"$block"}},{model:"$htmlList",modelSchema:{allowWhere:"$container",allowChildren:["$htmlList","htmlLi"],isBlock:!1}},{model:"htmlDir",view:"dir",modelSchema:{inheritAllFrom:"$htmlList"}},{model:"htmlMenu",view:"menu",modelSchema:{inheritAllFrom:"$htmlList"}},{model:"htmlUl",view:"ul",modelSchema:{inheritAllFrom:"$htmlList"}},{model:"htmlOl",view:"ol",modelSchema:{inheritAllFrom:"$htmlList"}},{model:"htmlLi",view:"li",modelSchema:{allowIn:"$htmlList",allowChildren:"$text",isBlock:!1}},{model:"htmlPre",view:"pre",modelSchema:{inheritAllFrom:"$block"}},{model:"htmlArticle",view:"article",modelSchema:{inheritAllFrom:"$container",isBlock:!1}},{model:"htmlSection",view:"section",modelSchema:{inheritAllFrom:"$container",isBlock:!1}},{model:"htmlNav",view:"nav",modelSchema:{inheritAllFrom:"$container",isBlock:!1}},{model:"htmlDivDl",view:"div",modelSchema:{allowChildren:["htmlDt","htmlDd"],allowIn:"htmlDl"}},{model:"htmlDl",view:"dl",modelSchema:{allowWhere:"$container",allowChildren:["htmlDt","htmlDd","htmlDivDl"],isBlock:!1}},{model:"htmlDt",view:"dt",modelSchema:{allowChildren:"$block",isBlock:!1}},{model:"htmlDd",view:"dd",modelSchema:{allowChildren:"$block",isBlock:!1}},{model:"htmlCenter",view:"center",modelSchema:{inheritAllFrom:"$container",isBlock:!1}}],T=[{model:"htmlLiAttributes",view:"li",appliesToBlock:!0,coupledAttribute:"listItemId"},{model:"htmlOlAttributes",view:"ol",appliesToBlock:!0,coupledAttribute:"listItemId"},{model:"htmlUlAttributes",view:"ul",appliesToBlock:!0,coupledAttribute:"listItemId"},{model:"htmlFigureAttributes",view:"figure",appliesToBlock:"table"},{model:"htmlTheadAttributes",view:"thead",appliesToBlock:"table"},{model:"htmlTbodyAttributes",view:"tbody",appliesToBlock:"table"},{model:"htmlFigureAttributes",view:"figure",appliesToBlock:"imageBlock"},{model:"htmlAcronym",view:"acronym",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlTt",view:"tt",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlFont",view:"font",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlTime",view:"time",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlVar",view:"var",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlBig",view:"big",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlSmall",view:"small",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlSamp",view:"samp",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlQ",view:"q",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlOutput",view:"output",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlKbd",view:"kbd",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlBdi",view:"bdi",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlBdo",view:"bdo",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlAbbr",view:"abbr",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlA",view:"a",priority:5,coupledAttribute:"linkHref"},{model:"htmlStrong",view:"strong",coupledAttribute:"bold",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlB",view:"b",coupledAttribute:"bold",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlI",view:"i",coupledAttribute:"italic",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlEm",view:"em",coupledAttribute:"italic",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlS",view:"s",coupledAttribute:"strikethrough",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlDel",view:"del",coupledAttribute:"strikethrough",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlIns",view:"ins",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlU",view:"u",coupledAttribute:"underline",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlSub",view:"sub",coupledAttribute:"subscript",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlSup",view:"sup",coupledAttribute:"superscript",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlCode",view:"code",coupledAttribute:"code",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlMark",view:"mark",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlSpan",view:"span",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlCite",view:"cite",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlLabel",view:"label",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlDfn",view:"dfn",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlObject",view:"object",isObject:!0,modelSchema:{inheritAllFrom:"$inlineObject"}},{model:"htmlIframe",view:"iframe",isObject:!0,modelSchema:{inheritAllFrom:"$inlineObject"}},{model:"htmlInput",view:"input",isObject:!0,modelSchema:{inheritAllFrom:"$inlineObject"}},{model:"htmlButton",view:"button",isObject:!0,modelSchema:{inheritAllFrom:"$inlineObject"}},{model:"htmlTextarea",view:"textarea",isObject:!0,modelSchema:{inheritAllFrom:"$inlineObject"}},{model:"htmlSelect",view:"select",isObject:!0,modelSchema:{inheritAllFrom:"$inlineObject"}},{model:"htmlVideo",view:"video",isObject:!0,modelSchema:{inheritAllFrom:"$inlineObject"}},{model:"htmlEmbed",view:"embed",isObject:!0,modelSchema:{inheritAllFrom:"$inlineObject"}},{model:"htmlOembed",view:"oembed",isObject:!0,modelSchema:{inheritAllFrom:"$inlineObject"}},{model:"htmlAudio",view:"audio",isObject:!0,modelSchema:{inheritAllFrom:"$inlineObject"}},{model:"htmlImg",view:"img",isObject:!0,modelSchema:{inheritAllFrom:"$inlineObject"}},{model:"htmlCanvas",view:"canvas",isObject:!0,modelSchema:{inheritAllFrom:"$inlineObject"}},{model:"htmlMeter",view:"meter",isObject:!0,modelSchema:{inheritAllFrom:"$inlineObject"}},{model:"htmlProgress",view:"progress",isObject:!0,modelSchema:{inheritAllFrom:"$inlineObject"}},{model:"htmlScript",view:"script",modelSchema:{allowWhere:["$text","$block"],isInline:!0}},{model:"htmlStyle",view:"style",modelSchema:{allowWhere:["$text","$block"],isInline:!0}},{model:"htmlCustomElement",view:"$customElement",modelSchema:{allowWhere:["$text","$block"],allowAttributesOf:"$inlineObject",isInline:!0}}];
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class P extends t{constructor(){super(...arguments),this._definitions=[]}static get pluginName(){return"DataSchema"}init(){for(const t of _)this.registerBlockElement(t);for(const t of T)this.registerInlineElement(t)}registerBlockElement(t){this._definitions.push({...t,isBlock:!0})}registerInlineElement(t){this._definitions.push({...t,isInline:!0})}extendBlockElement(t){this._extendDefinition({...t,isBlock:!0})}extendInlineElement(t){this._extendDefinition({...t,isInline:!0})}getDefinitionsForView(t,e=!1){const i=new Set;for(const o of this._getMatchingViewDefinitions(t)){if(e)for(const t of this._getReferences(o.model))i.add(t);i.add(o)}return i}getDefinitionsForModel(t){return this._definitions.filter((e=>e.model==t))}_getMatchingViewDefinitions(t){return this._definitions.filter((e=>e.view&&function(t,e){if("string"==typeof t)return t===e;if(t instanceof RegExp)return t.test(e);return!1}(t,e.view)))}*_getReferences(t){const i=["inheritAllFrom","inheritTypesFrom","allowWhere","allowContentOf","allowAttributesOf"],o=this._definitions.filter((e=>e.model==t));for(const{modelSchema:r}of o)if(r)for(const o of i)for(const i of e(r[o]||[])){const e=this._definitions.filter((t=>t.model==i));for(const o of e)i!==t&&(yield*this._getReferences(o.model),yield o)}}_extendDefinition(t){const e=Array.from(this._definitions.entries()).filter((([,e])=>e.model==t.model));if(0!=e.length)for(const[i,o]of e)this._definitions[i]=b({},o,t,((t,e)=>Array.isArray(t)?t.concat(e):void 0));else this._definitions.push(t)}}!function(t,{insertAt:e}={}){if("undefined"==typeof document)return;const i=document.head||document.getElementsByTagName("head")[0],o=document.createElement("style");o.type="text/css",window.litNonce&&o.setAttribute("nonce",window.litNonce),"top"===e&&i.firstChild?i.insertBefore(o,i.firstChild):i.appendChild(o),o.styleSheet?o.styleSheet.cssText=t:o.appendChild(document.createTextNode(t))}(":root{--ck-html-object-embed-unfocused-outline-width:1px}.ck-widget.html-object-embed{background-color:var(--ck-color-base-foreground);font-size:var(--ck-font-size-base);min-width:calc(76px + var(--ck-spacing-standard));padding:var(--ck-spacing-small);padding-top:calc(var(--ck-font-size-tiny) + var(--ck-spacing-large))}.ck-widget.html-object-embed:not(.ck-widget_selected):not(:hover){outline:var(--ck-html-object-embed-unfocused-outline-width) dashed var(--ck-color-widget-blurred-border)}.ck-widget.html-object-embed:before{background:#999;border-radius:0 0 var(--ck-border-radius) var(--ck-border-radius);color:var(--ck-color-base-background);content:attr(data-html-object-embed-label);font-family:var(--ck-font-face);font-size:var(--ck-font-size-tiny);font-style:normal;font-weight:400;left:var(--ck-spacing-standard);padding:calc(var(--ck-spacing-tiny) + var(--ck-html-object-embed-unfocused-outline-width)) var(--ck-spacing-small) var(--ck-spacing-tiny);position:absolute;top:0;transition:background var(--ck-widget-handler-animation-duration) var(--ck-widget-handler-animation-curve)}.ck-widget.html-object-embed .ck-widget__type-around .ck-widget__type-around__button.ck-widget__type-around__button_before{margin-left:50px}.ck-widget.html-object-embed .html-object-embed__content{pointer-events:none}div.ck-widget.html-object-embed{margin:1em auto}span.ck-widget.html-object-embed{display:inline-block}");
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */
class B extends t{constructor(t){super(t),this._dataSchema=t.plugins.get("DataSchema"),this._allowedAttributes=new n,this._disallowedAttributes=new n,this._allowedElements=new Set,this._disallowedElements=new Set,this._dataInitialized=!1,this._coupledAttributes=null,this._registerElementsAfterInit(),this._registerElementHandlers(),this._registerCoupledAttributesPostFixer(),this._registerAssociatedHtmlAttributesPostFixer()}static get pluginName(){return"DataFilter"}static get requires(){return[P,d]}loadAllowedConfig(t){for(const e of t){const t=e.name||/[\s\S]+/,i=N(e);this.allowElement(t),i.forEach((t=>this.allowAttributes(t)))}}loadDisallowedConfig(t){for(const e of t){const t=e.name||/[\s\S]+/,i=N(e);0==i.length?this.disallowElement(t):i.forEach((t=>this.disallowAttributes(t)))}}loadAllowedEmptyElementsConfig(t){for(const e of t)this.allowEmptyElement(e)}allowElement(t){for(const e of this._dataSchema.getDefinitionsForView(t,!0))this._addAllowedElement(e),this._coupledAttributes=null}disallowElement(t){for(const e of this._dataSchema.getDefinitionsForView(t,!1))this._disallowedElements.add(e.view)}allowEmptyElement(t){for(const e of this._dataSchema.getDefinitionsForView(t,!0))e.isInline&&this._dataSchema.extendInlineElement({...e,allowEmpty:!0})}allowAttributes(t){this._allowedAttributes.add(t)}disallowAttributes(t){this._disallowedAttributes.add(t)}processViewAttributes(t,e){const{consumable:i}=e;return D(t,this._disallowedAttributes,i),function(t,{attributes:e,classes:i,styles:o}){if(!e.length&&!i.length&&!o.length)return null;return{...e.length&&{attributes:x(t,e)},...o.length&&{styles:R(t,o)},...i.length&&{classes:i}}}(t,D(t,this._allowedAttributes,i))}_addAllowedElement(t){if(!this._allowedElements.has(t)){if(this._allowedElements.add(t),"appliesToBlock"in t&&"string"==typeof t.appliesToBlock)for(const e of this._dataSchema.getDefinitionsForModel(t.appliesToBlock))e.isBlock&&this._addAllowedElement(e);this._dataInitialized&&this.editor.data.once("set",(()=>{this._fireRegisterEvent(t)}),{priority:i.highest+1})}}_registerElementsAfterInit(){this.editor.data.on("init",(()=>{this._dataInitialized=!0;for(const t of this._allowedElements)this._fireRegisterEvent(t)}),{priority:i.highest+1})}_registerElementHandlers(){this.on("register",((t,e)=>{const i=this.editor.model.schema;if(e.isObject&&!i.isRegistered(e.model))this._registerObjectElement(e);else if(e.isBlock)this._registerBlockElement(e);else{if(!e.isInline)throw new o("data-filter-invalid-definition",null,e);this._registerInlineElement(e)}t.stop()}),{priority:"lowest"})}_registerCoupledAttributesPostFixer(){const t=this.editor.model,e=t.document.selection;t.document.registerPostFixer((e=>{const i=t.document.differ.getChanges();let o=!1;const r=this._getCoupledAttributesMap();for(const t of i){if("attribute"!=t.type||null!==t.attributeNewValue)continue;const i=r.get(t.attributeKey);if(i)for(const{item:r}of t.range.getWalker())for(const t of i)r.hasAttribute(t)&&(e.removeAttribute(t,r),o=!0)}return o})),this.listenTo(e,"change:attribute",((i,{attributeKeys:o})=>{const r=new Set,l=this._getCoupledAttributesMap();for(const t of o){if(e.hasAttribute(t))continue;const i=l.get(t);if(i)for(const t of i)e.hasAttribute(t)&&r.add(t)}0!=r.size&&t.change((t=>{for(const e of r)t.removeSelectionAttribute(e)}))}))}_registerAssociatedHtmlAttributesPostFixer(){const t=this.editor.model;t.document.registerPostFixer((e=>{const i=t.document.differ.getChanges();let o=!1;for(const r of i)if("insert"===r.type&&"$text"!==r.name)for(const i of r.attributes.keys())i.startsWith("html")&&i.endsWith("Attributes")&&(t.schema.checkAttribute(r.name,i)||(e.removeAttribute(i,r.position.nodeAfter),o=!0));return o}))}_getCoupledAttributesMap(){if(this._coupledAttributes)return this._coupledAttributes;this._coupledAttributes=new Map;for(const t of this._allowedElements)if(t.coupledAttribute&&t.model){const e=this._coupledAttributes.get(t.coupledAttribute);e?e.push(t.model):this._coupledAttributes.set(t.coupledAttribute,[t.model])}return this._coupledAttributes}_fireRegisterEvent(t){t.view&&this._disallowedElements.has(t.view)||this.fire(t.view?`register:${t.view}`:"register",t)}_registerObjectElement(t){const e=this.editor,o=e.model.schema,r=e.conversion,{view:l,model:n}=t;o.register(n,t.modelSchema),
/* istanbul ignore next: paranoid check -- @preserve */
l&&(o.extend(t.model,{allowAttributes:[y(l),"htmlContent"]}),e.data.registerRawContentMatcher({name:l}),r.for("upcast").elementToElement({view:l,model:E(t),converterPriority:i.low+2}),r.for("upcast").add(O(t,this)),r.for("editingDowncast").elementToStructure({model:{name:n,attributes:[y(l)]},view:k(e,t)}),r.for("dataDowncast").elementToElement({model:n,view:(t,{writer:e})=>C(l,t,e)}),r.for("dataDowncast").add(I(t)))}_registerBlockElement(t){const e=this.editor,o=e.model.schema,r=e.conversion,{view:l,model:n}=t;if(!o.isRegistered(t.model)){if(o.register(t.model,t.modelSchema),!l)return;r.for("upcast").elementToElement({model:n,view:l,converterPriority:i.low+2}),r.for("downcast").elementToElement({model:n,view:l})}l&&(o.extend(t.model,{allowAttributes:y(l)}),r.for("upcast").add(O(t,this)),r.for("downcast").add(I(t)))}_registerInlineElement(t){const e=this.editor,i=e.model.schema,o=e.conversion,r=t.model;t.appliesToBlock||(i.extend("$text",{allowAttributes:r}),t.attributeProperties&&i.setAttributeProperties(r,t.attributeProperties),o.for("upcast").add(S(t,this)),o.for("downcast").attributeToElement({model:r,view:$(t)}),t.allowEmpty&&(i.setAttributeProperties(r,{copyFromObject:!1}),i.isRegistered("htmlEmptyElement")||i.register("htmlEmptyElement",{inheritAllFrom:"$inlineObject"}),e.data.htmlProcessor.domConverter.registerInlineObjectMatcher((e=>e.name==t.view&&e.isEmpty&&Array.from(e.getAttributeKeys()).length?{name:!0}:null)),o.for("editingDowncast").elementToElement({model:"htmlEmptyElement",view:F(t,!0)}),o.for("dataDowncast").elementToElement({model:"htmlEmptyElement",view:F(t)})))}}function D(t,e,i){const o=e.matchAll(t)||[],r=t.document.stylesProcessor;return o.reduce(((e,{match:o})=>{for(const l of o.styles||[]){const o=r.getRelatedStyles(l).filter((t=>t.split("-").length>l.split("-").length)).sort(((t,e)=>e.split("-").length-t.split("-").length));for(const r of o)i.consume(t,{styles:[r]})&&e.styles.push(r);i.consume(t,{styles:[l]})&&e.styles.push(l)}for(const r of o.classes||[])i.consume(t,{classes:[r]})&&e.classes.push(r);for(const r of o.attributes||[])i.consume(t,{attributes:[r]})&&e.attributes.push(r);return e}),{attributes:[],classes:[],styles:[]})}function x(t,e){const i={};for(const o of e){const e=t.getAttribute(o);void 0!==e&&r(o)&&(i[o]=e)}return i}function R(t,e){const i=new s(t.document.stylesProcessor);for(const o of e){const e=t.getStyle(o);void 0!==e&&i.set(o,e)}return Object.fromEntries(i.getStylesEntries())}function j(t,e){const{name:i}=t,o=t[e];return g(o)?Object.entries(o).map((([t,o])=>({name:i,[e]:{[t]:o}}))):Array.isArray(o)?o.map((t=>({name:i,[e]:[t]}))):[t]}function N(t){const{name:e,attributes:i,classes:o,styles:r}=t,l=[];return i&&l.push(...j({name:e,attributes:i},"attributes")),o&&l.push(...j({name:e,classes:o},"classes")),r&&l.push(...j({name:e,styles:r},"styles")),l}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class V extends t{static get requires(){return[B]}static get pluginName(){return"CodeBlockElementSupport"}init(){if(!this.editor.plugins.has("CodeBlockEditing"))return;const t=this.editor.plugins.get(B);t.on("register:pre",((e,i)=>{if("codeBlock"!==i.model)return;const o=this.editor,r=o.model.schema,l=o.conversion;r.extend("codeBlock",{allowAttributes:["htmlPreAttributes","htmlContentAttributes"]}),l.for("upcast").add(function(t){return e=>{e.on("element:code",((e,i,o)=>{const r=i.viewItem,l=r.parent;function n(e,r){const l=t.processViewAttributes(e,o);l&&o.writer.setAttribute(r,l,i.modelRange)}l&&l.is("element","pre")&&(n(l,"htmlPreAttributes"),n(r,"htmlContentAttributes"))}),{priority:"low"})}}(t)),l.for("downcast").add((t=>{t.on("attribute:htmlPreAttributes:codeBlock",((t,e,i)=>{if(!i.consumable.consume(e.item,t.name))return;const{attributeOldValue:o,attributeNewValue:r}=e,l=i.mapper.toViewElement(e.item).parent;f(i.writer,o,r,l)})),t.on("attribute:htmlContentAttributes:codeBlock",((t,e,i)=>{if(!i.consumable.consume(e.item,t.name))return;const{attributeOldValue:o,attributeNewValue:r}=e,l=i.mapper.toViewElement(e.item);f(i.writer,o,r,l)}))})),e.stop()}))}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */
class H extends t{static get requires(){return[B]}static get pluginName(){return"DualContentModelElementSupport"}init(){this.editor.plugins.get(B).on("register",((t,e)=>{const o=e,r=this.editor,l=r.model.schema,n=r.conversion;if(!o.paragraphLikeModel)return;if(l.isRegistered(o.model)||l.isRegistered(o.paragraphLikeModel))return;const s={model:o.paragraphLikeModel,view:o.view};l.register(o.model,o.modelSchema),l.register(s.model,{inheritAllFrom:"$block"}),n.for("upcast").elementToElement({view:o.view,model:(t,{writer:e})=>this._hasBlockContent(t)?e.createElement(o.model):e.createElement(s.model),converterPriority:i.low+.5}),n.for("downcast").elementToElement({view:o.view,model:o.model}),this._addAttributeConversion(o),n.for("downcast").elementToElement({view:s.view,model:s.model}),this._addAttributeConversion(s),t.stop()}))}_hasBlockContent(t){const e=this.editor.editing.view,i=e.domConverter.blockElements;for(const o of e.createRangeIn(t).getItems())if(o.is("element")&&i.includes(o.name))return!0;return!1}_addAttributeConversion(t){const e=this.editor,i=e.conversion,o=e.plugins.get(B);e.model.schema.extend(t.model,{allowAttributes:y(t.view)}),i.for("upcast").add(O(t,o)),i.for("downcast").add(I(t))}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class L extends t{static get requires(){return[P,w]}static get pluginName(){return"HeadingElementSupport"}init(){const t=this.editor;if(!t.plugins.has("HeadingEditing"))return;const e=t.config.get("heading.options");this.registerHeadingElements(t,e)}registerHeadingElements(t,e){const i=t.plugins.get(P),o=[];for(const t of e)"model"in t&&"view"in t&&(i.registerBlockElement({view:t.view,model:t.model}),o.push(t.model));i.extendBlockElement({model:"htmlHgroup",modelSchema:{allowChildren:o}}),i.extendBlockElement({model:"htmlSummary",modelSchema:{allowChildren:o}})}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function M(t,e,i){const o=t.createRangeOn(e);for(const{item:t}of o.getWalker())if(t.is("element",i))return t}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class q extends t{static get requires(){return[B]}static get pluginName(){return"ImageElementSupport"}init(){const t=this.editor;if(!t.plugins.has("ImageInlineEditing")&&!t.plugins.has("ImageBlockEditing"))return;const e=t.model.schema,i=t.conversion,o=t.plugins.get(B);o.on("register:figure",(()=>{i.for("upcast").add(function(t){return e=>{e.on("element:figure",((e,i,o)=>{const r=i.viewItem;if(!i.modelRange||!r.hasClass("image"))return;const l=t.processViewAttributes(r,o);l&&o.writer.setAttribute("htmlFigureAttributes",l,i.modelRange)}),{priority:"low"})}}(o))})),o.on("register:img",((r,l)=>{"imageBlock"!==l.model&&"imageInline"!==l.model||(e.isRegistered("imageBlock")&&e.extend("imageBlock",{allowAttributes:["htmlImgAttributes","htmlFigureAttributes","htmlLinkAttributes"]}),e.isRegistered("imageInline")&&e.extend("imageInline",{allowAttributes:["htmlA","htmlImgAttributes"]}),i.for("upcast").add(function(t){return e=>{e.on("element:img",((e,i,o)=>{if(!i.modelRange)return;const r=i.viewItem,l=t.processViewAttributes(r,o);l&&o.writer.setAttribute("htmlImgAttributes",l,i.modelRange)}),{priority:"low"})}}(o)),i.for("downcast").add((t=>{function e(e){t.on(`attribute:${e}:imageInline`,((t,e,i)=>{if(!i.consumable.consume(e.item,t.name))return;const{attributeOldValue:o,attributeNewValue:r}=e,l=i.mapper.toViewElement(e.item);f(i.writer,o,r,l)}),{priority:"low"})}function i(e,i){t.on(`attribute:${i}:imageBlock`,((t,i,o)=>{if(!o.consumable.test(i.item,t.name))return;const{attributeOldValue:r,attributeNewValue:l}=i,n=o.mapper.toViewElement(i.item),s=M(o.writer,n,e);s&&(f(o.writer,r,l,s),o.consumable.consume(i.item,t.name))}),{priority:"low"}),"a"===e&&t.on("attribute:linkHref:imageBlock",((t,e,i)=>{if(!i.consumable.consume(e.item,"attribute:htmlLinkAttributes:imageBlock"))return;const o=i.mapper.toViewElement(e.item),r=M(i.writer,o,"a");A(i.writer,e.item.getAttribute("htmlLinkAttributes"),r)}),{priority:"low"})}e("htmlImgAttributes"),i("img","htmlImgAttributes"),i("figure","htmlFigureAttributes"),i("a","htmlLinkAttributes")})),t.plugins.has("LinkImage")&&i.for("upcast").add(function(t,e){const i=e.plugins.get("ImageUtils");return e=>{e.on("element:a",((e,o,r)=>{const l=o.viewItem;if(!i.findViewImgElement(l))return;const n=o.modelCursor.parent;if(!n.is("element","imageBlock"))return;const s=t.processViewAttributes(l,r);s&&r.writer.setAttribute("htmlLinkAttributes",s,n)}),{priority:"low"})}}(o,t)),r.stop())}))}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */
class W extends t{static get requires(){return[B]}static get pluginName(){return"MediaEmbedElementSupport"}init(){const t=this.editor;if(!t.plugins.has("MediaEmbed")||t.config.get("mediaEmbed.previewsInData"))return;const e=t.model.schema,i=t.conversion,o=this.editor.plugins.get(B),r=this.editor.plugins.get(P),l=t.config.get("mediaEmbed.elementName");r.registerBlockElement({model:"media",view:l}),o.on("register:figure",(()=>{i.for("upcast").add(function(t){return e=>{e.on("element:figure",((e,i,o)=>{const r=i.viewItem;if(!i.modelRange||!r.hasClass("media"))return;const l=t.processViewAttributes(r,o);l&&o.writer.setAttribute("htmlFigureAttributes",l,i.modelRange)}),{priority:"low"})}}(o))})),o.on(`register:${l}`,((t,r)=>{"media"===r.model&&(e.extend("media",{allowAttributes:[y(l),"htmlFigureAttributes"]}),i.for("upcast").add(function(t,e){const i=(i,o,r)=>{function l(e,i){const l=t.processViewAttributes(e,r);l&&r.writer.setAttribute(i,l,o.modelRange)}l(o.viewItem,y(e))};return t=>{t.on(`element:${e}`,i,{priority:"low"})}}(o,l)),i.for("dataDowncast").add(function(t){return e=>{function i(t,i){e.on(`attribute:${i}:media`,((e,i,o)=>{if(!o.consumable.consume(i.item,e.name))return;const{attributeOldValue:r,attributeNewValue:l}=i,n=o.mapper.toViewElement(i.item),s=M(o.writer,n,t);f(o.writer,r,l,s)}))}i(t,y(t)),i("figure","htmlFigureAttributes")}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */(l)),t.stop())}))}}class U extends t{static get requires(){return[B]}static get pluginName(){return"ScriptElementSupport"}init(){const t=this.editor.plugins.get(B);t.on("register:script",((e,i)=>{const o=this.editor,r=o.model.schema,l=o.conversion;r.register("htmlScript",i.modelSchema),r.extend("htmlScript",{allowAttributes:["htmlScriptAttributes","htmlContent"],isContent:!0}),o.data.registerRawContentMatcher({name:"script"}),l.for("upcast").elementToElement({view:"script",model:E(i)}),l.for("upcast").add(O(i,t)),l.for("downcast").elementToElement({model:"htmlScript",view:(t,{writer:e})=>C("script",t,e)}),l.for("downcast").add(I(i)),e.stop()}))}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class z extends t{static get requires(){return[B]}static get pluginName(){return"TableElementSupport"}init(){const t=this.editor;if(!t.plugins.has("TableEditing"))return;const e=t.model.schema,i=t.conversion,o=t.plugins.get(B),r=t.plugins.get("TableUtils");o.on("register:figure",(()=>{i.for("upcast").add(function(t){return e=>{e.on("element:figure",((e,i,o)=>{const r=i.viewItem;if(!i.modelRange||!r.hasClass("table"))return;const l=t.processViewAttributes(r,o);l&&o.writer.setAttribute("htmlFigureAttributes",l,i.modelRange)}),{priority:"low"})}}(o))})),o.on("register:table",((l,n)=>{"table"===n.model&&(e.extend("table",{allowAttributes:["htmlTableAttributes","htmlFigureAttributes","htmlTheadAttributes","htmlTbodyAttributes"]}),i.for("upcast").add(function(t){return e=>{e.on("element:table",((e,i,o)=>{if(!i.modelRange)return;const r=i.viewItem;l(r,"htmlTableAttributes");for(const t of r.getChildren())t.is("element","thead")&&l(t,"htmlTheadAttributes"),t.is("element","tbody")&&l(t,"htmlTbodyAttributes");function l(e,r){const l=t.processViewAttributes(e,o);l&&o.writer.setAttribute(r,l,i.modelRange)}}),{priority:"low"})}}(o)),i.for("downcast").add((t=>{function e(e,i){t.on(`attribute:${i}:table`,((t,i,o)=>{if(!o.consumable.test(i.item,t.name))return;const r=o.mapper.toViewElement(i.item),l=M(o.writer,r,e);l&&(o.consumable.consume(i.item,t.name),f(o.writer,i.attributeOldValue,i.attributeNewValue,l))}))}e("table","htmlTableAttributes"),e("figure","htmlFigureAttributes"),e("thead","htmlTheadAttributes"),e("tbody","htmlTbodyAttributes")})),t.model.document.registerPostFixer(function(t,e){return i=>{const o=t.document.differ.getChanges();let r=!1;for(const t of o){if("attribute"!=t.type||"headingRows"!=t.attributeKey)continue;const o=t.range.start.nodeAfter,l=o.getAttribute("htmlTheadAttributes"),n=o.getAttribute("htmlTbodyAttributes");l&&!t.attributeNewValue?(i.removeAttribute("htmlTheadAttributes",o),r=!0):n&&t.attributeNewValue==e.getRows(o)&&(i.removeAttribute("htmlTbodyAttributes",o),r=!0)}return r}}(t.model,r)),l.stop())}))}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */
class G extends t{static get requires(){return[B]}static get pluginName(){return"StyleElementSupport"}init(){const t=this.editor.plugins.get(B);t.on("register:style",((e,i)=>{const o=this.editor,r=o.model.schema,l=o.conversion;r.register("htmlStyle",i.modelSchema),r.extend("htmlStyle",{allowAttributes:["htmlStyleAttributes","htmlContent"],isContent:!0}),o.data.registerRawContentMatcher({name:"style"}),l.for("upcast").elementToElement({view:"style",model:E(i)}),l.for("upcast").add(O(i,t)),l.for("downcast").elementToElement({model:"htmlStyle",view:(t,{writer:e})=>C("style",t,e)}),l.for("downcast").add(I(i)),e.stop()}))}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class K extends t{static get requires(){return[B]}static get pluginName(){return"ListElementSupport"}init(){const t=this.editor;if(!t.plugins.has("ListEditing"))return;const e=t.model.schema,i=t.conversion,o=t.plugins.get(B),r=t.plugins.get("ListEditing"),l=t.plugins.get("ListUtils"),n=["ul","ol","li"];r.registerDowncastStrategy({scope:"item",attributeName:"htmlLiAttributes",setAttributeOnDowncast:A}),r.registerDowncastStrategy({scope:"list",attributeName:"htmlUlAttributes",setAttributeOnDowncast:A}),r.registerDowncastStrategy({scope:"list",attributeName:"htmlOlAttributes",setAttributeOnDowncast:A}),o.on("register",((t,r)=>{if(!n.includes(r.view))return;if(t.stop(),e.checkAttribute("$block","htmlLiAttributes"))return;const l=n.map((t=>y(t)));e.extend("$listItem",{allowAttributes:l}),i.for("upcast").add((t=>{t.on("element:ul",X("htmlUlAttributes",o),{priority:"low"}),t.on("element:ol",X("htmlOlAttributes",o),{priority:"low"}),t.on("element:li",X("htmlLiAttributes",o),{priority:"low"})}))})),r.on("postFixer",((t,{listNodes:e,writer:i})=>{for(const{node:o,previousNodeInList:r}of e)if(r){if(r.getAttribute("listType")==o.getAttribute("listType")){const e=Q(r.getAttribute("listType")),l=r.getAttribute(e);!p(o.getAttribute(e),l)&&i.model.schema.checkAttribute(o,e)&&(i.setAttribute(e,l,o),t.return=!0)}if(r.getAttribute("listItemId")==o.getAttribute("listItemId")){const e=r.getAttribute("htmlLiAttributes");!p(o.getAttribute("htmlLiAttributes"),e)&&i.model.schema.checkAttribute(o,"htmlLiAttributes")&&(i.setAttribute("htmlLiAttributes",e,o),t.return=!0)}}})),r.on("postFixer",((t,{listNodes:e,writer:i})=>{for(const{node:o}of e){const e=o.getAttribute("listType");!l.isNumberedListType(e)&&o.getAttribute("htmlOlAttributes")&&(i.removeAttribute("htmlOlAttributes",o),t.return=!0),l.isNumberedListType(e)&&o.getAttribute("htmlUlAttributes")&&(i.removeAttribute("htmlUlAttributes",o),t.return=!0)}}))}afterInit(){const t=this.editor;if(!t.commands.get("indentList"))return;const e=t.commands.get("indentList");this.listenTo(e,"afterExecute",((e,i)=>{t.model.change((e=>{for(const o of i){const i=Q(o.getAttribute("listType"));t.model.schema.checkAttribute(o,i)&&e.setAttribute(i,{},o)}}))}))}}function X(t,e){return(i,o,r)=>{const l=o.viewItem;o.modelRange||Object.assign(o,r.convertChildren(o.viewItem,o.modelCursor));const n=e.processViewAttributes(l,r);for(const e of o.modelRange.getItems({shallow:!0}))e.hasAttribute("listItemId")&&(e.hasAttribute("htmlUlAttributes")||e.hasAttribute("htmlOlAttributes")||r.writer.model.schema.checkAttribute(e,t)&&r.writer.setAttribute(t,n||{},e))}}function Q(t){return"numbered"===t||"customNumbered"==t?"htmlOlAttributes":"htmlUlAttributes"}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Y extends t{static get requires(){return[B,P]}static get pluginName(){return"CustomElementSupport"}init(){const t=this.editor.plugins.get(B),e=this.editor.plugins.get(P);t.on("register:$customElement",((i,o)=>{i.stop();const r=this.editor,l=r.model.schema,n=r.conversion,s=r.editing.view.domConverter.unsafeElements,a=r.data.htmlProcessor.domConverter.preElements;l.register(o.model,o.modelSchema),l.extend(o.model,{allowAttributes:["htmlElementName","htmlCustomElementAttributes","htmlContent"],isContent:!0}),r.data.htmlProcessor.domConverter.registerRawContentMatcher({name:"template"}),n.for("upcast").elementToElement({view:/.*/,model:(i,l)=>{if("$comment"==i.name)return null;if(!function(t){try{document.createElement(t)}catch(t){return!1}return!0}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */(i.name))return null;if(e.getDefinitionsForView(i.name).size)return null;s.includes(i.name)||s.push(i.name),a.includes(i.name)||a.push(i.name);const n=l.writer.createElement(o.model,{htmlElementName:i.name}),c=t.processViewAttributes(i,l);let d;if(c&&l.writer.setAttribute("htmlCustomElementAttributes",c,n),i.is("element","template")&&i.getCustomProperty("$rawContent"))d=i.getCustomProperty("$rawContent");else{const t=new m(i.document).createDocumentFragment(i),e=r.data.htmlProcessor.domConverter.viewToDom(t),o=e.firstChild;for(;o.firstChild;)e.appendChild(o.firstChild);o.remove(),d=r.data.htmlProcessor.htmlWriter.getHtml(e)}l.writer.setAttribute("htmlContent",d,n);for(const{item:t}of r.editing.view.createRangeIn(i))l.consumable.consume(t,{name:!0});return n},converterPriority:"low"}),n.for("editingDowncast").elementToElement({model:{name:o.model,attributes:["htmlElementName","htmlCustomElementAttributes","htmlContent"]},view:(t,{writer:e})=>{const i=t.getAttribute("htmlElementName"),o=e.createRawElement(i);return t.hasAttribute("htmlCustomElementAttributes")&&A(e,t.getAttribute("htmlCustomElementAttributes"),o),o}}),n.for("dataDowncast").elementToElement({model:{name:o.model,attributes:["htmlElementName","htmlCustomElementAttributes","htmlContent"]},view:(t,{writer:e})=>{const i=t.getAttribute("htmlElementName"),o=t.getAttribute("htmlContent"),r=e.createRawElement(i,null,((t,e)=>{e.setContentOf(t,o)}));return t.hasAttribute("htmlCustomElementAttributes")&&A(e,t.getAttribute("htmlCustomElementAttributes"),r),r}})}))}}class J extends t{static get pluginName(){return"GeneralHtmlSupport"}static get requires(){return[B,V,H,L,q,W,U,z,G,K,Y]}init(){const t=this.editor,e=t.plugins.get(B);e.loadAllowedEmptyElementsConfig(t.config.get("htmlSupport.allowEmpty")||[]),e.loadAllowedConfig(t.config.get("htmlSupport.allow")||[]),e.loadDisallowedConfig(t.config.get("htmlSupport.disallow")||[])}getGhsAttributeNameForElement(t){const e=this.editor.plugins.get("DataSchema"),i=Array.from(e.getDefinitionsForView(t,!1)),o=i.find((t=>t.isInline&&!i[0].isObject));return o?o.model:y(t)}addModelHtmlClass(t,i,o){const r=this.editor.model,l=this.getGhsAttributeNameForElement(t);r.change((t=>{for(const n of Z(r,o,l))v(t,n,l,"classes",(t=>{for(const o of e(i))t.add(o)}))}))}removeModelHtmlClass(t,i,o){const r=this.editor.model,l=this.getGhsAttributeNameForElement(t);r.change((t=>{for(const n of Z(r,o,l))v(t,n,l,"classes",(t=>{for(const o of e(i))t.delete(o)}))}))}setModelHtmlAttributes(t,e,i){const o=this.editor.model,r=this.getGhsAttributeNameForElement(t);o.change((t=>{for(const l of Z(o,i,r))v(t,l,r,"attributes",(t=>{for(const[i,o]of Object.entries(e))t.set(i,o)}))}))}removeModelHtmlAttributes(t,i,o){const r=this.editor.model,l=this.getGhsAttributeNameForElement(t);r.change((t=>{for(const n of Z(r,o,l))v(t,n,l,"attributes",(t=>{for(const o of e(i))t.delete(o)}))}))}setModelHtmlStyles(t,e,i){const o=this.editor.model,r=this.getGhsAttributeNameForElement(t);o.change((t=>{for(const l of Z(o,i,r))v(t,l,r,"styles",(t=>{for(const[i,o]of Object.entries(e))t.set(i,o)}))}))}removeModelHtmlStyles(t,i,o){const r=this.editor.model,l=this.getGhsAttributeNameForElement(t);r.change((t=>{for(const n of Z(r,o,l))v(t,n,l,"styles",(t=>{for(const o of e(i))t.delete(o)}))}))}}function*Z(t,e,i){if(e)if(!(Symbol.iterator in e)&&e.is("documentSelection")&&e.isCollapsed)t.schema.checkAttributeInSelection(e,i)&&(yield e);else for(const o of function(t,e,i){return!(Symbol.iterator in e)&&(e.is("node")||e.is("$text")||e.is("$textProxy"))?t.schema.checkAttribute(e,i)?[t.createRangeOn(e)]:[]:t.schema.getValidRanges(t.createSelection(e).getRanges(),i)}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */(t,e,i))yield*o.getItems({shallow:!0})}class tt extends t{static get pluginName(){return"HtmlComment"}init(){const t=this.editor,e=new Map;t.data.processor.skipComments=!1,t.model.schema.addAttributeCheck(((t,e)=>{if(t.endsWith("$root")&&e.startsWith("$comment"))return!0})),t.conversion.for("upcast").elementToMarker({view:"$comment",model:t=>{const i=`$comment:${l()}`,o=t.getCustomProperty("$rawContent");return e.set(i,o),i}}),t.conversion.for("dataDowncast").markerToElement({model:"$comment",view:(t,{writer:e})=>{let i;for(const e of this.editor.model.document.getRootNames())if(i=this.editor.model.document.getRoot(e),i.hasAttribute(t.markerName))break;const o=t.markerName,r=i.getAttribute(o),l=e.createUIElement("$comment");return e.setCustomProperty("$rawContent",r,l),l}}),t.model.document.registerPostFixer((i=>{let o=!1;const r=t.model.document.differ.getChangedMarkers().filter((t=>t.name.startsWith("$comment:")));for(const t of r){const{oldRange:r,newRange:l}=t.data;if(!r||!l||r.root!=l.root){if(r){const e=r.root;e.hasAttribute(t.name)&&(i.removeAttribute(t.name,e),o=!0)}if(l){const r=l.root;"$graveyard"==r.rootName?(i.removeMarker(t.name),o=!0):r.hasAttribute(t.name)||(i.setAttribute(t.name,e.get(t.name)||"",r),o=!0)}}}return o})),t.data.on("set",(()=>{for(const e of t.model.markers.getMarkersGroup("$comment"))this.removeHtmlComment(e.name)}),{priority:"high"}),t.model.on("deleteContent",((e,[i])=>{for(const e of i.getRanges()){const i=t.model.schema.getLimitElement(e),o=t.model.createPositionAt(i,0),r=t.model.createPositionAt(i,"end");let l;l=o.isTouching(e.start)&&r.isTouching(e.end)?this.getHtmlCommentsInRange(t.model.createRange(o,r)):this.getHtmlCommentsInRange(e,{skipBoundaries:!0});for(const t of l)this.removeHtmlComment(t)}}),{priority:"high"})}createHtmlComment(t,e){const i=l(),o=this.editor.model,r=o.document.getRoot(t.root.rootName),n=`$comment:${i}`;return o.change((i=>{const o=i.createRange(t);return i.addMarker(n,{usingOperation:!0,affectsData:!0,range:o}),i.setAttribute(n,e,r),n}))}removeHtmlComment(t){const e=this.editor,i=e.model.markers.get(t);return!!i&&(e.model.change((t=>{t.removeMarker(i)})),!0)}getHtmlCommentData(t){const e=this.editor.model.markers.get(t);if(!e)return null;let i="";for(const e of this.editor.model.document.getRoots())if(e.hasAttribute(t)){i=e.getAttribute(t);break}return{content:i,position:e.getStart()}}getHtmlCommentsInRange(t,{skipBoundaries:e=!1}={}){const i=!e;return Array.from(this.editor.model.markers.getMarkersGroup("$comment")).filter((e=>function(t,e){const o=t.getRange().start;return(o.isAfter(e.start)||i&&o.isEqual(e.start))&&(o.isBefore(e.end)||i&&o.isEqual(e.end))}(e,t))).map((t=>t.name))}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class et extends a{toView(t){if(!/<(?:html|body|head|meta)(?:\s[^>]*)?>/i.test(t.trim().slice(0,1e4)))return super.toView(t);let e="",i="";t=(t=t.trim().replace(/<\?xml\s[^?]*\?>/i,(t=>(i=t,"")))).trim().replace(/^<!DOCTYPE\s[^>]*?>/i,(t=>(e=t,"")));const o=this._toDom(t),r=this.domConverter.domToView(o,{skipComments:this.skipComments}),l=new m(r.document);return l.setCustomProperty("$fullPageDocument",o.ownerDocument.documentElement.outerHTML,r),e&&l.setCustomProperty("$fullPageDocType",e,r),i&&l.setCustomProperty("$fullPageXmlDeclaration",i,r),r}toData(t){let e=super.toData(t);const i=t.getCustomProperty("$fullPageDocument"),o=t.getCustomProperty("$fullPageDocType"),r=t.getCustomProperty("$fullPageXmlDeclaration");return i&&(e=i.replace(/<\/body\s*>/,e+"$&"),o&&(e=o+"\n"+e),r&&(e=r+"\n"+e)),e}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class it extends t{static get pluginName(){return"FullPage"}init(){const t=this.editor,e=["$fullPageDocument","$fullPageDocType","$fullPageXmlDeclaration"];t.data.processor=new et(t.data.viewDocument),t.model.schema.extend("$root",{allowAttributes:e}),t.data.on("toModel",((i,[o])=>{const r=t.model.document.getRoot();t.model.change((t=>{for(const i of e){const e=o.getCustomProperty(i);e&&t.setAttribute(i,e,r)}}))}),{priority:"low"}),t.data.on("toView",((t,[i])=>{if(!i.is("rootElement"))return;const o=i,r=t.return;if(!o.hasAttribute("$fullPageDocument"))return;const l=new m(r.document);for(const t of e){const e=o.getAttribute(t);e&&l.setCustomProperty(t,e,r)}}),{priority:"low"}),t.data.on("set",(()=>{const i=t.model.document.getRoot();t.model.change((t=>{for(const o of e)i.hasAttribute(o)&&t.removeAttribute(o,i)}))}),{priority:"high"}),t.data.on("get",((t,e)=>{e[0]||(e[0]={}),e[0].trim=!1}),{priority:"high"})}}export{B as DataFilter,P as DataSchema,it as FullPage,J as GeneralHtmlSupport,tt as HtmlComment,et as HtmlPageDataProcessor};