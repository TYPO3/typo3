import{Plugin as g}from"@ckeditor/ckeditor5-core";import{toArray as E,priorities as C,CKEditorError as z,isValidAttributeName as K,uid as j}from"@ckeditor/ckeditor5-utils";import{Matcher as V,StylesMap as X,UpcastWriter as B,HtmlDataProcessor as Q}from"@ckeditor/ckeditor5-engine";import{toWidget as N,Widget as Y}from"@ckeditor/ckeditor5-widget";import{startCase as J,cloneDeep as Z,mergeWith as ee,isPlainObject as te,isEqual as M}from"lodash-es";import{Enter as ie}from"@ckeditor/ckeditor5-enter";/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/function A(s,e,r,t){e&&re(s,e,t),r&&p(s,r,t)}function p(s,e,r){if(e.attributes)for(const[t,i]of Object.entries(e.attributes))s.setAttribute(t,i,r);e.styles&&s.setStyle(e.styles,r),e.classes&&s.addClass(e.classes,r)}function re(s,e,r){if(e.attributes)for(const[t]of Object.entries(e.attributes))s.removeAttribute(t,r);if(e.styles)for(const t of Object.keys(e.styles))s.removeStyle(t,r);e.classes&&s.removeClass(e.classes,r)}function oe(s,e){const r=Z(s);let t="attributes";for(t in e)t=="classes"?r[t]=Array.from(new Set([...s[t]||[],...e[t]])):r[t]={...s[t],...e[t]};return r}function y(s,e,r,t,i){const o=e.getAttribute(r),l={};for(const n of["attributes","styles","classes"]){if(n!=t){o&&o[n]&&(l[n]=o[n]);continue}if(t=="classes"){const a=new Set(o&&o.classes||[]);i(a),a.size&&(l[n]=Array.from(a));continue}const m=new Map(Object.entries(o&&o[n]||{}));i(m),m.size&&(l[n]=Object.fromEntries(m))}Object.keys(l).length?e.is("documentSelection")?s.setSelectionAttribute(r,l):s.setAttribute(r,l,e):o&&(e.is("documentSelection")?s.removeSelectionAttribute(r):s.removeAttribute(r,e))}function le(s){return J(s).replace(/ /g,"")}function b(s){return`html${le(s)}Attributes`}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/function D({model:s}){return(e,r)=>r.writer.createElement(s,{htmlContent:e.getCustomProperty("$rawContent")})}function ne(s,{view:e,isInline:r}){const t=s.t;return(i,{writer:o})=>{const l=t("HTML object"),n=T(e,i,o),m=i.getAttribute(b(e));o.addClass("html-object-embed__content",n),m&&p(o,m,n);const a=o.createContainerElement(r?"span":"div",{class:"html-object-embed","data-html-object-embed-label":l},n);return N(a,o,{label:l})}}function T(s,e,r){return r.createRawElement(s,null,(t,i)=>{i.setContentOf(t,e.getAttribute("htmlContent"))})}function se({view:s,model:e,allowEmpty:r},t){return o=>{o.on(`element:${s}`,(l,n,m)=>{let a=t.processViewAttributes(n.viewItem,m);if(!(!a&&!m.consumable.test(n.viewItem,{name:!0}))){if(a=a||{},m.consumable.consume(n.viewItem,{name:!0}),n.modelRange||(n=Object.assign(n,m.convertChildren(n.viewItem,n.modelCursor))),r&&n.modelRange.isCollapsed&&Object.keys(a).length){const u=m.writer.createElement("htmlEmptyElement");if(!m.safeInsert(u,n.modelCursor))return;const c=m.getSplitParts(u);n.modelRange=m.writer.createRange(n.modelRange.start,m.writer.createPositionAfter(c[c.length-1])),m.updateConversionResult(u,n),i(u,a,m);return}for(const u of n.modelRange.getItems())i(u,a,m)}},{priority:"low"})};function i(o,l,n){if(n.schema.checkAttribute(o,e)){const m=o.getAttribute(e),a=oe(l,m||{});n.writer.setAttribute(e,a,o)}}}function H({model:s,view:e},r){return(t,{writer:i,consumable:o})=>{if(!t.hasAttribute(s))return null;const l=i.createContainerElement(e),n=t.getAttribute(s);return o.consume(t,`attribute:${s}`),p(i,n,l),l.getFillerOffset=()=>null,r?N(l,i):l}}function me({priority:s,view:e}){return(r,t)=>{if(!r)return;const{writer:i}=t,o=i.createAttributeElement(e,null,{priority:s});return p(i,r,o),o}}function S({view:s},e){return r=>{r.on(`element:${s}`,(t,i,o)=>{if(!i.modelRange||i.modelRange.isCollapsed)return;const l=e.processViewAttributes(i.viewItem,o);l&&o.writer.setAttribute(b(i.viewItem.name),l,i.modelRange)},{priority:"low"})}}function F({view:s,model:e}){return r=>{r.on(`attribute:${b(s)}:${e}`,(t,i,o)=>{if(!o.consumable.consume(i.item,t.name))return;const{attributeOldValue:l,attributeNewValue:n}=i,m=o.writer,a=o.mapper.toViewElement(i.item);A(m,l,n,a)})}}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/var L={block:[{model:"codeBlock",view:"pre"},{model:"paragraph",view:"p"},{model:"blockQuote",view:"blockquote"},{model:"listItem",view:"li"},{model:"pageBreak",view:"div"},{model:"rawHtml",view:"div"},{model:"table",view:"table"},{model:"tableRow",view:"tr"},{model:"tableCell",view:"td"},{model:"tableCell",view:"th"},{model:"tableColumnGroup",view:"colgroup"},{model:"tableColumn",view:"col"},{model:"caption",view:"caption"},{model:"caption",view:"figcaption"},{model:"imageBlock",view:"img"},{model:"imageInline",view:"img"},{model:"htmlP",view:"p",modelSchema:{inheritAllFrom:"$block"}},{model:"htmlBlockquote",view:"blockquote",modelSchema:{inheritAllFrom:"$container"}},{model:"htmlTable",view:"table",modelSchema:{allowWhere:"$block",isBlock:!0}},{model:"htmlTbody",view:"tbody",modelSchema:{allowIn:"htmlTable",isBlock:!1}},{model:"htmlThead",view:"thead",modelSchema:{allowIn:"htmlTable",isBlock:!1}},{model:"htmlTfoot",view:"tfoot",modelSchema:{allowIn:"htmlTable",isBlock:!1}},{model:"htmlCaption",view:"caption",modelSchema:{allowIn:"htmlTable",allowChildren:"$text",isBlock:!1}},{model:"htmlColgroup",view:"colgroup",modelSchema:{allowIn:"htmlTable",allowChildren:"col",isBlock:!1}},{model:"htmlCol",view:"col",modelSchema:{allowIn:"htmlColgroup",isBlock:!1}},{model:"htmlTr",view:"tr",modelSchema:{allowIn:["htmlTable","htmlThead","htmlTbody"],isLimit:!0}},{model:"htmlTd",view:"td",modelSchema:{allowIn:"htmlTr",allowContentOf:"$container",isLimit:!0,isBlock:!1}},{model:"htmlTh",view:"th",modelSchema:{allowIn:"htmlTr",allowContentOf:"$container",isLimit:!0,isBlock:!1}},{model:"htmlFigure",view:"figure",modelSchema:{inheritAllFrom:"$container",isBlock:!1}},{model:"htmlFigcaption",view:"figcaption",modelSchema:{allowIn:"htmlFigure",allowChildren:"$text",isBlock:!1}},{model:"htmlAddress",view:"address",modelSchema:{inheritAllFrom:"$container",isBlock:!1}},{model:"htmlAside",view:"aside",modelSchema:{inheritAllFrom:"$container",isBlock:!1}},{model:"htmlMain",view:"main",modelSchema:{inheritAllFrom:"$container",isBlock:!1}},{model:"htmlDetails",view:"details",modelSchema:{inheritAllFrom:"$container",isBlock:!1}},{model:"htmlSummary",view:"summary",modelSchema:{allowChildren:["htmlH1","htmlH2","htmlH3","htmlH4","htmlH5","htmlH6","$text"],allowIn:"htmlDetails",isBlock:!1}},{model:"htmlDiv",view:"div",paragraphLikeModel:"htmlDivParagraph",modelSchema:{inheritAllFrom:"$container"}},{model:"htmlFieldset",view:"fieldset",modelSchema:{inheritAllFrom:"$container",isBlock:!1}},{model:"htmlLegend",view:"legend",modelSchema:{allowIn:"htmlFieldset",allowChildren:"$text"}},{model:"htmlHeader",view:"header",modelSchema:{inheritAllFrom:"$container",isBlock:!1}},{model:"htmlFooter",view:"footer",modelSchema:{inheritAllFrom:"$container",isBlock:!1}},{model:"htmlForm",view:"form",modelSchema:{inheritAllFrom:"$container",isBlock:!0}},{model:"htmlHgroup",view:"hgroup",modelSchema:{allowIn:["$root","$container"],allowChildren:["paragraph","htmlP","htmlH1","htmlH2","htmlH3","htmlH4","htmlH5","htmlH6"],isBlock:!1}},{model:"htmlH1",view:"h1",modelSchema:{inheritAllFrom:"$block"}},{model:"htmlH2",view:"h2",modelSchema:{inheritAllFrom:"$block"}},{model:"htmlH3",view:"h3",modelSchema:{inheritAllFrom:"$block"}},{model:"htmlH4",view:"h4",modelSchema:{inheritAllFrom:"$block"}},{model:"htmlH5",view:"h5",modelSchema:{inheritAllFrom:"$block"}},{model:"htmlH6",view:"h6",modelSchema:{inheritAllFrom:"$block"}},{model:"$htmlList",modelSchema:{allowWhere:"$container",allowChildren:["$htmlList","htmlLi"],isBlock:!1}},{model:"htmlDir",view:"dir",modelSchema:{inheritAllFrom:"$htmlList"}},{model:"htmlMenu",view:"menu",modelSchema:{inheritAllFrom:"$htmlList"}},{model:"htmlUl",view:"ul",modelSchema:{inheritAllFrom:"$htmlList"}},{model:"htmlOl",view:"ol",modelSchema:{inheritAllFrom:"$htmlList"}},{model:"htmlLi",view:"li",modelSchema:{allowIn:"$htmlList",allowChildren:"$text",isBlock:!1}},{model:"htmlPre",view:"pre",modelSchema:{inheritAllFrom:"$block"}},{model:"htmlArticle",view:"article",modelSchema:{inheritAllFrom:"$container",isBlock:!1}},{model:"htmlSection",view:"section",modelSchema:{inheritAllFrom:"$container",isBlock:!1}},{model:"htmlNav",view:"nav",modelSchema:{inheritAllFrom:"$container",isBlock:!1}},{model:"htmlDivDl",view:"div",modelSchema:{allowChildren:["htmlDt","htmlDd"],allowIn:"htmlDl"}},{model:"htmlDl",view:"dl",modelSchema:{allowWhere:"$container",allowChildren:["htmlDt","htmlDd","htmlDivDl"],isBlock:!1}},{model:"htmlDt",view:"dt",modelSchema:{allowChildren:"$block",isBlock:!1}},{model:"htmlDd",view:"dd",modelSchema:{allowChildren:"$block",isBlock:!1}},{model:"htmlCenter",view:"center",modelSchema:{inheritAllFrom:"$container",isBlock:!1}}],inline:[{model:"htmlLiAttributes",view:"li",appliesToBlock:!0,coupledAttribute:"listItemId"},{model:"htmlOlAttributes",view:"ol",appliesToBlock:!0,coupledAttribute:"listItemId"},{model:"htmlUlAttributes",view:"ul",appliesToBlock:!0,coupledAttribute:"listItemId"},{model:"htmlFigureAttributes",view:"figure",appliesToBlock:"table"},{model:"htmlTheadAttributes",view:"thead",appliesToBlock:"table"},{model:"htmlTbodyAttributes",view:"tbody",appliesToBlock:"table"},{model:"htmlFigureAttributes",view:"figure",appliesToBlock:"imageBlock"},{model:"htmlAcronym",view:"acronym",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlTt",view:"tt",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlFont",view:"font",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlTime",view:"time",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlVar",view:"var",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlBig",view:"big",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlSmall",view:"small",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlSamp",view:"samp",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlQ",view:"q",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlOutput",view:"output",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlKbd",view:"kbd",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlBdi",view:"bdi",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlBdo",view:"bdo",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlAbbr",view:"abbr",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlA",view:"a",priority:5,coupledAttribute:"linkHref"},{model:"htmlStrong",view:"strong",coupledAttribute:"bold",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlB",view:"b",coupledAttribute:"bold",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlI",view:"i",coupledAttribute:"italic",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlEm",view:"em",coupledAttribute:"italic",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlS",view:"s",coupledAttribute:"strikethrough",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlDel",view:"del",coupledAttribute:"strikethrough",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlIns",view:"ins",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlU",view:"u",coupledAttribute:"underline",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlSub",view:"sub",coupledAttribute:"subscript",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlSup",view:"sup",coupledAttribute:"superscript",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlCode",view:"code",coupledAttribute:"code",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlMark",view:"mark",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlSpan",view:"span",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlCite",view:"cite",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlLabel",view:"label",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlDfn",view:"dfn",attributeProperties:{copyOnEnter:!0,isFormatting:!0}},{model:"htmlObject",view:"object",isObject:!0,modelSchema:{inheritAllFrom:"$inlineObject"}},{model:"htmlIframe",view:"iframe",isObject:!0,modelSchema:{inheritAllFrom:"$inlineObject"}},{model:"htmlInput",view:"input",isObject:!0,modelSchema:{inheritAllFrom:"$inlineObject"}},{model:"htmlButton",view:"button",isObject:!0,modelSchema:{inheritAllFrom:"$inlineObject"}},{model:"htmlTextarea",view:"textarea",isObject:!0,modelSchema:{inheritAllFrom:"$inlineObject"}},{model:"htmlSelect",view:"select",isObject:!0,modelSchema:{inheritAllFrom:"$inlineObject"}},{model:"htmlVideo",view:"video",isObject:!0,modelSchema:{inheritAllFrom:"$inlineObject"}},{model:"htmlEmbed",view:"embed",isObject:!0,modelSchema:{inheritAllFrom:"$inlineObject"}},{model:"htmlOembed",view:"oembed",isObject:!0,modelSchema:{inheritAllFrom:"$inlineObject"}},{model:"htmlAudio",view:"audio",isObject:!0,modelSchema:{inheritAllFrom:"$inlineObject"}},{model:"htmlImg",view:"img",isObject:!0,modelSchema:{inheritAllFrom:"$inlineObject"}},{model:"htmlCanvas",view:"canvas",isObject:!0,modelSchema:{inheritAllFrom:"$inlineObject"}},{model:"htmlMeter",view:"meter",isObject:!0,modelSchema:{inheritAllFrom:"$inlineObject"}},{model:"htmlProgress",view:"progress",isObject:!0,modelSchema:{inheritAllFrom:"$inlineObject"}},{model:"htmlScript",view:"script",modelSchema:{allowWhere:["$text","$block"],isInline:!0}},{model:"htmlStyle",view:"style",modelSchema:{allowWhere:["$text","$block"],isInline:!0}},{model:"htmlCustomElement",view:"$customElement",modelSchema:{allowWhere:["$text","$block"],allowAttributesOf:"$inlineObject",isInline:!0}}]};/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class v extends g{constructor(){super(...arguments),this._definitions=[]}static get pluginName(){return"DataSchema"}static get isOfficialPlugin(){return!0}init(){for(const e of L.block)this.registerBlockElement(e);for(const e of L.inline)this.registerInlineElement(e)}registerBlockElement(e){this._definitions.push({...e,isBlock:!0})}registerInlineElement(e){this._definitions.push({...e,isInline:!0})}extendBlockElement(e){this._extendDefinition({...e,isBlock:!0})}extendInlineElement(e){this._extendDefinition({...e,isInline:!0})}getDefinitionsForView(e,r=!1){const t=new Set;for(const i of this._getMatchingViewDefinitions(e)){if(r)for(const o of this._getReferences(i.model))t.add(o);t.add(i)}return t}getDefinitionsForModel(e){return this._definitions.filter(r=>r.model==e)}_getMatchingViewDefinitions(e){return this._definitions.filter(r=>r.view&&ae(e,r.view))}*_getReferences(e){const r=["inheritAllFrom","inheritTypesFrom","allowWhere","allowContentOf","allowAttributesOf"],t=this._definitions.filter(i=>i.model==e);for(const{modelSchema:i}of t)if(i)for(const o of r)for(const l of E(i[o]||[])){const n=this._definitions.filter(m=>m.model==l);for(const m of n)l!==e&&(yield*this._getReferences(m.model),yield m)}}_extendDefinition(e){const r=Array.from(this._definitions.entries()).filter(([,t])=>t.model==e.model);if(r.length==0){this._definitions.push(e);return}for(const[t,i]of r)this._definitions[t]=ee({},i,e,(o,l)=>Array.isArray(o)?o.concat(l):void 0)}}function ae(s,e){return typeof s=="string"?s===e:s instanceof RegExp?s.test(e):!1}function ue(s,{insertAt:e}={}){if(typeof document>"u")return;const r=document.head||document.getElementsByTagName("head")[0],t=document.createElement("style");t.type="text/css",window.litNonce&&t.setAttribute("nonce",window.litNonce),e==="top"&&r.firstChild?r.insertBefore(t,r.firstChild):r.appendChild(t),t.styleSheet?t.styleSheet.cssText=s:t.appendChild(document.createTextNode(s))}ue(":root{--ck-html-object-embed-unfocused-outline-width:1px}.ck-widget.html-object-embed{background-color:var(--ck-color-base-foreground);font-size:var(--ck-font-size-base);min-width:calc(76px + var(--ck-spacing-standard));padding:var(--ck-spacing-small);padding-top:calc(var(--ck-font-size-tiny) + var(--ck-spacing-large))}.ck-widget.html-object-embed:not(.ck-widget_selected):not(:hover){outline:var(--ck-html-object-embed-unfocused-outline-width) dashed var(--ck-color-widget-blurred-border)}.ck-widget.html-object-embed:before{background:#999;border-radius:0 0 var(--ck-border-radius) var(--ck-border-radius);color:var(--ck-color-base-background);content:attr(data-html-object-embed-label);font-family:var(--ck-font-face);font-size:var(--ck-font-size-tiny);font-style:normal;font-weight:400;left:var(--ck-spacing-standard);padding:calc(var(--ck-spacing-tiny) + var(--ck-html-object-embed-unfocused-outline-width)) var(--ck-spacing-small) var(--ck-spacing-tiny);position:absolute;top:0;transition:background var(--ck-widget-handler-animation-duration) var(--ck-widget-handler-animation-curve)}.ck-widget.html-object-embed .ck-widget__type-around .ck-widget__type-around__button.ck-widget__type-around__button_before{margin-left:50px}.ck-widget.html-object-embed .html-object-embed__content{pointer-events:none}div.ck-widget.html-object-embed{margin:1em auto}span.ck-widget.html-object-embed{display:inline-block}");/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class d extends g{constructor(e){super(e),this._dataSchema=e.plugins.get("DataSchema"),this._allowedAttributes=new V,this._disallowedAttributes=new V,this._allowedElements=new Set,this._disallowedElements=new Set,this._dataInitialized=!1,this._coupledAttributes=null,this._registerElementsAfterInit(),this._registerElementHandlers(),this._registerCoupledAttributesPostFixer(),this._registerAssociatedHtmlAttributesPostFixer()}static get pluginName(){return"DataFilter"}static get isOfficialPlugin(){return!0}static get requires(){return[v,Y]}loadAllowedConfig(e){for(const r of e){const t=r.name||/[\s\S]+/,i=U(r);this.allowElement(t),i.forEach(o=>this.allowAttributes(o))}}loadDisallowedConfig(e){for(const r of e){const t=r.name||/[\s\S]+/,i=U(r);i.length==0?this.disallowElement(t):i.forEach(o=>this.disallowAttributes(o))}}loadAllowedEmptyElementsConfig(e){for(const r of e)this.allowEmptyElement(r)}allowElement(e){for(const r of this._dataSchema.getDefinitionsForView(e,!0))this._addAllowedElement(r),this._coupledAttributes=null}disallowElement(e){for(const r of this._dataSchema.getDefinitionsForView(e,!1))this._disallowedElements.add(r.view)}allowEmptyElement(e){for(const r of this._dataSchema.getDefinitionsForView(e,!0))r.isInline&&this._dataSchema.extendInlineElement({...r,allowEmpty:!0})}allowAttributes(e){this._allowedAttributes.add(e)}disallowAttributes(e){this._disallowedAttributes.add(e)}processViewAttributes(e,r){const{consumable:t}=r;return W(e,this._disallowedAttributes,t),ce(e,W(e,this._allowedAttributes,t))}_addAllowedElement(e){if(!this._allowedElements.has(e)){if(this._allowedElements.add(e),"appliesToBlock"in e&&typeof e.appliesToBlock=="string")for(const r of this._dataSchema.getDefinitionsForModel(e.appliesToBlock))r.isBlock&&this._addAllowedElement(r);this._dataInitialized&&this.editor.data.once("set",()=>{this._fireRegisterEvent(e)},{priority:C.highest+1})}}_registerElementsAfterInit(){this.editor.data.on("init",()=>{this._dataInitialized=!0;for(const e of this._allowedElements)this._fireRegisterEvent(e)},{priority:C.highest+1})}_registerElementHandlers(){this.on("register",(e,r)=>{const t=this.editor.model.schema;if(r.isObject&&!t.isRegistered(r.model))this._registerObjectElement(r);else if(r.isBlock)this._registerBlockElement(r);else if(r.isInline)this._registerInlineElement(r);else throw new z("data-filter-invalid-definition",null,r);e.stop()},{priority:"lowest"})}_registerCoupledAttributesPostFixer(){const e=this.editor.model,r=e.document.selection;e.document.registerPostFixer(t=>{const i=e.document.differ.getChanges();let o=!1;const l=this._getCoupledAttributesMap();for(const n of i){if(n.type!="attribute"||n.attributeNewValue!==null)continue;const m=l.get(n.attributeKey);if(m)for(const{item:a}of n.range.getWalker())for(const u of m)a.hasAttribute(u)&&(t.removeAttribute(u,a),o=!0)}return o}),this.listenTo(r,"change:attribute",(t,{attributeKeys:i})=>{const o=new Set,l=this._getCoupledAttributesMap();for(const n of i){if(r.hasAttribute(n))continue;const m=l.get(n);if(m)for(const a of m)r.hasAttribute(a)&&o.add(a)}o.size!=0&&e.change(n=>{for(const m of o)n.removeSelectionAttribute(m)})})}_registerAssociatedHtmlAttributesPostFixer(){const e=this.editor.model;e.document.registerPostFixer(r=>{const t=e.document.differ.getChanges();let i=!1;for(const o of t)if(!(o.type!=="insert"||o.name==="$text"))for(const l of o.attributes.keys())!l.startsWith("html")||!l.endsWith("Attributes")||e.schema.checkAttribute(o.name,l)||(r.removeAttribute(l,o.position.nodeAfter),i=!0);return i})}_getCoupledAttributesMap(){if(this._coupledAttributes)return this._coupledAttributes;this._coupledAttributes=new Map;for(const e of this._allowedElements)if(e.coupledAttribute&&e.model){const r=this._coupledAttributes.get(e.coupledAttribute);r?r.push(e.model):this._coupledAttributes.set(e.coupledAttribute,[e.model])}return this._coupledAttributes}_fireRegisterEvent(e){e.view&&this._disallowedElements.has(e.view)||this.fire(e.view?`register:${e.view}`:"register",e)}_registerObjectElement(e){const r=this.editor,t=r.model.schema,i=r.conversion,{view:o,model:l}=e;t.register(l,e.modelSchema);/* istanbul ignore next: paranoid check -- @preserve */o&&(t.extend(e.model,{allowAttributes:[b(o),"htmlContent"]}),r.data.registerRawContentMatcher({name:o}),i.for("upcast").elementToElement({view:o,model:D(e),converterPriority:C.low+2}),i.for("upcast").add(S(e,this)),i.for("editingDowncast").elementToStructure({model:{name:l,attributes:[b(o)]},view:ne(r,e)}),i.for("dataDowncast").elementToElement({model:l,view:(n,{writer:m})=>T(o,n,m)}),i.for("dataDowncast").add(F(e)))}_registerBlockElement(e){const r=this.editor,t=r.model.schema,i=r.conversion,{view:o,model:l}=e;if(!t.isRegistered(e.model)){if(t.register(e.model,e.modelSchema),!o)return;i.for("upcast").elementToElement({model:l,view:o,converterPriority:C.low+2}),i.for("downcast").elementToElement({model:l,view:o})}o&&(t.extend(e.model,{allowAttributes:b(o)}),i.for("upcast").add(S(e,this)),i.for("downcast").add(F(e)))}_registerInlineElement(e){const r=this.editor,t=r.model.schema,i=r.conversion,o=e.model;e.appliesToBlock||(t.extend("$text",{allowAttributes:o}),e.attributeProperties&&t.setAttributeProperties(o,e.attributeProperties),i.for("upcast").add(se(e,this)),i.for("downcast").attributeToElement({model:o,view:me(e)}),e.allowEmpty&&(t.setAttributeProperties(o,{copyFromObject:!1}),t.isRegistered("htmlEmptyElement")||t.register("htmlEmptyElement",{inheritAllFrom:"$inlineObject"}),r.data.htmlProcessor.domConverter.registerInlineObjectMatcher(l=>l.name==e.view&&l.isEmpty&&Array.from(l.getAttributeKeys()).length?{name:!0}:null),i.for("editingDowncast").elementToElement({model:"htmlEmptyElement",view:H(e,!0)}),i.for("dataDowncast").elementToElement({model:"htmlEmptyElement",view:H(e)})))}}function W(s,e,r){const t=e.matchAll(s)||[],i=s.document.stylesProcessor;return t.reduce((o,{match:l})=>{for(const n of l.styles||[]){const m=i.getRelatedStyles(n).filter(a=>a.split("-").length>n.split("-").length).sort((a,u)=>u.split("-").length-a.split("-").length);for(const a of m)r.consume(s,{styles:[a]})&&o.styles.push(a);r.consume(s,{styles:[n]})&&o.styles.push(n)}for(const n of l.classes||[])r.consume(s,{classes:[n]})&&o.classes.push(n);for(const n of l.attributes||[])r.consume(s,{attributes:[n]})&&o.attributes.push(n);return o},{attributes:[],classes:[],styles:[]})}function ce(s,{attributes:e,classes:r,styles:t}){return!e.length&&!r.length&&!t.length?null:{...e.length&&{attributes:de(s,e)},...t.length&&{styles:he(s,t)},...r.length&&{classes:r}}}function de(s,e){const r={};for(const t of e){const i=s.getAttribute(t);i!==void 0&&K(t)&&(r[t]=i)}return r}function he(s,e){const r=new X(s.document.stylesProcessor);for(const t of e){const i=s.getStyle(t);i!==void 0&&r.set(t,i)}return Object.fromEntries(r.getStylesEntries())}function R(s,e){const{name:r}=s,t=s[e];return te(t)?Object.entries(t).map(([i,o])=>({name:r,[e]:{[i]:o}})):Array.isArray(t)?t.map(i=>({name:r,[e]:[i]})):[s]}function U(s){const{name:e,attributes:r,classes:t,styles:i}=s,o=[];return r&&o.push(...R({name:e,attributes:r},"attributes")),t&&o.push(...R({name:e,classes:t},"classes")),i&&o.push(...R({name:e,styles:i},"styles")),o}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class fe extends g{static get requires(){return[d]}static get pluginName(){return"CodeBlockElementSupport"}static get isOfficialPlugin(){return!0}init(){if(!this.editor.plugins.has("CodeBlockEditing"))return;const e=this.editor.plugins.get(d);e.on("register:pre",(r,t)=>{if(t.model!=="codeBlock")return;const i=this.editor,o=i.model.schema,l=i.conversion;o.extend("codeBlock",{allowAttributes:["htmlPreAttributes","htmlContentAttributes"]}),l.for("upcast").add(ge(e)),l.for("downcast").add(be()),r.stop()})}}function ge(s){return e=>{e.on("element:code",(r,t,i)=>{const o=t.viewItem,l=o.parent;if(!l||!l.is("element","pre"))return;n(l,"htmlPreAttributes"),n(o,"htmlContentAttributes");function n(m,a){const u=s.processViewAttributes(m,i);u&&i.writer.setAttribute(a,u,t.modelRange)}},{priority:"low"})}}function be(){return s=>{s.on("attribute:htmlPreAttributes:codeBlock",(e,r,t)=>{if(!t.consumable.consume(r.item,e.name))return;const{attributeOldValue:i,attributeNewValue:o}=r,n=t.mapper.toViewElement(r.item).parent;A(t.writer,i,o,n)}),s.on("attribute:htmlContentAttributes:codeBlock",(e,r,t)=>{if(!t.consumable.consume(r.item,e.name))return;const{attributeOldValue:i,attributeNewValue:o}=r,l=t.mapper.toViewElement(r.item);A(t.writer,i,o,l)})}}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class pe extends g{static get requires(){return[d]}static get pluginName(){return"DualContentModelElementSupport"}static get isOfficialPlugin(){return!0}init(){this.editor.plugins.get(d).on("register",(r,t)=>{const i=t,o=this.editor,l=o.model.schema,n=o.conversion;if(!i.paragraphLikeModel||l.isRegistered(i.model)||l.isRegistered(i.paragraphLikeModel))return;const m={model:i.paragraphLikeModel,view:i.view};l.register(i.model,i.modelSchema),l.register(m.model,{inheritAllFrom:"$block"}),n.for("upcast").elementToElement({view:i.view,model:(a,{writer:u})=>this._hasBlockContent(a)?u.createElement(i.model):u.createElement(m.model),converterPriority:C.low+.5}),n.for("downcast").elementToElement({view:i.view,model:i.model}),this._addAttributeConversion(i),n.for("downcast").elementToElement({view:m.view,model:m.model}),this._addAttributeConversion(m),r.stop()})}_hasBlockContent(e){const r=this.editor.editing.view,t=r.domConverter.blockElements;for(const i of r.createRangeIn(e).getItems())if(i.is("element")&&t.includes(i.name))return!0;return!1}_addAttributeConversion(e){const r=this.editor,t=r.conversion,i=r.plugins.get(d);r.model.schema.extend(e.model,{allowAttributes:b(e.view)}),t.for("upcast").add(S(e,i)),t.for("downcast").add(F(e))}}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class we extends g{static get requires(){return[v,ie]}static get pluginName(){return"HeadingElementSupport"}static get isOfficialPlugin(){return!0}init(){const e=this.editor;if(!e.plugins.has("HeadingEditing"))return;const r=e.config.get("heading.options");this.registerHeadingElements(e,r)}registerHeadingElements(e,r){const t=e.plugins.get(v),i=[];for(const o of r)"model"in o&&"view"in o&&(t.registerBlockElement({view:o.view,model:o.model}),i.push(o.model));t.extendBlockElement({model:"htmlHgroup",modelSchema:{allowChildren:i}}),t.extendBlockElement({model:"htmlSummary",modelSchema:{allowChildren:i}})}}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/function P(s,e,r){const t=s.createRangeOn(e);for(const{item:i}of t.getWalker())if(i.is("element",r))return i}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class Ae extends g{static get requires(){return[d]}static get pluginName(){return"ImageElementSupport"}static get isOfficialPlugin(){return!0}init(){const e=this.editor;if(!e.plugins.has("ImageInlineEditing")&&!e.plugins.has("ImageBlockEditing"))return;const r=e.model.schema,t=e.conversion,i=e.plugins.get(d);i.on("register:figure",()=>{t.for("upcast").add(ke(i))}),i.on("register:img",(o,l)=>{l.model!=="imageBlock"&&l.model!=="imageInline"||(r.isRegistered("imageBlock")&&r.extend("imageBlock",{allowAttributes:["htmlImgAttributes","htmlFigureAttributes","htmlLinkAttributes"]}),r.isRegistered("imageInline")&&r.extend("imageInline",{allowAttributes:["htmlA","htmlImgAttributes"]}),t.for("upcast").add(ve(i)),t.for("downcast").add(Ee()),e.plugins.has("LinkImage")&&t.for("upcast").add(ye(i,e)),o.stop())})}}function ve(s){return e=>{e.on("element:img",(r,t,i)=>{if(!t.modelRange)return;const o=t.viewItem,l=s.processViewAttributes(o,i);l&&i.writer.setAttribute("htmlImgAttributes",l,t.modelRange)},{priority:"low"})}}function ye(s,e){const r=e.plugins.get("ImageUtils");return t=>{t.on("element:a",(i,o,l)=>{const n=o.viewItem;if(!r.findViewImgElement(n))return;const a=o.modelCursor.parent;if(!a.is("element","imageBlock"))return;const u=s.processViewAttributes(n,l);u&&l.writer.setAttribute("htmlLinkAttributes",u,a)},{priority:"low"})}}function ke(s){return e=>{e.on("element:figure",(r,t,i)=>{const o=t.viewItem;if(!t.modelRange||!o.hasClass("image"))return;const l=s.processViewAttributes(o,i);l&&i.writer.setAttribute("htmlFigureAttributes",l,t.modelRange)},{priority:"low"})}}function Ee(){return s=>{e("htmlImgAttributes"),r("img","htmlImgAttributes"),r("figure","htmlFigureAttributes"),r("a","htmlLinkAttributes");function e(t){s.on(`attribute:${t}:imageInline`,(i,o,l)=>{if(!l.consumable.consume(o.item,i.name))return;const{attributeOldValue:n,attributeNewValue:m}=o,a=l.mapper.toViewElement(o.item);A(l.writer,n,m,a)},{priority:"low"})}function r(t,i){s.on(`attribute:${i}:imageBlock`,(o,l,n)=>{if(!n.consumable.test(l.item,o.name))return;const{attributeOldValue:m,attributeNewValue:a}=l,u=n.mapper.toViewElement(l.item),c=P(n.writer,u,t);c&&(A(n.writer,m,a,c),n.consumable.consume(l.item,o.name))},{priority:"low"}),t==="a"&&s.on("attribute:linkHref:imageBlock",(o,l,n)=>{if(!n.consumable.consume(l.item,"attribute:htmlLinkAttributes:imageBlock"))return;const m=n.mapper.toViewElement(l.item),a=P(n.writer,m,"a");p(n.writer,l.item.getAttribute("htmlLinkAttributes"),a)},{priority:"low"})}}}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class Ce extends g{static get requires(){return[d]}static get pluginName(){return"MediaEmbedElementSupport"}static get isOfficialPlugin(){return!0}init(){const e=this.editor;if(!e.plugins.has("MediaEmbed")||e.config.get("mediaEmbed.previewsInData"))return;const r=e.model.schema,t=e.conversion,i=this.editor.plugins.get(d),o=this.editor.plugins.get(v),l=e.config.get("mediaEmbed.elementName");o.registerBlockElement({model:"media",view:l}),i.on("register:figure",()=>{t.for("upcast").add(Fe(i))}),i.on(`register:${l}`,(n,m)=>{m.model==="media"&&(r.extend("media",{allowAttributes:[b(l),"htmlFigureAttributes"]}),t.for("upcast").add(Se(i,l)),t.for("dataDowncast").add(Oe(l)),n.stop())})}}function Se(s,e){const r=(t,i,o)=>{const l=i.viewItem;n(l,b(e));function n(m,a){const u=s.processViewAttributes(m,o);u&&o.writer.setAttribute(a,u,i.modelRange)}};return t=>{t.on(`element:${e}`,r,{priority:"low"})}}function Fe(s){return e=>{e.on("element:figure",(r,t,i)=>{const o=t.viewItem;if(!t.modelRange||!o.hasClass("media"))return;const l=s.processViewAttributes(o,i);l&&i.writer.setAttribute("htmlFigureAttributes",l,t.modelRange)},{priority:"low"})}}function Oe(s){return e=>{r(s,b(s)),r("figure","htmlFigureAttributes");function r(t,i){e.on(`attribute:${i}:media`,(o,l,n)=>{if(!n.consumable.consume(l.item,o.name))return;const{attributeOldValue:m,attributeNewValue:a}=l,u=n.mapper.toViewElement(l.item),c=P(n.writer,u,t);A(n.writer,m,a,c)})}}}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class Te extends g{static get requires(){return[d]}static get pluginName(){return"ScriptElementSupport"}static get isOfficialPlugin(){return!0}init(){const e=this.editor.plugins.get(d);e.on("register:script",(r,t)=>{const i=this.editor,o=i.model.schema,l=i.conversion;o.register("htmlScript",t.modelSchema),o.extend("htmlScript",{allowAttributes:["htmlScriptAttributes","htmlContent"],isContent:!0}),i.data.registerRawContentMatcher({name:"script"}),l.for("upcast").elementToElement({view:"script",model:D(t)}),l.for("upcast").add(S(t,e)),l.for("downcast").elementToElement({model:"htmlScript",view:(n,{writer:m})=>T("script",n,m)}),l.for("downcast").add(F(t)),r.stop()})}}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class Pe extends g{static get requires(){return[d]}static get pluginName(){return"TableElementSupport"}static get isOfficialPlugin(){return!0}init(){const e=this.editor;if(!e.plugins.has("TableEditing"))return;const r=e.model.schema,t=e.conversion,i=e.plugins.get(d),o=e.plugins.get("TableUtils");i.on("register:figure",()=>{t.for("upcast").add(_e(i))}),i.on("register:table",(l,n)=>{n.model==="table"&&(r.extend("table",{allowAttributes:["htmlTableAttributes","htmlFigureAttributes","htmlTheadAttributes","htmlTbodyAttributes"]}),t.for("upcast").add(Ie(i)),t.for("downcast").add(Be()),e.model.document.registerPostFixer($e(e.model,o)),l.stop())})}}function $e(s,e){return r=>{const t=s.document.differ.getChanges();let i=!1;for(const o of t){if(o.type!="attribute"||o.attributeKey!="headingRows")continue;const l=o.range.start.nodeAfter,n=l.getAttribute("htmlTheadAttributes"),m=l.getAttribute("htmlTbodyAttributes");n&&!o.attributeNewValue?(r.removeAttribute("htmlTheadAttributes",l),i=!0):m&&o.attributeNewValue==e.getRows(l)&&(r.removeAttribute("htmlTbodyAttributes",l),i=!0)}return i}}function Ie(s){return e=>{e.on("element:table",(r,t,i)=>{if(!t.modelRange)return;const o=t.viewItem;l(o,"htmlTableAttributes");for(const n of o.getChildren())n.is("element","thead")&&l(n,"htmlTheadAttributes"),n.is("element","tbody")&&l(n,"htmlTbodyAttributes");function l(n,m){const a=s.processViewAttributes(n,i);a&&i.writer.setAttribute(m,a,t.modelRange)}},{priority:"low"})}}function _e(s){return e=>{e.on("element:figure",(r,t,i)=>{const o=t.viewItem;if(!t.modelRange||!o.hasClass("table"))return;const l=s.processViewAttributes(o,i);l&&i.writer.setAttribute("htmlFigureAttributes",l,t.modelRange)},{priority:"low"})}}function Be(){return s=>{e("table","htmlTableAttributes"),e("figure","htmlFigureAttributes"),e("thead","htmlTheadAttributes"),e("tbody","htmlTbodyAttributes");function e(r,t){s.on(`attribute:${t}:table`,(i,o,l)=>{if(!l.consumable.test(o.item,i.name))return;const n=l.mapper.toViewElement(o.item),m=P(l.writer,n,r);m&&(l.consumable.consume(o.item,i.name),A(l.writer,o.attributeOldValue,o.attributeNewValue,m))})}}}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class De extends g{static get requires(){return[d]}static get pluginName(){return"StyleElementSupport"}static get isOfficialPlugin(){return!0}init(){const e=this.editor.plugins.get(d);e.on("register:style",(r,t)=>{const i=this.editor,o=i.model.schema,l=i.conversion;o.register("htmlStyle",t.modelSchema),o.extend("htmlStyle",{allowAttributes:["htmlStyleAttributes","htmlContent"],isContent:!0}),i.data.registerRawContentMatcher({name:"style"}),l.for("upcast").elementToElement({view:"style",model:D(t)}),l.for("upcast").add(S(t,e)),l.for("downcast").elementToElement({model:"htmlStyle",view:(n,{writer:m})=>T("style",n,m)}),l.for("downcast").add(F(t)),r.stop()})}}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class Re extends g{static get requires(){return[d]}static get pluginName(){return"ListElementSupport"}static get isOfficialPlugin(){return!0}init(){const e=this.editor;if(!e.plugins.has("ListEditing"))return;const r=e.model.schema,t=e.conversion,i=e.plugins.get(d),o=e.plugins.get("ListEditing"),l=e.plugins.get("ListUtils"),n=["ul","ol","li"];o.registerDowncastStrategy({scope:"item",attributeName:"htmlLiAttributes",setAttributeOnDowncast:p}),o.registerDowncastStrategy({scope:"list",attributeName:"htmlUlAttributes",setAttributeOnDowncast:p}),o.registerDowncastStrategy({scope:"list",attributeName:"htmlOlAttributes",setAttributeOnDowncast:p}),i.on("register",(m,a)=>{if(!n.includes(a.view)||(m.stop(),r.checkAttribute("$block","htmlLiAttributes")))return;const u=n.map(c=>b(c));r.extend("$listItem",{allowAttributes:u}),t.for("upcast").add(c=>{c.on("element:ul",x("htmlUlAttributes",i),{priority:"low"}),c.on("element:ol",x("htmlOlAttributes",i),{priority:"low"}),c.on("element:li",x("htmlLiAttributes",i),{priority:"low"})})}),o.on("postFixer",(m,{listNodes:a,writer:u})=>{for(const{node:c,previousNodeInList:h}of a)if(h){if(h.getAttribute("listType")==c.getAttribute("listType")){const f=q(h.getAttribute("listType")),w=h.getAttribute(f);!M(c.getAttribute(f),w)&&u.model.schema.checkAttribute(c,f)&&(u.setAttribute(f,w,c),m.return=!0)}if(h.getAttribute("listItemId")==c.getAttribute("listItemId")){const f=h.getAttribute("htmlLiAttributes");!M(c.getAttribute("htmlLiAttributes"),f)&&u.model.schema.checkAttribute(c,"htmlLiAttributes")&&(u.setAttribute("htmlLiAttributes",f,c),m.return=!0)}}}),o.on("postFixer",(m,{listNodes:a,writer:u})=>{for(const{node:c}of a){const h=c.getAttribute("listType");!l.isNumberedListType(h)&&c.getAttribute("htmlOlAttributes")&&(u.removeAttribute("htmlOlAttributes",c),m.return=!0),l.isNumberedListType(h)&&c.getAttribute("htmlUlAttributes")&&(u.removeAttribute("htmlUlAttributes",c),m.return=!0)}})}afterInit(){const e=this.editor;if(!e.commands.get("indentList"))return;const r=e.commands.get("indentList");this.listenTo(r,"afterExecute",(t,i)=>{e.model.change(o=>{for(const l of i){const n=q(l.getAttribute("listType"));e.model.schema.checkAttribute(l,n)&&o.setAttribute(n,{},l)}})})}}function x(s,e){return(r,t,i)=>{const o=t.viewItem;t.modelRange||Object.assign(t,i.convertChildren(t.viewItem,t.modelCursor));const l=e.processViewAttributes(o,i);for(const n of t.modelRange.getItems({shallow:!0}))n.hasAttribute("listItemId")&&(n.hasAttribute("htmlUlAttributes")||n.hasAttribute("htmlOlAttributes")||i.writer.model.schema.checkAttribute(n,s)&&i.writer.setAttribute(s,l||{},n))}}function q(s){return s==="numbered"||s=="customNumbered"?"htmlOlAttributes":"htmlUlAttributes"}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class xe extends g{static get requires(){return[d,v]}static get pluginName(){return"CustomElementSupport"}static get isOfficialPlugin(){return!0}init(){const e=this.editor.plugins.get(d),r=this.editor.plugins.get(v);e.on("register:$customElement",(t,i)=>{t.stop();const o=this.editor,l=o.model.schema,n=o.conversion,m=o.editing.view.domConverter.unsafeElements,a=o.data.htmlProcessor.domConverter.preElements;l.register(i.model,i.modelSchema),l.extend(i.model,{allowAttributes:["htmlElementName","htmlCustomElementAttributes","htmlContent"],isContent:!0}),o.data.htmlProcessor.domConverter.registerRawContentMatcher({name:"template"}),n.for("upcast").elementToElement({view:/.*/,model:(u,c)=>{if(u.name=="$comment"||!je(u.name)||r.getDefinitionsForView(u.name).size)return null;m.includes(u.name)||m.push(u.name),a.includes(u.name)||a.push(u.name);const h=c.writer.createElement(i.model,{htmlElementName:u.name}),f=e.processViewAttributes(u,c);f&&c.writer.setAttribute("htmlCustomElementAttributes",f,h);let w;if(u.is("element","template")&&u.getCustomProperty("$rawContent"))w=u.getCustomProperty("$rawContent");else{const $=new B(u.document).createDocumentFragment(u),I=o.data.htmlProcessor.domConverter.viewToDom($),_=I.firstChild;for(;_.firstChild;)I.appendChild(_.firstChild);_.remove(),w=o.data.htmlProcessor.htmlWriter.getHtml(I)}c.writer.setAttribute("htmlContent",w,h);for(const{item:O}of o.editing.view.createRangeIn(u))c.consumable.consume(O,{name:!0});return h},converterPriority:"low"}),n.for("editingDowncast").elementToElement({model:{name:i.model,attributes:["htmlElementName","htmlCustomElementAttributes","htmlContent"]},view:(u,{writer:c})=>{const h=u.getAttribute("htmlElementName"),f=c.createRawElement(h);return u.hasAttribute("htmlCustomElementAttributes")&&p(c,u.getAttribute("htmlCustomElementAttributes"),f),f}}),n.for("dataDowncast").elementToElement({model:{name:i.model,attributes:["htmlElementName","htmlCustomElementAttributes","htmlContent"]},view:(u,{writer:c})=>{const h=u.getAttribute("htmlElementName"),f=u.getAttribute("htmlContent"),w=c.createRawElement(h,null,(O,$)=>{$.setContentOf(O,f)});return u.hasAttribute("htmlCustomElementAttributes")&&p(c,u.getAttribute("htmlCustomElementAttributes"),w),w}})})}}function je(s){try{document.createElement(s)}catch{return!1}return!0}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class Ve extends g{static get pluginName(){return"GeneralHtmlSupport"}static get isOfficialPlugin(){return!0}static get requires(){return[d,fe,pe,we,Ae,Ce,Te,Pe,De,Re,xe]}init(){const e=this.editor,r=e.plugins.get(d);r.loadAllowedEmptyElementsConfig(e.config.get("htmlSupport.allowEmpty")||[]),r.loadAllowedConfig(e.config.get("htmlSupport.allow")||[]),r.loadDisallowedConfig(e.config.get("htmlSupport.disallow")||[])}getGhsAttributeNameForElement(e){const r=this.editor.plugins.get("DataSchema"),t=Array.from(r.getDefinitionsForView(e,!1)),i=t.find(o=>o.isInline&&!t[0].isObject);return i?i.model:b(e)}addModelHtmlClass(e,r,t){const i=this.editor.model,o=this.getGhsAttributeNameForElement(e);i.change(l=>{for(const n of k(i,t,o))y(l,n,o,"classes",m=>{for(const a of E(r))m.add(a)})})}removeModelHtmlClass(e,r,t){const i=this.editor.model,o=this.getGhsAttributeNameForElement(e);i.change(l=>{for(const n of k(i,t,o))y(l,n,o,"classes",m=>{for(const a of E(r))m.delete(a)})})}setModelHtmlAttributes(e,r,t){const i=this.editor.model,o=this.getGhsAttributeNameForElement(e);i.change(l=>{for(const n of k(i,t,o))y(l,n,o,"attributes",m=>{for(const[a,u]of Object.entries(r))m.set(a,u)})})}removeModelHtmlAttributes(e,r,t){const i=this.editor.model,o=this.getGhsAttributeNameForElement(e);i.change(l=>{for(const n of k(i,t,o))y(l,n,o,"attributes",m=>{for(const a of E(r))m.delete(a)})})}setModelHtmlStyles(e,r,t){const i=this.editor.model,o=this.getGhsAttributeNameForElement(e);i.change(l=>{for(const n of k(i,t,o))y(l,n,o,"styles",m=>{for(const[a,u]of Object.entries(r))m.set(a,u)})})}removeModelHtmlStyles(e,r,t){const i=this.editor.model,o=this.getGhsAttributeNameForElement(e);i.change(l=>{for(const n of k(i,t,o))y(l,n,o,"styles",m=>{for(const a of E(r))m.delete(a)})})}}function*k(s,e,r){if(e)if(!(Symbol.iterator in e)&&e.is("documentSelection")&&e.isCollapsed)s.schema.checkAttributeInSelection(e,r)&&(yield e);else for(const t of Ne(s,e,r))yield*t.getItems({shallow:!0})}function Ne(s,e,r){return!(Symbol.iterator in e)&&(e.is("node")||e.is("$text")||e.is("$textProxy"))?s.schema.checkAttribute(e,r)?[s.createRangeOn(e)]:[]:s.schema.getValidRanges(s.createSelection(e).getRanges(),r)}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class Me extends g{static get pluginName(){return"HtmlComment"}static get isOfficialPlugin(){return!0}init(){const e=this.editor,r=new Map;e.data.processor.skipComments=!1,e.model.schema.addAttributeCheck((t,i)=>{if(t.endsWith("$root")&&i.startsWith("$comment"))return!0}),e.conversion.for("upcast").elementToMarker({view:"$comment",model:t=>{const o=`$comment:${j()}`,l=t.getCustomProperty("$rawContent");return r.set(o,l),o}}),e.conversion.for("dataDowncast").markerToElement({model:"$comment",view:(t,{writer:i})=>{let o;for(const a of this.editor.model.document.getRootNames())if(o=this.editor.model.document.getRoot(a),o.hasAttribute(t.markerName))break;const l=t.markerName,n=o.getAttribute(l),m=i.createUIElement("$comment");return i.setCustomProperty("$rawContent",n,m),m}}),e.model.document.registerPostFixer(t=>{let i=!1;const o=e.model.document.differ.getChangedMarkers().filter(l=>l.name.startsWith("$comment:"));for(const l of o){const{oldRange:n,newRange:m}=l.data;if(!(n&&m&&n.root==m.root)){if(n){const a=n.root;a.hasAttribute(l.name)&&(t.removeAttribute(l.name,a),i=!0)}if(m){const a=m.root;a.rootName=="$graveyard"?(t.removeMarker(l.name),i=!0):a.hasAttribute(l.name)||(t.setAttribute(l.name,r.get(l.name)||"",a),i=!0)}}}return i}),e.data.on("set",()=>{for(const t of e.model.markers.getMarkersGroup("$comment"))this.removeHtmlComment(t.name)},{priority:"high"}),e.model.on("deleteContent",(t,[i])=>{for(const o of i.getRanges()){const l=e.model.schema.getLimitElement(o),n=e.model.createPositionAt(l,0),m=e.model.createPositionAt(l,"end");let a;n.isTouching(o.start)&&m.isTouching(o.end)?a=this.getHtmlCommentsInRange(e.model.createRange(n,m)):a=this.getHtmlCommentsInRange(o,{skipBoundaries:!0});for(const u of a)this.removeHtmlComment(u)}},{priority:"high"})}createHtmlComment(e,r){const t=j(),o=this.editor.model,l=o.document.getRoot(e.root.rootName),n=`$comment:${t}`;return o.change(m=>{const a=m.createRange(e);return m.addMarker(n,{usingOperation:!0,affectsData:!0,range:a}),m.setAttribute(n,r,l),n})}removeHtmlComment(e){const r=this.editor,t=r.model.markers.get(e);return t?(r.model.change(i=>{i.removeMarker(t)}),!0):!1}getHtmlCommentData(e){const t=this.editor.model.markers.get(e);if(!t)return null;let i="";for(const o of this.editor.model.document.getRoots())if(o.hasAttribute(e)){i=o.getAttribute(e);break}return{content:i,position:t.getStart()}}getHtmlCommentsInRange(e,{skipBoundaries:r=!1}={}){const t=!r;return Array.from(this.editor.model.markers.getMarkersGroup("$comment")).filter(o=>i(o,e)).map(o=>o.name);function i(o,l){const n=o.getRange().start;return(n.isAfter(l.start)||t&&n.isEqual(l.start))&&(n.isBefore(l.end)||t&&n.isEqual(l.end))}}}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class G extends Q{toView(e){if(!/<(?:html|body|head|meta)(?:\s[^>]*)?>/i.test(e.trim().slice(0,1e4)))return super.toView(e);let r="",t="";e=e.trim().replace(/<\?xml\s[^?]*\?>/i,n=>(t=n,"")),e=e.trim().replace(/^<!DOCTYPE\s[^>]*?>/i,n=>(r=n,""));const i=this._toDom(e),o=this.domConverter.domToView(i,{skipComments:this.skipComments}),l=new B(o.document);return l.setCustomProperty("$fullPageDocument",i.ownerDocument.documentElement.outerHTML,o),r&&l.setCustomProperty("$fullPageDocType",r,o),t&&l.setCustomProperty("$fullPageXmlDeclaration",t,o),o}toData(e){let r=super.toData(e);const t=e.getCustomProperty("$fullPageDocument"),i=e.getCustomProperty("$fullPageDocType"),o=e.getCustomProperty("$fullPageXmlDeclaration");return t&&(r=t.replace(/<\/body\s*>/,r+"$&"),i&&(r=i+`
`+r),o&&(r=o+`
`+r)),r}}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class He extends g{static get pluginName(){return"FullPage"}static get isOfficialPlugin(){return!0}init(){const e=this.editor,r=["$fullPageDocument","$fullPageDocType","$fullPageXmlDeclaration"];e.data.processor=new G(e.data.viewDocument),e.model.schema.extend("$root",{allowAttributes:r}),e.data.on("toModel",(t,[i])=>{const o=e.model.document.getRoot();e.model.change(l=>{for(const n of r){const m=i.getCustomProperty(n);m&&l.setAttribute(n,m,o)}})},{priority:"low"}),e.data.on("toView",(t,[i])=>{if(!i.is("rootElement"))return;const o=i,l=t.return;if(!o.hasAttribute("$fullPageDocument"))return;const n=new B(l.document);for(const m of r){const a=o.getAttribute(m);a&&n.setCustomProperty(m,a,l)}},{priority:"low"}),e.data.on("set",()=>{const t=e.model.document.getRoot();e.model.change(i=>{for(const o of r)t.hasAttribute(o)&&i.removeAttribute(o,t)})},{priority:"high"}),e.data.on("get",(t,i)=>{i[0]||(i[0]={}),i[0].trim=!1},{priority:"high"})}}export{d as DataFilter,v as DataSchema,He as FullPage,Ve as GeneralHtmlSupport,Me as HtmlComment,G as HtmlPageDataProcessor};
