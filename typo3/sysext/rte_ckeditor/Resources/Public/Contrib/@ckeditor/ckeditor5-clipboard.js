import{Plugin as b}from"@ckeditor/ckeditor5-core";import{EventInfo as B,getRangeFromMouseEvent as ne,uid as V,toUnit as ie,delay as L,DomEmitterMixin as P,global as h,Rect as k,ResizeObserver as oe,env as f,createElement as U}from"@ckeditor/ckeditor5-utils";import{DomEventObserver as se,DataTransfer as ae,Range as le,MouseObserver as ce,LiveRange as T}from"@ckeditor/ckeditor5-engine";import{mapValues as de,throttle as $}from"lodash-es";import{Widget as ge,isWidget as v}from"@ckeditor/ckeditor5-widget";import{View as pe}from"@ckeditor/ckeditor5-ui";/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class y extends se{constructor(e){super(e),this.domEventType=["paste","copy","cut","drop","dragover","dragstart","dragend","dragenter","dragleave"];const t=this.document;this.listenTo(t,"paste",r("clipboardInput"),{priority:"low"}),this.listenTo(t,"drop",r("clipboardInput"),{priority:"low"}),this.listenTo(t,"dragover",r("dragging"),{priority:"low"});function r(i){return(s,o)=>{o.preventDefault();const n=o.dropRange?[o.dropRange]:null,l=new B(t,i);t.fire(l,{dataTransfer:o.dataTransfer,method:s.name,targetRanges:n,target:o.target,domEvent:o.domEvent}),l.stop.called&&o.stopPropagation()}}}onDomEvent(e){const t="clipboardData"in e?e.clipboardData:e.dataTransfer,r=e.type=="drop"||e.type=="paste",i={dataTransfer:new ae(t,{cacheFiles:r})};if(e.type=="drop"||e.type=="dragover"){const s=ne(e);i.dropRange=s&&this.view.domConverter.domRangeToView(s)}this.fire(e.type,e,i)}}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/function N(a){return a=a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\r?\n\r?\n/g,"</p><p>").replace(/\r?\n/g,"<br>").replace(/\t/g,"&nbsp;&nbsp;&nbsp;&nbsp;").replace(/^\s/,"&nbsp;").replace(/\s$/,"&nbsp;").replace(/\s\s/g," &nbsp;"),(a.includes("</p><p>")||a.includes("<br>"))&&(a=`<p>${a}</p>`),a}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/function he(a){return a.replace(/<span(?: class="Apple-converted-space"|)>(\s+)<\/span>/g,(e,t)=>t.length==1?" ":t).replace(/<!--[\s\S]*?-->/g,"")}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/const W=["figcaption","li"],z=["ol","ul"];function q(a){if(a.is("$text")||a.is("$textProxy"))return a.data;if(a.is("element","img")&&a.hasAttribute("alt"))return a.getAttribute("alt");if(a.is("element","br"))return`
`;let e="",t=null;for(const r of a.getChildren())e+=ue(r,t)+q(r),t=r;return e}function ue(a,e){return e?a.is("element","li")&&!a.isEmpty&&a.getChild(0).is("containerElement")||z.includes(a.name)&&z.includes(e.name)?`

`:!a.is("containerElement")&&!e.is("containerElement")?"":W.includes(a.name)||W.includes(e.name)?`
`:a.is("element")&&a.getCustomProperty("dataPipeline:transparentRendering")||e.is("element")&&e.getCustomProperty("dataPipeline:transparentRendering")?"":`

`:""}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class A extends b{constructor(){super(...arguments),this._markersToCopy=new Map}static get pluginName(){return"ClipboardMarkersUtils"}static get isOfficialPlugin(){return!0}_registerMarkerToCopy(e,t){this._markersToCopy.set(e,t)}_copySelectedFragmentWithMarkers(e,t,r=i=>i.model.getSelectedContent(i.model.document.selection)){return this.editor.model.change(i=>{const s=i.model.document.selection;i.setSelection(t);const o=this._insertFakeMarkersIntoSelection(i,i.model.document.selection,e),n=r(i),l=this._removeFakeMarkersInsideElement(i,n);for(const[c,d]of Object.entries(o)){l[c]||(l[c]=i.createRangeIn(n));for(const g of d)i.remove(g)}n.markers.clear();for(const[c,d]of Object.entries(l))n.markers.set(c,d);return i.setSelection(s),n})}_pasteMarkersIntoTransformedElement(e,t){const r=this._getPasteMarkersFromRangeMap(e);return this.editor.model.change(i=>{const s=this._insertFakeMarkersElements(i,r),o=t(i),n=this._removeFakeMarkersInsideElement(i,o);for(const l of Object.values(s).flat())i.remove(l);for(const[l,c]of Object.entries(n))i.model.markers.has(l)||i.addMarker(l,{usingOperation:!0,affectsData:!0,range:c});return o})}_pasteFragmentWithMarkers(e){const t=this._getPasteMarkersFromRangeMap(e.markers);e.markers.clear();for(const r of t)e.markers.set(r.name,r.range);return this.editor.model.insertContent(e)}_forceMarkersCopy(e,t,r={allowedActions:"all",copyPartiallySelected:!0,duplicateOnPaste:!0}){const i=this._markersToCopy.get(e);this._markersToCopy.set(e,r),t(),i?this._markersToCopy.set(e,i):this._markersToCopy.delete(e)}_isMarkerCopyable(e,t){const r=this._getMarkerClipboardConfig(e);if(!r)return!1;if(!t)return!0;const{allowedActions:i}=r;return i==="all"||i.includes(t)}_hasMarkerConfiguration(e){return!!this._getMarkerClipboardConfig(e)}_getMarkerClipboardConfig(e){const[t]=e.split(":");return this._markersToCopy.get(t)||null}_insertFakeMarkersIntoSelection(e,t,r){const i=this._getCopyableMarkersFromSelection(e,t,r);return this._insertFakeMarkersElements(e,i)}_getCopyableMarkersFromSelection(e,t,r){const i=Array.from(t.getRanges()),s=new Set(i.flatMap(n=>Array.from(e.model.markers.getMarkersIntersectingRange(n)))),o=n=>{if(!this._isMarkerCopyable(n.name,r))return!1;const{copyPartiallySelected:c}=this._getMarkerClipboardConfig(n.name);if(!c){const d=n.getRange();return i.some(g=>g.containsRange(d,!0))}return!0};return Array.from(s).filter(o).map(n=>({name:r==="dragstart"?this._getUniqueMarkerName(n.name):n.name,range:n.getRange()}))}_getPasteMarkersFromRangeMap(e,t=null){const{model:r}=this.editor;return(e instanceof Map?Array.from(e.entries()):Object.entries(e)).flatMap(([s,o])=>{if(!this._hasMarkerConfiguration(s))return[{name:s,range:o}];if(this._isMarkerCopyable(s,t)){const n=this._getMarkerClipboardConfig(s),l=r.markers.has(s)&&r.markers.get(s).getRange().root.rootName==="$graveyard";return(n.duplicateOnPaste||l)&&(s=this._getUniqueMarkerName(s)),[{name:s,range:o}]}return[]})}_insertFakeMarkersElements(e,t){const r={},i=t.flatMap(s=>{const{start:o,end:n}=s.range;return[{position:o,marker:s,type:"start"},{position:n,marker:s,type:"end"}]}).sort(({position:s},{position:o})=>s.isBefore(o)?1:-1);for(const{position:s,marker:o,type:n}of i){const l=e.createElement("$marker",{"data-name":o.name,"data-type":n});r[o.name]||(r[o.name]=[]),r[o.name].push(l),e.insert(l,s)}return r}_removeFakeMarkersInsideElement(e,t){const i=this._getAllFakeMarkersFromElement(e,t).reduce((s,o)=>{const n=o.markerElement&&e.createPositionBefore(o.markerElement);let l=s[o.name],c=!1;return l&&l.start&&l.end&&(this._getMarkerClipboardConfig(o.name).duplicateOnPaste?s[this._getUniqueMarkerName(o.name)]=s[o.name]:c=!0,l=null),c||(s[o.name]={...l,[o.type]:n}),o.markerElement&&e.remove(o.markerElement),s},{});return de(i,s=>new le(s.start||e.createPositionFromPath(t,[0]),s.end||e.createPositionAt(t,"end")))}_getAllFakeMarkersFromElement(e,t){const r=Array.from(e.createRangeIn(t)).flatMap(({item:o})=>{if(!o.is("element","$marker"))return[];const n=o.getAttribute("data-name"),l=o.getAttribute("data-type");return[{markerElement:o,name:n,type:l}]}),i=[],s=[];for(const o of r)o.type==="end"&&(r.some(l=>l.name===o.name&&l.type==="start")||i.push({markerElement:null,name:o.name,type:"start"})),o.type==="start"&&(r.some(l=>l.name===o.name&&l.type==="end")||s.unshift({markerElement:null,name:o.name,type:"end"}));return[...i,...r,...s]}_getUniqueMarkerName(e){const t=e.split(":"),r=V().substring(1,6);return t.length===3?`${t.slice(0,2).join(":")}:${r}`:`${t.join(":")}:${r}`}}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class _ extends b{static get pluginName(){return"ClipboardPipeline"}static get isOfficialPlugin(){return!0}static get requires(){return[A]}init(){this.editor.editing.view.addObserver(y),this._setupPasteDrop(),this._setupCopyCut()}_fireOutputTransformationEvent(e,t,r){const i=this.editor.plugins.get("ClipboardMarkersUtils");this.editor.model.enqueueChange({isUndoable:r==="cut"},()=>{const s=i._copySelectedFragmentWithMarkers(r,t);this.fire("outputTransformation",{dataTransfer:e,content:s,method:r})})}_setupPasteDrop(){const e=this.editor,t=e.model,r=e.editing.view,i=r.document,s=this.editor.plugins.get("ClipboardMarkersUtils");this.listenTo(i,"clipboardInput",(o,n)=>{n.method=="paste"&&!e.model.canEditAt(e.model.document.selection)&&o.stop()},{priority:"highest"}),this.listenTo(i,"clipboardInput",(o,n)=>{const l=n.dataTransfer;let c;if(n.content)c=n.content;else{let g="";l.getData("text/html")?g=he(l.getData("text/html")):l.getData("text/plain")&&(g=N(l.getData("text/plain"))),c=this.editor.data.htmlProcessor.toView(g)}const d=new B(this,"inputTransformation");this.fire(d,{content:c,dataTransfer:l,targetRanges:n.targetRanges,method:n.method}),d.stop.called&&o.stop(),r.scrollToTheSelection()},{priority:"low"}),this.listenTo(this,"inputTransformation",(o,n)=>{if(n.content.isEmpty)return;const c=this.editor.data.toModel(n.content,"$clipboardHolder");c.childCount!=0&&(o.stop(),t.change(()=>{this.fire("contentInsertion",{content:c,method:n.method,dataTransfer:n.dataTransfer,targetRanges:n.targetRanges})}))},{priority:"low"}),this.listenTo(this,"contentInsertion",(o,n)=>{n.resultRange=s._pasteFragmentWithMarkers(n.content)},{priority:"low"})}_setupCopyCut(){const e=this.editor,t=e.model.document,i=e.editing.view.document,s=(o,n)=>{const l=n.dataTransfer;n.preventDefault(),this._fireOutputTransformationEvent(l,t.selection,o.name)};this.listenTo(i,"copy",s,{priority:"low"}),this.listenTo(i,"cut",(o,n)=>{e.model.canEditAt(e.model.document.selection)?s(o,n):n.preventDefault()},{priority:"low"}),this.listenTo(this,"outputTransformation",(o,n)=>{const l=e.data.toView(n.content);i.fire("clipboardOutput",{dataTransfer:n.dataTransfer,content:l,method:n.method})},{priority:"low"}),this.listenTo(i,"clipboardOutput",(o,n)=>{n.content.isEmpty||(n.dataTransfer.setData("text/html",this.editor.data.htmlProcessor.toData(n.content)),n.dataTransfer.setData("text/plain",q(n.content))),n.method=="cut"&&e.model.deleteContent(t.selection)},{priority:"low"})}}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*//* istanbul ignore file -- @preserve */const S=ie("px");class me extends pe{constructor(){super();const e=this.bindTemplate;this.set({isVisible:!1,left:null,top:null,width:null}),this.setTemplate({tag:"div",attributes:{class:["ck","ck-clipboard-drop-target-line",e.if("isVisible","ck-hidden",t=>!t)],style:{left:e.to("left",t=>S(t)),top:e.to("top",t=>S(t)),width:e.to("width",t=>S(t))}}})}}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class w extends b{constructor(){super(...arguments),this.removeDropMarkerDelayed=L(()=>this.removeDropMarker(),40),this._updateDropMarkerThrottled=$(e=>this._updateDropMarker(e),40),this._reconvertMarkerThrottled=$(()=>{this.editor.model.markers.has("drop-target")&&this.editor.editing.reconvertMarker("drop-target")},0),this._dropTargetLineView=new me,this._domEmitter=new(P()),this._scrollables=new Map}static get pluginName(){return"DragDropTarget"}static get isOfficialPlugin(){return!0}init(){this._setupDropMarker()}destroy(){this._domEmitter.stopListening();for(const{resizeObserver:e}of this._scrollables.values())e.destroy();return this._updateDropMarkerThrottled.cancel(),this.removeDropMarkerDelayed.cancel(),this._reconvertMarkerThrottled.cancel(),super.destroy()}updateDropMarker(e,t,r,i,s,o){this.removeDropMarkerDelayed.cancel();const n=j(this.editor,e,t,r,i,s,o);/* istanbul ignore next -- @preserve */if(n){if(o&&o.containsRange(n))return this.removeDropMarker();this._updateDropMarkerThrottled(n)}}getFinalDropRange(e,t,r,i,s,o){const n=j(this.editor,e,t,r,i,s,o);return this.removeDropMarker(),n}removeDropMarker(){const e=this.editor.model;this.removeDropMarkerDelayed.cancel(),this._updateDropMarkerThrottled.cancel(),this._dropTargetLineView.isVisible=!1,e.markers.has("drop-target")&&e.change(t=>{t.removeMarker("drop-target")})}_setupDropMarker(){const e=this.editor;e.ui.view.body.add(this._dropTargetLineView),e.conversion.for("editingDowncast").markerToHighlight({model:"drop-target",view:{classes:["ck-clipboard-drop-target-range"]}}),e.conversion.for("editingDowncast").markerToElement({model:"drop-target",view:(t,{writer:r})=>{if(e.model.schema.checkChild(t.markerRange.start,"$text"))return this._dropTargetLineView.isVisible=!1,this._createDropTargetPosition(r);t.markerRange.isCollapsed?this._updateDropTargetLine(t.markerRange):this._dropTargetLineView.isVisible=!1}})}_updateDropMarker(e){const t=this.editor,r=t.model.markers;t.model.change(i=>{r.has("drop-target")?r.get("drop-target").getRange().isEqual(e)||i.updateMarker("drop-target",{range:e}):i.addMarker("drop-target",{range:e,usingOperation:!1,affectsData:!1})})}_createDropTargetPosition(e){return e.createUIElement("span",{class:"ck ck-clipboard-drop-target-position"},function(t){const r=this.toDomElement(t);return r.append("\u2060",t.createElement("span"),"\u2060"),r})}_updateDropTargetLine(e){const t=this.editor.editing,r=e.start.nodeBefore,i=e.start.nodeAfter,s=e.start.parent,o=r?t.mapper.toViewElement(r):null,n=o?t.view.domConverter.mapViewToDom(o):null,l=i?t.mapper.toViewElement(i):null,c=l?t.view.domConverter.mapViewToDom(l):null,d=t.mapper.toViewElement(s);if(!d)return;const g=t.view.domConverter.mapViewToDom(d),p=this._getScrollableRect(d),{scrollX:u,scrollY:m}=h.window,C=n?new k(n):null,x=c?new k(c):null,D=new k(g).excludeScrollbarsAndBorders(),I=C?C.bottom:D.top,E=x?x.top:D.bottom,O=h.window.getComputedStyle(g),R=I<=E?(I+E)/2:E;if(p.top<R&&R<p.bottom){const ee=D.left+parseFloat(O.paddingLeft),te=D.right-parseFloat(O.paddingRight),F=Math.max(ee+u,p.left),re=Math.min(te+u,p.right);this._dropTargetLineView.set({isVisible:!0,left:F,top:R+m,width:re-F})}else this._dropTargetLineView.isVisible=!1}_getScrollableRect(e){const t=e.root.rootName;let r;if(this._scrollables.has(t))r=this._scrollables.get(t).domElement;else{const i=this.editor.editing.view.domConverter.mapViewToDom(e);r=be(i),this._domEmitter.listenTo(r,"scroll",this._reconvertMarkerThrottled,{usePassive:!0});const s=new oe(r,this._reconvertMarkerThrottled);this._scrollables.set(t,{domElement:r,resizeObserver:s})}return new k(r).excludeScrollbarsAndBorders()}}function j(a,e,t,r,i,s,o){const n=a.model,l=a.editing.mapper;let d=K(a,e);for(;d;){if(!s){if(n.schema.checkChild(d,"$text")){if(t){const g=t[0].start,p=l.toModelPosition(g);if(!o||Array.from(o.getItems({shallow:!0})).every(m=>n.schema.checkChild(p,m))){if(n.schema.checkChild(p,"$text"))return n.createRange(p);if(g)return M(a,K(a,g.parent),r,i)}}}else if(n.schema.isInline(d))return M(a,d,r,i)}if(n.schema.isBlock(d))return M(a,d,r,i);if(n.schema.checkChild(d,"$block")){const g=Array.from(d.getChildren()).filter(m=>m.is("element")&&!fe(a,m));let p=0,u=g.length;if(u==0)return n.createRange(n.createPositionAt(d,"end"));for(;p<u-1;){const m=Math.floor((p+u)/2);H(a,g[m],r,i)=="before"?u=m:p=m}return M(a,g[p],r,i)}d=d.parent}return null}function fe(a,e){const t=a.editing.mapper,r=a.editing.view.domConverter,i=t.toViewElement(e);if(!i)return!0;const s=r.mapViewToDom(i);return h.window.getComputedStyle(s).float!="none"}function M(a,e,t,r){const i=a.model;return i.createRange(i.createPositionAt(e,H(a,e,t,r)))}function H(a,e,t,r){const i=a.editing.mapper,s=a.editing.view.domConverter,o=i.toViewElement(e),n=s.mapViewToDom(o),l=new k(n);return a.model.schema.isInline(e)?t<(l.left+l.right)/2?"before":"after":r<(l.top+l.bottom)/2?"before":"after"}function K(a,e){const t=a.editing.mapper,r=a.editing.view,i=t.toModelElement(e);if(i)return i;const s=r.createPositionBefore(e),o=t.findMappedViewAncestor(s);return t.toModelElement(o)}function be(a){let e=a;do{e=e.parentElement;const t=h.window.getComputedStyle(e).overflowY;if(t=="auto"||t=="scroll")break}while(e.tagName!="BODY");return e}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class G extends b{constructor(){super(...arguments),this._isBlockDragging=!1,this._domEmitter=new(P())}static get pluginName(){return"DragDropBlockToolbar"}static get isOfficialPlugin(){return!0}init(){const e=this.editor;if(this.listenTo(e,"change:isReadOnly",(t,r,i)=>{i?(this.forceDisabled("readOnlyMode"),this._isBlockDragging=!1):this.clearForceDisabled("readOnlyMode")}),f.isAndroid&&this.forceDisabled("noAndroidSupport"),e.plugins.has("BlockToolbar")){const r=e.plugins.get("BlockToolbar").buttonView.element;this._domEmitter.listenTo(r,"dragstart",(i,s)=>this._handleBlockDragStart(s)),this._domEmitter.listenTo(h.document,"dragover",(i,s)=>this._handleBlockDragging(s)),this._domEmitter.listenTo(h.document,"drop",(i,s)=>this._handleBlockDragging(s)),this._domEmitter.listenTo(h.document,"dragend",()=>this._handleBlockDragEnd(),{useCapture:!0}),this.isEnabled&&r.setAttribute("draggable","true"),this.on("change:isEnabled",(i,s,o)=>{r.setAttribute("draggable",o?"true":"false")})}}destroy(){return this._domEmitter.stopListening(),super.destroy()}_handleBlockDragStart(e){if(!this.isEnabled)return;const t=this.editor.model,r=t.document.selection,i=this.editor.editing.view,s=Array.from(r.getSelectedBlocks()),o=t.createRange(t.createPositionBefore(s[0]),t.createPositionAfter(s[s.length-1]));t.change(n=>n.setSelection(o)),this._isBlockDragging=!0,i.focus(),i.getObserver(y).onDomEvent(e)}_handleBlockDragging(e){if(!this.isEnabled||!this._isBlockDragging)return;const t=e.clientX+(this.editor.locale.contentLanguageDirection=="ltr"?100:-100),r=e.clientY,i=document.elementFromPoint(t,r),s=this.editor.editing.view;!i||!i.closest(".ck-editor__editable")||s.getObserver(y).onDomEvent({...e,type:e.type,dataTransfer:e.dataTransfer,target:i,clientX:t,clientY:r,preventDefault:()=>e.preventDefault(),stopPropagation:()=>e.stopPropagation()})}_handleBlockDragEnd(){this._isBlockDragging=!1}}function ke(a,{insertAt:e}={}){if(typeof document>"u")return;const t=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css",window.litNonce&&r.setAttribute("nonce",window.litNonce),e==="top"&&t.firstChild?t.insertBefore(r,t.firstChild):t.appendChild(r),r.styleSheet?r.styleSheet.cssText=a:r.appendChild(document.createTextNode(a))}ke('.ck.ck-editor__editable .ck.ck-clipboard-drop-target-position{display:inline;pointer-events:none;position:relative}.ck.ck-editor__editable .ck.ck-clipboard-drop-target-position span{position:absolute;width:0}.ck.ck-editor__editable .ck-widget:-webkit-drag>.ck-widget__selection-handle,.ck.ck-editor__editable .ck-widget:-webkit-drag>.ck-widget__type-around{display:none}.ck.ck-clipboard-drop-target-line{pointer-events:none;position:absolute}:root{--ck-clipboard-drop-target-dot-width:12px;--ck-clipboard-drop-target-dot-height:8px;--ck-clipboard-drop-target-color:var(--ck-color-focus-border)}.ck.ck-editor__editable .ck.ck-clipboard-drop-target-position span{background:var(--ck-clipboard-drop-target-color);border:1px solid var(--ck-clipboard-drop-target-color);bottom:calc(var(--ck-clipboard-drop-target-dot-height)*-.5);margin-left:-1px;top:calc(var(--ck-clipboard-drop-target-dot-height)*-.5)}.ck.ck-editor__editable .ck.ck-clipboard-drop-target-position span:after{border-color:var(--ck-clipboard-drop-target-color) transparent transparent transparent;border-style:solid;border-width:calc(var(--ck-clipboard-drop-target-dot-height)) calc(var(--ck-clipboard-drop-target-dot-width)*.5) 0 calc(var(--ck-clipboard-drop-target-dot-width)*.5);content:"";display:block;height:0;left:50%;position:absolute;top:calc(var(--ck-clipboard-drop-target-dot-height)*-.5);transform:translateX(-50%);width:0}.ck.ck-editor__editable .ck-widget.ck-clipboard-drop-target-range{outline:var(--ck-widget-outline-thickness) solid var(--ck-clipboard-drop-target-color)!important}.ck.ck-editor__editable .ck-widget:-webkit-drag{zoom:.6;outline:none!important}.ck.ck-clipboard-drop-target-line{background:var(--ck-clipboard-drop-target-color);border:1px solid var(--ck-clipboard-drop-target-color);height:0;margin-top:-1px}.ck.ck-clipboard-drop-target-line:before{border-style:solid;content:"";height:0;position:absolute;top:calc(var(--ck-clipboard-drop-target-dot-width)*-.5);width:0}[dir=ltr] .ck.ck-clipboard-drop-target-line:before{border-color:transparent transparent transparent var(--ck-clipboard-drop-target-color);border-width:calc(var(--ck-clipboard-drop-target-dot-width)*.5) 0 calc(var(--ck-clipboard-drop-target-dot-width)*.5) var(--ck-clipboard-drop-target-dot-height);left:-1px}[dir=rtl] .ck.ck-clipboard-drop-target-line:before{border-color:transparent var(--ck-clipboard-drop-target-color) transparent transparent;border-width:calc(var(--ck-clipboard-drop-target-dot-width)*.5) var(--ck-clipboard-drop-target-dot-height) calc(var(--ck-clipboard-drop-target-dot-width)*.5) 0;right:-1px}');/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class X extends b{constructor(){super(...arguments),this._clearDraggableAttributesDelayed=L(()=>this._clearDraggableAttributes(),40),this._blockMode=!1,this._domEmitter=new(P())}static get pluginName(){return"DragDrop"}static get isOfficialPlugin(){return!0}static get requires(){return[_,ge,w,G]}init(){const e=this.editor,t=e.editing.view;this._draggedRange=null,this._draggingUid="",this._draggableElement=null,t.addObserver(y),t.addObserver(ce),this._setupDragging(),this._setupContentInsertionIntegration(),this._setupClipboardInputIntegration(),this._setupDraggableAttributeHandling(),this.listenTo(e,"change:isReadOnly",(r,i,s)=>{s?this.forceDisabled("readOnlyMode"):this.clearForceDisabled("readOnlyMode")}),this.on("change:isEnabled",(r,i,s)=>{s||this._finalizeDragging(!1)}),f.isAndroid&&this.forceDisabled("noAndroidSupport")}destroy(){return this._draggedRange&&(this._draggedRange.detach(),this._draggedRange=null),this._previewContainer&&this._previewContainer.remove(),this._domEmitter.stopListening(),this._clearDraggableAttributesDelayed.cancel(),super.destroy()}_setupDragging(){const e=this.editor,t=e.model,r=e.editing.view,i=r.document,s=e.plugins.get(w);this.listenTo(i,"dragstart",(o,n)=>{if(n.target&&n.target.is("editableElement")){n.preventDefault();return}if(this._prepareDraggedRange(n.target),!this._draggedRange){n.preventDefault();return}this._draggingUid=V(),n.dataTransfer.effectAllowed=this.isEnabled?"copyMove":"copy",n.dataTransfer.setData("application/ckeditor5-dragging-uid",this._draggingUid);const l=t.createSelection(this._draggedRange.toRange());this.editor.plugins.get("ClipboardPipeline")._fireOutputTransformationEvent(n.dataTransfer,l,"dragstart");const{dataTransfer:d,domTarget:g,domEvent:p}=n,{clientX:u}=p;this._updatePreview({dataTransfer:d,domTarget:g,clientX:u}),n.stopPropagation(),this.isEnabled||(this._draggedRange.detach(),this._draggedRange=null,this._draggingUid="")},{priority:"low"}),this.listenTo(i,"dragend",(o,n)=>{this._finalizeDragging(!n.dataTransfer.isCanceled&&n.dataTransfer.dropEffect=="move")},{priority:"low"}),this._domEmitter.listenTo(h.document,"dragend",()=>{this._blockMode=!1},{useCapture:!0}),this.listenTo(i,"dragenter",()=>{this.isEnabled&&r.focus()}),this.listenTo(i,"dragleave",()=>{s.removeDropMarkerDelayed()}),this.listenTo(i,"dragging",(o,n)=>{if(!this.isEnabled){n.dataTransfer.dropEffect="none";return}const{clientX:l,clientY:c}=n.domEvent;s.updateDropMarker(n.target,n.targetRanges,l,c,this._blockMode,this._draggedRange),this._draggedRange||(n.dataTransfer.dropEffect="copy"),f.isGecko||(n.dataTransfer.effectAllowed=="copy"?n.dataTransfer.dropEffect="copy":["all","copyMove"].includes(n.dataTransfer.effectAllowed)&&(n.dataTransfer.dropEffect="move")),o.stop()},{priority:"low"})}_setupClipboardInputIntegration(){const e=this.editor,r=e.editing.view.document,i=e.plugins.get(w);this.listenTo(r,"clipboardInput",(s,o)=>{if(o.method!="drop")return;const{clientX:n,clientY:l}=o.domEvent,c=i.getFinalDropRange(o.target,o.targetRanges,n,l,this._blockMode,this._draggedRange);if(!c){this._finalizeDragging(!1),s.stop();return}if(this._draggedRange&&this._draggingUid!=o.dataTransfer.getData("application/ckeditor5-dragging-uid")&&(this._draggedRange.detach(),this._draggedRange=null,this._draggingUid=""),Y(o.dataTransfer)=="move"&&this._draggedRange&&this._draggedRange.containsRange(c,!0)){this._finalizeDragging(!1),s.stop();return}o.targetRanges=[e.editing.mapper.toViewRange(c)]},{priority:"high"})}_setupContentInsertionIntegration(){const e=this.editor.plugins.get(_);e.on("contentInsertion",(t,r)=>{if(!this.isEnabled||r.method!=="drop")return;const i=r.targetRanges.map(s=>this.editor.editing.mapper.toModelRange(s));this.editor.model.change(s=>s.setSelection(i))},{priority:"high"}),e.on("contentInsertion",(t,r)=>{if(!this.isEnabled||r.method!=="drop")return;const i=Y(r.dataTransfer)=="move",s=!r.resultRange||!r.resultRange.isCollapsed;this._finalizeDragging(s&&i)},{priority:"lowest"})}_setupDraggableAttributeHandling(){const e=this.editor,t=e.editing.view,r=t.document;this.listenTo(r,"mousedown",(i,s)=>{if(f.isAndroid||!s)return;this._clearDraggableAttributesDelayed.cancel();let o=J(s.target);if(f.isBlink&&!e.isReadOnly&&!o&&!r.selection.isCollapsed){const n=r.selection.getSelectedElement();(!n||!v(n))&&(o=r.selection.editableElement)}o&&(t.change(n=>{n.setAttribute("draggable","true",o)}),this._draggableElement=e.editing.mapper.toModelElement(o))}),this.listenTo(r,"mouseup",()=>{f.isAndroid||this._clearDraggableAttributesDelayed()})}_clearDraggableAttributes(){const e=this.editor.editing;e.view.change(t=>{this._draggableElement&&this._draggableElement.root.rootName!="$graveyard"&&t.removeAttribute("draggable",e.mapper.toViewElement(this._draggableElement)),this._draggableElement=null})}_finalizeDragging(e){const t=this.editor,r=t.model;t.plugins.get(w).removeDropMarker(),this._clearDraggableAttributes(),t.plugins.has("WidgetToolbarRepository")&&t.plugins.get("WidgetToolbarRepository").clearForceDisabled("dragDrop"),this._draggingUid="",this._previewContainer&&(this._previewContainer.remove(),this._previewContainer=void 0),this._draggedRange&&(e&&this.isEnabled&&r.change(s=>{const o=r.createSelection(this._draggedRange);r.deleteContent(o,{doNotAutoparagraph:!0});const n=o.getFirstPosition().parent;n.isEmpty&&!r.schema.checkChild(n,"$text")&&r.schema.checkChild(n,"paragraph")&&s.insertElement("paragraph",n,0)}),this._draggedRange.detach(),this._draggedRange=null)}_prepareDraggedRange(e){const t=this.editor,r=t.model,i=r.document.selection,s=e?J(e):null;if(s){const c=t.editing.mapper.toModelElement(s);this._draggedRange=T.fromRange(r.createRangeOn(c)),this._blockMode=r.schema.isBlock(c),t.plugins.has("WidgetToolbarRepository")&&t.plugins.get("WidgetToolbarRepository").forceDisabled("dragDrop");return}if(i.isCollapsed&&!i.getFirstPosition().parent.isEmpty)return;const o=Array.from(i.getSelectedBlocks()),n=i.getFirstRange();if(o.length==0){this._draggedRange=T.fromRange(n);return}const l=Q(r,o);if(o.length>1)this._draggedRange=T.fromRange(l),this._blockMode=!0;else if(o.length==1){const c=n.start.isTouching(l.start)&&n.end.isTouching(l.end);this._draggedRange=T.fromRange(c?l:n),this._blockMode=c}r.change(c=>c.setSelection(this._draggedRange.toRange()))}_updatePreview({dataTransfer:e,domTarget:t,clientX:r}){const i=this.editor.editing.view,s=i.document.selection.editableElement,o=i.domConverter.mapViewToDom(s),n=h.window.getComputedStyle(o);this._previewContainer?this._previewContainer.firstElementChild&&this._previewContainer.removeChild(this._previewContainer.firstElementChild):(this._previewContainer=U(h.document,"div",{style:"position: fixed; left: -999999px;"}),h.document.body.appendChild(this._previewContainer));const l=new k(o);if(o.contains(t))return;const c=parseFloat(n.paddingLeft),d=U(h.document,"div");d.className="ck ck-content",d.style.width=n.width,d.style.paddingLeft=`${l.left-r+c}px`,f.isiOS&&(d.style.backgroundColor="white"),i.domConverter.setContentOf(d,e.getData("text/html")),e.setDragImage(d,0,0),this._previewContainer.appendChild(d)}}function Y(a){return f.isGecko?a.dropEffect:["all","copyMove"].includes(a.effectAllowed)?"move":"copy"}function J(a){if(a.is("editableElement"))return null;if(a.hasClass("ck-widget__selection-handle"))return a.findAncestor(v);if(v(a))return a;const e=a.findAncestor(t=>v(t)||t.is("editableElement"));return v(e)?e:null}function Q(a,e){const t=e[0],r=e[e.length-1],i=t.getCommonAncestor(r),s=a.createPositionBefore(t),o=a.createPositionAfter(r);if(i&&i.is("element")&&!a.schema.isLimit(i)){const n=a.createRangeOn(i),l=s.isTouching(n.start),c=o.isTouching(n.end);if(l&&c)return Q(a,[i])}return a.createRange(s,o)}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class Z extends b{static get pluginName(){return"PastePlainText"}static get isOfficialPlugin(){return!0}static get requires(){return[_]}init(){const e=this.editor,t=e.model,r=e.editing.view,i=t.document.selection;r.addObserver(y),e.plugins.get(_).on("contentInsertion",(s,o)=>{_e(o.content,t)&&t.change(n=>{const l=Array.from(i.getAttributes()).filter(([d])=>t.schema.getAttributeProperties(d).isFormatting);i.isCollapsed||t.deleteContent(i,{doNotAutoparagraph:!0}),l.push(...i.getAttributes());const c=n.createRangeIn(o.content);for(const d of c.getItems())for(const g of l)t.schema.checkAttribute(d,g[0])&&n.setAttribute(g[0],g[1],d)})})}}function _e(a,e){let t=e.createRangeIn(a);if(a.childCount==1){const r=a.getChild(0);r.is("element")&&e.schema.isBlock(r)&&!e.schema.isObject(r)&&!e.schema.isLimit(r)&&(t=e.createRangeIn(r))}for(const r of t.getItems())if(!e.schema.isInline(r)||Array.from(r.getAttributeKeys()).find(s=>e.schema.getAttributeProperties(s).isFormatting))return!1;return!0}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class ve extends b{static get pluginName(){return"Clipboard"}static get isOfficialPlugin(){return!0}static get requires(){return[A,_,X,Z]}init(){const e=this.editor,t=this.editor.t;e.accessibility.addKeystrokeInfos({keystrokes:[{label:t("Copy selected content"),keystroke:"CTRL+C"},{label:t("Paste content"),keystroke:"CTRL+V"},{label:t("Paste content as plain text"),keystroke:"CTRL+SHIFT+V"}]})}}export{ve as Clipboard,A as ClipboardMarkersUtils,_ as ClipboardPipeline,X as DragDrop,G as DragDropBlockToolbar,w as DragDropTarget,Z as PastePlainText,N as plainTextToHtml};
