import{Plugin as g,Command as _}from"@ckeditor/ckeditor5-core";import{IconPreviousArrow as V,IconFindReplace as y}from"@ckeditor/ckeditor5-icons";import{View as m,ViewCollection as H,FocusCycler as W,submitHandler as L,CollapsibleView as U,SwitchButtonView as C,ButtonView as T,LabeledFieldView as j,createLabeledInputText as q,Dialog as G,DropdownView as K,createDropdown as z,FormHeaderView as Q,MenuBarMenuListItemButtonView as Y,DialogViewPosition as Z,CssTransitionDisablerMixin as J}from"@ckeditor/ckeditor5-ui";import{FocusTracker as X,KeystrokeHandler as ee,isVisible as te,Rect as ie,ObservableMixin as ne,Collection as w,uid as se,scrollViewportToShowTarget as re}from"@ckeditor/ckeditor5-utils";function b(o,{insertAt:i}={}){if(!o||typeof document>"u")return;const e=document.head||document.getElementsByTagName("head")[0],t=document.createElement("style");t.type="text/css",window.litNonce&&t.setAttribute("nonce",window.litNonce),i==="top"&&e.firstChild?e.insertBefore(t,e.firstChild):e.appendChild(t),t.styleSheet?t.styleSheet.cssText=o:t.appendChild(document.createTextNode(o))}b('.ck-vertical-form .ck-button:after{bottom:-1px;content:"";position:absolute;right:-1px;top:-1px;width:0;z-index:1}.ck-vertical-form .ck-button:focus:after{display:none}@media screen and (max-width:600px){.ck.ck-responsive-form .ck-button:after{bottom:-1px;content:"";position:absolute;right:-1px;top:-1px;width:0;z-index:1}.ck.ck-responsive-form .ck-button:focus:after{display:none}}.ck-vertical-form>.ck-button:nth-last-child(2):after{border-right:1px solid var(--ck-color-base-border)}.ck.ck-responsive-form{padding:var(--ck-spacing-large)}.ck.ck-responsive-form:focus{outline:none}[dir=ltr] .ck.ck-responsive-form>:not(:first-child),[dir=rtl] .ck.ck-responsive-form>:not(:last-child){margin-left:var(--ck-spacing-standard)}@media screen and (max-width:600px){.ck.ck-responsive-form{padding:0;width:calc(var(--ck-input-width)*.8)}.ck.ck-responsive-form .ck-labeled-field-view{margin:var(--ck-spacing-large) var(--ck-spacing-large) 0}.ck.ck-responsive-form .ck-labeled-field-view .ck-input-number,.ck.ck-responsive-form .ck-labeled-field-view .ck-input-text{min-width:0;width:100%}.ck.ck-responsive-form .ck-labeled-field-view .ck-labeled-field-view__error{white-space:normal}.ck.ck-responsive-form>.ck-button:nth-last-child(2):after{border-right:1px solid var(--ck-color-base-border)}.ck.ck-responsive-form>.ck-button:last-child,.ck.ck-responsive-form>.ck-button:nth-last-child(2){border-radius:0;margin-top:var(--ck-spacing-large);padding:var(--ck-spacing-standard)}.ck.ck-responsive-form>.ck-button:last-child:not(:focus),.ck.ck-responsive-form>.ck-button:nth-last-child(2):not(:focus){border-top:1px solid var(--ck-color-base-border)}[dir=ltr] .ck.ck-responsive-form>.ck-button:last-child,[dir=ltr] .ck.ck-responsive-form>.ck-button:nth-last-child(2),[dir=rtl] .ck.ck-responsive-form>.ck-button:last-child,[dir=rtl] .ck.ck-responsive-form>.ck-button:nth-last-child(2){margin-left:0}[dir=rtl] .ck.ck-responsive-form>.ck-button:last-child:last-of-type,[dir=rtl] .ck.ck-responsive-form>.ck-button:nth-last-child(2):last-of-type{border-right:1px solid var(--ck-color-base-border)}}'),b(".ck.ck-find-and-replace-form{max-width:100%}.ck.ck-find-and-replace-form .ck-find-and-replace-form__actions,.ck.ck-find-and-replace-form .ck-find-and-replace-form__inputs{display:flex}.ck.ck-find-and-replace-form .ck-find-and-replace-form__actions.ck-find-and-replace-form__inputs .ck-results-counter,.ck.ck-find-and-replace-form .ck-find-and-replace-form__inputs.ck-find-and-replace-form__inputs .ck-results-counter{position:absolute}.ck.ck-find-and-replace-form{width:400px}.ck.ck-find-and-replace-form:focus{outline:none}.ck.ck-find-and-replace-form .ck-find-and-replace-form__actions,.ck.ck-find-and-replace-form .ck-find-and-replace-form__inputs{align-content:stretch;align-items:center;flex:1 1 auto;flex-direction:row;flex-wrap:wrap;margin:0;padding:var(--ck-spacing-large)}.ck.ck-find-and-replace-form .ck-find-and-replace-form__actions>.ck-button,.ck.ck-find-and-replace-form .ck-find-and-replace-form__inputs>.ck-button{flex:0 0 auto}[dir=ltr] .ck.ck-find-and-replace-form .ck-find-and-replace-form__actions>*+*,[dir=ltr] .ck.ck-find-and-replace-form .ck-find-and-replace-form__inputs>*+*{margin-left:var(--ck-spacing-standard)}[dir=rtl] .ck.ck-find-and-replace-form .ck-find-and-replace-form__actions>*+*,[dir=rtl] .ck.ck-find-and-replace-form .ck-find-and-replace-form__inputs>*+*{margin-right:var(--ck-spacing-standard)}.ck.ck-find-and-replace-form .ck-find-and-replace-form__actions .ck-labeled-field-view,.ck.ck-find-and-replace-form .ck-find-and-replace-form__inputs .ck-labeled-field-view{flex:1 1 auto}.ck.ck-find-and-replace-form .ck-find-and-replace-form__actions .ck-labeled-field-view .ck-input,.ck.ck-find-and-replace-form .ck-find-and-replace-form__inputs .ck-labeled-field-view .ck-input{min-width:50px;width:100%}.ck.ck-find-and-replace-form .ck-find-and-replace-form__inputs{align-items:flex-start}.ck.ck-find-and-replace-form .ck-find-and-replace-form__inputs>.ck-button-prev>.ck-icon{transform:rotate(90deg)}.ck.ck-find-and-replace-form .ck-find-and-replace-form__inputs>.ck-button-next>.ck-icon{transform:rotate(-90deg)}.ck.ck-find-and-replace-form .ck-find-and-replace-form__inputs .ck-results-counter{color:var(--ck-color-base-border);top:50%;transform:translateY(-50%)}[dir=ltr] .ck.ck-find-and-replace-form .ck-find-and-replace-form__inputs .ck-results-counter{right:var(--ck-spacing-standard)}[dir=rtl] .ck.ck-find-and-replace-form .ck-find-and-replace-form__inputs .ck-results-counter{left:var(--ck-spacing-standard)}.ck.ck-find-and-replace-form .ck-find-and-replace-form__inputs>.ck-labeled-field-replace{flex:0 0 100%;padding-top:var(--ck-spacing-standard)}[dir=ltr] .ck.ck-find-and-replace-form .ck-find-and-replace-form__inputs>.ck-labeled-field-replace{margin-left:0}[dir=rtl] .ck.ck-find-and-replace-form .ck-find-and-replace-form__inputs>.ck-labeled-field-replace{margin-right:0}.ck.ck-find-and-replace-form .ck-find-and-replace-form__actions{flex-wrap:wrap;justify-content:flex-end;margin-top:calc(var(--ck-spacing-large)*-1)}.ck.ck-find-and-replace-form .ck-find-and-replace-form__actions>.ck-button-find{font-weight:700}.ck.ck-find-and-replace-form .ck-find-and-replace-form__actions>.ck-button-find .ck-button__label{padding-left:var(--ck-spacing-large);padding-right:var(--ck-spacing-large)}.ck.ck-find-and-replace-form .ck-switchbutton{align-items:center;display:flex;flex-direction:row;flex-wrap:nowrap;justify-content:space-between;width:100%}@media screen and (max-width:600px){.ck.ck-find-and-replace-form{max-width:100%;width:300px}.ck.ck-find-and-replace-form.ck-find-and-replace-form__input{flex-wrap:wrap}.ck.ck-find-and-replace-form.ck-find-and-replace-form__input .ck-labeled-field-view{flex:1 0 auto;margin-bottom:var(--ck-spacing-standard);width:100%}.ck.ck-find-and-replace-form.ck-find-and-replace-form__input>.ck-button{text-align:center}.ck.ck-find-and-replace-form.ck-find-and-replace-form__input>.ck-button:first-of-type{flex:1 1 auto}[dir=ltr] .ck.ck-find-and-replace-form.ck-find-and-replace-form__input>.ck-button:first-of-type{margin-left:0}[dir=rtl] .ck.ck-find-and-replace-form.ck-find-and-replace-form__input>.ck-button:first-of-type{margin-right:0}.ck.ck-find-and-replace-form.ck-find-and-replace-form__input>.ck-button:first-of-type .ck-button__label{text-align:center;width:100%}.ck.ck-find-and-replace-form.ck-find-and-replace-form__actions>:not(.ck-labeled-field-view){flex:1 1 auto;flex-wrap:wrap}.ck.ck-find-and-replace-form.ck-find-and-replace-form__actions>:not(.ck-labeled-field-view)>.ck-button{text-align:center}.ck.ck-find-and-replace-form.ck-find-and-replace-form__actions>:not(.ck-labeled-field-view)>.ck-button:first-of-type{flex:1 1 auto}[dir=ltr] .ck.ck-find-and-replace-form.ck-find-and-replace-form__actions>:not(.ck-labeled-field-view)>.ck-button:first-of-type{margin-left:0}[dir=rtl] .ck.ck-find-and-replace-form.ck-find-and-replace-form__actions>:not(.ck-labeled-field-view)>.ck-button:first-of-type{margin-right:0}.ck.ck-find-and-replace-form.ck-find-and-replace-form__actions>:not(.ck-labeled-field-view)>.ck-button .ck-button__label{text-align:center;width:100%}}");/**
* @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class F extends m{children;_findInputView;_replaceInputView;_findButtonView;_findPrevButtonView;_findNextButtonView;_advancedOptionsCollapsibleView;_matchCaseSwitchView;_wholeWordsOnlySwitchView;_replaceButtonView;_replaceAllButtonView;_inputsDivView;_actionButtonsDivView;_focusTracker;_keystrokes;_focusables;focusCycler;constructor(i){super(i);const e=i.t;this.children=this.createCollection(),this.set("matchCount",0),this.set("highlightOffset",0),this.set("isDirty",!1),this.set("_areCommandsEnabled",{}),this.set("_resultsCounterText",""),this.set("_matchCase",!1),this.set("_wholeWordsOnly",!1),this.bind("_searchResultsFound").to(this,"matchCount",this,"isDirty",(t,n)=>t>0&&!n),this._findInputView=this._createInputField(e("Find in text\u2026")),this._findPrevButtonView=this._createButton({label:e("Previous result"),class:"ck-button-prev",icon:V,keystroke:"Shift+F3",tooltip:!0}),this._findNextButtonView=this._createButton({label:e("Next result"),class:"ck-button-next",icon:V,keystroke:"F3",tooltip:!0}),this._replaceInputView=this._createInputField(e("Replace with\u2026"),"ck-labeled-field-replace"),this._inputsDivView=this._createInputsDiv(),this._matchCaseSwitchView=this._createMatchCaseSwitch(),this._wholeWordsOnlySwitchView=this._createWholeWordsOnlySwitch(),this._advancedOptionsCollapsibleView=this._createAdvancedOptionsCollapsible(),this._replaceAllButtonView=this._createButton({label:e("Replace all"),class:"ck-button-replaceall",withText:!0}),this._replaceButtonView=this._createButton({label:e("Replace"),class:"ck-button-replace",withText:!0}),this._findButtonView=this._createButton({label:e("Find"),class:"ck-button-find ck-button-action",withText:!0}),this._actionButtonsDivView=this._createActionButtonsDiv(),this._focusTracker=new X,this._keystrokes=new ee,this._focusables=new H,this.focusCycler=new W({focusables:this._focusables,focusTracker:this._focusTracker,keystrokeHandler:this._keystrokes,actions:{focusPrevious:"shift + tab",focusNext:"tab"}}),this.children.addMany([this._inputsDivView,this._advancedOptionsCollapsibleView,this._actionButtonsDivView]),this.setTemplate({tag:"form",attributes:{class:["ck","ck-find-and-replace-form"],tabindex:"-1"},children:this.children})}render(){super.render(),L({view:this}),this._initFocusCycling(),this._initKeystrokeHandling()}destroy(){super.destroy(),this._focusTracker.destroy(),this._keystrokes.destroy()}focus(i){i===-1?this.focusCycler.focusLast():this.focusCycler.focusFirst()}reset(){this._findInputView.errorText=null,this.isDirty=!0}get _textToFind(){return this._findInputView.fieldView.element.value}get _textToReplace(){return this._replaceInputView.fieldView.element.value}_createInputsDiv(){const i=this.locale,e=i.t,t=new m(i);return this._findInputView.fieldView.on("input",()=>{this.isDirty=!0}),this._findPrevButtonView.delegate("execute").to(this,"findPrevious"),this._findNextButtonView.delegate("execute").to(this,"findNext"),this._findPrevButtonView.bind("isEnabled").to(this,"_areCommandsEnabled",({findPrevious:n})=>n),this._findNextButtonView.bind("isEnabled").to(this,"_areCommandsEnabled",({findNext:n})=>n),this._injectFindResultsCounter(),this._replaceInputView.bind("isEnabled").to(this,"_areCommandsEnabled",this,"_searchResultsFound",({replace:n},s)=>n&&s),this._replaceInputView.bind("infoText").to(this._replaceInputView,"isEnabled",this._replaceInputView,"isFocused",(n,s)=>n||!s?"":e("Tip: Find some text first in order to replace it.")),t.setTemplate({tag:"div",attributes:{class:["ck","ck-find-and-replace-form__inputs"]},children:[this._findInputView,this._findPrevButtonView,this._findNextButtonView,this._replaceInputView]}),t}_onFindButtonExecute(){if(!this._textToFind){const i=this.t;this._findInputView.errorText=i("Text to find must not be empty.");return}this.isDirty=!1,this.fire("findNext",{searchText:this._textToFind,matchCase:this._matchCase,wholeWords:this._wholeWordsOnly})}_injectFindResultsCounter(){const i=this.locale,e=i.t,t=this.bindTemplate,n=new m(this.locale);this.bind("_resultsCounterText").to(this,"highlightOffset",this,"matchCount",(c,r)=>e("%0 of %1",[c,r])),n.setTemplate({tag:"span",attributes:{class:["ck","ck-results-counter",t.if("isDirty","ck-hidden")]},children:[{text:t.to("_resultsCounterText")}]});const s=()=>{const c=this._findInputView.fieldView.element;if(!c||!te(c))return;const r=new ie(n.element).width,d=i.uiLanguageDirection==="ltr"?"paddingRight":"paddingLeft";r?c.style[d]=`calc( 2 * var(--ck-spacing-standard) + ${r}px )`:c.style[d]=""};this.on("change:_resultsCounterText",s,{priority:"low"}),this.on("change:isDirty",s,{priority:"low"}),this._findInputView.template.children[0].children.push(n)}_createAdvancedOptionsCollapsible(){const i=this.locale.t,e=new U(this.locale,[this._matchCaseSwitchView,this._wholeWordsOnlySwitchView]);return e.set({label:i("Advanced options"),isCollapsed:!0}),e}_createActionButtonsDiv(){const i=new m(this.locale);return this._replaceButtonView.bind("isEnabled").to(this,"_areCommandsEnabled",this,"_searchResultsFound",({replace:e},t)=>e&&t),this._replaceAllButtonView.bind("isEnabled").to(this,"_areCommandsEnabled",this,"_searchResultsFound",({replaceAll:e},t)=>e&&t),this._replaceButtonView.on("execute",()=>{this.fire("replace",{searchText:this._textToFind,replaceText:this._textToReplace})}),this._replaceAllButtonView.on("execute",()=>{this.fire("replaceAll",{searchText:this._textToFind,replaceText:this._textToReplace}),this.focus()}),this._findButtonView.on("execute",this._onFindButtonExecute.bind(this)),i.setTemplate({tag:"div",attributes:{class:["ck","ck-find-and-replace-form__actions"]},children:[this._replaceAllButtonView,this._replaceButtonView,this._findButtonView]}),i}_createMatchCaseSwitch(){const i=this.locale.t,e=new C(this.locale);return e.set({label:i("Match case"),withText:!0}),e.bind("isOn").to(this,"_matchCase"),e.on("execute",()=>{this._matchCase=!this._matchCase,this.isDirty=!0}),e}_createWholeWordsOnlySwitch(){const i=this.locale.t,e=new C(this.locale);return e.set({label:i("Whole words only"),withText:!0}),e.bind("isOn").to(this,"_wholeWordsOnly"),e.on("execute",()=>{this._wholeWordsOnly=!this._wholeWordsOnly,this.isDirty=!0}),e}_initFocusCycling(){[this._findInputView,this._findPrevButtonView,this._findNextButtonView,this._replaceInputView,this._advancedOptionsCollapsibleView.buttonView,this._matchCaseSwitchView,this._wholeWordsOnlySwitchView,this._replaceAllButtonView,this._replaceButtonView,this._findButtonView].forEach(e=>{this._focusables.add(e),this._focusTracker.add(e.element)})}_initKeystrokeHandling(){const i=t=>t.stopPropagation(),e=t=>{t.stopPropagation(),t.preventDefault()};this._keystrokes.listenTo(this.element),this._keystrokes.set("f3",t=>{e(t),this._findNextButtonView.fire("execute")}),this._keystrokes.set("shift+f3",t=>{e(t),this._findPrevButtonView.fire("execute")}),this._keystrokes.set("enter",t=>{const n=t.target;n===this._findInputView.fieldView.element?(this._areCommandsEnabled.findNext?this._findNextButtonView.fire("execute"):this._findButtonView.fire("execute"),e(t)):n===this._replaceInputView.fieldView.element&&!this.isDirty&&(this._replaceButtonView.fire("execute"),e(t))}),this._keystrokes.set("shift+enter",t=>{t.target===this._findInputView.fieldView.element&&(this._areCommandsEnabled.findPrevious?this._findPrevButtonView.fire("execute"):this._findButtonView.fire("execute"),e(t))}),this._keystrokes.set("arrowright",i),this._keystrokes.set("arrowleft",i),this._keystrokes.set("arrowup",i),this._keystrokes.set("arrowdown",i)}_createButton(i){const e=new T(this.locale);return e.set(i),e}_createInputField(i,e){const t=new j(this.locale,q);return t.label=i,t.class=e,t}}/**
* @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class A extends g{static get requires(){return[G]}static get pluginName(){return"FindAndReplaceUI"}static get isOfficialPlugin(){return!0}formView;constructor(i){super(i),i.config.define("findAndReplace.uiType","dialog"),this.formView=null}init(){const i=this.editor,e=i.config.get("findAndReplace.uiType")==="dropdown",t=i.commands.get("find"),n=this.editor.t;i.ui.componentFactory.add("findAndReplace",()=>{let s;return e?(s=this._createDropdown(),s.bind("isEnabled").to(t)):s=this._createDialogButtonForToolbar(),i.keystrokes.set("Ctrl+F",(c,r)=>{if(t.isEnabled){if(s instanceof K){const d=s.buttonView;d.isOn||d.fire("execute")}else s.isOn?i.plugins.get("Dialog").view.focus():s.fire("execute");r()}}),s}),e||i.ui.componentFactory.add("menuBar:findAndReplace",()=>this._createDialogButtonForMenuBar()),i.accessibility.addKeystrokeInfos({keystrokes:[{label:n("Find in the document"),keystroke:"CTRL+F"}]})}_createDropdown(){const i=this.editor,e=i.locale.t,t=z(i.locale);return t.once("change:isOpen",()=>{this.formView=this._createFormView(),this.formView.children.add(new Q(i.locale,{label:e("Find and replace")}),0),t.panelView.children.add(this.formView)}),t.on("change:isOpen",(n,s,c)=>{c?this._setupFormView():this.fire("searchReseted")},{priority:"low"}),t.buttonView.set({icon:y,label:e("Find and replace"),keystroke:"CTRL+F",tooltip:!0}),t}_createDialogButtonForToolbar(){const i=this.editor,e=this._createButton(T),t=i.plugins.get("Dialog");return e.set({tooltip:!0}),e.bind("isOn").to(t,"id",n=>n==="findAndReplace"),e.on("execute",()=>{e.isOn?t.hide():this._showDialog()}),e}_createDialogButtonForMenuBar(){const i=this._createButton(Y),e=this.editor.plugins.get("Dialog"),t=this.editor.plugins.get("Dialog");return i.set({role:"menuitemcheckbox",isToggleable:!0}),i.bind("isOn").to(t,"id",n=>n==="findAndReplace"),i.on("execute",()=>{if(e.id==="findAndReplace"){e.hide();return}this._showDialog()}),i}_createButton(i){const e=this.editor,t=e.commands.get("find"),n=new i(e.locale),s=e.locale.t;return n.bind("isEnabled").to(t),n.set({icon:y,label:s("Find and replace"),keystroke:"CTRL+F"}),n}_showDialog(){const i=this.editor,e=i.plugins.get("Dialog"),t=i.locale.t;this.formView||(this.formView=this._createFormView()),e.show({id:"findAndReplace",title:t("Find and replace"),content:this.formView,position:Z.EDITOR_TOP_SIDE,onShow:()=>{this._setupFormView()},onHide:()=>{this.fire("searchReseted")}})}_createFormView(){const i=this.editor,e=new(J(F))(i.locale),t=i.commands,s=this.editor.plugins.get("FindAndReplaceEditing").state;e.bind("highlightOffset").to(s,"highlightedOffset"),e.listenTo(s.results,"change",()=>{e.matchCount=s.results.length});const c=t.get("findNext"),r=t.get("findPrevious"),d=t.get("replace"),a=t.get("replaceAll");return e.bind("_areCommandsEnabled").to(c,"isEnabled",r,"isEnabled",d,"isEnabled",a,"isEnabled",(l,h,f,u)=>({findNext:l,findPrevious:h,replace:f,replaceAll:u})),e.delegate("findNext","findPrevious","replace","replaceAll").to(this),e.on("change:isDirty",(l,h,f)=>{f&&this.fire("searchReseted")}),e}_setupFormView(){this.formView.disableCssTransitions(),this.formView.reset(),this.formView._findInputView.fieldView.select(),this.formView.enableCssTransitions()}}/**
* @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class B extends _{_state;constructor(i,e){super(i),this.isEnabled=!0,this.affectsData=!1,this._state=e}execute(i,{matchCase:e,wholeWords:t}={}){const{editor:n}=this,{model:s}=n,c=n.plugins.get("FindAndReplaceUtils");let r,d="";typeof i=="string"?r=(...h)=>({results:c.findByTextCallback(i,{matchCase:e,wholeWords:t})(...h),searchText:i}):r=i;const a=r;r=(...h)=>{const f=a(...h);return f&&"searchText"in f&&(d=f.searchText),f};const l=s.document.getRootNames().reduce((h,f)=>c.updateFindResultFromRange(s.createRangeIn(s.document.getRoot(f)),s,r,h),null);return this._state.clear(s),this._state.results.addMany(l),this._state.highlightedResult=l.get(0),this._state.searchText=d,r&&(this._state.lastSearchCallback=r),this._state.matchCase=!!e,this._state.matchWholeWords=!!t,{results:l,findCallback:r}}}/**
* @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class I extends ne(){constructor(i){super(),this.set("results",new w),this.set("highlightedResult",null),this.set("highlightedOffset",0),this.set("searchText",""),this.set("replaceText",""),this.set("lastSearchCallback",null),this.set("matchCase",!1),this.set("matchWholeWords",!1),this.results.on("change",(e,{removed:t,index:n})=>{if(Array.from(t).length){let s=!1;if(i.change(c=>{for(const r of t)this.highlightedResult===r&&(s=!0),i.markers.has(r.marker.name)&&c.removeMarker(r.marker)}),s){const c=n>=this.results.length?0:n;this.highlightedResult=this.results.get(c)}}}),this.on("change:highlightedResult",()=>{this.refreshHighlightOffset(i)})}clear(i){this.searchText="",i.change(e=>{if(this.highlightedResult){const t=this.highlightedResult.marker.name.split(":")[1],n=i.markers.get(`findResultHighlighted:${t}`);n&&e.removeMarker(n)}[...this.results].forEach(({marker:t})=>{e.removeMarker(t)})}),this.results.clear()}refreshHighlightOffset(i){const{highlightedResult:e,results:t}=this;e?this.highlightedOffset=x(i,[...t]).indexOf(e)+1:this.highlightedOffset=0}}function x(o,i){const e={before:-1,same:0,after:1,different:1};return o.document.getRootNames().flatMap(t=>i.filter(n=>n.marker.getStart().root.rootName===t).sort((n,s)=>e[n.marker.getStart().compareWith(s.marker.getStart())]))}/**
* @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class v extends _{_state;constructor(i,e){super(i),this.isEnabled=!0,this._state=e,this._isEnabledBasedOnSelection=!1}_replace(i,e){const{model:t}=this.editor,n=e.marker.getRange();t.canEditAt(n)&&t.change(s=>{if(n.root.rootName==="$graveyard"){this._state.results.remove(e);return}let c={};for(const r of n.getItems())if(r.is("$text")||r.is("$textProxy")){c=r.getAttributes();break}t.insertContent(s.createText(i,c),n),this._state.results.has(e)&&this._state.results.remove(e)})}}/**
* @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class E extends v{execute(i,e){const t=Math.max(this._state.highlightedOffset-1,0);if(this._replace(i,e),this._state.results.length){const n=x(this.editor.model,[...this._state.results]);this._state.highlightedResult=n[t%n.length]}}}/**
* @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class D extends v{execute(i,e){const{editor:t}=this,{model:n}=t,s=t.plugins.get("FindAndReplaceUtils"),c=e instanceof w?e:n.document.getRootNames().reduce((r,d)=>s.updateFindResultFromRange(n.createRangeIn(n.document.getRoot(d)),n,s.findByTextCallback(e,this._state),r),null);c.length&&n.change(()=>{[...c].forEach(r=>{this._replace(i,r)})})}}/**
* @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class R extends _{_state;constructor(i,e){super(i),this.affectsData=!1,this._state=e,this.isEnabled=!1,this.listenTo(this._state.results,"change",()=>{this.isEnabled=this._state.results.length>1})}refresh(){this.isEnabled=this._state.results.length>1}execute(){const i=this._state.results,e=i.getIndex(this._state.highlightedResult),t=e+1>=i.length?0:e+1;this._state.highlightedResult=this._state.results.get(t)}}/**
* @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class O extends R{execute(){const e=this._state.results.getIndex(this._state.highlightedResult),t=e-1<0?this._state.results.length-1:e-1;this._state.highlightedResult=this._state.results.get(t)}}function ae(o,i,{signal:e,edges:t}={}){let n,s=null;const c=t!=null&&t.includes("leading"),r=t==null||t.includes("trailing"),d=()=>{s!==null&&(o.apply(n,s),n=void 0,s=null)},a=()=>{r&&d(),u()};let l=null;const h=()=>{l!=null&&clearTimeout(l),l=setTimeout(()=>{l=null,a()},i)},f=()=>{l!==null&&(clearTimeout(l),l=null)},u=()=>{f(),n=void 0,s=null},k=()=>{f(),d()},p=function(...M){if(e?.aborted)return;n=this,s=M;const $=l==null;h(),c&&$&&d()};return p.schedule=h,p.cancel=u,p.flush=k,e?.addEventListener("abort",u,{once:!0}),p}function oe(o,i=0,e={}){typeof e!="object"&&(e={});const{leading:t=!1,trailing:n=!0,maxWait:s}=e,c=Array(2);t&&(c[0]="leading"),n&&(c[1]="trailing");let r,d=null;const a=ae(function(...f){r=o.apply(this,f),d=null},i,{edges:c}),l=function(...f){return s!=null&&(d===null&&(d=Date.now()),Date.now()-d>=s)?(r=o.apply(this,f),d=Date.now(),a.cancel(),a.schedule(),r):(a.apply(this,f),r)},h=()=>(a.flush(),r);return l.cancel=a.cancel,l.flush=h,l}function S(o){if(o==null)return"";if(typeof o=="string")return o;if(Array.isArray(o))return o.map(S).join(",");const i=String(o);return i==="0"&&Object.is(Number(o),-0)?"-0":i}function ce(o){return o.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&")}function le(o){return ce(S(o))}/**
* @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class P extends g{static get pluginName(){return"FindAndReplaceUtils"}static get isOfficialPlugin(){return!0}updateFindResultFromRange(i,e,t,n){const s=n||new w,c=r=>s.find(d=>{const{marker:a}=d,l=a.getRange(),h=r.getRange();return l.isEqual(h)});return e.change(r=>{[...i].forEach(({type:d,item:a})=>{if(d==="elementStart"&&e.schema.checkChild(a,"$text")){let l=t({item:a,text:this.rangeToText(e.createRangeIn(a))});if(!l)return;"results"in l&&(l=l.results),l.forEach(h=>{const f=`findResult:${se()}`,u=r.addMarker(f,{usingOperation:!1,affectsData:!1,range:r.createRange(r.createPositionAt(a,h.start),r.createPositionAt(a,h.end))}),k=de(s,u);c(u)||s.add({id:f,label:h.label,marker:u},k)})}})}),s}rangeToText(i){return Array.from(i.getItems({shallow:!0})).reduce((e,t)=>t.is("$text")||t.is("$textProxy")?e+t.data:`${e}
`,"")}findByTextCallback(i,e){let t="gu";e.matchCase||(t+="i");let n=`(${le(i)})`;if(e.wholeWords){const r="[^a-zA-Z\xC0-\u024F\u1E00-\u1EFF]";new RegExp("^"+r).test(i)||(n=`(^|${r}|_)${n}`),new RegExp(r+"$").test(i)||(n=`${n}(?=_|${r}|$)`)}const s=new RegExp(n,t);function c({text:r}){return[...r.matchAll(s)].map(he)}return c}}function de(o,i){const e=o.find(({marker:t})=>i.getStart().isBefore(t.getStart()));return e?o.getIndex(e):o.length}function he(o){const i=o.length-1;let e=o.index;return o.length===3&&(e+=o[1].length),{label:o[i],start:e,end:e+o[i].length}}b(".ck-find-result{background:var(--ck-color-highlight-background);color:var(--ck-color-text)}.ck-find-result_selected{background:#ff9633}");/**
* @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/const fe="ck-find-result_selected";class N extends g{static get requires(){return[P]}static get pluginName(){return"FindAndReplaceEditing"}static get licenseFeatureCode(){return"FAR"}static get isPremiumPlugin(){return!0}static get isOfficialPlugin(){return!0}state;init(){this.state=new I(this.editor.model),this.set("_isSearchActive",!1),this._defineConverters(),this._defineCommands(),this.listenTo(this.state,"change:highlightedResult",(t,n,s,c)=>{const{model:r}=this.editor;r.change(d=>{if(c){const a=c.marker.name.split(":")[1],l=r.markers.get(`findResultHighlighted:${a}`);l&&d.removeMarker(l)}if(s){const a=s.marker.name.split(":")[1];d.addMarker(`findResultHighlighted:${a}`,{usingOperation:!1,affectsData:!1,range:s.marker.getRange()})}})});/* istanbul ignore next -- @preserve */const e=oe(((t,n,s)=>{if(s){const c=this.editor.editing.view.domConverter,r=this.editor.editing.mapper.toViewRange(s.marker.getRange());re({target:c.viewRangeToDom(r),viewportOffset:40})}}).bind(this),32);this.listenTo(this.state,"change:highlightedResult",e,{priority:"low"}),this.listenTo(this.editor,"destroy",e.cancel),this.on("change:_isSearchActive",(t,n,s)=>{s?this.listenTo(this.editor.model.document,"change:data",this._onDocumentChange):this.stopListening(this.editor.model.document,"change:data",this._onDocumentChange)})}find(i,e){return this._isSearchActive=!0,this.editor.execute("find",i,e),this.state.results}stop(){this.state.clear(this.editor.model),this._isSearchActive=!1}_defineCommands(){this.editor.commands.add("find",new B(this.editor,this.state)),this.editor.commands.add("findNext",new R(this.editor,this.state)),this.editor.commands.add("findPrevious",new O(this.editor,this.state)),this.editor.commands.add("replace",new E(this.editor,this.state)),this.editor.commands.add("replaceAll",new D(this.editor,this.state))}_defineConverters(){const{editor:i}=this;i.conversion.for("editingDowncast").markerToHighlight({model:"findResult",view:({markerName:e})=>{const[,t]=e.split(":");return{name:"span",classes:["ck-find-result"],attributes:{"data-find-result":t}}}}),i.conversion.for("editingDowncast").markerToHighlight({model:"findResultHighlighted",view:({markerName:e})=>{const[,t]=e.split(":");return{name:"span",classes:[fe],attributes:{"data-find-result":t}}}})}_onDocumentChange=()=>{const i=new Set,e=new Set,t=this.editor.model,{results:n}=this.state,s=t.document.differ.getChanges(),c=t.document.differ.getChangedMarkers();s.forEach(a=>{a.position&&(a.name==="$text"||a.position.nodeAfter&&t.schema.isInline(a.position.nodeAfter)?(i.add(a.position.parent),[...t.markers.getMarkersAtPosition(a.position)].forEach(l=>{e.add(l.name)})):a.type==="insert"&&a.position.nodeAfter&&i.add(a.position.nodeAfter))}),c.forEach(({name:a,data:{newRange:l}})=>{l&&l.start.root.rootName==="$graveyard"&&e.add(a)}),i.forEach(a=>{[...t.markers.getMarkersIntersectingRange(t.createRangeIn(a))].forEach(h=>e.add(h.name))}),e.forEach(a=>{n.has(a)&&(n.get(a)===this.state.highlightedResult&&(this.state.highlightedResult=null),n.remove(a))});const r=[],d=this.editor.plugins.get("FindAndReplaceUtils");i.forEach(a=>{const l=d.updateFindResultFromRange(t.createRangeOn(a),t,this.state.lastSearchCallback,n);r.push(...l)}),c.forEach(a=>{if(a.data.newRange){const l=d.updateFindResultFromRange(a.data.newRange,t,this.state.lastSearchCallback,n);r.push(...l)}}),!this.state.highlightedResult&&r.length?this.state.highlightedResult=r[0]:this.state.refreshHighlightOffset(t)}}/**
* @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class ue extends g{static get requires(){return[N,A]}static get pluginName(){return"FindAndReplace"}static get isOfficialPlugin(){return!0}init(){const i=this.editor.plugins.get("FindAndReplaceUI"),e=this.editor.plugins.get("FindAndReplaceEditing"),t=e.state;i.on("findNext",(n,s)=>{s?(t.searchText=s.searchText,e.find(s.searchText,s)):this.editor.execute("findNext")}),i.on("findPrevious",(n,s)=>{s&&t.searchText!==s.searchText?e.find(s.searchText):this.editor.execute("findPrevious")}),i.on("replace",(n,s)=>{t.searchText!==s.searchText&&e.find(s.searchText);const c=t.highlightedResult;c&&this.editor.execute("replace",s.replaceText,c)}),i.on("replaceAll",(n,s)=>{t.searchText!==s.searchText&&e.find(s.searchText),this.editor.execute("replaceAll",s.replaceText,t.results)}),i.on("searchReseted",()=>{t.clear(this.editor.model),e.stop()})}}export{ue as FindAndReplace,N as FindAndReplaceEditing,F as FindAndReplaceFormView,I as FindAndReplaceState,A as FindAndReplaceUI,P as FindAndReplaceUtils,B as FindCommand,R as FindNextCommand,O as FindPreviousCommand,v as FindReplaceCommandBase,D as ReplaceAllCommand,E as ReplaceCommand,x as _sortFindResultsByMarkerPositions};
