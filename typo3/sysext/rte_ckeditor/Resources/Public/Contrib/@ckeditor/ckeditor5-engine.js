import{logWarning as e,EmitterMixin as t,CKEditorError as n,compareArrays as s,toArray as i,toMap as r,isIterable as o,ObservableMixin as a,count as l,EventInfo as c,Collection as h,keyCodes as d,isText as u,env as f,remove as m,insertAt as g,diff as p,fastDiff as _,isNode as w,isComment as y,indexOf as b,global as v,isValidAttributeName as P,first as A,getAncestors as C,DomEmitterMixin as k,getCode as E,isArrowKeyCode as S,scrollViewportToShowTarget as R,uid as x,spliceArray as T,priorities as O,isInsideSurrogatePair as M,isInsideCombinedSymbol as N,isInsideEmojiSequence as I}from"@ckeditor/ckeditor5-utils";import{clone as F,isObject as B,unset as D,get as V,merge as $,set as q,isPlainObject as L,extend as W,debounce as j,isEqualWith as z,cloneDeep as U,isEqual as J}from"lodash-es";function K(e,{insertAt:t}={}){if(!e||"undefined"==typeof document)return;const n=document.head||document.getElementsByTagName("head")[0],s=document.createElement("style");s.type="text/css",window.litNonce&&s.setAttribute("nonce",window.litNonce),"top"===t&&n.firstChild?n.insertBefore(s,n.firstChild):n.appendChild(s),s.styleSheet?s.styleSheet.cssText=e:s.appendChild(document.createTextNode(e))}K(".ck .ck-placeholder,.ck.ck-placeholder{position:relative}.ck .ck-placeholder:before,.ck.ck-placeholder:before{content:attr(data-placeholder);left:0;pointer-events:none;position:absolute;right:0}.ck.ck-read-only .ck-placeholder:before{display:none}.ck.ck-reset_all .ck-placeholder{position:relative}@media (forced-colors:active){.ck .ck-placeholder,.ck.ck-placeholder{forced-color-adjust:preserve-parent-color}}.ck .ck-placeholder:before,.ck.ck-placeholder:before{cursor:text}@media (forced-colors:none){.ck .ck-placeholder:before,.ck.ck-placeholder:before{color:var(--ck-color-engine-placeholder-text)}}@media (forced-colors:active){.ck .ck-placeholder:before,.ck.ck-placeholder:before{font-style:italic;margin-left:1px}}");
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */
const G=new WeakMap;let H=!1;function Y({view:t,element:n,text:s,isDirectHost:i=!0,keepOnFocus:r=!1}){const o=t.document;function a(e){G.get(o).set(n,{text:e,isDirectHost:i,keepOnFocus:r,hostElement:i?n:null}),t.change((e=>te(o,e)))}G.has(o)||(G.set(o,new Map),o.registerPostFixer((e=>te(o,e))),o.on("change:isComposing",(()=>{t.change((e=>te(o,e)))}),{priority:"high"})),n.is("editableElement")&&n.on("change:placeholder",((e,t,n)=>{a(n)})),n.placeholder?a(n.placeholder):s&&a(s),s&&function(){H||e("enableplaceholder-deprecated-text-option");H=!0}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */()}function X(e,t){const n=t.document;G.has(n)&&e.change((e=>{const s=G.get(n),i=s.get(t);e.removeAttribute("data-placeholder",i.hostElement),Z(e,i.hostElement),s.delete(t)}))}function Q(e,t){return!t.hasClass("ck-placeholder")&&(e.addClass("ck-placeholder",t),!0)}function Z(e,t){return!!t.hasClass("ck-placeholder")&&(e.removeClass("ck-placeholder",t),!0)}function ee(e,t){if(!e.isAttached())return!1;const n=Array.from(e.getChildren()).some((e=>!e.is("uiElement")));if(n)return!1;const s=e.document,i=s.selection.anchor;return(!s.isComposing||!i||i.parent!==e)&&(!!t||(!s.isFocused||!!i&&i.parent!==e))}function te(e,t){const n=G.get(e),s=[];let i=!1;for(const[e,r]of n)r.isDirectHost&&(s.push(e),ne(t,e,r)&&(i=!0));for(const[e,r]of n){if(r.isDirectHost)continue;const n=se(e);n&&(s.includes(n)||(r.hostElement=n,ne(t,e,r)&&(i=!0)))}return i}function ne(e,t,n){const{text:s,isDirectHost:i,hostElement:r}=n;let o=!1;r.getAttribute("data-placeholder")!==s&&(e.setAttribute("data-placeholder",s,r),o=!0);return(i||1==t.childCount)&&ee(r,n.keepOnFocus)?Q(e,r)&&(o=!0):Z(e,r)&&(o=!0),o}function se(e){if(e.childCount){const t=e.getChild(0);if(t.is("element")&&!t.is("uiElement")&&!t.is("attributeElement"))return t}return null}let ie=class{
/* istanbul ignore next -- @preserve */
is(){throw new Error("is() method is abstract")}},re=class extends(t(ie)){constructor(e){super(),this.document=e,this.parent=null}get index(){let e;if(!this.parent)return null;if(-1==(e=this.parent.getChildIndex(this)))throw new n("view-node-not-found-in-parent",this);return e}get nextSibling(){const e=this.index;return null!==e&&this.parent.getChild(e+1)||null}get previousSibling(){const e=this.index;return null!==e&&this.parent.getChild(e-1)||null}get root(){let e=this;for(;e.parent;)e=e.parent;return e}isAttached(){return this.root.is("rootElement")}getPath(){const e=[];let t=this;for(;t.parent;)e.unshift(t.index),t=t.parent;return e}getAncestors(e={}){const t=[];let n=e.includeSelf?this:this.parent;for(;n;)t[e.parentFirst?"push":"unshift"](n),n=n.parent;return t}getCommonAncestor(e,t={}){const n=this.getAncestors(t),s=e.getAncestors(t);let i=0;for(;n[i]==s[i]&&n[i];)i++;return 0===i?null:n[i-1]}isBefore(e){if(this==e)return!1;if(this.root!==e.root)return!1;const t=this.getPath(),n=e.getPath(),i=s(t,n);switch(i){case"prefix":return!0;case"extension":return!1;default:return t[i]<n[i]}}isAfter(e){return this!=e&&(this.root===e.root&&!this.isBefore(e))}_remove(){this.parent._removeChildren(this.index)}_fireChange(e,t){this.fire(`change:${e}`,t),this.parent&&this.parent._fireChange(e,t)}toJSON(){const e=F(this);return delete e.parent,e}};
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */re.prototype.is=function(e){return"node"===e||"view:node"===e};
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */
let oe=class e extends re{constructor(e,t){super(e),this._textData=t}get data(){return this._textData}get _data(){return this.data}set _data(e){this._fireChange("text",this),this._textData=e}isSimilar(t){return t instanceof e&&(this===t||this.data===t.data)}_clone(){return new e(this.document,this.data)}};oe.prototype.is=function(e){return"$text"===e||"view:$text"===e||"text"===e||"view:text"===e||"node"===e||"view:node"===e};
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */
let ae=class extends ie{constructor(e,t,s){if(super(),this.textNode=e,t<0||t>e.data.length)throw new n("view-textproxy-wrong-offsetintext",this);if(s<0||t+s>e.data.length)throw new n("view-textproxy-wrong-length",this);this.data=e.data.substring(t,t+s),this.offsetInText=t}get offsetSize(){return this.data.length}get isPartial(){return this.data.length!==this.textNode.data.length}get parent(){return this.textNode.parent}get root(){return this.textNode.root}get document(){return this.textNode.document}getAncestors(e={}){const t=[];let n=e.includeSelf?this.textNode:this.parent;for(;null!==n;)t[e.parentFirst?"push":"unshift"](n),n=n.parent;return t}};ae.prototype.is=function(e){return"$textProxy"===e||"view:$textProxy"===e||"textProxy"===e||"view:textProxy"===e};
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */
class le{constructor(...e){this._patterns=[],this.add(...e)}add(...e){for(let t of e)("string"==typeof t||t instanceof RegExp)&&(t={name:t}),this._patterns.push(t)}match(...e){for(const t of e)for(const e of this._patterns){const n=ce(t,e);if(n)return{element:t,pattern:e,match:n}}return null}matchAll(...e){const t=[];for(const n of e)for(const e of this._patterns){const s=ce(n,e);s&&t.push({element:n,pattern:e,match:s})}return t.length>0?t:null}getElementName(){if(1!==this._patterns.length)return null;const e=this._patterns[0],t=e.name;return"function"==typeof e||!t||t instanceof RegExp?null:t}}function ce(t,n){if("function"==typeof n)return n(t);const s={};return n.name&&(s.name=function(e,t){if(e instanceof RegExp)return!!t.match(e);return e===t}(n.name,t.name),!s.name)||n.attributes&&(s.attributes=function(t,n){const s=new Set(n.getAttributeKeys());"object"!=typeof t||t instanceof RegExp||Array.isArray(t)?(s.delete("style"),s.delete("class")):(void 0!==t.style&&e("matcher-pattern-deprecated-attributes-style-key",t),void 0!==t.class&&e("matcher-pattern-deprecated-attributes-class-key",t));return he(t,s,(e=>n.getAttribute(e)))}(n.attributes,t),!s.attributes)||n.classes&&(s.classes=function(e,t){return he(e,t.getClassNames(),(/* istanbul ignore next -- @preserve */()=>{}))}(n.classes,t),!s.classes)||n.styles&&(s.styles=function(e,t){return he(e,t.getStyleNames(!0),(e=>t.getStyle(e)))}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */(n.styles,t),!s.styles)?null:s}function he(t,n,s){const i=function(t){if(Array.isArray(t))return t.map((t=>"object"!=typeof t||t instanceof RegExp?[t,!0]:(void 0!==t.key&&void 0!==t.value||e("matcher-pattern-missing-key-or-value",t),[t.key,t.value])));if("object"!=typeof t||t instanceof RegExp)return[[t,!0]];const n=[];for(const e in t)Object.prototype.hasOwnProperty.call(t,e)&&n.push([e,t[e]]);return n}(t),r=Array.from(n),o=[];if(i.forEach((([e,t])=>{r.forEach((n=>{(function(e,t){return!0===e||e===t||e instanceof RegExp&&t.match(e)})(e,n)&&function(e,t,n){if(!0===e)return!0;const s=n(t);return e===s||e instanceof RegExp&&!!String(s).match(e)}(t,n,s)&&o.push(n)}))})),i.length&&!(o.length<i.length))return o}class de{constructor(e){this._cachedStyleNames=null,this._cachedExpandedStyleNames=null,this._styles={},this._styleProcessor=e}get isEmpty(){return!Object.entries(this._styles).length}get size(){return this.isEmpty?0:this.getStyleNames().length}setTo(e){this.clear();const t=function(e){let t=null,n=0,s=0,i=null;const r=new Map;if(""===e)return r;";"!=e.charAt(e.length-1)&&(e+=";");for(let o=0;o<e.length;o++){const a=e.charAt(o);if(null===t)switch(a){case":":i||(i=e.substr(n,o-n),s=o+1);break;case'"':case"'":t=a;break;case";":{const t=e.substr(s,o-s);i&&r.set(i.trim(),t.trim()),i=null,n=o+1;break}}else a===t&&(t=null)}return r}(e);for(const[e,n]of t)this._styleProcessor.toNormalizedForm(e,n,this._styles)}has(e){if(this.isEmpty)return!1;const t=this._styleProcessor.getReducedForm(e,this._styles).find((([t])=>t===e));return Array.isArray(t)}set(e,t){if(this._cachedStyleNames=null,this._cachedExpandedStyleNames=null,B(e))for(const[t,n]of Object.entries(e))this._styleProcessor.toNormalizedForm(t,n,this._styles);else this._styleProcessor.toNormalizedForm(e,t,this._styles)}remove(e){this._cachedStyleNames=null,this._cachedExpandedStyleNames=null;const t=fe(e);D(this._styles,t),delete this._styles[e],this._cleanEmptyObjectsOnPath(t)}getNormalized(e){return this._styleProcessor.getNormalized(e,this._styles)}toString(){return this.isEmpty?"":this.getStylesEntries().map((e=>e.join(":"))).sort().join(";")+";"}getAsString(e){if(this.isEmpty)return;if(this._styles[e]&&!B(this._styles[e]))return this._styles[e];const t=this._styleProcessor.getReducedForm(e,this._styles).find((([t])=>t===e));return Array.isArray(t)?t[1]:void 0}getStyleNames(e=!1){return this.isEmpty?[]:e?(this._cachedExpandedStyleNames=this._cachedExpandedStyleNames||this._styleProcessor.getStyleNames(this._styles),this._cachedExpandedStyleNames):(this._cachedStyleNames=this._cachedStyleNames||this.getStylesEntries().map((([e])=>e)),this._cachedStyleNames)}clear(){this._styles={},this._cachedStyleNames=null,this._cachedExpandedStyleNames=null}getStylesEntries(){const e=[],t=Object.keys(this._styles);for(const n of t)e.push(...this._styleProcessor.getReducedForm(n,this._styles));return e}_cleanEmptyObjectsOnPath(e){const t=e.split(".");if(!(t.length>1))return;const n=t.splice(0,t.length-1).join("."),s=V(this._styles,n);if(!s)return;!Object.keys(s).length&&this.remove(n)}}class ue{constructor(){this._normalizers=new Map,this._extractors=new Map,this._reducers=new Map,this._consumables=new Map}toNormalizedForm(e,t,n){if(B(t))me(n,fe(e),t);else if(this._normalizers.has(e)){const s=this._normalizers.get(e),{path:i,value:r}=s(t);me(n,i,r)}else me(n,e,t)}getNormalized(e,t){if(!e)return $({},t);if(void 0!==t[e])return t[e];if(this._extractors.has(e)){const n=this._extractors.get(e);if("string"==typeof n)return V(t,n);const s=n(e,t);if(s)return s}return V(t,fe(e))}getReducedForm(e,t){const n=this.getNormalized(e,t);if(void 0===n)return[];if(this._reducers.has(e)){return this._reducers.get(e)(n)}return[[e,n]]}getStyleNames(e){const t=new Set;for(const n of this._consumables.keys()){const s=this.getNormalized(n,e);s&&("object"!=typeof s||Object.keys(s).length)&&t.add(n)}for(const n of Object.keys(e))t.add(n);return Array.from(t)}getRelatedStyles(e){return this._consumables.get(e)||[]}setNormalizer(e,t){this._normalizers.set(e,t)}setExtractor(e,t){this._extractors.set(e,t)}setReducer(e,t){this._reducers.set(e,t)}setStyleRelation(e,t){this._mapStyleNames(e,t);for(const n of t)this._mapStyleNames(n,[e])}_mapStyleNames(e,t){this._consumables.has(e)||this._consumables.set(e,[]),this._consumables.get(e).push(...t)}}function fe(e){return e.replace("-",".")}function me(e,t,n){let s=n;B(n)&&(s=$({},V(e,t),n)),q(e,t,s)}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */let ge=class e extends re{constructor(e,t,n,s){if(super(e),this._unsafeAttributesToRender=[],this._customProperties=new Map,this.name=t,this._attrs=function(e){const t=r(e);for(const[e,n]of t)null===n?t.delete(e):"string"!=typeof n&&t.set(e,String(n));return t}(n),this._children=[],s&&this._insertChild(0,s),this._classes=new Set,this._attrs.has("class")){const e=this._attrs.get("class");pe(this._classes,e),this._attrs.delete("class")}this._styles=new de(this.document.stylesProcessor),this._attrs.has("style")&&(this._styles.setTo(this._attrs.get("style")),this._attrs.delete("style"))}get childCount(){return this._children.length}get isEmpty(){return 0===this._children.length}getChild(e){return this._children[e]}getChildIndex(e){return this._children.indexOf(e)}getChildren(){return this._children[Symbol.iterator]()}*getAttributeKeys(){this._classes.size>0&&(yield"class"),this._styles.isEmpty||(yield"style"),yield*this._attrs.keys()}*getAttributes(){yield*this._attrs.entries(),this._classes.size>0&&(yield["class",this.getAttribute("class")]),this._styles.isEmpty||(yield["style",this.getAttribute("style")])}getAttribute(e){if("class"==e)return this._classes.size>0?[...this._classes].join(" "):void 0;if("style"==e){const e=this._styles.toString();return""==e?void 0:e}return this._attrs.get(e)}hasAttribute(e){return"class"==e?this._classes.size>0:"style"==e?!this._styles.isEmpty:this._attrs.has(e)}isSimilar(t){if(!(t instanceof e))return!1;if(this===t)return!0;if(this.name!=t.name)return!1;if(this._attrs.size!==t._attrs.size||this._classes.size!==t._classes.size||this._styles.size!==t._styles.size)return!1;for(const[e,n]of this._attrs)if(!t._attrs.has(e)||t._attrs.get(e)!==n)return!1;for(const e of this._classes)if(!t._classes.has(e))return!1;for(const e of this._styles.getStyleNames())if(!t._styles.has(e)||t._styles.getAsString(e)!==this._styles.getAsString(e))return!1;return!0}hasClass(...e){for(const t of e)if(!this._classes.has(t))return!1;return!0}getClassNames(){return this._classes.keys()}getStyle(e){return this._styles.getAsString(e)}getNormalizedStyle(e){return this._styles.getNormalized(e)}getStyleNames(e){return this._styles.getStyleNames(e)}hasStyle(...e){for(const t of e)if(!this._styles.has(t))return!1;return!0}findAncestor(...e){const t=new le(...e);let n=this.parent;for(;n&&!n.is("documentFragment");){if(t.match(n))return n;n=n.parent}return null}getCustomProperty(e){return this._customProperties.get(e)}*getCustomProperties(){yield*this._customProperties.entries()}getIdentity(){const e=Array.from(this._classes).sort().join(","),t=this._styles.toString(),n=Array.from(this._attrs).map((e=>`${e[0]}="${e[1]}"`)).sort().join(" ");return this.name+(""==e?"":` class="${e}"`)+(t?` style="${t}"`:"")+(""==n?"":` ${n}`)}shouldRenderUnsafeAttribute(e){return this._unsafeAttributesToRender.includes(e)}_clone(e=!1){const t=[];if(e)for(const n of this.getChildren())t.push(n._clone(e));const n=new this.constructor(this.document,this.name,this._attrs,t);return n._classes=new Set(this._classes),n._styles.set(this._styles.getNormalized()),n._customProperties=new Map(this._customProperties),n.getFillerOffset=this.getFillerOffset,n._unsafeAttributesToRender=this._unsafeAttributesToRender,n}_appendChild(e){return this._insertChild(this.childCount,e)}_insertChild(e,t){this._fireChange("children",this);let n=0;const s=function(e,t){if("string"==typeof t)return[new oe(e,t)];o(t)||(t=[t]);const n=[];for(const s of t)"string"==typeof s?n.push(new oe(e,s)):s instanceof ae?n.push(new oe(e,s.data)):n.push(s);return n}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */(this.document,t);for(const t of s)null!==t.parent&&t._remove(),t.parent=this,t.document=this.document,this._children.splice(e,0,t),e++,n++;return n}_removeChildren(e,t=1){this._fireChange("children",this);for(let n=e;n<e+t;n++)this._children[n].parent=null;return this._children.splice(e,t)}_setAttribute(e,t){const n=String(t);this._fireChange("attributes",this),"class"==e?pe(this._classes,n):"style"==e?this._styles.setTo(n):this._attrs.set(e,n)}_removeAttribute(e){return this._fireChange("attributes",this),"class"==e?this._classes.size>0&&(this._classes.clear(),!0):"style"==e?!this._styles.isEmpty&&(this._styles.clear(),!0):this._attrs.delete(e)}_addClass(e){this._fireChange("attributes",this);for(const t of i(e))this._classes.add(t)}_removeClass(e){this._fireChange("attributes",this);for(const t of i(e))this._classes.delete(t)}_setStyle(e,t){this._fireChange("attributes",this),"string"!=typeof e?this._styles.set(e):this._styles.set(e,t)}_removeStyle(e){this._fireChange("attributes",this);for(const t of i(e))this._styles.remove(t)}_setCustomProperty(e,t){this._customProperties.set(e,t)}_removeCustomProperty(e){return this._customProperties.delete(e)}};function pe(e,t){const n=t.split(/\s+/);e.clear(),n.forEach((t=>e.add(t)))}ge.prototype.is=function(e,t){return t?t===this.name&&("element"===e||"view:element"===e):"element"===e||"view:element"===e||"node"===e||"view:node"===e};class _e extends ge{constructor(e,t,n,s){super(e,t,n,s),this.getFillerOffset=we}}function we(){const e=[...this.getChildren()],t=e[this.childCount-1];if(t&&t.is("element","br"))return this.childCount;for(const t of e)if(!t.is("uiElement"))return null;return this.childCount}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */_e.prototype.is=function(e,t){return t?t===this.name&&("containerElement"===e||"view:containerElement"===e||"element"===e||"view:element"===e):"containerElement"===e||"view:containerElement"===e||"element"===e||"view:element"===e||"node"===e||"view:node"===e};class ye extends(a(_e)){constructor(e,t,n,s){super(e,t,n,s),this.set("isReadOnly",!1),this.set("isFocused",!1),this.set("placeholder",void 0),this.bind("isReadOnly").to(e),this.bind("isFocused").to(e,"isFocused",(t=>t&&e.selection.editableElement==this)),this.listenTo(e.selection,"change",(()=>{this.isFocused=e.isFocused&&e.selection.editableElement==this}))}destroy(){this.stopListening()}}ye.prototype.is=function(e,t){return t?t===this.name&&("editableElement"===e||"view:editableElement"===e||"containerElement"===e||"view:containerElement"===e||"element"===e||"view:element"===e):"editableElement"===e||"view:editableElement"===e||"containerElement"===e||"view:containerElement"===e||"element"===e||"view:element"===e||"node"===e||"view:node"===e};
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */
const be=Symbol("rootName");class ve extends ye{constructor(e,t){super(e,t),this.rootName="main"}get rootName(){return this.getCustomProperty(be)}set rootName(e){this._setCustomProperty(be,e)}set _name(e){this.name=e}}ve.prototype.is=function(e,t){return t?t===this.name&&("rootElement"===e||"view:rootElement"===e||"editableElement"===e||"view:editableElement"===e||"containerElement"===e||"view:containerElement"===e||"element"===e||"view:element"===e):"rootElement"===e||"view:rootElement"===e||"editableElement"===e||"view:editableElement"===e||"containerElement"===e||"view:containerElement"===e||"element"===e||"view:element"===e||"node"===e||"view:node"===e};
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */
let Pe=class{constructor(e={}){if(!e.boundaries&&!e.startPosition)throw new n("view-tree-walker-no-start-position",null);if(e.direction&&"forward"!=e.direction&&"backward"!=e.direction)throw new n("view-tree-walker-unknown-direction",e.startPosition,{direction:e.direction});this.boundaries=e.boundaries||null,e.startPosition?this._position=Ae._createAt(e.startPosition):this._position=Ae._createAt(e.boundaries["backward"==e.direction?"end":"start"]),this.direction=e.direction||"forward",this.singleCharacters=!!e.singleCharacters,this.shallow=!!e.shallow,this.ignoreElementEnd=!!e.ignoreElementEnd,this._boundaryStartParent=this.boundaries?this.boundaries.start.parent:null,this._boundaryEndParent=this.boundaries?this.boundaries.end.parent:null}[Symbol.iterator](){return this}get position(){return this._position}skip(e){let t,n;do{n=this.position,t=this.next()}while(!t.done&&e(t.value));t.done||(this._position=n)}next(){return"forward"==this.direction?this._next():this._previous()}_next(){let e=this.position.clone();const t=this.position,n=e.parent;if(null===n.parent&&e.offset===n.childCount)return{done:!0,value:void 0};if(n===this._boundaryEndParent&&e.offset==this.boundaries.end.offset)return{done:!0,value:void 0};let s;if(n&&n.is("view:$text")){if(e.isAtEnd)return this._position=Ae._createAfter(n),this._next();s=n.data[e.offset]}else s=n.getChild(e.offset);if("string"==typeof s){let s;if(this.singleCharacters)s=1;else{s=(n===this._boundaryEndParent?this.boundaries.end.offset:n.data.length)-e.offset}const i=new ae(n,e.offset,s);return e.offset+=s,this._position=e,this._formatReturnValue("text",i,t,e,s)}if(s&&s.is("view:element")){if(this.shallow){if(this.boundaries&&this.boundaries.end.isBefore(e))return{done:!0,value:void 0};e.offset++}else e=new Ae(s,0);return this._position=e,this._formatReturnValue("elementStart",s,t,e,1)}if(s&&s.is("view:$text")){if(this.singleCharacters)return e=new Ae(s,0),this._position=e,this._next();let n,i=s.data.length;return s==this._boundaryEndParent?(i=this.boundaries.end.offset,n=new ae(s,0,i),e=Ae._createAfter(n)):(n=new ae(s,0,s.data.length),e.offset++),this._position=e,this._formatReturnValue("text",n,t,e,i)}return e=Ae._createAfter(n),this._position=e,this.ignoreElementEnd?this._next():this._formatReturnValue("elementEnd",n,t,e)}_previous(){let e=this.position.clone();const t=this.position,n=e.parent;if(null===n.parent&&0===e.offset)return{done:!0,value:void 0};if(n==this._boundaryStartParent&&e.offset==this.boundaries.start.offset)return{done:!0,value:void 0};let s;if(n.is("view:$text")){if(e.isAtStart)return this._position=Ae._createBefore(n),this._previous();s=n.data[e.offset-1]}else s=n.getChild(e.offset-1);if("string"==typeof s){let s;if(this.singleCharacters)s=1;else{const t=n===this._boundaryStartParent?this.boundaries.start.offset:0;s=e.offset-t}e.offset-=s;const i=new ae(n,e.offset,s);return this._position=e,this._formatReturnValue("text",i,t,e,s)}if(s&&s.is("view:element"))return this.shallow?(e.offset--,this._position=e,this._formatReturnValue("elementStart",s,t,e,1)):(e=new Ae(s,s.childCount),this._position=e,this.ignoreElementEnd?this._previous():this._formatReturnValue("elementEnd",s,t,e));if(s&&s.is("view:$text")){if(this.singleCharacters)return e=new Ae(s,s.data.length),this._position=e,this._previous();let n,i=s.data.length;if(s==this._boundaryStartParent){const t=this.boundaries.start.offset;n=new ae(s,t,s.data.length-t),i=n.data.length,e=Ae._createBefore(n)}else n=new ae(s,0,s.data.length),e.offset--;return this._position=e,this._formatReturnValue("text",n,t,e,i)}return e=Ae._createBefore(n),this._position=e,this._formatReturnValue("elementStart",n,t,e,1)}_formatReturnValue(e,t,n,s,i){return t.is("view:$textProxy")&&(t.offsetInText+t.data.length==t.textNode.data.length&&("forward"!=this.direction||this.boundaries&&this.boundaries.end.isEqual(this.position)?n=Ae._createAfter(t.textNode):(s=Ae._createAfter(t.textNode),this._position=s)),0===t.offsetInText&&("backward"!=this.direction||this.boundaries&&this.boundaries.start.isEqual(this.position)?n=Ae._createBefore(t.textNode):(s=Ae._createBefore(t.textNode),this._position=s))),{done:!1,value:{type:e,item:t,previousPosition:n,nextPosition:s,length:i}}}},Ae=class e extends ie{constructor(e,t){super(),this.parent=e,this.offset=t}get nodeAfter(){return this.parent.is("$text")?null:this.parent.getChild(this.offset)||null}get nodeBefore(){return this.parent.is("$text")?null:this.parent.getChild(this.offset-1)||null}get isAtStart(){return 0===this.offset}get isAtEnd(){const e=this.parent.is("$text")?this.parent.data.length:this.parent.childCount;return this.offset===e}get root(){return this.parent.root}get editableElement(){let e=this.parent;for(;!(e instanceof ye);){if(!e.parent)return null;e=e.parent}return e}getShiftedBy(t){const n=e._createAt(this),s=n.offset+t;return n.offset=s<0?0:s,n}getLastMatchingPosition(e,t={}){t.startPosition=this;const n=new Pe(t);return n.skip(e),n.position}getAncestors(){return this.parent.is("documentFragment")?[this.parent]:this.parent.getAncestors({includeSelf:!0})}getCommonAncestor(e){const t=this.getAncestors(),n=e.getAncestors();let s=0;for(;t[s]==n[s]&&t[s];)s++;return 0===s?null:t[s-1]}isEqual(e){return this.parent==e.parent&&this.offset==e.offset}isBefore(e){return"before"==this.compareWith(e)}isAfter(e){return"after"==this.compareWith(e)}compareWith(e){if(this.root!==e.root)return"different";if(this.isEqual(e))return"same";const t=this.parent.is("node")?this.parent.getPath():[],n=e.parent.is("node")?e.parent.getPath():[];t.push(this.offset),n.push(e.offset);const i=s(t,n);switch(i){case"prefix":return"before";case"extension":return"after";default:return t[i]<n[i]?"before":"after"}}getWalker(e={}){return e.startPosition=this,new Pe(e)}clone(){return new e(this.parent,this.offset)}static _createAt(t,s){if(t instanceof e)return new this(t.parent,t.offset);{const i=t;if("end"==s)s=i.is("$text")?i.data.length:i.childCount;else{if("before"==s)return this._createBefore(i);if("after"==s)return this._createAfter(i);if(0!==s&&!s)throw new n("view-createpositionat-offset-required",i)}return new e(i,s)}}static _createAfter(t){if(t.is("$textProxy"))return new e(t.textNode,t.offsetInText+t.data.length);if(!t.parent)throw new n("view-position-after-root",t,{root:t});return new e(t.parent,t.index+1)}static _createBefore(t){if(t.is("$textProxy"))return new e(t.textNode,t.offsetInText);if(!t.parent)throw new n("view-position-before-root",t,{root:t});return new e(t.parent,t.index)}};
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */Ae.prototype.is=function(e){return"position"===e||"view:position"===e};
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */
let Ce=class e extends ie{constructor(e,t=null){super(),this.start=e.clone(),this.end=t?t.clone():e.clone()}*[Symbol.iterator](){yield*new Pe({boundaries:this,ignoreElementEnd:!0})}get isCollapsed(){return this.start.isEqual(this.end)}get isFlat(){return this.start.parent===this.end.parent}get root(){return this.start.root}getEnlarged(){let t=this.start.getLastMatchingPosition(ke,{direction:"backward"}),n=this.end.getLastMatchingPosition(ke);return t.parent.is("$text")&&t.isAtStart&&(t=Ae._createBefore(t.parent)),n.parent.is("$text")&&n.isAtEnd&&(n=Ae._createAfter(n.parent)),new e(t,n)}getTrimmed(){let t=this.start.getLastMatchingPosition(ke);if(t.isAfter(this.end)||t.isEqual(this.end))return new e(t,t);let n=this.end.getLastMatchingPosition(ke,{direction:"backward"});const s=t.nodeAfter,i=n.nodeBefore;return s&&s.is("$text")&&(t=new Ae(s,0)),i&&i.is("$text")&&(n=new Ae(i,i.data.length)),new e(t,n)}isEqual(e){return this==e||this.start.isEqual(e.start)&&this.end.isEqual(e.end)}containsPosition(e){return e.isAfter(this.start)&&e.isBefore(this.end)}containsRange(e,t=!1){e.isCollapsed&&(t=!1);const n=this.containsPosition(e.start)||t&&this.start.isEqual(e.start),s=this.containsPosition(e.end)||t&&this.end.isEqual(e.end);return n&&s}getDifference(t){const n=[];return this.isIntersecting(t)?(this.containsPosition(t.start)&&n.push(new e(this.start,t.start)),this.containsPosition(t.end)&&n.push(new e(t.end,this.end))):n.push(this.clone()),n}getIntersection(t){if(this.isIntersecting(t)){let n=this.start,s=this.end;return this.containsPosition(t.start)&&(n=t.start),this.containsPosition(t.end)&&(s=t.end),new e(n,s)}return null}getWalker(e={}){return e.boundaries=this,new Pe(e)}getCommonAncestor(){return this.start.getCommonAncestor(this.end)}getContainedElement(){if(this.isCollapsed)return null;let e=this.start.nodeAfter,t=this.end.nodeBefore;return this.start.parent.is("$text")&&this.start.isAtEnd&&this.start.parent.nextSibling&&(e=this.start.parent.nextSibling),this.end.parent.is("$text")&&this.end.isAtStart&&this.end.parent.previousSibling&&(t=this.end.parent.previousSibling),e&&e.is("element")&&e===t?e:null}clone(){return new e(this.start,this.end)}*getItems(e={}){e.boundaries=this,e.ignoreElementEnd=!0;const t=new Pe(e);for(const e of t)yield e.item}*getPositions(e={}){e.boundaries=this;const t=new Pe(e);yield t.position;for(const e of t)yield e.nextPosition}isIntersecting(e){return this.start.isBefore(e.end)&&this.end.isAfter(e.start)}static _createFromParentsAndOffsets(e,t,n,s){return new this(new Ae(e,t),new Ae(n,s))}static _createFromPositionAndShift(e,t){const n=e,s=e.getShiftedBy(t);return t>0?new this(n,s):new this(s,n)}static _createIn(e){return this._createFromParentsAndOffsets(e,0,e,e.childCount)}static _createOn(e){const t=e.is("$textProxy")?e.offsetSize:1;return this._createFromPositionAndShift(Ae._createBefore(e),t)}};function ke(e){return!(!e.item.is("attributeElement")&&!e.item.is("uiElement"))}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */Ce.prototype.is=function(e){return"range"===e||"view:range"===e};let Ee=class e extends(t(ie)){constructor(...e){super(),this._ranges=[],this._lastRangeBackward=!1,this._isFake=!1,this._fakeSelectionLabel="",e.length&&this.setTo(...e)}get isFake(){return this._isFake}get fakeSelectionLabel(){return this._fakeSelectionLabel}get anchor(){if(!this._ranges.length)return null;const e=this._ranges[this._ranges.length-1];return(this._lastRangeBackward?e.end:e.start).clone()}get focus(){if(!this._ranges.length)return null;const e=this._ranges[this._ranges.length-1];return(this._lastRangeBackward?e.start:e.end).clone()}get isCollapsed(){return 1===this.rangeCount&&this._ranges[0].isCollapsed}get rangeCount(){return this._ranges.length}get isBackward(){return!this.isCollapsed&&this._lastRangeBackward}get editableElement(){return this.anchor?this.anchor.editableElement:null}*getRanges(){for(const e of this._ranges)yield e.clone()}getFirstRange(){let e=null;for(const t of this._ranges)e&&!t.start.isBefore(e.start)||(e=t);return e?e.clone():null}getLastRange(){let e=null;for(const t of this._ranges)e&&!t.end.isAfter(e.end)||(e=t);return e?e.clone():null}getFirstPosition(){const e=this.getFirstRange();return e?e.start.clone():null}getLastPosition(){const e=this.getLastRange();return e?e.end.clone():null}isEqual(e){if(this.isFake!=e.isFake)return!1;if(this.isFake&&this.fakeSelectionLabel!=e.fakeSelectionLabel)return!1;if(this.rangeCount!=e.rangeCount)return!1;if(0===this.rangeCount)return!0;if(!this.anchor.isEqual(e.anchor)||!this.focus.isEqual(e.focus))return!1;for(const t of this._ranges){let n=!1;for(const s of e._ranges)if(t.isEqual(s)){n=!0;break}if(!n)return!1}return!0}isSimilar(e){if(this.isBackward!=e.isBackward)return!1;const t=l(this.getRanges());if(t!=l(e.getRanges()))return!1;if(0==t)return!0;for(let t of this.getRanges()){t=t.getTrimmed();let n=!1;for(let s of e.getRanges())if(s=s.getTrimmed(),t.start.isEqual(s.start)&&t.end.isEqual(s.end)){n=!0;break}if(!n)return!1}return!0}getSelectedElement(){return 1!==this.rangeCount?null:this.getFirstRange().getContainedElement()}setTo(...t){let[s,i,r]=t;if("object"==typeof i&&(r=i,i=void 0),null===s)this._setRanges([]),this._setFakeOptions(r);else if(s instanceof e||s instanceof Se)this._setRanges(s.getRanges(),s.isBackward),this._setFakeOptions({fake:s.isFake,label:s.fakeSelectionLabel});else if(s instanceof Ce)this._setRanges([s],r&&r.backward),this._setFakeOptions(r);else if(s instanceof Ae)this._setRanges([new Ce(s)]),this._setFakeOptions(r);else if(s instanceof re){const e=!!r&&!!r.backward;let t;if(void 0===i)throw new n("view-selection-setto-required-second-parameter",this);t="in"==i?Ce._createIn(s):"on"==i?Ce._createOn(s):new Ce(Ae._createAt(s,i)),this._setRanges([t],e),this._setFakeOptions(r)}else{if(!o(s))throw new n("view-selection-setto-not-selectable",this);this._setRanges(s,r&&r.backward),this._setFakeOptions(r)}this.fire("change")}setFocus(e,t){if(null===this.anchor)throw new n("view-selection-setfocus-no-ranges",this);const s=Ae._createAt(e,t);if("same"==s.compareWith(this.focus))return;const i=this.anchor;this._ranges.pop(),"before"==s.compareWith(i)?this._addRange(new Ce(s,i),!0):this._addRange(new Ce(i,s)),this.fire("change")}_setRanges(e,t=!1){e=Array.from(e),this._ranges=[];for(const t of e)this._addRange(t);this._lastRangeBackward=!!t}_setFakeOptions(e={}){this._isFake=!!e.fake,this._fakeSelectionLabel=e.fake&&e.label||""}_addRange(e,t=!1){if(!(e instanceof Ce))throw new n("view-selection-add-range-not-range",this);this._pushRange(e),this._lastRangeBackward=!!t}_pushRange(e){for(const t of this._ranges)if(e.isIntersecting(t))throw new n("view-selection-range-intersects",this,{addedRange:e,intersectingRange:t});this._ranges.push(new Ce(e.start,e.end))}};Ee.prototype.is=function(e){return"selection"===e||"view:selection"===e};
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */
let Se=class extends(t(ie)){constructor(...e){super(),this._selection=new Ee,this._selection.delegate("change").to(this),e.length&&this._selection.setTo(...e)}get isFake(){return this._selection.isFake}get fakeSelectionLabel(){return this._selection.fakeSelectionLabel}get anchor(){return this._selection.anchor}get focus(){return this._selection.focus}get isCollapsed(){return this._selection.isCollapsed}get rangeCount(){return this._selection.rangeCount}get isBackward(){return this._selection.isBackward}get editableElement(){return this._selection.editableElement}get _ranges(){return this._selection._ranges}*getRanges(){yield*this._selection.getRanges()}getFirstRange(){return this._selection.getFirstRange()}getLastRange(){return this._selection.getLastRange()}getFirstPosition(){return this._selection.getFirstPosition()}getLastPosition(){return this._selection.getLastPosition()}getSelectedElement(){return this._selection.getSelectedElement()}isEqual(e){return this._selection.isEqual(e)}isSimilar(e){return this._selection.isSimilar(e)}_setTo(...e){this._selection.setTo(...e)}_setFocus(e,t){this._selection.setFocus(e,t)}};Se.prototype.is=function(e){return"selection"===e||"documentSelection"==e||"view:selection"==e||"view:documentSelection"==e};
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */
class Re extends c{constructor(e,t,n){super(e,t),this.startRange=n,this._eventPhase="none",this._currentTarget=null}get eventPhase(){return this._eventPhase}get currentTarget(){return this._currentTarget}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */const xe=Symbol("bubbling contexts");function Te(e){return class extends e{fire(e,...t){try{const n=e instanceof c?e:new c(this,e),s=Ie(this);if(!s.size)return;if(Oe(n,"capturing",this),Me(s,"$capture",n,...t))return n.return;const i=n.startRange||this.selection.getFirstRange(),r=i?i.getContainedElement():null,o=!!r&&Boolean(Ne(s,r));let a=r||function(e){if(!e)return null;const t=e.start.parent,n=e.end.parent,s=t.getPath(),i=n.getPath();return s.length>i.length?t:n}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */(i);if(Oe(n,"atTarget",a),!o){if(Me(s,"$text",n,...t))return n.return;Oe(n,"bubbling",a)}for(;a;){if(a.is("rootElement")){if(Me(s,"$root",n,...t))return n.return}else if(a.is("element")&&Me(s,a.name,n,...t))return n.return;if(Me(s,a,n,...t))return n.return;a=a.parent,Oe(n,"bubbling",a)}return Oe(n,"bubbling",this),Me(s,"$document",n,...t),n.return}catch(e){
/* istanbul ignore next -- @preserve */
n.rethrowUnexpectedError(e,this)}}_addEventListener(e,n,s){const r=i(s.context||"$document"),o=Ie(this);for(const i of r){let r=o.get(i);r||(r=new(t()),o.set(i,r)),this.listenTo(r,e,n,s)}}_removeEventListener(e,t){const n=Ie(this);for(const s of n.values())this.stopListening(s,e,t)}}}{const e=Te(Object);["fire","_addEventListener","_removeEventListener"].forEach((t=>{Te[t]=e.prototype[t]}))}function Oe(e,t,n){e instanceof Re&&(e._eventPhase=t,e._currentTarget=n)}function Me(e,t,n,...s){const i="string"==typeof t?e.get(t):Ne(e,t);return!!i&&(i.fire(n,...s),n.stop.called)}function Ne(e,t){for(const[n,s]of e)if("function"==typeof n&&n(t))return s;return null}function Ie(e){return e[xe]||(e[xe]=new Map),e[xe]}let Fe=class extends(Te(a())){constructor(e){super(),this._postFixers=new Set,this.selection=new Se,this.roots=new h({idProperty:"rootName"}),this.stylesProcessor=e,this.set("isReadOnly",!1),this.set("isFocused",!1),this.set("isSelecting",!1),this.set("isComposing",!1)}getRoot(e="main"){return this.roots.get(e)}registerPostFixer(e){this._postFixers.add(e)}destroy(){this.roots.forEach((e=>e.destroy())),this.stopListening()}_callPostFixers(e){let t=!1;do{for(const n of this._postFixers)if(t=n(e),t)break}while(t)}};
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class Be extends ge{constructor(e,t,n,s){super(e,t,n,s),this._priority=10,this._id=null,this._clonesGroup=null,this.getFillerOffset=De}get priority(){return this._priority}get id(){return this._id}getElementsWithSameId(){if(null===this.id)throw new n("attribute-element-get-elements-with-same-id-no-id",this);return new Set(this._clonesGroup)}isSimilar(e){return null!==this.id||null!==e.id?this.id===e.id:super.isSimilar(e)&&this.priority==e.priority}_clone(e=!1){const t=super._clone(e);return t._priority=this._priority,t._id=this._id,t}}function De(){if(Ve(this))return null;let e=this.parent;for(;e&&e.is("attributeElement");){if(Ve(e)>1)return null;e=e.parent}return!e||Ve(e)>1?null:this.childCount}function Ve(e){return Array.from(e.getChildren()).filter((e=>!e.is("uiElement"))).length}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */Be.DEFAULT_PRIORITY=10,Be.prototype.is=function(e,t){return t?t===this.name&&("attributeElement"===e||"view:attributeElement"===e||"element"===e||"view:element"===e):"attributeElement"===e||"view:attributeElement"===e||"element"===e||"view:element"===e||"node"===e||"view:node"===e};class $e extends ge{constructor(e,t,n,s){super(e,t,n,s),this.getFillerOffset=qe}_insertChild(e,t){if(t&&(t instanceof re||Array.from(t).length>0))throw new n("view-emptyelement-cannot-add",[this,t]);return 0}}function qe(){return null}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */$e.prototype.is=function(e,t){return t?t===this.name&&("emptyElement"===e||"view:emptyElement"===e||"element"===e||"view:element"===e):"emptyElement"===e||"view:emptyElement"===e||"element"===e||"view:element"===e||"node"===e||"view:node"===e};class Le extends ge{constructor(e,t,n,s){super(e,t,n,s),this.getFillerOffset=je}_insertChild(e,t){if(t&&(t instanceof re||Array.from(t).length>0))throw new n("view-uielement-cannot-add",[this,t]);return 0}render(e,t){return this.toDomElement(e)}toDomElement(e){const t=e.createElement(this.name);for(const e of this.getAttributeKeys())t.setAttribute(e,this.getAttribute(e));return t}}function We(e){e.document.on("arrowKey",((t,n)=>function(e,t,n){if(t.keyCode==d.arrowright){const e=t.domTarget.ownerDocument.defaultView.getSelection(),s=1==e.rangeCount&&e.getRangeAt(0).collapsed;if(s||t.shiftKey){const t=e.focusNode,i=e.focusOffset,r=n.domPositionToView(t,i);if(null===r)return;let o=!1;const a=r.getLastMatchingPosition((e=>(e.item.is("uiElement")&&(o=!0),!(!e.item.is("uiElement")&&!e.item.is("attributeElement")))));if(o){const t=n.viewPositionToDom(a);s?e.collapse(t.parent,t.offset):e.extend(t.parent,t.offset)}}}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */(0,n,e.domConverter)),{priority:"low"})}function je(){return null}Le.prototype.is=function(e,t){return t?t===this.name&&("uiElement"===e||"view:uiElement"===e||"element"===e||"view:element"===e):"uiElement"===e||"view:uiElement"===e||"element"===e||"view:element"===e||"node"===e||"view:node"===e};class ze extends ge{constructor(e,t,n,s){super(e,t,n,s),this.getFillerOffset=Ue}_insertChild(e,t){if(t&&(t instanceof re||Array.from(t).length>0))throw new n("view-rawelement-cannot-add",[this,t]);return 0}render(e,t){}}function Ue(){return null}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */ze.prototype.is=function(e,t){return t?t===this.name&&("rawElement"===e||"view:rawElement"===e||"element"===e||"view:element"===e):"rawElement"===e||"view:rawElement"===e||e===this.name||e==="view:"+this.name||"element"===e||"view:element"===e||"node"===e||"view:node"===e};let Je=class extends(t(ie)){constructor(e,t){super(),this._children=[],this._customProperties=new Map,this.document=e,t&&this._insertChild(0,t)}[Symbol.iterator](){return this._children[Symbol.iterator]()}get childCount(){return this._children.length}get isEmpty(){return 0===this.childCount}get root(){return this}get parent(){return null}get name(){}get getFillerOffset(){}getCustomProperty(e){return this._customProperties.get(e)}*getCustomProperties(){yield*this._customProperties.entries()}_appendChild(e){return this._insertChild(this.childCount,e)}getChild(e){return this._children[e]}getChildIndex(e){return this._children.indexOf(e)}getChildren(){return this._children[Symbol.iterator]()}_insertChild(e,t){this._fireChange("children",this);let n=0;const s=function(e,t){if("string"==typeof t)return[new oe(e,t)];o(t)||(t=[t]);return Array.from(t).map((t=>"string"==typeof t?new oe(e,t):t instanceof ae?new oe(e,t.data):t))}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */(this.document,t);for(const t of s)null!==t.parent&&t._remove(),t.parent=this,this._children.splice(e,0,t),e++,n++;return n}_removeChildren(e,t=1){this._fireChange("children",this);for(let n=e;n<e+t;n++)this._children[n].parent=null;return this._children.splice(e,t)}_fireChange(e,t){this.fire("change:"+e,t)}_setCustomProperty(e,t){this._customProperties.set(e,t)}_removeCustomProperty(e){return this._customProperties.delete(e)}};Je.prototype.is=function(e){return"documentFragment"===e||"view:documentFragment"===e};class Ke{constructor(e){this._cloneGroups=new Map,this._slotFactory=null,this.document=e}setSelection(...e){this.document.selection._setTo(...e)}setSelectionFocus(e,t){this.document.selection._setFocus(e,t)}createDocumentFragment(e){return new Je(this.document,e)}createText(e){return new oe(this.document,e)}createAttributeElement(e,t,n={}){const s=new Be(this.document,e,t);return"number"==typeof n.priority&&(s._priority=n.priority),n.id&&(s._id=n.id),n.renderUnsafeAttributes&&s._unsafeAttributesToRender.push(...n.renderUnsafeAttributes),s}createContainerElement(e,t,n={},s={}){let i=null;L(n)?s=n:i=n;const r=new _e(this.document,e,t,i);return s.renderUnsafeAttributes&&r._unsafeAttributesToRender.push(...s.renderUnsafeAttributes),r}createEditableElement(e,t,n={}){const s=new ye(this.document,e,t);return n.renderUnsafeAttributes&&s._unsafeAttributesToRender.push(...n.renderUnsafeAttributes),s}createEmptyElement(e,t,n={}){const s=new $e(this.document,e,t);return n.renderUnsafeAttributes&&s._unsafeAttributesToRender.push(...n.renderUnsafeAttributes),s}createUIElement(e,t,n){const s=new Le(this.document,e,t);return n&&(s.render=n),s}createRawElement(e,t,n,s={}){const i=new ze(this.document,e,t);return n&&(i.render=n),s.renderUnsafeAttributes&&i._unsafeAttributesToRender.push(...s.renderUnsafeAttributes),i}setAttribute(e,t,n){n._setAttribute(e,t)}removeAttribute(e,t){t._removeAttribute(e)}addClass(e,t){t._addClass(e)}removeClass(e,t){t._removeClass(e)}setStyle(e,t,n){L(e)&&void 0===n?t._setStyle(e):n._setStyle(e,t)}removeStyle(e,t){t._removeStyle(e)}setCustomProperty(e,t,n){n._setCustomProperty(e,t)}removeCustomProperty(e,t){return t._removeCustomProperty(e)}breakAttributes(e){return e instanceof Ae?this._breakAttributes(e):this._breakAttributesRange(e)}breakContainer(e){const t=e.parent;if(!t.is("containerElement"))throw new n("view-writer-break-non-container-element",this.document);if(!t.parent)throw new n("view-writer-break-root",this.document);if(e.isAtStart)return Ae._createBefore(t);if(!e.isAtEnd){const n=t._clone(!1);this.insert(Ae._createAfter(t),n);const s=new Ce(e,Ae._createAt(t,"end")),i=new Ae(n,0);this.move(s,i)}return Ae._createAfter(t)}mergeAttributes(e){const t=e.offset,n=e.parent;if(n.is("$text"))return e;if(n.is("attributeElement")&&0===n.childCount){const e=n.parent,t=n.index;return n._remove(),this._removeFromClonedElementsGroup(n),this.mergeAttributes(new Ae(e,t))}const s=n.getChild(t-1),i=n.getChild(t);if(!s||!i)return e;if(s.is("$text")&&i.is("$text"))return Qe(s,i);if(s.is("attributeElement")&&i.is("attributeElement")&&s.isSimilar(i)){const e=s.childCount;return s._appendChild(i.getChildren()),i._remove(),this._removeFromClonedElementsGroup(i),this.mergeAttributes(new Ae(s,e))}return e}mergeContainers(e){const t=e.nodeBefore,s=e.nodeAfter;if(!(t&&s&&t.is("containerElement")&&s.is("containerElement")))throw new n("view-writer-merge-containers-invalid-position",this.document);const i=t.getChild(t.childCount-1),r=i instanceof oe?Ae._createAt(i,"end"):Ae._createAt(t,"end");return this.move(Ce._createIn(s),Ae._createAt(t,"end")),this.remove(Ce._createOn(s)),r}insert(e,t){et(t=o(t)?[...t]:[t],this.document);const n=t.reduce(((e,t)=>{const n=e[e.length-1],s=!t.is("uiElement");return n&&n.breakAttributes==s?n.nodes.push(t):e.push({breakAttributes:s,nodes:[t]}),e}),[]);let s=null,i=e;for(const{nodes:e,breakAttributes:t}of n){const n=this._insertNodes(i,e,t);s||(s=n.start),i=n.end}return s?new Ce(s,i):new Ce(e)}remove(e){const t=e instanceof Ce?e:Ce._createOn(e);if(nt(t,this.document),t.isCollapsed)return new Je(this.document);const{start:n,end:s}=this._breakAttributesRange(t,!0),i=n.parent,r=s.offset-n.offset,o=i._removeChildren(n.offset,r);for(const e of o)this._removeFromClonedElementsGroup(e);const a=this.mergeAttributes(n);return t.start=a,t.end=a.clone(),new Je(this.document,o)}clear(e,t){nt(e,this.document);const n=e.getWalker({direction:"backward",ignoreElementEnd:!0});for(const s of n){const n=s.item;let i;if(n.is("element")&&t.isSimilar(n))i=Ce._createOn(n);else if(!s.nextPosition.isAfter(e.start)&&n.is("$textProxy")){const e=n.getAncestors().find((e=>e.is("element")&&t.isSimilar(e)));e&&(i=Ce._createIn(e))}i&&(i.end.isAfter(e.end)&&(i.end=e.end),i.start.isBefore(e.start)&&(i.start=e.start),this.remove(i))}}move(e,t){let n;if(t.isAfter(e.end)){const s=(t=this._breakAttributes(t,!0)).parent,i=s.childCount;e=this._breakAttributesRange(e,!0),n=this.remove(e),t.offset+=s.childCount-i}else n=this.remove(e);return this.insert(t,n)}wrap(e,t){if(!(t instanceof Be))throw new n("view-writer-wrap-invalid-attribute",this.document);if(nt(e,this.document),e.isCollapsed){let n=e.start;n.parent.is("element")&&(s=n.parent,!Array.from(s.getChildren()).some((e=>!e.is("uiElement"))))&&(n=n.getLastMatchingPosition((e=>e.item.is("uiElement")))),n=this._wrapPosition(n,t);const i=this.document.selection;return i.isCollapsed&&i.getFirstPosition().isEqual(e.start)&&this.setSelection(n),new Ce(n)}return this._wrapRange(e,t);var s}unwrap(e,t){if(!(t instanceof Be))throw new n("view-writer-unwrap-invalid-attribute",this.document);if(nt(e,this.document),e.isCollapsed)return e;const{start:s,end:i}=this._breakAttributesRange(e,!0),r=s.parent,o=this._unwrapChildren(r,s.offset,i.offset,t),a=this.mergeAttributes(o.start);a.isEqual(o.start)||o.end.offset--;const l=this.mergeAttributes(o.end);return new Ce(a,l)}rename(e,t){const n=new _e(this.document,e,t.getAttributes());return this.insert(Ae._createAfter(t),n),this.move(Ce._createIn(t),Ae._createAt(n,0)),this.remove(Ce._createOn(t)),n}clearClonedElementsGroup(e){this._cloneGroups.delete(e)}createPositionAt(e,t){return Ae._createAt(e,t)}createPositionAfter(e){return Ae._createAfter(e)}createPositionBefore(e){return Ae._createBefore(e)}createRange(e,t){return new Ce(e,t)}createRangeOn(e){return Ce._createOn(e)}createRangeIn(e){return Ce._createIn(e)}createSelection(...e){return new Ee(...e)}createSlot(e="children"){if(!this._slotFactory)throw new n("view-writer-invalid-create-slot-context",this.document);return this._slotFactory(this,e)}_registerSlotFactory(e){this._slotFactory=e}_clearSlotFactory(){this._slotFactory=null}_insertNodes(e,t,s){let i,r;if(i=s?Ge(e):e.parent.is("$text")?e.parent.parent:e.parent,!i)throw new n("view-writer-invalid-position-container",this.document);r=s?this._breakAttributes(e,!0):e.parent.is("$text")?Xe(e):e;const o=i._insertChild(r.offset,t);for(const e of t)this._addToClonedElementsGroup(e);const a=r.getShiftedBy(o),l=this.mergeAttributes(r);l.isEqual(r)||a.offset--;const c=this.mergeAttributes(a);return new Ce(l,c)}_wrapChildren(e,t,n,s){let i=t;const r=[];for(;i<n;){const t=e.getChild(i),n=t.is("$text"),o=t.is("attributeElement");if(o&&this._wrapAttributeElement(s,t))r.push(new Ae(e,i));else if(n||!o||He(s,t)){const n=s._clone();t._remove(),n._appendChild(t),e._insertChild(i,n),this._addToClonedElementsGroup(n),r.push(new Ae(e,i))}else this._wrapChildren(t,0,t.childCount,s);i++}let o=0;for(const e of r){if(e.offset-=o,e.offset==t)continue;this.mergeAttributes(e).isEqual(e)||(o++,n--)}return Ce._createFromParentsAndOffsets(e,t,e,n)}_unwrapChildren(e,t,n,s){let i=t;const r=[];for(;i<n;){const t=e.getChild(i);if(t.is("attributeElement"))if(t.isSimilar(s)){const s=t.getChildren(),o=t.childCount;t._remove(),e._insertChild(i,s),this._removeFromClonedElementsGroup(t),r.push(new Ae(e,i),new Ae(e,i+o)),i+=o,n+=o-1}else this._unwrapAttributeElement(s,t)?(r.push(new Ae(e,i),new Ae(e,i+1)),i++):(this._unwrapChildren(t,0,t.childCount,s),i++);else i++}let o=0;for(const e of r){if(e.offset-=o,e.offset==t||e.offset==n)continue;this.mergeAttributes(e).isEqual(e)||(o++,n--)}return Ce._createFromParentsAndOffsets(e,t,e,n)}_wrapRange(e,t){const{start:n,end:s}=this._breakAttributesRange(e,!0),i=n.parent,r=this._wrapChildren(i,n.offset,s.offset,t),o=this.mergeAttributes(r.start);o.isEqual(r.start)||r.end.offset--;const a=this.mergeAttributes(r.end);return new Ce(o,a)}_wrapPosition(e,t){if(t.isSimilar(e.parent))return Ye(e.clone());e.parent.is("$text")&&(e=Xe(e));const n=this.createAttributeElement("_wrapPosition-fake-element");n._priority=Number.POSITIVE_INFINITY,n.isSimilar=()=>!1,e.parent._insertChild(e.offset,n);const s=new Ce(e,e.getShiftedBy(1));this.wrap(s,t);const i=new Ae(n.parent,n.index);n._remove();const r=i.nodeBefore,o=i.nodeAfter;return r&&r.is("view:$text")&&o&&o.is("view:$text")?Qe(r,o):Ye(i)}_wrapAttributeElement(e,t){if(!st(e,t))return!1;if(e.name!==t.name||e.priority!==t.priority)return!1;for(const n of e.getAttributeKeys())if("class"!==n&&"style"!==n&&t.hasAttribute(n)&&t.getAttribute(n)!==e.getAttribute(n))return!1;for(const n of e.getStyleNames())if(t.hasStyle(n)&&t.getStyle(n)!==e.getStyle(n))return!1;for(const n of e.getAttributeKeys())"class"!==n&&"style"!==n&&(t.hasAttribute(n)||this.setAttribute(n,e.getAttribute(n),t));for(const n of e.getStyleNames())t.hasStyle(n)||this.setStyle(n,e.getStyle(n),t);for(const n of e.getClassNames())t.hasClass(n)||this.addClass(n,t);return!0}_unwrapAttributeElement(e,t){if(!st(e,t))return!1;if(e.name!==t.name||e.priority!==t.priority)return!1;for(const n of e.getAttributeKeys())if("class"!==n&&"style"!==n&&(!t.hasAttribute(n)||t.getAttribute(n)!==e.getAttribute(n)))return!1;if(!t.hasClass(...e.getClassNames()))return!1;for(const n of e.getStyleNames())if(!t.hasStyle(n)||t.getStyle(n)!==e.getStyle(n))return!1;for(const n of e.getAttributeKeys())"class"!==n&&"style"!==n&&this.removeAttribute(n,t);return this.removeClass(Array.from(e.getClassNames()),t),this.removeStyle(Array.from(e.getStyleNames()),t),!0}_breakAttributesRange(e,t=!1){const n=e.start,s=e.end;if(nt(e,this.document),e.isCollapsed){const n=this._breakAttributes(e.start,t);return new Ce(n,n)}const i=this._breakAttributes(s,t),r=i.parent.childCount,o=this._breakAttributes(n,t);return i.offset+=i.parent.childCount-r,new Ce(o,i)}_breakAttributes(e,t=!1){const s=e.offset,i=e.parent;if(e.parent.is("emptyElement"))throw new n("view-writer-cannot-break-empty-element",this.document);if(e.parent.is("uiElement"))throw new n("view-writer-cannot-break-ui-element",this.document);if(e.parent.is("rawElement"))throw new n("view-writer-cannot-break-raw-element",this.document);if(!t&&i.is("$text")&&tt(i.parent))return e.clone();if(tt(i))return e.clone();if(i.is("$text"))return this._breakAttributes(Xe(e),t);if(s==i.childCount){const e=new Ae(i.parent,i.index+1);return this._breakAttributes(e,t)}if(0===s){const e=new Ae(i.parent,i.index);return this._breakAttributes(e,t)}{const e=i.index+1,n=i._clone();i.parent._insertChild(e,n),this._addToClonedElementsGroup(n);const r=i.childCount-s,o=i._removeChildren(s,r);n._appendChild(o);const a=new Ae(i.parent,e);return this._breakAttributes(a,t)}}_addToClonedElementsGroup(e){if(!e.root.is("rootElement"))return;if(e.is("element"))for(const t of e.getChildren())this._addToClonedElementsGroup(t);const t=e.id;if(!t)return;let n=this._cloneGroups.get(t);n||(n=new Set,this._cloneGroups.set(t,n)),n.add(e),e._clonesGroup=n}_removeFromClonedElementsGroup(e){if(e.is("element"))for(const t of e.getChildren())this._removeFromClonedElementsGroup(t);const t=e.id;if(!t)return;const n=this._cloneGroups.get(t);n&&n.delete(e)}}function Ge(e){let t=e.parent;for(;!tt(t);){if(!t)return;t=t.parent}return t}function He(e,t){return e.priority<t.priority||!(e.priority>t.priority)&&e.getIdentity()<t.getIdentity()}function Ye(e){const t=e.nodeBefore;if(t&&t.is("$text"))return new Ae(t,t.data.length);const n=e.nodeAfter;return n&&n.is("$text")?new Ae(n,0):e}function Xe(e){if(e.offset==e.parent.data.length)return new Ae(e.parent.parent,e.parent.index+1);if(0===e.offset)return new Ae(e.parent.parent,e.parent.index);const t=e.parent.data.slice(e.offset);return e.parent._data=e.parent.data.slice(0,e.offset),e.parent.parent._insertChild(e.parent.index+1,new oe(e.root.document,t)),new Ae(e.parent.parent,e.parent.index+1)}function Qe(e,t){const n=e.data.length;return e._data+=t.data,t._remove(),new Ae(e,n)}const Ze=[oe,Be,_e,$e,ze,Le];function et(e,t){for(const s of e){if(!Ze.some((e=>s instanceof e)))throw new n("view-writer-insert-invalid-node-type",t);s.is("$text")||et(s.getChildren(),t)}}function tt(e){return e&&(e.is("containerElement")||e.is("documentFragment"))}function nt(e,t){const s=Ge(e.start),i=Ge(e.end);if(!s||!i||s!==i)throw new n("view-writer-invalid-range-container",t)}function st(e,t){return null===e.id&&null===t.id}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */const it=e=>e.createTextNode(" "),rt=e=>{const t=e.createElement("span");return t.dataset.ckeFiller="true",t.innerText=" ",t},ot=e=>{const t=e.createElement("br");return t.dataset.ckeFiller="true",t},at=7,lt="⁠".repeat(at);function ct(e){return"string"==typeof e?e.substr(0,at)===lt:u(e)&&e.data.substr(0,at)===lt}function ht(e){return e.data.length==at&&ct(e)}function dt(e){const t="string"==typeof e?e:e.data;return ct(e)?t.slice(at):t}function ut(e,t){if(t.keyCode==d.arrowleft){const e=t.domTarget.ownerDocument.defaultView.getSelection();if(1==e.rangeCount&&e.getRangeAt(0).collapsed){const t=e.getRangeAt(0).startContainer,n=e.getRangeAt(0).startOffset;ct(t)&&n<=at&&e.collapse(t,0)}}}K(".ck.ck-editor__editable span[data-ck-unsafe-element]{display:none}");
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */
class ft extends(a()){constructor(e,t){super(),this.domDocuments=new Set,this.markedAttributes=new Set,this.markedChildren=new Set,this.markedTexts=new Set,this._inlineFiller=null,this._fakeSelectionContainer=null,this.domConverter=e,this.selection=t,this.set("isFocused",!1),this.set("isSelecting",!1),this.set("isComposing",!1),f.isBlink&&!f.isAndroid&&this.on("change:isSelecting",(()=>{this.isSelecting||this.render()}))}markToSync(e,t){if("text"===e)this.domConverter.mapViewToDom(t.parent)&&this.markedTexts.add(t);else{if(!this.domConverter.mapViewToDom(t))return;if("attributes"===e)this.markedAttributes.add(t);else{if("children"!==e)throw new n("view-renderer-unknown-type",this);this.markedChildren.add(t)}}}render(){if(this.isComposing&&!f.isAndroid)return;let e=null;const t=!(f.isBlink&&!f.isAndroid)||!this.isSelecting;for(const e of this.markedChildren)this._updateChildrenMappings(e);t?(this._inlineFiller&&!this._isSelectionInInlineFiller()&&this._removeInlineFiller(),this._inlineFiller?e=this._getInlineFillerPosition():this._needsInlineFillerAtSelection()&&(e=this.selection.getFirstPosition(),this.markedChildren.add(e.parent))):this._inlineFiller&&this._inlineFiller.parentNode&&(e=this.domConverter.domPositionToView(this._inlineFiller),e&&e.parent.is("$text")&&(e=Ae._createBefore(e.parent)));for(const e of this.markedAttributes)this._updateAttrs(e);for(const t of this.markedChildren)this._updateChildren(t,{inlineFillerPosition:e});for(const t of this.markedTexts)!this.markedChildren.has(t.parent)&&this.domConverter.mapViewToDom(t.parent)&&this._updateText(t,{inlineFillerPosition:e});if(t)if(e){const t=this.domConverter.viewPositionToDom(e),n=t.parent.ownerDocument;ct(t.parent)?this._inlineFiller=t.parent:this._inlineFiller=mt(n,t.parent,t.offset)}else this._inlineFiller=null;this._updateFocus(),this._updateSelection(),this.domConverter._clearTemporaryCustomProperties(),this.markedTexts.clear(),this.markedAttributes.clear(),this.markedChildren.clear()}_updateChildrenMappings(e){const t=this.domConverter.mapViewToDom(e);if(!t)return;const n=Array.from(t.childNodes),s=Array.from(this.domConverter.viewChildrenToDom(e,{withChildren:!1})),i=this._diffNodeLists(n,s),r=this._findUpdateActions(i,n,s,gt);if(-1!==r.indexOf("update")){const t={equal:0,insert:0,delete:0};for(const i of r)if("update"===i){const i=t.equal+t.insert,r=t.equal+t.delete,o=e.getChild(i);!o||o.is("uiElement")||o.is("rawElement")||this._updateElementMappings(o,n[r]),m(s[i]),t.equal++}else t[i]++}}_updateElementMappings(e,t){this.domConverter.unbindDomElement(t),this.domConverter.bindElements(t,e),this.markedChildren.add(e),this.markedAttributes.add(e)}_getInlineFillerPosition(){const e=this.selection.getFirstPosition();return e.parent.is("$text")?Ae._createBefore(e.parent):e}_isSelectionInInlineFiller(){if(1!=this.selection.rangeCount||!this.selection.isCollapsed)return!1;const e=this.selection.getFirstPosition(),t=this.domConverter.viewPositionToDom(e);return!!(t&&u(t.parent)&&ct(t.parent))}_removeInlineFiller(){const e=this._inlineFiller;if(!ct(e))throw new n("view-renderer-filler-was-lost",this);ht(e)?e.remove():e.data=e.data.substr(at),this._inlineFiller=null}_needsInlineFillerAtSelection(){if(1!=this.selection.rangeCount||!this.selection.isCollapsed)return!1;const e=this.selection.getFirstPosition(),t=e.parent,n=e.offset;if(!this.domConverter.mapViewToDom(t.root))return!1;if(!t.is("element"))return!1;if(!function(e){if("false"==e.getAttribute("contenteditable"))return!1;const t=e.findAncestor((e=>e.hasAttribute("contenteditable")));return!t||"true"==t.getAttribute("contenteditable")}(t))return!1;const s=e.nodeBefore,i=e.nodeAfter;return!(s instanceof oe||i instanceof oe)&&(!!(n!==t.getFillerOffset()||s&&s.is("element","br"))&&(!f.isAndroid||!s&&!i))}_updateText(e,t){const n=this.domConverter.findCorrespondingDomText(e);let s=this.domConverter.viewToDom(e).data;const i=t.inlineFillerPosition;i&&i.parent==e.parent&&i.offset==e.index&&(s=lt+s),this._updateTextNode(n,s)}_updateAttrs(e){const t=this.domConverter.mapViewToDom(e);if(t){for(const n of Array.from(t.attributes)){const s=n.name;e.hasAttribute(s)||this.domConverter.removeDomElementAttribute(t,s)}for(const n of e.getAttributeKeys())this.domConverter.setDomElementAttribute(t,n,e.getAttribute(n),e)}}_updateChildren(e,t){const n=this.domConverter.mapViewToDom(e);if(!n)return;if(f.isAndroid){let e=null;for(const t of Array.from(n.childNodes)){if(e&&u(e)&&u(t)){n.normalize();break}e=t}}const s=t.inlineFillerPosition,i=n.childNodes,r=Array.from(this.domConverter.viewChildrenToDom(e,{bind:!0}));s&&s.parent===e&&mt(n.ownerDocument,r,s.offset);const o=this._diffNodeLists(i,r),a=this._findUpdateActions(o,i,r,pt);let l=0;const c=new Set;for(const e of a)"delete"===e?(c.add(i[l]),m(i[l])):"equal"!==e&&"update"!==e||l++;l=0;for(const e of a)"insert"===e?(g(n,l,r[l]),l++):"update"===e?(this._updateTextNode(i[l],r[l].data),l++):"equal"===e&&(this._markDescendantTextToSync(this.domConverter.domToView(r[l])),l++);for(const e of c)e.parentNode||this.domConverter.unbindDomElement(e)}_diffNodeLists(e,t){return e=function(e,t){const n=Array.from(e);if(0==n.length||!t)return n;n[n.length-1]==t&&n.pop();return n}(e,this._fakeSelectionContainer),p(e,t,_t.bind(null,this.domConverter))}_findUpdateActions(e,t,n,s){if(-1===e.indexOf("insert")||-1===e.indexOf("delete"))return e;let i=[],r=[],o=[];const a={equal:0,insert:0,delete:0};for(const l of e)"insert"===l?o.push(n[a.equal+a.insert]):"delete"===l?r.push(t[a.equal+a.delete]):(i=i.concat(p(r,o,s).map((e=>"equal"===e?"update":e))),i.push("equal"),r=[],o=[]),a[l]++;return i.concat(p(r,o,s).map((e=>"equal"===e?"update":e)))}_updateTextNode(e,t){const n=e.data;n!=t&&(f.isAndroid&&this.isComposing&&n.replace(/\u00A0/g," ")==t.replace(/\u00A0/g," ")||this._updateTextNodeInternal(e,t))}_updateTextNodeInternal(e,t){const n=_(e.data,t);for(const t of n)"insert"===t.type?e.insertData(t.index,t.values.join("")):e.deleteData(t.index,t.howMany)}_markDescendantTextToSync(e){if(e)if(e.is("$text"))this.markedTexts.add(e);else if(e.is("element"))for(const t of e.getChildren())this._markDescendantTextToSync(t)}_updateSelection(){if(f.isBlink&&!f.isAndroid&&this.isSelecting&&!this.markedChildren.size)return;if(0===this.selection.rangeCount)return this._removeDomSelection(),void this._removeFakeSelection();const e=this.domConverter.mapViewToDom(this.selection.editableElement);this.isFocused&&e&&(this.selection.isFake?this._updateFakeSelection(e):this._fakeSelectionContainer&&this._fakeSelectionContainer.isConnected?(this._removeFakeSelection(),this._updateDomSelection(e)):this.isComposing&&f.isAndroid||this._updateDomSelection(e))}_updateFakeSelection(e){const t=e.ownerDocument;this._fakeSelectionContainer||(this._fakeSelectionContainer=function(e){const t=e.createElement("div");return t.className="ck-fake-selection-container",Object.assign(t.style,{position:"fixed",top:0,left:"-9999px",width:"42px"}),t.textContent=" ",t}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */(t));const n=this._fakeSelectionContainer;if(this.domConverter.bindFakeSelection(n,this.selection),!this._fakeSelectionNeedsUpdate(e))return;n.parentElement&&n.parentElement==e||e.appendChild(n),n.textContent=this.selection.fakeSelectionLabel||" ";const s=t.getSelection(),i=t.createRange();s.removeAllRanges(),i.selectNodeContents(n),s.addRange(i)}_updateDomSelection(e){const t=e.ownerDocument.defaultView.getSelection();if(!this._domSelectionNeedsUpdate(t))return;const n=this.domConverter.viewPositionToDom(this.selection.anchor),s=this.domConverter.viewPositionToDom(this.selection.focus);t.setBaseAndExtent(n.parent,n.offset,s.parent,s.offset),f.isGecko&&function(e,t){let n=e.parent,s=e.offset;u(n)&&ht(n)&&(s=b(n)+1,n=n.parentNode);if(n.nodeType!=Node.ELEMENT_NODE||s!=n.childNodes.length-1)return;const i=n.childNodes[s];i&&"BR"==i.tagName&&t.addRange(t.getRangeAt(0))}(s,t)}_domSelectionNeedsUpdate(e){if(!this.domConverter.isDomSelectionCorrect(e))return!0;const t=e&&this.domConverter.domSelectionToView(e);return(!t||!this.selection.isEqual(t))&&!(!this.selection.isCollapsed&&this.selection.isSimilar(t))}_fakeSelectionNeedsUpdate(e){const t=this._fakeSelectionContainer,n=e.ownerDocument.getSelection();return!t||t.parentElement!==e||(n.anchorNode!==t&&!t.contains(n.anchorNode)||t.textContent!==this.selection.fakeSelectionLabel)}_removeDomSelection(){for(const e of this.domDocuments){const t=e.getSelection();if(t.rangeCount){const n=e.activeElement,s=this.domConverter.mapDomToView(n);n&&s&&t.removeAllRanges()}}}_removeFakeSelection(){const e=this._fakeSelectionContainer;e&&e.remove()}_updateFocus(){if(this.isFocused){const e=this.selection.editableElement;e&&this.domConverter.focus(e)}}}function mt(e,t,n){const s=t instanceof Array?t:t.childNodes,i=s[n];if(u(i))return i.data=lt+i.data,i;{const i=e.createTextNode(lt);return Array.isArray(t)?s.splice(n,0,i):g(t,n,i),i}}function gt(e,t){return w(e)&&w(t)&&!u(e)&&!u(t)&&!y(e)&&!y(t)&&e.tagName.toLowerCase()===t.tagName.toLowerCase()}function pt(e,t){return w(e)&&w(t)&&u(e)&&u(t)}function _t(e,t,n){return t===n||(u(t)&&u(n)?t.data===n.data:!(!e.isBlockFiller(t)||!e.isBlockFiller(n)))}const wt=ot(v.document),yt=it(v.document),bt=rt(v.document),vt="data-ck-unsafe-attribute-",Pt="data-ck-unsafe-element";class At{constructor(e,{blockFillerMode:t,renderingMode:n="editing"}={}){this._domToViewMapping=new WeakMap,this._viewToDomMapping=new WeakMap,this._fakeSelectionMapping=new WeakMap,this._rawContentElementMatcher=new le,this._inlineObjectElementMatcher=new le,this._elementsWithTemporaryCustomProperties=new Set,this.document=e,this.renderingMode=n,this.blockFillerMode=t||("editing"===n?"br":"nbsp"),this.preElements=["pre","textarea"],this.blockElements=["address","article","aside","blockquote","caption","center","dd","details","dir","div","dl","dt","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","legend","li","main","menu","nav","ol","p","pre","section","summary","table","tbody","td","tfoot","th","thead","tr","ul"],this.inlineObjectElements=["object","iframe","input","button","textarea","select","option","video","embed","audio","img","canvas"],this.unsafeElements=["script","style"],this._domDocument="editing"===this.renderingMode?v.document:v.document.implementation.createHTMLDocument("")}bindFakeSelection(e,t){this._fakeSelectionMapping.set(e,new Ee(t))}fakeSelectionToView(e){return this._fakeSelectionMapping.get(e)}bindElements(e,t){this._domToViewMapping.set(e,t),this._viewToDomMapping.set(t,e)}unbindDomElement(e){const t=this._domToViewMapping.get(e);if(t){this._domToViewMapping.delete(e),this._viewToDomMapping.delete(t);for(const t of e.children)this.unbindDomElement(t)}}bindDocumentFragments(e,t){this._domToViewMapping.set(e,t),this._viewToDomMapping.set(t,e)}shouldRenderAttribute(e,t,n){return"data"===this.renderingMode||!(e=e.toLowerCase()).startsWith("on")&&(("srcdoc"!==e||!t.match(/\bon\S+\s*=|javascript:|<\s*\/*script/i))&&("img"===n&&("src"===e||"srcset"===e)||("source"===n&&"srcset"===e||!t.match(/^\s*(javascript:|data:(image\/svg|text\/x?html))/i))))}setContentOf(e,t){if("data"===this.renderingMode)return void(e.innerHTML=t);const n=(new DOMParser).parseFromString(t,"text/html"),s=n.createDocumentFragment(),i=n.body.childNodes;for(;i.length>0;)s.appendChild(i[0]);const r=n.createTreeWalker(s,NodeFilter.SHOW_ELEMENT),o=[];let a;for(;a=r.nextNode();)o.push(a);for(const e of o){for(const t of e.getAttributeNames())this.setDomElementAttribute(e,t,e.getAttribute(t));const t=e.tagName.toLowerCase();this._shouldRenameElement(t)&&(Et(t),e.replaceWith(this._createReplacementDomElement(t,e)))}for(;e.firstChild;)e.firstChild.remove();e.append(s)}viewToDom(e,t={}){if(e.is("$text")){const t=this._processDataFromViewText(e);return this._domDocument.createTextNode(t)}{const n=e;if(this.mapViewToDom(n)){if(!n.getCustomProperty("editingPipeline:doNotReuseOnce"))return this.mapViewToDom(n);this._elementsWithTemporaryCustomProperties.add(n)}let s;if(n.is("documentFragment"))s=this._domDocument.createDocumentFragment(),t.bind&&this.bindDocumentFragments(s,n);else{if(n.is("uiElement"))return s="$comment"===n.name?this._domDocument.createComment(n.getCustomProperty("$rawContent")):n.render(this._domDocument,this),t.bind&&this.bindElements(s,n),s;this._shouldRenameElement(n.name)?(Et(n.name),s=this._createReplacementDomElement(n.name)):s=n.hasAttribute("xmlns")?this._domDocument.createElementNS(n.getAttribute("xmlns"),n.name):this._domDocument.createElement(n.name),n.is("rawElement")&&n.render(s,this),t.bind&&this.bindElements(s,n);for(const e of n.getAttributeKeys())this.setDomElementAttribute(s,e,n.getAttribute(e),n)}if(!1!==t.withChildren)for(const e of this.viewChildrenToDom(n,t))s instanceof HTMLTemplateElement?s.content.appendChild(e):s.appendChild(e);return s}}setDomElementAttribute(t,n,s,i){const r=this.shouldRenderAttribute(n,s,t.tagName.toLowerCase())||i&&i.shouldRenderUnsafeAttribute(n);r||e("domconverter-unsafe-attribute-detected",{domElement:t,key:n,value:s}),P(n)?(t.hasAttribute(n)&&!r?t.removeAttribute(n):t.hasAttribute(vt+n)&&r&&t.removeAttribute(vt+n),t.setAttribute(r?n:vt+n,s)):e("domconverter-invalid-attribute-detected",{domElement:t,key:n,value:s})}removeDomElementAttribute(e,t){t!=Pt&&(e.removeAttribute(t),e.removeAttribute(vt+t))}*viewChildrenToDom(t,n={}){const s=t.getFillerOffset&&t.getFillerOffset();let i=0;for(const r of t.getChildren()){s===i&&(yield this._getBlockFiller());const t=r.is("element")&&!!r.getCustomProperty("dataPipeline:transparentRendering")&&!A(r.getAttributes());if(t&&"data"==this.renderingMode)if(r.is("rawElement")){const e=this._domDocument.createElement(r.name);r.render(e,this),yield*[...e.childNodes]}else yield*this.viewChildrenToDom(r,n);else t&&e("domconverter-transparent-rendering-unsupported-in-editing-pipeline",{viewElement:r}),yield this.viewToDom(r,n);i++}s===i&&(yield this._getBlockFiller())}viewRangeToDom(e){const t=this.viewPositionToDom(e.start),n=this.viewPositionToDom(e.end),s=this._domDocument.createRange();return s.setStart(t.parent,t.offset),s.setEnd(n.parent,n.offset),s}viewPositionToDom(e){const t=e.parent;if(t.is("$text")){const n=this.findCorrespondingDomText(t);if(!n)return null;let s=e.offset;return ct(n)&&(s+=at),{parent:n,offset:s}}{let n,s,i;if(0===e.offset){if(n=this.mapViewToDom(t),!n)return null;i=n.childNodes[0]}else{const t=e.nodeBefore;if(s=t.is("$text")?this.findCorrespondingDomText(t):this.mapViewToDom(t),!s)return null;n=s.parentNode,i=s.nextSibling}if(u(i)&&ct(i))return{parent:i,offset:at};return{parent:n,offset:s?b(s)+1:0}}}domToView(e,t={}){const n=[],s=this._domToView(e,t,n),i=s.next().value;return i?(s.next(),this._processDomInlineNodes(null,n,t),i.is("$text")&&0==i.data.length?null:i):null}*domChildrenToView(e,t={},n=[]){let s=[];s=e instanceof HTMLTemplateElement?[...e.content.childNodes]:[...e.childNodes];for(let i=0;i<s.length;i++){const r=s[i],o=this._domToView(r,t,n),a=o.next().value;null!==a&&(this._isBlockViewElement(a)&&this._processDomInlineNodes(e,n,t),yield a,o.next())}this._processDomInlineNodes(e,n,t)}domSelectionToView(e){if(function(e){if(!f.isGecko)return!1;if(!e.rangeCount)return!1;const t=e.getRangeAt(0).startContainer;try{Object.prototype.toString.call(t)}catch(e){return!0}return!1}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */(e))return new Ee([]);if(1===e.rangeCount){let t=e.getRangeAt(0).startContainer;u(t)&&(t=t.parentNode);const n=this.fakeSelectionToView(t);if(n)return n}const t=this.isDomSelectionBackward(e),n=[];for(let t=0;t<e.rangeCount;t++){const s=e.getRangeAt(t),i=this.domRangeToView(s);i&&n.push(i)}return new Ee(n,{backward:t})}domRangeToView(e){const t=this.domPositionToView(e.startContainer,e.startOffset),n=this.domPositionToView(e.endContainer,e.endOffset);return t&&n?new Ce(t,n):null}domPositionToView(e,t=0){if(this.isBlockFiller(e))return this.domPositionToView(e.parentNode,b(e));const n=this.mapDomToView(e);if(n&&(n.is("uiElement")||n.is("rawElement")))return Ae._createBefore(n);if(u(e)){if(ht(e))return this.domPositionToView(e.parentNode,b(e));const n=this.findCorrespondingViewText(e);let s=t;return n?(ct(e)&&(s-=at,s=s<0?0:s),new Ae(n,s)):null}if(0===t){const t=this.mapDomToView(e);if(t)return new Ae(t,0)}else{const n=e.childNodes[t-1];if(u(n)&&ht(n)||n&&this.isBlockFiller(n))return this.domPositionToView(n.parentNode,b(n));const s=u(n)?this.findCorrespondingViewText(n):this.mapDomToView(n);if(s&&s.parent)return new Ae(s.parent,s.index+1)}return null}mapDomToView(e){return this.getHostViewElement(e)||this._domToViewMapping.get(e)}findCorrespondingViewText(e){if(ht(e))return null;const t=this.getHostViewElement(e);if(t)return t;const n=e.previousSibling;if(n){if(!this.isElement(n))return null;const e=this.mapDomToView(n);if(e){const t=e.nextSibling;return t instanceof oe?t:null}}else{const t=this.mapDomToView(e.parentNode);if(t){const e=t.getChild(0);return e instanceof oe?e:null}}return null}mapViewToDom(e){return this._viewToDomMapping.get(e)}findCorrespondingDomText(e){const t=e.previousSibling;return t&&this.mapViewToDom(t)?this.mapViewToDom(t).nextSibling:!t&&e.parent&&this.mapViewToDom(e.parent)?this.mapViewToDom(e.parent).childNodes[0]:null}focus(e){const t=this.mapViewToDom(e);if(t&&t.ownerDocument.activeElement!==t){const{scrollX:e,scrollY:n}=v.window,s=[];Ct(t,(e=>{const{scrollLeft:t,scrollTop:n}=e;s.push([t,n])})),t.focus(),Ct(t,(e=>{const[t,n]=s.shift();e.scrollLeft=t,e.scrollTop=n})),v.window.scrollTo(e,n)}}_clearDomSelection(){const e=this.mapViewToDom(this.document.selection.editableElement);if(!e)return;const t=e.ownerDocument.defaultView.getSelection(),n=this.domSelectionToView(t);n&&n.rangeCount>0&&t.removeAllRanges()}isElement(e){return e&&e.nodeType==Node.ELEMENT_NODE}isDocumentFragment(e){return e&&e.nodeType==Node.DOCUMENT_FRAGMENT_NODE}isBlockFiller(e){return"br"==this.blockFillerMode?e.isEqualNode(wt):!("BR"!==e.tagName||!kt(e,this.blockElements)||1!==e.parentNode.childNodes.length)||(e.isEqualNode(bt)||function(e,t){const n=e.isEqualNode(yt);return n&&kt(e,t)&&1===e.parentNode.childNodes.length}(e,this.blockElements))}isDomSelectionBackward(e){if(e.isCollapsed)return!1;const t=this._domDocument.createRange();try{t.setStart(e.anchorNode,e.anchorOffset),t.setEnd(e.focusNode,e.focusOffset)}catch(e){return!1}const n=t.collapsed;return t.detach(),n}getHostViewElement(e){const t=C(e);for(t.pop();t.length;){const e=t.pop(),n=this._domToViewMapping.get(e);if(n&&(n.is("uiElement")||n.is("rawElement")))return n}return null}isDomSelectionCorrect(e){return this._isDomSelectionPositionCorrect(e.anchorNode,e.anchorOffset)&&this._isDomSelectionPositionCorrect(e.focusNode,e.focusOffset)}registerRawContentMatcher(e){this._rawContentElementMatcher.add(e)}registerInlineObjectMatcher(e){this._inlineObjectElementMatcher.add(e)}_clearTemporaryCustomProperties(){for(const e of this._elementsWithTemporaryCustomProperties)e._removeCustomProperty("editingPipeline:doNotReuseOnce");this._elementsWithTemporaryCustomProperties.clear()}_getBlockFiller(){switch(this.blockFillerMode){case"nbsp":return it(this._domDocument);case"markedNbsp":return rt(this._domDocument);case"br":return ot(this._domDocument)}}_isDomSelectionPositionCorrect(e,t){if(u(e)&&ct(e)&&t<at)return!1;if(this.isElement(e)&&ct(e.childNodes[t]))return!1;const n=this.mapDomToView(e);return!n||!n.is("uiElement")&&!n.is("rawElement")}*_domToView(e,t,n){if(this.isBlockFiller(e))return null;const s=this.getHostViewElement(e);if(s)return s;if(y(e)&&t.skipComments)return null;if(u(e)){if(ht(e))return null;{const t=e.data;if(""===t)return null;const s=new oe(this.document,t);return n.push(s),s}}{let s=this.mapDomToView(e);if(s)return this._isInlineObjectElement(s)&&n.push(s),s;if(this.isDocumentFragment(e))s=new Je(this.document),t.bind&&this.bindDocumentFragments(e,s);else{s=this._createViewElement(e,t),t.bind&&this.bindElements(e,s);const i=e.attributes;if(i)for(let e=i.length,t=0;t<e;t++)s._setAttribute(i[t].name,i[t].value);if(this._isViewElementWithRawContent(s,t))return s._setCustomProperty("$rawContent",e.innerHTML),this._isBlockViewElement(s)||n.push(s),s;if(y(e))return s._setCustomProperty("$rawContent",e.data),s}yield s;const i=[];if(!1!==t.withChildren)for(const n of this.domChildrenToView(e,t,i))s._appendChild(n);if(this._isInlineObjectElement(s))n.push(s),this._processDomInlineNodes(null,i,t);else for(const e of i)n.push(e)}}_processDomInlineNodes(e,t,n){if(!t.length)return;if(e&&!this.isDocumentFragment(e)&&!this._isBlockDomElement(e))return;let s=!1;for(let e=0;e<t.length;e++){const i=t[e];if(!i.is("$text")){s=!1;continue}let r,o=!1;if(this._isPreFormatted(i))r=dt(i.data);else{r=i.data.replace(/[ \n\t\r]{1,}/g," "),o=/[^\S\u00A0]/.test(r.charAt(r.length-1));const a=e>0?t[e-1]:null,l=e+1<t.length?t[e+1]:null,c=!a||a.is("element")&&"br"==a.name||s,h=!l&&!ct(i.data);!1!==n.withChildren&&(c&&(r=r.replace(/^ /,"")),h&&(r=r.replace(/ $/,""))),r=dt(r),r=r.replace(/ \u00A0/g,"  ");const d=l&&l.is("element")&&"br"!=l.name,u=l&&l.is("$text")&&" "==l.data.charAt(0);(/[ \u00A0]\u00A0$/.test(r)||!l||d||u)&&(r=r.replace(/\u00A0$/," ")),(c||a&&a.is("element")&&"br"!=a.name)&&(r=r.replace(/^\u00A0/," "))}0==r.length&&i.parent?(i._remove(),t.splice(e,1),e--):(i._data=r,s=o)}t.length=0}_processDataFromViewText(e){let t=e.data;if(this._isPreFormatted(e))return t;if(" "==t.charAt(0)){const n=this._getTouchingInlineViewNode(e,!1);!(n&&n.is("$textProxy")&&this._nodeEndsWithSpace(n))&&n||(t=" "+t.substr(1))}if(" "==t.charAt(t.length-1)){const n=this._getTouchingInlineViewNode(e,!0),s=n&&n.is("$textProxy")&&" "==n.data.charAt(0);" "!=t.charAt(t.length-2)&&n&&!s||(t=t.substr(0,t.length-1)+" ")}return t.replace(/ {2}/g,"  ")}_nodeEndsWithSpace(e){if(this._isPreFormatted(e))return!1;const t=this._processDataFromViewText(e);return" "==t.charAt(t.length-1)}_isPreFormatted(e){if(function(e,t){return e.getAncestors().some((e=>e.is("element")&&t.includes(e.name)))}(e,this.preElements))return!0;for(const t of e.getAncestors({parentFirst:!0}))if(t.is("element")&&t.hasStyle("white-space")&&"inherit"!==t.getStyle("white-space"))return["pre","pre-wrap","break-spaces"].includes(t.getStyle("white-space"));return!1}_getTouchingInlineViewNode(e,t){const n=new Pe({startPosition:t?Ae._createAfter(e):Ae._createBefore(e),direction:t?"forward":"backward"});for(const{item:e}of n){if(e.is("$textProxy"))return e;if(!e.is("element")||!e.getCustomProperty("dataPipeline:transparentRendering")){if(e.is("element","br"))return null;if(this._isInlineObjectElement(e))return e;if(e.is("containerElement"))return null}}return null}_isBlockDomElement(e){return this.isElement(e)&&this.blockElements.includes(e.tagName.toLowerCase())}_isBlockViewElement(e){return e.is("element")&&this.blockElements.includes(e.name)}_isInlineObjectElement(e){return!!e.is("element")&&("br"==e.name||this.inlineObjectElements.includes(e.name)||!!this._inlineObjectElementMatcher.match(e))}_createViewElement(e,t){if(y(e))return new Le(this.document,"$comment");const n=t.keepOriginalCase?e.tagName:e.tagName.toLowerCase();return new ge(this.document,n)}_isViewElementWithRawContent(e,t){return!1!==t.withChildren&&e.is("element")&&!!this._rawContentElementMatcher.match(e)}_shouldRenameElement(e){const t=e.toLowerCase();return"editing"===this.renderingMode&&this.unsafeElements.includes(t)}_createReplacementDomElement(e,t){const n=this._domDocument.createElement("span");if(n.setAttribute(Pt,e),t){for(;t.firstChild;)n.appendChild(t.firstChild);for(const e of t.getAttributeNames())n.setAttribute(e,t.getAttribute(e))}return n}}function Ct(e,t){let n=e;for(;n;)t(n),n=n.parentElement}function kt(e,t){const n=e.parentNode;return!!n&&!!n.tagName&&t.includes(n.tagName.toLowerCase())}function Et(t){"script"===t&&e("domconverter-unsafe-script-element-detected"),"style"===t&&e("domconverter-unsafe-style-element-detected")}class St extends(k()){constructor(e){super(),this._isEnabled=!1,this.view=e,this.document=e.document}get isEnabled(){return this._isEnabled}enable(){this._isEnabled=!0}disable(){this._isEnabled=!1}destroy(){this.disable(),this.stopListening()}checkShouldIgnoreEventFromTarget(e){return e&&3===e.nodeType&&(e=e.parentNode),!(!e||1!==e.nodeType)&&e.matches("[data-cke-ignore-events], [data-cke-ignore-events] *")}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class Rt{constructor(e,t,n){this.view=e,this.document=e.document,this.domEvent=t,this.domTarget=t.target,W(this,n)}get target(){return this.view.domConverter.mapDomToView(this.domTarget)}preventDefault(){this.domEvent.preventDefault()}stopPropagation(){this.domEvent.stopPropagation()}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class xt extends St{constructor(){super(...arguments),this.useCapture=!1,this.usePassive=!1}observe(e){("string"==typeof this.domEventType?[this.domEventType]:this.domEventType).forEach((t=>{this.listenTo(e,t,((e,t)=>{this.isEnabled&&!this.checkShouldIgnoreEventFromTarget(t.target)&&this.onDomEvent(t)}),{useCapture:this.useCapture,usePassive:this.usePassive})}))}stopObserving(e){this.stopListening(e)}fire(e,t,n){this.isEnabled&&this.document.fire(e,new Rt(this.view,t,n))}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class Tt extends xt{constructor(){super(...arguments),this.domEventType=["keydown","keyup"]}onDomEvent(e){const t={keyCode:e.keyCode,altKey:e.altKey,ctrlKey:e.ctrlKey,shiftKey:e.shiftKey,metaKey:e.metaKey,get keystroke(){return E(this)}};this.fire(e.type,e,t)}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class Ot extends St{constructor(e){super(e),this._fireSelectionChangeDoneDebounced=j((e=>{this.document.fire("selectionChangeDone",e)}),200)}observe(){const e=this.document;e.on("arrowKey",((t,n)=>{e.selection.isFake&&this.isEnabled&&n.preventDefault()}),{context:"$capture"}),e.on("arrowKey",((t,n)=>{e.selection.isFake&&this.isEnabled&&this._handleSelectionMove(n.keyCode)}),{priority:"lowest"})}stopObserving(){}destroy(){super.destroy(),this._fireSelectionChangeDoneDebounced.cancel()}_handleSelectionMove(e){const t=this.document.selection,n=new Ee(t.getRanges(),{backward:t.isBackward,fake:!1});e!=d.arrowleft&&e!=d.arrowup||n.setTo(n.getFirstPosition()),e!=d.arrowright&&e!=d.arrowdown||n.setTo(n.getLastPosition());const s={oldSelection:t,newSelection:n,domSelection:null};this.document.fire("selectionChange",s),this._fireSelectionChangeDoneDebounced(s)}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class Mt extends St{constructor(e){super(e),this._config={childList:!0,characterData:!0,subtree:!0},this.domConverter=e.domConverter,this._domElements=new Set,this._mutationObserver=new window.MutationObserver(this._onMutations.bind(this))}flush(){this._onMutations(this._mutationObserver.takeRecords())}observe(e){this._domElements.add(e),this.isEnabled&&this._mutationObserver.observe(e,this._config)}stopObserving(e){if(this._domElements.delete(e),this.isEnabled){this._mutationObserver.disconnect();for(const e of this._domElements)this._mutationObserver.observe(e,this._config)}}enable(){super.enable();for(const e of this._domElements)this._mutationObserver.observe(e,this._config)}disable(){super.disable(),this._mutationObserver.disconnect()}destroy(){super.destroy(),this._mutationObserver.disconnect()}_onMutations(e){if(0===e.length)return;const t=this.domConverter,n=new Set,s=new Set;for(const n of e){const e=t.mapDomToView(n.target);e&&(e.is("uiElement")||e.is("rawElement")||"childList"!==n.type||this._isBogusBrMutation(n)||s.add(e))}for(const i of e){const e=t.mapDomToView(i.target);if((!e||!e.is("uiElement")&&!e.is("rawElement"))&&"characterData"===i.type){const e=t.findCorrespondingViewText(i.target);e&&!s.has(e.parent)?n.add(e):!e&&ct(i.target)&&s.add(t.mapDomToView(i.target.parentNode))}}const i=[];for(const e of n)i.push({type:"text",node:e});for(const e of s){const n=t.mapViewToDom(e),s=Array.from(e.getChildren()),r=Array.from(t.domChildrenToView(n,{withChildren:!1}));z(s,r,Nt)||i.push({type:"children",node:e})}i.length&&this.document.fire("mutations",{mutations:i})}_isBogusBrMutation(e){let t=null;return null===e.nextSibling&&0===e.removedNodes.length&&1==e.addedNodes.length&&(t=this.domConverter.domToView(e.addedNodes[0],{withChildren:!1})),t&&t.is("element","br")}}function Nt(e,t){if(!Array.isArray(e))return e===t||!(!e.is("$text")||!t.is("$text"))&&e.data===t.data}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class It extends xt{constructor(e){super(e),this._renderTimeoutId=null,this._isFocusChanging=!1,this.domEventType=["focus","blur"],this.useCapture=!0;const t=this.document;t.on("focus",(()=>this._handleFocus())),t.on("blur",((e,t)=>this._handleBlur(t))),t.on("beforeinput",(()=>{t.isFocused||this._handleFocus()}),{priority:"highest"})}flush(){this._isFocusChanging&&(this._isFocusChanging=!1,this.document.isFocused=!0)}onDomEvent(e){this.fire(e.type,e)}destroy(){this._clearTimeout(),super.destroy()}_handleFocus(){this._clearTimeout(),this._isFocusChanging=!0,this._renderTimeoutId=setTimeout((()=>{this._renderTimeoutId=null,this.flush(),this.view.change((()=>{}))}),50)}_handleBlur(e){const t=this.document.selection.editableElement;null!==t&&t!==e.target||(this.document.isFocused=!1,this._isFocusChanging=!1,this.view.change((()=>{})))}_clearTimeout(){this._renderTimeoutId&&(clearTimeout(this._renderTimeoutId),this._renderTimeoutId=null)}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class Ft extends St{constructor(e){super(e),this.mutationObserver=e.getObserver(Mt),this.focusObserver=e.getObserver(It),this.selection=this.document.selection,this.domConverter=e.domConverter,this._documents=new WeakSet,this._fireSelectionChangeDoneDebounced=j((e=>{this.document.fire("selectionChangeDone",e)}),200),this._clearInfiniteLoopInterval=setInterval((()=>this._clearInfiniteLoop()),1e3),this._documentIsSelectingInactivityTimeoutDebounced=j((()=>this.document.isSelecting=!1),5e3),this._loopbackCounter=0}observe(e){const t=e.ownerDocument,n=()=>{this.document.isSelecting&&(this._handleSelectionChange(t),this.document.isSelecting=!1,this._documentIsSelectingInactivityTimeoutDebounced.cancel())};this.listenTo(e,"selectstart",(()=>{this.document.isSelecting=!0,this._documentIsSelectingInactivityTimeoutDebounced()}),{priority:"highest"}),this.listenTo(e,"keydown",n,{priority:"highest",useCapture:!0}),this.listenTo(e,"keyup",n,{priority:"highest",useCapture:!0}),this._documents.has(t)||(this.listenTo(t,"mouseup",n,{priority:"highest",useCapture:!0}),this.listenTo(t,"selectionchange",(()=>{this.document.isComposing&&!f.isAndroid||(this._handleSelectionChange(t),this._documentIsSelectingInactivityTimeoutDebounced())})),this.listenTo(this.view.document,"compositionstart",(()=>{this._handleSelectionChange(t)}),{priority:"lowest"}),this._documents.add(t))}stopObserving(e){this.stopListening(e)}destroy(){super.destroy(),clearInterval(this._clearInfiniteLoopInterval),this._fireSelectionChangeDoneDebounced.cancel(),this._documentIsSelectingInactivityTimeoutDebounced.cancel()}
/* istanbul ignore next -- @preserve */_reportInfiniteLoop(){}_handleSelectionChange(e){if(!this.isEnabled)return;const t=e.defaultView.getSelection();if(this.checkShouldIgnoreEventFromTarget(t.anchorNode))return;this.mutationObserver.flush();const n=this.domConverter.domSelectionToView(t);if(0!=n.rangeCount){if(this.view.hasDomSelection=!0,this.focusObserver.flush(),!this.selection.isEqual(n)||!this.domConverter.isDomSelectionCorrect(t))if(++this._loopbackCounter>60)this._reportInfiniteLoop();else if(this.selection.isSimilar(n))this.view.forceRender();else{const e={oldSelection:this.selection,newSelection:n,domSelection:t};this.document.fire("selectionChange",e),this._fireSelectionChangeDoneDebounced(e)}}else this.view.hasDomSelection=!1}_clearInfiniteLoop(){this._loopbackCounter=0}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class Bt extends xt{constructor(e){super(e),this.domEventType=["compositionstart","compositionupdate","compositionend"];const t=this.document;t.on("compositionstart",(()=>{t.isComposing=!0}),{priority:"low"}),t.on("compositionend",(()=>{t.isComposing=!1}),{priority:"low"})}onDomEvent(e){this.fire(e.type,e,{data:e.data})}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class Dt{constructor(e,t={}){this._files=t.cacheFiles?Vt(e):null,this._native=e}get files(){return this._files||(this._files=Vt(this._native)),this._files}get types(){return this._native.types}getData(e){return this._native.getData(e)}setData(e,t){this._native.setData(e,t)}set effectAllowed(e){this._native.effectAllowed=e}get effectAllowed(){return this._native.effectAllowed}set dropEffect(e){this._native.dropEffect=e}get dropEffect(){return this._native.dropEffect}setDragImage(e,t,n){this._native.setDragImage(e,t,n)}get isCanceled(){return"none"==this._native.dropEffect||!!this._native.mozUserCancelled}}function Vt(e){const t=Array.from(e.files||[]),n=Array.from(e.items||[]);return t.length?t:n.filter((e=>"file"===e.kind)).map((e=>e.getAsFile()))}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class $t extends xt{constructor(){super(...arguments),this.domEventType="beforeinput"}onDomEvent(e){const t=e.getTargetRanges(),n=this.view,s=n.document;let i=null,r=null,o=[];if(e.dataTransfer&&(i=new Dt(e.dataTransfer)),null!==e.data?r=e.data:i&&(r=i.getData("text/plain")),s.selection.isFake)o=Array.from(s.selection.getRanges());else if(t.length)o=t.map((e=>{const t=n.domConverter.domPositionToView(e.startContainer,e.startOffset),s=n.domConverter.domPositionToView(e.endContainer,e.endOffset);return t?n.createRange(t,s):s?n.createRange(s):void 0})).filter((e=>!!e));else if(f.isAndroid){const t=e.target.ownerDocument.defaultView.getSelection();o=Array.from(n.domConverter.domSelectionToView(t).getRanges())}if(f.isAndroid&&"insertCompositionText"==e.inputType&&r&&r.endsWith("\n"))this.fire(e.type,e,{inputType:"insertParagraph",targetRanges:[n.createRange(o[0].end)]});else if("insertText"==e.inputType&&r&&r.includes("\n")){const t=r.split(/\n{1,2}/g);let n=o;for(let r=0;r<t.length;r++){const o=t[r];""!=o&&(this.fire(e.type,e,{data:o,dataTransfer:i,targetRanges:n,inputType:e.inputType,isComposing:e.isComposing}),n=[s.selection.getFirstRange()]),r+1<t.length&&(this.fire(e.type,e,{inputType:"insertParagraph",targetRanges:n}),n=[s.selection.getFirstRange()])}}else this.fire(e.type,e,{data:r,dataTransfer:i,targetRanges:o,inputType:e.inputType,isComposing:e.isComposing})}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class qt extends St{constructor(e){super(e),this.document.on("keydown",((e,t)=>{if(this.isEnabled&&S(t.keyCode)){const n=new Re(this.document,"arrowKey",this.document.selection.getFirstRange());this.document.fire(n,t),n.stop.called&&e.stop()}}))}observe(){}stopObserving(){}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class Lt extends St{constructor(e){super(e);const t=this.document;t.on("keydown",((e,n)=>{if(!this.isEnabled||n.keyCode!=d.tab||n.ctrlKey)return;const s=new Re(t,"tab",t.selection.getFirstRange());t.fire(s,n),s.stop.called&&e.stop()}))}observe(){}stopObserving(){}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class Wt extends(a()){constructor(e){super(),this.domRoots=new Map,this._initialDomRootAttributes=new WeakMap,this._observers=new Map,this._ongoingChange=!1,this._postFixersInProgress=!1,this._renderingDisabled=!1,this._hasChangedSinceTheLastRendering=!1,this.document=new Fe(e),this.domConverter=new At(this.document),this.set("isRenderingInProgress",!1),this.set("hasDomSelection",!1),this._renderer=new ft(this.domConverter,this.document.selection),this._renderer.bind("isFocused","isSelecting","isComposing").to(this.document,"isFocused","isSelecting","isComposing"),this._writer=new Ke(this.document),this.addObserver(Mt),this.addObserver(It),this.addObserver(Ft),this.addObserver(Tt),this.addObserver(Ot),this.addObserver(Bt),this.addObserver(qt),this.addObserver($t),this.addObserver(Lt),this.document.on("arrowKey",ut,{priority:"low"}),We(this),this.on("render",(()=>{this._render(),this.document.fire("layoutChanged"),this._hasChangedSinceTheLastRendering=!1})),this.listenTo(this.document.selection,"change",(()=>{this._hasChangedSinceTheLastRendering=!0})),this.listenTo(this.document,"change:isFocused",(()=>{this._hasChangedSinceTheLastRendering=!0})),f.isiOS&&this.listenTo(this.document,"blur",((e,t)=>{this.domConverter.mapDomToView(t.domEvent.relatedTarget)||this.domConverter._clearDomSelection()})),this.listenTo(this.document,"mutations",((e,{mutations:t})=>{t.forEach((e=>this._renderer.markToSync(e.type,e.node)))}),{priority:"low"}),this.listenTo(this.document,"mutations",(()=>{this.forceRender()}),{priority:"lowest"})}attachDomRoot(e,t="main"){const n=this.document.getRoot(t);n._name=e.tagName.toLowerCase();const s={};for(const{name:t,value:i}of Array.from(e.attributes))s[t]=i,"class"===t?this._writer.addClass(i.split(" "),n):n.hasAttribute(t)||this._writer.setAttribute(t,i,n);this._initialDomRootAttributes.set(e,s);const i=()=>{this._writer.setAttribute("contenteditable",(!n.isReadOnly).toString(),n),n.isReadOnly?this._writer.addClass("ck-read-only",n):this._writer.removeClass("ck-read-only",n)};i(),this.domRoots.set(t,e),this.domConverter.bindElements(e,n),this._renderer.markToSync("children",n),this._renderer.markToSync("attributes",n),this._renderer.domDocuments.add(e.ownerDocument),n.on("change:children",((e,t)=>this._renderer.markToSync("children",t))),n.on("change:attributes",((e,t)=>this._renderer.markToSync("attributes",t))),n.on("change:text",((e,t)=>this._renderer.markToSync("text",t))),n.on("change:isReadOnly",(()=>this.change(i))),n.on("change",(()=>{this._hasChangedSinceTheLastRendering=!0}));for(const n of this._observers.values())n.observe(e,t)}detachDomRoot(e){const t=this.domRoots.get(e);Array.from(t.attributes).forEach((({name:e})=>t.removeAttribute(e)));const n=this._initialDomRootAttributes.get(t);for(const e in n)t.setAttribute(e,n[e]);this.domRoots.delete(e),this.domConverter.unbindDomElement(t);for(const e of this._observers.values())e.stopObserving(t)}getDomRoot(e="main"){return this.domRoots.get(e)}addObserver(e){let t=this._observers.get(e);if(t)return t;t=new e(this),this._observers.set(e,t);for(const[e,n]of this.domRoots)t.observe(n,e);return t.enable(),t}getObserver(e){return this._observers.get(e)}disableObservers(){for(const e of this._observers.values())e.disable()}enableObservers(){for(const e of this._observers.values())e.enable()}scrollToTheSelection({alignToTop:e,forceScroll:t,viewportOffset:n=20,ancestorOffset:s=20}={}){const i=this.document.selection.getFirstRange();if(!i)return;const r=U({alignToTop:e,forceScroll:t,viewportOffset:n,ancestorOffset:s});"number"==typeof n&&(n={top:n,bottom:n,left:n,right:n});const o={target:this.domConverter.viewRangeToDom(i),viewportOffset:n,ancestorOffset:s,alignToTop:e,forceScroll:t};this.fire("scrollToTheSelection",o,r),R(o)}focus(){if(!this.document.isFocused){const e=this.document.selection.editableElement;e&&(this.domConverter.focus(e),this.forceRender())}}change(e){if(this.isRenderingInProgress||this._postFixersInProgress)throw new n("cannot-change-view-tree",this);try{if(this._ongoingChange)return e(this._writer);this._ongoingChange=!0;const t=e(this._writer);return this._ongoingChange=!1,!this._renderingDisabled&&this._hasChangedSinceTheLastRendering&&(this._postFixersInProgress=!0,this.document._callPostFixers(this._writer),this._postFixersInProgress=!1,this.fire("render")),t}catch(e){
/* istanbul ignore next -- @preserve */
n.rethrowUnexpectedError(e,this)}}forceRender(){this._hasChangedSinceTheLastRendering=!0,this.getObserver(It).flush(),this.change((()=>{}))}destroy(){for(const e of this._observers.values())e.destroy();this.document.destroy(),this.stopListening()}createPositionAt(e,t){return Ae._createAt(e,t)}createPositionAfter(e){return Ae._createAfter(e)}createPositionBefore(e){return Ae._createBefore(e)}createRange(e,t){return new Ce(e,t)}createRangeOn(e){return Ce._createOn(e)}createRangeIn(e){return Ce._createIn(e)}createSelection(...e){return new Ee(...e)}_disableRendering(e){this._renderingDisabled=e,0==e&&this.change((()=>{}))}_render(){this.isRenderingInProgress=!0,this.disableObservers(),this._renderer.render(),this.enableObservers(),this.isRenderingInProgress=!1}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class jt{
/* istanbul ignore next -- @preserve */
is(){throw new Error("is() method is abstract")}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class zt extends jt{constructor(e,t,s){if(super(),this.textNode=e,t<0||t>e.offsetSize)throw new n("model-textproxy-wrong-offsetintext",this);if(s<0||t+s>e.offsetSize)throw new n("model-textproxy-wrong-length",this);this.data=e.data.substring(t,t+s),this.offsetInText=t}get startOffset(){return null!==this.textNode.startOffset?this.textNode.startOffset+this.offsetInText:null}get offsetSize(){return this.data.length}get endOffset(){return null!==this.startOffset?this.startOffset+this.offsetSize:null}get isPartial(){return this.offsetSize!==this.textNode.offsetSize}get parent(){return this.textNode.parent}get root(){return this.textNode.root}getPath(){const e=this.textNode.getPath();return e.length>0&&(e[e.length-1]+=this.offsetInText),e}getAncestors(e={}){const t=[];let n=e.includeSelf?this:this.parent;for(;n;)t[e.parentFirst?"push":"unshift"](n),n=n.parent;return t}hasAttribute(e){return this.textNode.hasAttribute(e)}getAttribute(e){return this.textNode.getAttribute(e)}getAttributes(){return this.textNode.getAttributes()}getAttributeKeys(){return this.textNode.getAttributeKeys()}}zt.prototype.is=function(e){return"$textProxy"===e||"model:$textProxy"===e||"textProxy"===e||"model:textProxy"===e};
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */
class Ut{constructor(e){if(!e||!e.boundaries&&!e.startPosition)throw new n("model-tree-walker-no-start-position",null);const t=e.direction||"forward";if("forward"!=t&&"backward"!=t)throw new n("model-tree-walker-unknown-direction",e,{direction:t});this.direction=t,this.boundaries=e.boundaries||null,e.startPosition?this._position=e.startPosition.clone():this._position=Kt._createAt(this.boundaries["backward"==this.direction?"end":"start"]),this.position.stickiness="toNone",this.singleCharacters=!!e.singleCharacters,this.shallow=!!e.shallow,this.ignoreElementEnd=!!e.ignoreElementEnd,this._boundaryStartParent=this.boundaries?this.boundaries.start.parent:null,this._boundaryEndParent=this.boundaries?this.boundaries.end.parent:null,this._visitedParent=this.position.parent}[Symbol.iterator](){return this}get position(){return this._position}skip(e){let t,n,s,i;do{s=this.position,i=this._visitedParent,({done:t,value:n}=this.next())}while(!t&&e(n));t||(this._position=s,this._visitedParent=i)}next(){return"forward"==this.direction?this._next():this._previous()}_next(){const e=this.position,t=this.position.clone(),n=this._visitedParent;if(null===n.parent&&t.offset===n.maxOffset)return{done:!0,value:void 0};if(n===this._boundaryEndParent&&t.offset==this.boundaries.end.offset)return{done:!0,value:void 0};const s=Gt(t,n),i=s||Ht(t,n,s);if(i&&i.is("model:element")){if(this.shallow){if(this.boundaries&&this.boundaries.end.isBefore(t))return{done:!0,value:void 0};t.offset++}else t.path.push(0),this._visitedParent=i;return this._position=t,Jt("elementStart",i,e,t,1)}if(i&&i.is("model:$text")){let s;if(this.singleCharacters)s=1;else{let e=i.endOffset;this._boundaryEndParent==n&&this.boundaries.end.offset<e&&(e=this.boundaries.end.offset),s=e-t.offset}const r=t.offset-i.startOffset,o=new zt(i,r,s);return t.offset+=s,this._position=t,Jt("text",o,e,t,s)}return t.path.pop(),t.offset++,this._position=t,this._visitedParent=n.parent,this.ignoreElementEnd?this._next():Jt("elementEnd",n,e,t)}_previous(){const e=this.position,t=this.position.clone(),n=this._visitedParent;if(null===n.parent&&0===t.offset)return{done:!0,value:void 0};if(n==this._boundaryStartParent&&t.offset==this.boundaries.start.offset)return{done:!0,value:void 0};const s=t.parent,i=Gt(t,s),r=i||Yt(t,s,i);if(r&&r.is("model:element"))return t.offset--,this.shallow?(this._position=t,Jt("elementStart",r,e,t,1)):(t.path.push(r.maxOffset),this._position=t,this._visitedParent=r,this.ignoreElementEnd?this._previous():Jt("elementEnd",r,e,t));if(r&&r.is("model:$text")){let s;if(this.singleCharacters)s=1;else{let e=r.startOffset;this._boundaryStartParent==n&&this.boundaries.start.offset>e&&(e=this.boundaries.start.offset),s=t.offset-e}const i=t.offset-r.startOffset,o=new zt(r,i-s,s);return t.offset-=s,this._position=t,Jt("text",o,e,t,s)}return t.path.pop(),this._position=t,this._visitedParent=n.parent,Jt("elementStart",n,e,t,1)}}function Jt(e,t,n,s,i){return{done:!1,value:{type:e,item:t,previousPosition:n,nextPosition:s,length:i}}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class Kt extends jt{constructor(e,t,s="toNone"){if(super(),!e.is("element")&&!e.is("documentFragment"))throw new n("model-position-root-invalid",e);if(!Array.isArray(t)||0===t.length)throw new n("model-position-path-incorrect-format",e,{path:t});e.is("rootElement")?t=t.slice():(t=[...e.getPath(),...t],e=e.root),this.root=e,this.path=t,this.stickiness=s}get offset(){return this.path[this.path.length-1]}set offset(e){this.path[this.path.length-1]=e}get parent(){let e=this.root;for(let t=0;t<this.path.length-1;t++)if(e=e.getChildAtOffset(this.path[t]),!e)throw new n("model-position-path-incorrect",this,{position:this});if(e.is("$text"))throw new n("model-position-path-incorrect",this,{position:this});return e}get index(){return this.parent.offsetToIndex(this.offset)}get textNode(){return Gt(this,this.parent)}get nodeAfter(){const e=this.parent;return Ht(this,e,Gt(this,e))}get nodeBefore(){const e=this.parent;return Yt(this,e,Gt(this,e))}get isAtStart(){return 0===this.offset}get isAtEnd(){return this.offset==this.parent.maxOffset}isValid(){if(this.offset<0)return!1;let e=this.root;for(let t=0;t<this.path.length-1;t++)if(e=e.getChildAtOffset(this.path[t]),!e)return!1;return this.offset<=e.maxOffset}compareWith(e){if(this.root!=e.root)return"different";const t=s(this.path,e.path);switch(t){case"same":return"same";case"prefix":return"before";case"extension":return"after";default:return this.path[t]<e.path[t]?"before":"after"}}getLastMatchingPosition(e,t={}){t.startPosition=this;const n=new Ut(t);return n.skip(e),n.position}getParentPath(){return this.path.slice(0,-1)}getAncestors(){const e=this.parent;return e.is("documentFragment")?[e]:e.getAncestors({includeSelf:!0})}findAncestor(e){const t=this.parent;return t.is("element")?t.findAncestor(e,{includeSelf:!0}):null}getCommonPath(e){if(this.root!=e.root)return[];const t=s(this.path,e.path),n="string"==typeof t?Math.min(this.path.length,e.path.length):t;return this.path.slice(0,n)}getCommonAncestor(e){const t=this.getAncestors(),n=e.getAncestors();let s=0;for(;t[s]==n[s]&&t[s];)s++;return 0===s?null:t[s-1]}getShiftedBy(e){const t=this.clone(),n=t.offset+e;return t.offset=n<0?0:n,t}isAfter(e){return"after"==this.compareWith(e)}isBefore(e){return"before"==this.compareWith(e)}isEqual(e){return"same"==this.compareWith(e)}isTouching(e){if(this.root!==e.root)return!1;const t=Math.min(this.path.length,e.path.length);for(let n=0;n<t;n++){const t=this.path[n]-e.path[n];if(t<-1||t>1)return!1;if(1===t)return Xt(e,this,n);if(-1===t)return Xt(this,e,n)}return this.path.length===e.path.length||(this.path.length>e.path.length?Qt(this.path,t):Qt(e.path,t))}hasSameParentAs(e){if(this.root!==e.root)return!1;const t=this.getParentPath(),n=e.getParentPath();return"same"==s(t,n)}getTransformedByOperation(e){let t;switch(e.type){case"insert":t=this._getTransformedByInsertOperation(e);break;case"move":case"remove":case"reinsert":t=this._getTransformedByMoveOperation(e);break;case"split":t=this._getTransformedBySplitOperation(e);break;case"merge":t=this._getTransformedByMergeOperation(e);break;default:t=Kt._createAt(this)}return t}_getTransformedByInsertOperation(e){return this._getTransformedByInsertion(e.position,e.howMany)}_getTransformedByMoveOperation(e){return this._getTransformedByMove(e.sourcePosition,e.targetPosition,e.howMany)}_getTransformedBySplitOperation(e){const t=e.movedRange;return t.containsPosition(this)||t.start.isEqual(this)&&"toNext"==this.stickiness?this._getCombined(e.splitPosition,e.moveTargetPosition):e.graveyardPosition?this._getTransformedByMove(e.graveyardPosition,e.insertionPosition,1):this._getTransformedByInsertion(e.insertionPosition,1)}_getTransformedByMergeOperation(e){const t=e.movedRange;let n;return t.containsPosition(this)||t.start.isEqual(this)?(n=this._getCombined(e.sourcePosition,e.targetPosition),e.sourcePosition.isBefore(e.targetPosition)&&(n=n._getTransformedByDeletion(e.deletionPosition,1))):n=this.isEqual(e.deletionPosition)?Kt._createAt(e.deletionPosition):this._getTransformedByMove(e.deletionPosition,e.graveyardPosition,1),n}_getTransformedByDeletion(e,t){const n=Kt._createAt(this);if(this.root!=e.root)return n;if("same"==s(e.getParentPath(),this.getParentPath())){if(e.offset<this.offset){if(e.offset+t>this.offset)return null;n.offset-=t}}else if("prefix"==s(e.getParentPath(),this.getParentPath())){const s=e.path.length-1;if(e.offset<=this.path[s]){if(e.offset+t>this.path[s])return null;n.path[s]-=t}}return n}_getTransformedByInsertion(e,t){const n=Kt._createAt(this);if(this.root!=e.root)return n;if("same"==s(e.getParentPath(),this.getParentPath()))(e.offset<this.offset||e.offset==this.offset&&"toPrevious"!=this.stickiness)&&(n.offset+=t);else if("prefix"==s(e.getParentPath(),this.getParentPath())){const s=e.path.length-1;e.offset<=this.path[s]&&(n.path[s]+=t)}return n}_getTransformedByMove(e,t,n){if(t=t._getTransformedByDeletion(e,n),e.isEqual(t))return Kt._createAt(this);const s=this._getTransformedByDeletion(e,n);return null===s||e.isEqual(this)&&"toNext"==this.stickiness||e.getShiftedBy(n).isEqual(this)&&"toPrevious"==this.stickiness?this._getCombined(e,t):s._getTransformedByInsertion(t,n)}_getCombined(e,t){const n=e.path.length-1,s=Kt._createAt(t);return s.stickiness=this.stickiness,s.offset=s.offset+this.path[n]-e.offset,s.path=[...s.path,...this.path.slice(n+1)],s}toJSON(){return{root:this.root.toJSON(),path:Array.from(this.path),stickiness:this.stickiness}}clone(){return new this.constructor(this.root,this.path,this.stickiness)}static _createAt(e,t,s="toNone"){if(e.is("model:position"))return new Kt(e.root,e.path,e.stickiness);{const i=e;if("end"==t)t=i.maxOffset;else{if("before"==t)return this._createBefore(i,s);if("after"==t)return this._createAfter(i,s);if(0!==t&&!t)throw new n("model-createpositionat-offset-required",[this,e])}if(!i.is("element")&&!i.is("documentFragment"))throw new n("model-position-parent-incorrect",[this,e]);const r=i.getPath();return r.push(t),new this(i.root,r,s)}}static _createAfter(e,t){if(!e.parent)throw new n("model-position-after-root",[this,e],{root:e});return this._createAt(e.parent,e.endOffset,t)}static _createBefore(e,t){if(!e.parent)throw new n("model-position-before-root",e,{root:e});return this._createAt(e.parent,e.startOffset,t)}static fromJSON(e,t){if("$graveyard"===e.root){const n=new Kt(t.graveyard,e.path);return n.stickiness=e.stickiness,n}if(!t.getRoot(e.root))throw new n("model-position-fromjson-no-root",t,{rootName:e.root});return new Kt(t.getRoot(e.root),e.path,e.stickiness)}}function Gt(e,t){const n=t.getChildAtOffset(e.offset);return n&&n.is("$text")&&n.startOffset<e.offset?n:null}function Ht(e,t,n){return null!==n?null:t.getChildAtOffset(e.offset)}function Yt(e,t,n){return null!==n?null:t.getChild(t.offsetToIndex(e.offset)-1)}function Xt(e,t,n){return n+1!==e.path.length&&(!!Qt(t.path,n+1)&&!!function(e,t){let n=e.parent,s=e.path.length-1,i=0;for(;s>=t;){if(e.path[s]+i!==n.maxOffset)return!1;i=1,s--,n=n.parent}return!0}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */(e,n+1))}function Qt(e,t){for(;t<e.length;){if(0!==e[t])return!1;t++}return!0}Kt.prototype.is=function(e){return"position"===e||"model:position"===e};class Zt extends jt{constructor(e,t){super(),this.start=Kt._createAt(e),this.end=t?Kt._createAt(t):Kt._createAt(e),this.start.stickiness=this.isCollapsed?"toNone":"toNext",this.end.stickiness=this.isCollapsed?"toNone":"toPrevious"}*[Symbol.iterator](){yield*new Ut({boundaries:this,ignoreElementEnd:!0})}get isCollapsed(){return this.start.isEqual(this.end)}get isFlat(){const e=this.start.getParentPath(),t=this.end.getParentPath();return"same"==s(e,t)}get root(){return this.start.root}containsPosition(e){return e.isAfter(this.start)&&e.isBefore(this.end)}containsRange(e,t=!1){e.isCollapsed&&(t=!1);const n=this.containsPosition(e.start)||t&&this.start.isEqual(e.start),s=this.containsPosition(e.end)||t&&this.end.isEqual(e.end);return n&&s}containsItem(e){const t=Kt._createBefore(e);return this.containsPosition(t)||this.start.isEqual(t)}isEqual(e){return this.start.isEqual(e.start)&&this.end.isEqual(e.end)}isIntersecting(e){return this.start.isBefore(e.end)&&this.end.isAfter(e.start)}getDifference(e){const t=[];return this.isIntersecting(e)?(this.containsPosition(e.start)&&t.push(new Zt(this.start,e.start)),this.containsPosition(e.end)&&t.push(new Zt(e.end,this.end))):t.push(new Zt(this.start,this.end)),t}getIntersection(e){if(this.isIntersecting(e)){let t=this.start,n=this.end;return this.containsPosition(e.start)&&(t=e.start),this.containsPosition(e.end)&&(n=e.end),new Zt(t,n)}return null}getJoined(e,t=!1){let n=this.isIntersecting(e);if(n||(n=this.start.isBefore(e.start)?t?this.end.isTouching(e.start):this.end.isEqual(e.start):t?e.end.isTouching(this.start):e.end.isEqual(this.start)),!n)return null;let s=this.start,i=this.end;return e.start.isBefore(s)&&(s=e.start),e.end.isAfter(i)&&(i=e.end),new Zt(s,i)}getMinimalFlatRanges(){const e=[],t=this.start.getCommonPath(this.end).length,n=Kt._createAt(this.start);let s=n.parent;for(;n.path.length>t+1;){const t=s.maxOffset-n.offset;0!==t&&e.push(new Zt(n,n.getShiftedBy(t))),n.path=n.path.slice(0,-1),n.offset++,s=s.parent}for(;n.path.length<=this.end.path.length;){const t=this.end.path[n.path.length-1],s=t-n.offset;0!==s&&e.push(new Zt(n,n.getShiftedBy(s))),n.offset=t,n.path.push(0)}return e}getWalker(e={}){return e.boundaries=this,new Ut(e)}*getItems(e={}){e.boundaries=this,e.ignoreElementEnd=!0;const t=new Ut(e);for(const e of t)yield e.item}*getPositions(e={}){e.boundaries=this;const t=new Ut(e);yield t.position;for(const e of t)yield e.nextPosition}getTransformedByOperation(e){switch(e.type){case"insert":return this._getTransformedByInsertOperation(e);case"move":case"remove":case"reinsert":return this._getTransformedByMoveOperation(e);case"split":return[this._getTransformedBySplitOperation(e)];case"merge":return[this._getTransformedByMergeOperation(e)]}return[new Zt(this.start,this.end)]}getTransformedByOperations(e){const t=[new Zt(this.start,this.end)];for(const n of e)for(let e=0;e<t.length;e++){const s=t[e].getTransformedByOperation(n);t.splice(e,1,...s),e+=s.length-1}for(let e=0;e<t.length;e++){const n=t[e];for(let s=e+1;s<t.length;s++){const e=t[s];(n.containsRange(e)||e.containsRange(n)||n.isEqual(e))&&t.splice(s,1)}}return t}getCommonAncestor(){return this.start.getCommonAncestor(this.end)}getContainedElement(){if(this.isCollapsed)return null;const e=this.start.nodeAfter,t=this.end.nodeBefore;return e&&e.is("element")&&e===t?e:null}toJSON(){return{start:this.start.toJSON(),end:this.end.toJSON()}}clone(){return new this.constructor(this.start,this.end)}_getTransformedByInsertOperation(e,t=!1){return this._getTransformedByInsertion(e.position,e.howMany,t)}_getTransformedByMoveOperation(e,t=!1){const n=e.sourcePosition,s=e.howMany,i=e.targetPosition;return this._getTransformedByMove(n,i,s,t)}_getTransformedBySplitOperation(e){const t=this.start._getTransformedBySplitOperation(e);let n=this.end._getTransformedBySplitOperation(e);return this.end.isEqual(e.insertionPosition)&&(n=this.end.getShiftedBy(1)),t.root!=n.root&&(n=this.end.getShiftedBy(-1)),new Zt(t,n)}_getTransformedByMergeOperation(e){if(this.start.isEqual(e.targetPosition)&&this.end.isEqual(e.deletionPosition))return new Zt(this.start);let t=this.start._getTransformedByMergeOperation(e),n=this.end._getTransformedByMergeOperation(e);return t.root!=n.root&&(n=this.end.getShiftedBy(-1)),t.isAfter(n)?(e.sourcePosition.isBefore(e.targetPosition)?(t=Kt._createAt(n),t.offset=0):(e.deletionPosition.isEqual(t)||(n=e.deletionPosition),t=e.targetPosition),new Zt(t,n)):new Zt(t,n)}_getTransformedByInsertion(e,t,n=!1){if(n&&this.containsPosition(e))return[new Zt(this.start,e),new Zt(e.getShiftedBy(t),this.end._getTransformedByInsertion(e,t))];{const n=new Zt(this.start,this.end);return n.start=n.start._getTransformedByInsertion(e,t),n.end=n.end._getTransformedByInsertion(e,t),[n]}}_getTransformedByMove(e,t,n,s=!1){if(this.isCollapsed){const s=this.start._getTransformedByMove(e,t,n);return[new Zt(s)]}const i=Zt._createFromPositionAndShift(e,n),r=t._getTransformedByDeletion(e,n);if(this.containsPosition(t)&&!s&&(i.containsPosition(this.start)||i.containsPosition(this.end))){const s=this.start._getTransformedByMove(e,t,n),i=this.end._getTransformedByMove(e,t,n);return[new Zt(s,i)]}let o;const a=this.getDifference(i);let l=null;const c=this.getIntersection(i);if(1==a.length?l=new Zt(a[0].start._getTransformedByDeletion(e,n),a[0].end._getTransformedByDeletion(e,n)):2==a.length&&(l=new Zt(this.start,this.end._getTransformedByDeletion(e,n))),o=l?l._getTransformedByInsertion(r,n,null!==c||s):[],c){const e=new Zt(c.start._getCombined(i.start,r),c.end._getCombined(i.start,r));2==o.length?o.splice(1,0,e):o.push(e)}return o}_getTransformedByDeletion(e,t){let n=this.start._getTransformedByDeletion(e,t),s=this.end._getTransformedByDeletion(e,t);return null==n&&null==s?null:(null==n&&(n=e),null==s&&(s=e),new Zt(n,s))}static _createFromPositionAndShift(e,t){const n=e,s=e.getShiftedBy(t);return t>0?new this(n,s):new this(s,n)}static _createIn(e){return new this(Kt._createAt(e,0),Kt._createAt(e,e.maxOffset))}static _createOn(e){return this._createFromPositionAndShift(Kt._createBefore(e),e.offsetSize)}static _createFromRanges(e){if(0===e.length)throw new n("range-create-from-ranges-empty-array",null);if(1==e.length)return e[0].clone();const t=e[0];e.sort(((e,t)=>e.start.isAfter(t.start)?1:-1));const s=e.indexOf(t),i=new this(t.start,t.end);for(let t=s-1;t>=0&&e[t].end.isEqual(i.start);t--)i.start=Kt._createAt(e[t].start);for(let t=s+1;t<e.length&&e[t].start.isEqual(i.end);t++)i.end=Kt._createAt(e[t].end);return i}static fromJSON(e,t){return new this(Kt.fromJSON(e.start,t),Kt.fromJSON(e.end,t))}}Zt.prototype.is=function(e){return"range"===e||"model:range"===e};
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */
class en extends(t()){constructor(){super(),this._modelToViewMapping=new WeakMap,this._viewToModelMapping=new WeakMap,this._viewToModelLengthCallbacks=new Map,this._markerNameToElements=new Map,this._elementToMarkerNames=new Map,this._deferredBindingRemovals=new Map,this._unboundMarkerNames=new Set,this.on("modelToViewPosition",((e,t)=>{if(t.viewPosition)return;const s=this._modelToViewMapping.get(t.modelPosition.parent);if(!s)throw new n("mapping-model-position-view-parent-not-found",this,{modelPosition:t.modelPosition});t.viewPosition=this.findPositionIn(s,t.modelPosition.offset)}),{priority:"low"}),this.on("viewToModelPosition",((e,t)=>{if(t.modelPosition)return;const n=this.findMappedViewAncestor(t.viewPosition),s=this._viewToModelMapping.get(n),i=this._toModelOffset(t.viewPosition.parent,t.viewPosition.offset,n);t.modelPosition=Kt._createAt(s,i)}),{priority:"low"})}bindElements(e,t){this._modelToViewMapping.set(e,t),this._viewToModelMapping.set(t,e)}unbindViewElement(e,t={}){const n=this.toModelElement(e);if(this._elementToMarkerNames.has(e))for(const t of this._elementToMarkerNames.get(e))this._unboundMarkerNames.add(t);t.defer?this._deferredBindingRemovals.set(e,e.root):(this._viewToModelMapping.delete(e),this._modelToViewMapping.get(n)==e&&this._modelToViewMapping.delete(n))}unbindModelElement(e){const t=this.toViewElement(e);this._modelToViewMapping.delete(e),this._viewToModelMapping.get(t)==e&&this._viewToModelMapping.delete(t)}bindElementToMarker(e,t){const n=this._markerNameToElements.get(t)||new Set;n.add(e);const s=this._elementToMarkerNames.get(e)||new Set;s.add(t),this._markerNameToElements.set(t,n),this._elementToMarkerNames.set(e,s)}unbindElementFromMarkerName(e,t){const n=this._markerNameToElements.get(t);n&&(n.delete(e),0==n.size&&this._markerNameToElements.delete(t));const s=this._elementToMarkerNames.get(e);s&&(s.delete(t),0==s.size&&this._elementToMarkerNames.delete(e))}flushUnboundMarkerNames(){const e=Array.from(this._unboundMarkerNames);return this._unboundMarkerNames.clear(),e}flushDeferredBindings(){for(const[e,t]of this._deferredBindingRemovals)e.root==t&&this.unbindViewElement(e);this._deferredBindingRemovals=new Map}clearBindings(){this._modelToViewMapping=new WeakMap,this._viewToModelMapping=new WeakMap,this._markerNameToElements=new Map,this._elementToMarkerNames=new Map,this._unboundMarkerNames=new Set,this._deferredBindingRemovals=new Map}toModelElement(e){return this._viewToModelMapping.get(e)}toViewElement(e){return this._modelToViewMapping.get(e)}toModelRange(e){return new Zt(this.toModelPosition(e.start),this.toModelPosition(e.end))}toViewRange(e){return new Ce(this.toViewPosition(e.start),this.toViewPosition(e.end))}toModelPosition(e){const t={viewPosition:e,mapper:this};return this.fire("viewToModelPosition",t),t.modelPosition}toViewPosition(e,t={}){const n={modelPosition:e,mapper:this,isPhantom:t.isPhantom};return this.fire("modelToViewPosition",n),n.viewPosition}markerNameToElements(e){const t=this._markerNameToElements.get(e);if(!t)return null;const n=new Set;for(const e of t)if(e.is("attributeElement"))for(const t of e.getElementsWithSameId())n.add(t);else n.add(e);return n}registerViewToModelLength(e,t){this._viewToModelLengthCallbacks.set(e,t)}findMappedViewAncestor(e){let t=e.parent;for(;!this._viewToModelMapping.has(t);)t=t.parent;return t}_toModelOffset(e,t,n){if(n!=e){return this._toModelOffset(e.parent,e.index,n)+this._toModelOffset(e,t,e)}if(e.is("$text"))return t;let s=0;for(let n=0;n<t;n++)s+=this.getModelLength(e.getChild(n));return s}getModelLength(e){const t=[e];let n=0;for(;t.length>0;){const e=t.pop(),s=e.name&&this._viewToModelLengthCallbacks.size>0&&this._viewToModelLengthCallbacks.get(e.name);if(s)n+=s(e);else if(this._viewToModelMapping.has(e))n+=1;else if(e.is("$text"))n+=e.data.length;else{if(e.is("uiElement"))continue;for(const n of e.getChildren())t.push(n)}}return n}findPositionIn(e,t){let n,s=0,i=0,r=0;if(e.is("$text"))return new Ae(e,t);for(;i<t;)n=e.getChild(r),s=this.getModelLength(n),i+=s,r++;return i==t?this._moveViewPositionToTextNode(new Ae(e,r)):this.findPositionIn(n,t-(i-s))}_moveViewPositionToTextNode(e){const t=e.nodeBefore,n=e.nodeAfter;return t&&t.is("view:$text")?new Ae(t,t.data.length):n&&n.is("view:$text")?new Ae(n,0):e}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class tn{constructor(){this._consumable=new Map,this._textProxyRegistry=new Map}add(e,t){t=nn(t),e instanceof zt&&(e=this._getSymbolForTextProxy(e)),this._consumable.has(e)||this._consumable.set(e,new Map),this._consumable.get(e).set(t,!0)}consume(e,t){return t=nn(t),e instanceof zt&&(e=this._getSymbolForTextProxy(e)),!!this.test(e,t)&&(this._consumable.get(e).set(t,!1),!0)}test(e,t){t=nn(t),e instanceof zt&&(e=this._getSymbolForTextProxy(e));const n=this._consumable.get(e);if(void 0===n)return null;const s=n.get(t);return void 0===s?null:s}revert(e,t){t=nn(t),e instanceof zt&&(e=this._getSymbolForTextProxy(e));const n=this.test(e,t);return!1===n?(this._consumable.get(e).set(t,!0),!0):!0!==n&&null}verifyAllConsumed(e){const t=[];for(const[n,s]of this._consumable)for(const[i,r]of s){const s=i.split(":")[0];r&&e==s&&t.push({event:i,item:n.name||n.description})}if(t.length)throw new n("conversion-model-consumable-not-consumed",null,{items:t})}_getSymbolForTextProxy(e){let t=null;const n=this._textProxyRegistry.get(e.startOffset);if(n){const s=n.get(e.endOffset);s&&(t=s.get(e.parent))}return t||(t=this._addSymbolForTextProxy(e)),t}_addSymbolForTextProxy(e){const t=e.startOffset,n=e.endOffset,s=e.parent,i=Symbol("$textProxy:"+e.data);let r,o;return r=this._textProxyRegistry.get(t),r||(r=new Map,this._textProxyRegistry.set(t,r)),o=r.get(n),o||(o=new Map,r.set(n,o)),o.set(s,i),i}}function nn(e){const t=e.split(":");return"insert"==t[0]?t[0]:"addMarker"==t[0]||"removeMarker"==t[0]?e:t.length>1?t[0]+":"+t[1]:t[0]}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class sn extends(t()){constructor(e){super(),this._conversionApi={dispatcher:this,...e},this._firedEventsMap=new WeakMap}convertChanges(e,t,n){const s=this._createConversionApi(n,e.getRefreshedItems());for(const t of e.getMarkersToRemove())this._convertMarkerRemove(t.name,t.range,s);const i=this._reduceChanges(e.getChanges());for(const e of i)"insert"===e.type?this._convertInsert(Zt._createFromPositionAndShift(e.position,e.length),s):"reinsert"===e.type?this._convertReinsert(Zt._createFromPositionAndShift(e.position,e.length),s):"remove"===e.type?this._convertRemove(e.position,e.length,e.name,s):this._convertAttribute(e.range,e.attributeKey,e.attributeOldValue,e.attributeNewValue,s);s.mapper.flushDeferredBindings();for(const e of s.mapper.flushUnboundMarkerNames()){const n=t.get(e).getRange();this._convertMarkerRemove(e,n,s),this._convertMarkerAdd(e,n,s)}for(const t of e.getMarkersToAdd())this._convertMarkerAdd(t.name,t.range,s);s.consumable.verifyAllConsumed("insert")}convert(e,t,n,s={}){const i=this._createConversionApi(n,void 0,s);this._convertInsert(e,i);for(const[e,n]of t)this._convertMarkerAdd(e,n,i);i.consumable.verifyAllConsumed("insert")}convertSelection(e,t,n){const s=this._createConversionApi(n);this.fire("cleanSelection",{selection:e},s);const i=e.getFirstPosition().root;if(!s.mapper.toViewElement(i))return;const r=Array.from(t.getMarkersAtPosition(e.getFirstPosition()));if(this._addConsumablesForSelection(s.consumable,e,r),this.fire("selection",{selection:e},s),e.isCollapsed){for(const t of r)if(s.consumable.test(e,"addMarker:"+t.name)){const n=t.getRange();if(!rn(e.getFirstPosition(),t,s.mapper))continue;const i={item:e,markerName:t.name,markerRange:n};this.fire(`addMarker:${t.name}`,i,s)}for(const t of e.getAttributeKeys())if(s.consumable.test(e,"attribute:"+t)){const n={item:e,range:e.getFirstRange(),attributeKey:t,attributeOldValue:null,attributeNewValue:e.getAttribute(t)};this.fire(`attribute:${t}:$text`,n,s)}}}_convertInsert(e,t,n={}){n.doNotAddConsumables||this._addConsumablesForInsert(t.consumable,e);for(const n of e.getWalker({shallow:!0}))this._testAndFire("insert",on(n),t)}_convertRemove(e,t,n,s){this.fire(`remove:${n}`,{position:e,length:t},s)}_convertAttribute(e,t,n,s,i){this._addConsumablesForRange(i.consumable,e,`attribute:${t}`);for(const r of e){const e={item:r.item,range:Zt._createFromPositionAndShift(r.previousPosition,r.length),attributeKey:t,attributeOldValue:n,attributeNewValue:s};this._testAndFire(`attribute:${t}`,e,i)}}_convertReinsert(e,t){const n=Array.from(e.getWalker({shallow:!0}));this._addConsumablesForInsert(t.consumable,n);for(const e of n.map(on))this._testAndFire("insert",{...e,reconversion:!0},t)}_convertMarkerAdd(e,t,n){if("$graveyard"==t.root.rootName)return;const s=`addMarker:${e}`;if(n.consumable.add(t,s),this.fire(s,{markerName:e,markerRange:t},n),n.consumable.consume(t,s)){this._addConsumablesForRange(n.consumable,t,s);for(const i of t.getItems()){if(!n.consumable.test(i,s))continue;const r={item:i,range:Zt._createOn(i),markerName:e,markerRange:t};this.fire(s,r,n)}}}_convertMarkerRemove(e,t,n){"$graveyard"!=t.root.rootName&&this.fire(`removeMarker:${e}`,{markerName:e,markerRange:t},n)}_reduceChanges(e){const t={changes:e};return this.fire("reduceChanges",t),t.changes}_addConsumablesForInsert(e,t){for(const n of t){const t=n.item;if(null===e.test(t,"insert")){e.add(t,"insert");for(const n of t.getAttributeKeys())e.add(t,"attribute:"+n)}}return e}_addConsumablesForRange(e,t,n){for(const s of t.getItems())e.add(s,n);return e}_addConsumablesForSelection(e,t,n){e.add(t,"selection");for(const s of n)e.add(t,"addMarker:"+s.name);for(const n of t.getAttributeKeys())e.add(t,"attribute:"+n);return e}_testAndFire(e,t,n){const s=function(e,t){const n=t.item.is("element")?t.item.name:"$text";return`${e}:${n}`}(e,t),i=t.item.is("$textProxy")?n.consumable._getSymbolForTextProxy(t.item):t.item,r=this._firedEventsMap.get(n),o=r.get(i);if(o){if(o.has(s))return;o.add(s)}else r.set(i,new Set([s]));this.fire(s,t,n)}_testAndFireAddAttributes(e,t){const n={item:e,range:Zt._createOn(e)};for(const e of n.item.getAttributeKeys())n.attributeKey=e,n.attributeOldValue=null,n.attributeNewValue=n.item.getAttribute(e),this._testAndFire(`attribute:${e}`,n,t)}_createConversionApi(e,t=new Set,n={}){const s={...this._conversionApi,consumable:new tn,writer:e,options:n,convertItem:e=>this._convertInsert(Zt._createOn(e),s),convertChildren:e=>this._convertInsert(Zt._createIn(e),s,{doNotAddConsumables:!0}),convertAttributes:e=>this._testAndFireAddAttributes(e,s),canReuseView:e=>!t.has(s.mapper.toModelElement(e))};return this._firedEventsMap.set(s,new Map),s}}function rn(e,t,n){const s=t.getRange(),i=Array.from(e.getAncestors());i.shift(),i.reverse();return!i.some((e=>{if(s.containsItem(e)){return!!n.toViewElement(e).getCustomProperty("addHighlight")}}))}function on(e){return{item:e.item,range:Zt._createFromPositionAndShift(e.previousPosition,e.length)}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */let an=class extends jt{constructor(e){super(),this.parent=null,this._index=null,this._startOffset=null,this._attrs=r(e)}get document(){return null}get index(){return this._index}get startOffset(){return this._startOffset}get offsetSize(){return 1}get endOffset(){return null===this.startOffset?null:this.startOffset+this.offsetSize}get nextSibling(){const e=this.index;return null!==e&&this.parent.getChild(e+1)||null}get previousSibling(){const e=this.index;return null!==e&&this.parent.getChild(e-1)||null}get root(){let e=this;for(;e.parent;)e=e.parent;return e}isAttached(){return null!==this.parent&&this.root.isAttached()}getPath(){const e=[];let t=this;for(;t.parent;)e.unshift(t.startOffset),t=t.parent;return e}getAncestors(e={}){const t=[];let n=e.includeSelf?this:this.parent;for(;n;)t[e.parentFirst?"push":"unshift"](n),n=n.parent;return t}getCommonAncestor(e,t={}){const n=this.getAncestors(t),s=e.getAncestors(t);let i=0;for(;n[i]==s[i]&&n[i];)i++;return 0===i?null:n[i-1]}isBefore(e){if(this==e)return!1;if(this.root!==e.root)return!1;const t=this.getPath(),n=e.getPath(),i=s(t,n);switch(i){case"prefix":return!0;case"extension":return!1;default:return t[i]<n[i]}}isAfter(e){return this!=e&&(this.root===e.root&&!this.isBefore(e))}hasAttribute(e){return this._attrs.has(e)}getAttribute(e){return this._attrs.get(e)}getAttributes(){return this._attrs.entries()}getAttributeKeys(){return this._attrs.keys()}toJSON(){const e={};return this._attrs.size&&(e.attributes=Array.from(this._attrs).reduce(((e,t)=>(e[t[0]]=t[1],e)),{})),e}_clone(e){return new this.constructor(this._attrs)}_remove(){this.parent._removeChildren(this.index)}_setAttribute(e,t){this._attrs.set(e,t)}_setAttributesTo(e){this._attrs=r(e)}_removeAttribute(e){return this._attrs.delete(e)}_clearAttributes(){this._attrs.clear()}};an.prototype.is=function(e){return"node"===e||"model:node"===e};
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */
class ln extends(t(jt)){constructor(...e){super(),this._lastRangeBackward=!1,this._attrs=new Map,this._ranges=[],e.length&&this.setTo(...e)}get anchor(){if(this._ranges.length>0){const e=this._ranges[this._ranges.length-1];return this._lastRangeBackward?e.end:e.start}return null}get focus(){if(this._ranges.length>0){const e=this._ranges[this._ranges.length-1];return this._lastRangeBackward?e.start:e.end}return null}get isCollapsed(){return 1===this._ranges.length&&this._ranges[0].isCollapsed}get rangeCount(){return this._ranges.length}get isBackward(){return!this.isCollapsed&&this._lastRangeBackward}isEqual(e){if(this.rangeCount!=e.rangeCount)return!1;if(0===this.rangeCount)return!0;if(!this.anchor.isEqual(e.anchor)||!this.focus.isEqual(e.focus))return!1;for(const t of this._ranges){let n=!1;for(const s of e._ranges)if(t.isEqual(s)){n=!0;break}if(!n)return!1}return!0}*getRanges(){for(const e of this._ranges)yield new Zt(e.start,e.end)}getFirstRange(){let e=null;for(const t of this._ranges)e&&!t.start.isBefore(e.start)||(e=t);return e?new Zt(e.start,e.end):null}getLastRange(){let e=null;for(const t of this._ranges)e&&!t.end.isAfter(e.end)||(e=t);return e?new Zt(e.start,e.end):null}getFirstPosition(){const e=this.getFirstRange();return e?e.start.clone():null}getLastPosition(){const e=this.getLastRange();return e?e.end.clone():null}setTo(...e){let[t,s,i]=e;if("object"==typeof s&&(i=s,s=void 0),null===t)this._setRanges([]);else if(t instanceof ln)this._setRanges(t.getRanges(),t.isBackward);else if(t&&"function"==typeof t.getRanges)this._setRanges(t.getRanges(),t.isBackward);else if(t instanceof Zt)this._setRanges([t],!!i&&!!i.backward);else if(t instanceof Kt)this._setRanges([new Zt(t)]);else if(t instanceof an){const e=!!i&&!!i.backward;let r;if("in"==s)r=Zt._createIn(t);else if("on"==s)r=Zt._createOn(t);else{if(void 0===s)throw new n("model-selection-setto-required-second-parameter",[this,t]);r=new Zt(Kt._createAt(t,s))}this._setRanges([r],e)}else{if(!o(t))throw new n("model-selection-setto-not-selectable",[this,t]);this._setRanges(t,i&&!!i.backward)}}_setRanges(e,t=!1){const s=Array.from(e),i=s.some((t=>{if(!(t instanceof Zt))throw new n("model-selection-set-ranges-not-range",[this,e]);return this._ranges.every((e=>!e.isEqual(t)))}));(s.length!==this._ranges.length||i)&&(this._replaceAllRanges(s),this._lastRangeBackward=!!t,this.fire("change:range",{directChange:!0}))}setFocus(e,t){if(null===this.anchor)throw new n("model-selection-setfocus-no-ranges",[this,e]);const s=Kt._createAt(e,t);if("same"==s.compareWith(this.focus))return;const i=this.anchor;this._ranges.length&&this._popRange(),"before"==s.compareWith(i)?(this._pushRange(new Zt(s,i)),this._lastRangeBackward=!0):(this._pushRange(new Zt(i,s)),this._lastRangeBackward=!1),this.fire("change:range",{directChange:!0})}getAttribute(e){return this._attrs.get(e)}getAttributes(){return this._attrs.entries()}getAttributeKeys(){return this._attrs.keys()}hasAttribute(e){return this._attrs.has(e)}removeAttribute(e){this.hasAttribute(e)&&(this._attrs.delete(e),this.fire("change:attribute",{attributeKeys:[e],directChange:!0}))}setAttribute(e,t){this.getAttribute(e)!==t&&(this._attrs.set(e,t),this.fire("change:attribute",{attributeKeys:[e],directChange:!0}))}getSelectedElement(){return 1!==this.rangeCount?null:this.getFirstRange().getContainedElement()}*getSelectedBlocks(){const e=new WeakSet;for(const t of this.getRanges()){const n=dn(t.start,e);fn(n,t)&&(yield n);for(const n of t.getWalker()){const s=n.item;"elementEnd"==n.type&&hn(s,e,t)&&(yield s)}const s=dn(t.end,e);mn(s,t)&&(yield s)}}containsEntireContent(e=this.anchor.root){const t=Kt._createAt(e,0),n=Kt._createAt(e,"end");return t.isTouching(this.getFirstPosition())&&n.isTouching(this.getLastPosition())}_pushRange(e){this._checkRange(e),this._ranges.push(new Zt(e.start,e.end))}_checkRange(e){for(let t=0;t<this._ranges.length;t++)if(e.isIntersecting(this._ranges[t]))throw new n("model-selection-range-intersects",[this,e],{addedRange:e,intersectingRange:this._ranges[t]})}_replaceAllRanges(e){this._removeAllRanges();for(const t of e)this._pushRange(t)}_removeAllRanges(){for(;this._ranges.length>0;)this._popRange()}_popRange(){this._ranges.pop()}}function cn(e,t){return!t.has(e)&&(t.add(e),e.root.document.model.schema.isBlock(e)&&!!e.parent)}function hn(e,t,n){return cn(e,t)&&un(e,n)}function dn(e,t){const n=e.parent.root.document.model.schema,s=e.parent.getAncestors({parentFirst:!0,includeSelf:!0});let i=!1;const r=s.find((e=>!i&&(i=n.isLimit(e),!i&&cn(e,t))));return s.forEach((e=>t.add(e))),r}function un(e,t){const n=function(e){const t=e.root.document.model.schema;let n=e.parent;for(;n;){if(t.isBlock(n))return n;n=n.parent}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */(e);if(!n)return!0;return!t.containsRange(Zt._createOn(n),!0)}function fn(e,t){return!!e&&(!(!t.isCollapsed&&!e.isEmpty)||!t.start.isTouching(Kt._createAt(e,e.maxOffset))&&un(e,t))}function mn(e,t){return!!e&&(!(!t.isCollapsed&&!e.isEmpty)||!t.end.isTouching(Kt._createAt(e,0))&&un(e,t))}ln.prototype.is=function(e){return"selection"===e||"model:selection"===e};class gn extends(t(Zt)){constructor(e,t){super(e,t),pn.call(this)}detach(){this.stopListening()}toRange(){return new Zt(this.start,this.end)}static fromRange(e){return new gn(e.start,e.end)}}function pn(){this.listenTo(this.root.document.model,"applyOperation",((e,t)=>{const n=t[0];n.isDocumentOperation&&_n.call(this,n)}),{priority:"low"})}function _n(e){const t=this.getTransformedByOperation(e),n=Zt._createFromRanges(t),s=!n.isEqual(this),i=function(e,t){switch(t.type){case"insert":return e.containsPosition(t.position);case"move":case"remove":case"reinsert":case"merge":return e.containsPosition(t.sourcePosition)||e.start.isEqual(t.sourcePosition)||e.containsPosition(t.targetPosition);case"split":return e.containsPosition(t.splitPosition)||e.containsPosition(t.insertionPosition)}return!1}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */(this,e);let r=null;if(s){"$graveyard"==n.root.rootName&&(r="remove"==e.type?e.sourcePosition:e.deletionPosition);const t=this.toRange();this.start=n.start,this.end=n.end,this.fire("change:range",t,{deletionPosition:r})}else i&&this.fire("change:content",this.toRange(),{deletionPosition:r})}gn.prototype.is=function(e){return"liveRange"===e||"model:liveRange"===e||"range"==e||"model:range"===e};class wn extends an{constructor(e,t){super(t),this._data=e||""}get offsetSize(){return this.data.length}get data(){return this._data}toJSON(){const e=super.toJSON();return e.data=this.data,e}_clone(){return new wn(this.data,this.getAttributes())}static fromJSON(e){return new wn(e.data,e.attributes)}}wn.prototype.is=function(e){return"$text"===e||"model:$text"===e||"text"===e||"model:text"===e||"node"===e||"model:node"===e};
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */
const yn="selection:";class bn extends(t(jt)){constructor(e){super(),this._selection=new vn(e),this._selection.delegate("change:range").to(this),this._selection.delegate("change:attribute").to(this),this._selection.delegate("change:marker").to(this)}get isCollapsed(){return this._selection.isCollapsed}get anchor(){return this._selection.anchor}get focus(){return this._selection.focus}get rangeCount(){return this._selection.rangeCount}get hasOwnRange(){return this._selection.hasOwnRange}get isBackward(){return this._selection.isBackward}get isGravityOverridden(){return this._selection.isGravityOverridden}get markers(){return this._selection.markers}get _ranges(){return this._selection._ranges}getRanges(){return this._selection.getRanges()}getFirstPosition(){return this._selection.getFirstPosition()}getLastPosition(){return this._selection.getLastPosition()}getFirstRange(){return this._selection.getFirstRange()}getLastRange(){return this._selection.getLastRange()}getSelectedBlocks(){return this._selection.getSelectedBlocks()}getSelectedElement(){return this._selection.getSelectedElement()}containsEntireContent(e){return this._selection.containsEntireContent(e)}destroy(){this._selection.destroy()}getAttributeKeys(){return this._selection.getAttributeKeys()}getAttributes(){return this._selection.getAttributes()}getAttribute(e){return this._selection.getAttribute(e)}hasAttribute(e){return this._selection.hasAttribute(e)}refresh(){this._selection.updateMarkers(),this._selection._updateAttributes(!1)}observeMarkers(e){this._selection.observeMarkers(e)}_setFocus(e,t){this._selection.setFocus(e,t)}_setTo(...e){this._selection.setTo(...e)}_setAttribute(e,t){this._selection.setAttribute(e,t)}_removeAttribute(e){this._selection.removeAttribute(e)}_getStoredAttributes(){return this._selection.getStoredAttributes()}_overrideGravity(){return this._selection.overrideGravity()}_restoreGravity(e){this._selection.restoreGravity(e)}static _getStoreAttributeKey(e){return yn+e}static _isStoreAttributeKey(e){return e.startsWith(yn)}}bn.prototype.is=function(e){return"selection"===e||"model:selection"==e||"documentSelection"==e||"model:documentSelection"==e};class vn extends ln{constructor(e){super(),this.markers=new h({idProperty:"name"}),this._attributePriority=new Map,this._selectionRestorePosition=null,this._hasChangedRange=!1,this._overriddenGravityRegister=new Set,this._observedMarkers=new Set,this._model=e.model,this._document=e,this.listenTo(this._model,"applyOperation",((e,t)=>{const n=t[0];n.isDocumentOperation&&"marker"!=n.type&&"rename"!=n.type&&"noop"!=n.type&&(0==this._ranges.length&&this._selectionRestorePosition&&this._fixGraveyardSelection(this._selectionRestorePosition),this._selectionRestorePosition=null,this._hasChangedRange&&(this._hasChangedRange=!1,this.fire("change:range",{directChange:!1})))}),{priority:"lowest"}),this.on("change:range",(()=>{this._validateSelectionRanges(this.getRanges())})),this.listenTo(this._model.markers,"update",((e,t,n,s)=>{this._updateMarker(t,s)})),this.listenTo(this._document,"change",((e,t)=>{!function(e,t){const n=e.document.differ;for(const s of n.getChanges()){if("insert"!=s.type)continue;const n=s.position.parent;s.length===n.maxOffset&&e.enqueueChange(t,(e=>{const t=Array.from(n.getAttributeKeys()).filter((e=>e.startsWith(yn)));for(const s of t)e.removeAttribute(s,n)}))}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */(this._model,t)}))}get isCollapsed(){return 0===this._ranges.length?this._document._getDefaultRange().isCollapsed:super.isCollapsed}get anchor(){return super.anchor||this._document._getDefaultRange().start}get focus(){return super.focus||this._document._getDefaultRange().end}get rangeCount(){return this._ranges.length?this._ranges.length:1}get hasOwnRange(){return this._ranges.length>0}get isGravityOverridden(){return!!this._overriddenGravityRegister.size}destroy(){for(let e=0;e<this._ranges.length;e++)this._ranges[e].detach();this.stopListening()}*getRanges(){this._ranges.length?yield*super.getRanges():yield this._document._getDefaultRange()}getFirstRange(){return super.getFirstRange()||this._document._getDefaultRange()}getLastRange(){return super.getLastRange()||this._document._getDefaultRange()}setTo(...e){super.setTo(...e),this._updateAttributes(!0),this.updateMarkers()}setFocus(e,t){super.setFocus(e,t),this._updateAttributes(!0),this.updateMarkers()}setAttribute(e,t){if(this._setAttribute(e,t)){const t=[e];this.fire("change:attribute",{attributeKeys:t,directChange:!0})}}removeAttribute(e){if(this._removeAttribute(e)){const t=[e];this.fire("change:attribute",{attributeKeys:t,directChange:!0})}}overrideGravity(){const e=x();return this._overriddenGravityRegister.add(e),1===this._overriddenGravityRegister.size&&this._updateAttributes(!0),e}restoreGravity(e){if(!this._overriddenGravityRegister.has(e))throw new n("document-selection-gravity-wrong-restore",this,{uid:e});this._overriddenGravityRegister.delete(e),this.isGravityOverridden||this._updateAttributes(!0)}observeMarkers(e){this._observedMarkers.add(e),this.updateMarkers()}_replaceAllRanges(e){this._validateSelectionRanges(e),super._replaceAllRanges(e)}_popRange(){this._ranges.pop().detach()}_pushRange(e){const t=this._prepareRange(e);t&&this._ranges.push(t)}_validateSelectionRanges(e){for(const t of e)if(!this._document._validateSelectionRange(t))throw new n("document-selection-wrong-position",this,{range:t})}_prepareRange(e){if(this._checkRange(e),e.root==this._document.graveyard)return;const t=gn.fromRange(e);return t.on("change:range",((e,n,s)=>{if(this._hasChangedRange=!0,t.root==this._document.graveyard){this._selectionRestorePosition=s.deletionPosition;const e=this._ranges.indexOf(t);this._ranges.splice(e,1),t.detach()}})),t}updateMarkers(){if(!this._observedMarkers.size)return;const e=[];let t=!1;for(const t of this._model.markers){const n=t.name.split(":",1)[0];if(!this._observedMarkers.has(n))continue;const s=t.getRange();for(const n of this.getRanges())s.containsRange(n,!n.isCollapsed)&&e.push(t)}const n=Array.from(this.markers);for(const n of e)this.markers.has(n)||(this.markers.add(n),t=!0);for(const n of Array.from(this.markers))e.includes(n)||(this.markers.remove(n),t=!0);t&&this.fire("change:marker",{oldMarkers:n,directChange:!1})}_updateMarker(e,t){const n=e.name.split(":",1)[0];if(!this._observedMarkers.has(n))return;let s=!1;const i=Array.from(this.markers),r=this.markers.has(e);if(t){let n=!1;for(const e of this.getRanges())if(t.containsRange(e,!e.isCollapsed)){n=!0;break}n&&!r?(this.markers.add(e),s=!0):!n&&r&&(this.markers.remove(e),s=!0)}else r&&(this.markers.remove(e),s=!0);s&&this.fire("change:marker",{oldMarkers:i,directChange:!1})}_updateAttributes(e){const t=r(this._getSurroundingAttributes()),n=r(this.getAttributes());if(e)this._attributePriority=new Map,this._attrs=new Map;else for(const[e,t]of this._attributePriority)"low"==t&&(this._attrs.delete(e),this._attributePriority.delete(e));this._setAttributesTo(t);const s=[];for(const[e,t]of this.getAttributes())n.has(e)&&n.get(e)===t||s.push(e);for(const[e]of n)this.hasAttribute(e)||s.push(e);s.length>0&&this.fire("change:attribute",{attributeKeys:s,directChange:!1})}_setAttribute(e,t,n=!0){const s=n?"normal":"low";if("low"==s&&"normal"==this._attributePriority.get(e))return!1;return super.getAttribute(e)!==t&&(this._attrs.set(e,t),this._attributePriority.set(e,s),!0)}_removeAttribute(e,t=!0){const n=t?"normal":"low";return("low"!=n||"normal"!=this._attributePriority.get(e))&&(this._attributePriority.set(e,n),!!super.hasAttribute(e)&&(this._attrs.delete(e),!0))}_setAttributesTo(e){const t=new Set;for(const[t,n]of this.getAttributes())e.get(t)!==n&&this._removeAttribute(t,!1);for(const[n,s]of e){this._setAttribute(n,s,!1)&&t.add(n)}return t}*getStoredAttributes(){const e=this.getFirstPosition().parent;if(this.isCollapsed&&e.isEmpty)for(const t of e.getAttributeKeys())if(t.startsWith(yn)){const n=t.substr(10);yield[n,e.getAttribute(t)]}}_getSurroundingAttributes(){const e=this.getFirstPosition(),t=this._model.schema;if("$graveyard"==e.root.rootName)return null;let n=null;if(this.isCollapsed){const s=e.textNode?e.textNode:e.nodeBefore,i=e.textNode?e.textNode:e.nodeAfter;if(this.isGravityOverridden||(n=Pn(s,t)),n||(n=Pn(i,t)),!this.isGravityOverridden&&!n){let e=s;for(;e&&!n;)e=e.previousSibling,n=Pn(e,t)}if(!n){let e=i;for(;e&&!n;)e=e.nextSibling,n=Pn(e,t)}n||(n=this.getStoredAttributes())}else{const e=this.getFirstRange();for(const s of e){if(s.item.is("element")&&t.isObject(s.item)){n=Pn(s.item,t);break}if("text"==s.type){n=s.item.getAttributes();break}}}return n}_fixGraveyardSelection(e){const t=this._model.schema.getNearestSelectionRange(e);t&&this._pushRange(t)}}function Pn(e,t){if(!e)return null;if(e instanceof zt||e instanceof wn)return e.getAttributes();if(!t.isInline(e))return null;if(!t.isObject(e))return[];const n=[];for(const[s,i]of e.getAttributes())t.checkAttribute("$text",s)&&!1!==t.getAttributeProperties(s).copyFromObject&&n.push([s,i]);return n}class An{constructor(e){this._nodes=[],this._offsetToNode=[],e&&this._insertNodes(0,e)}[Symbol.iterator](){return this._nodes[Symbol.iterator]()}get length(){return this._nodes.length}get maxOffset(){return this._offsetToNode.length}getNode(e){return this._nodes[e]||null}getNodeAtOffset(e){return this._offsetToNode[e]||null}getNodeIndex(e){return e.index}getNodeStartOffset(e){return e.startOffset}indexToOffset(e){if(e==this._nodes.length)return this.maxOffset;const t=this._nodes[e];if(!t)throw new n("model-nodelist-index-out-of-bounds",this);return this.getNodeStartOffset(t)}offsetToIndex(e){if(e==this._offsetToNode.length)return this._nodes.length;const t=this._offsetToNode[e];if(!t)throw new n("model-nodelist-offset-out-of-bounds",this,{offset:e,nodeList:this});return this.getNodeIndex(t)}_insertNodes(e,t){const s=[];for(const e of t){if(!(e instanceof an))throw new n("model-nodelist-insertnodes-not-node",this);s.push(e)}let i=this.indexToOffset(e);T(this._nodes,s,e),T(this._offsetToNode,function(e){const t=[];let n=0;for(const s of e)for(let e=0;e<s.offsetSize;e++)t[n++]=s;return t}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */(s),i);for(let t=e;t<this._nodes.length;t++)this._nodes[t]._index=t,this._nodes[t]._startOffset=i,i+=this._nodes[t].offsetSize}_removeNodes(e,t=1){if(0==t)return[];let n=this.indexToOffset(e);const s=this._nodes.splice(e,t),i=s[s.length-1],r=i.startOffset+i.offsetSize-n;this._offsetToNode.splice(n,r);for(const e of s)e._index=null,e._startOffset=null;for(let t=e;t<this._nodes.length;t++)this._nodes[t]._index=t,this._nodes[t]._startOffset=n,n+=this._nodes[t].offsetSize;return s}_removeNodesArray(e){if(0==e.length)return;for(const t of e)t._index=null,t._startOffset=null;this._nodes=this._nodes.filter((e=>null!==e.index)),this._offsetToNode=this._offsetToNode.filter((e=>null!==e.index));let t=0;for(let e=0;e<this._nodes.length;e++)this._nodes[e]._index=e,this._nodes[e]._startOffset=t,t+=this._nodes[e].offsetSize}toJSON(){return this._nodes.map((e=>e.toJSON()))}}class Cn extends an{constructor(e,t,n){super(t),this._children=new An,this.name=e,n&&this._insertChild(0,n)}get childCount(){return this._children.length}get maxOffset(){return this._children.maxOffset}get isEmpty(){return 0===this.childCount}getChild(e){return this._children.getNode(e)}getChildAtOffset(e){return this._children.getNodeAtOffset(e)}getChildren(){return this._children[Symbol.iterator]()}getChildIndex(e){return this._children.getNodeIndex(e)}getChildStartOffset(e){return this._children.getNodeStartOffset(e)}offsetToIndex(e){return this._children.offsetToIndex(e)}getNodeByPath(e){let t=this;for(const n of e)t=t.getChildAtOffset(n);return t}findAncestor(e,t={}){let n=t.includeSelf?this:this.parent;for(;n;){if(n.name===e)return n;n=n.parent}return null}toJSON(){const e=super.toJSON();if(e.name=this.name,this._children.length>0){e.children=[];for(const t of this._children)e.children.push(t.toJSON())}return e}_clone(e=!1){const t=e?function(e){const t=[];for(const n of e)t.push(n._clone(!0));return t}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */(this._children):void 0;return new Cn(this.name,this.getAttributes(),t)}_appendChild(e){this._insertChild(this.childCount,e)}_insertChild(e,t){const n=function(e){if("string"==typeof e)return[new wn(e)];o(e)||(e=[e]);const t=[];for(const n of e)"string"==typeof n?t.push(new wn(n)):n instanceof zt?t.push(new wn(n.data,n.getAttributes())):t.push(n);return t}(t);for(const e of n)null!==e.parent&&e._remove(),e.parent=this;this._children._insertNodes(e,n)}_removeChildren(e,t=1){const n=this._children._removeNodes(e,t);for(const e of n)e.parent=null;return n}_removeChildrenArray(e){this._children._removeNodesArray(e);for(const t of e)t.parent=null}static fromJSON(e){let t;if(e.children){t=[];for(const n of e.children)n.name?t.push(Cn.fromJSON(n)):t.push(wn.fromJSON(n))}return new Cn(e.name,e.attributes,t)}}Cn.prototype.is=function(e,t){return t?t===this.name&&("element"===e||"model:element"===e):"element"===e||"model:element"===e||"node"===e||"model:node"===e};class kn{constructor(e){this._dispatchers=e}add(e){for(const t of this._dispatchers)e(t);return this}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class En extends kn{elementToElement(e){return this.add(function(e){const t=Mn(e.model),n=Nn(e.view,"container");t.attributes.length&&(t.children=!0);return s=>{s.on(`insert:${t.name}`,xn(n,Vn(t)),{priority:e.converterPriority||"normal"}),(t.children||t.attributes.length)&&s.on("reduceChanges",Dn(t),{priority:"low"})}}(e))}elementToStructure(e){return this.add(function(e){const t=Mn(e.model),s=Nn(e.view,"container");return t.children=!0,i=>{if(i._conversionApi.schema.checkChild(t.name,"$text"))throw new n("conversion-element-to-structure-disallowed-text",i,{elementName:t.name});var r,o;i.on(`insert:${t.name}`,(r=s,o=Vn(t),(e,t,s)=>{if(!o(t.item,s.consumable,{preflight:!0}))return;const i=new Map;s.writer._registerSlotFactory(function(e,t,s){return(i,r)=>{const o=i.createContainerElement("$slot");let a=null;if("children"===r)a=Array.from(e.getChildren());else{if("function"!=typeof r)throw new n("conversion-slot-mode-unknown",s.dispatcher,{modeOrFilter:r});a=Array.from(e.getChildren()).filter((e=>r(e)))}return t.set(o,a),o}}(t.item,i,s));const a=r(t.item,s,t);if(s.writer._clearSlotFactory(),!a)return;!function(e,t,s){const i=Array.from(t.values()).flat(),r=new Set(i);if(r.size!=i.length)throw new n("conversion-slot-filter-overlap",s.dispatcher,{element:e});if(r.size!=e.childCount)throw new n("conversion-slot-filter-incomplete",s.dispatcher,{element:e})}(t.item,i,s),o(t.item,s.consumable);const l=s.mapper.toViewPosition(t.range.start);s.mapper.bindElements(t.item,a),s.writer.insert(l,a),s.convertAttributes(t.item),function(e,t,n,s){n.mapper.on("modelToViewPosition",o,{priority:"highest"});let i=null,r=null;for([i,r]of t)$n(e,r,n,s),n.writer.move(n.writer.createRangeIn(i),n.writer.createPositionBefore(i)),n.writer.remove(i);function o(e,t){const n=t.modelPosition.nodeAfter,s=r.indexOf(n);s<0||(t.viewPosition=t.mapper.findPositionIn(i,s))}n.mapper.off("modelToViewPosition",o)}(a,i,s,{reconversion:t.reconversion})}),{priority:e.converterPriority||"normal"}),i.on("reduceChanges",Dn(t),{priority:"low"})}}(e))}attributeToElement(e){return this.add(function(e){e=U(e);let t=e.model;"string"==typeof t&&(t={key:t});let n=`attribute:${t.key}`;t.name&&(n+=":"+t.name);if(t.values)for(const n of t.values)e.view[n]=Nn(e.view[n],"attribute");else e.view=Nn(e.view,"attribute");const s=In(e);return t=>{t.on(n,Rn(s),{priority:e.converterPriority||"normal"})}}(e))}attributeToAttribute(e){return this.add(function(e){e=U(e);let t=e.model;"string"==typeof t&&(t={key:t});let s=`attribute:${t.key}`;t.name&&(s+=":"+t.name);if(t.values)for(const n of t.values)e.view[n]=Fn(e.view[n]);else e.view=Fn(e.view);const i=In(e);return t=>{var r;t.on(s,(r=i,(e,t,s)=>{if(!s.consumable.test(t.item,e.name))return;const i=r(t.attributeOldValue,s,t),o=r(t.attributeNewValue,s,t);if(!i&&!o)return;s.consumable.consume(t.item,e.name);const a=s.mapper.toViewElement(t.item),l=s.writer;if(!a)throw new n("conversion-attribute-to-attribute-on-text",s.dispatcher,t);if(null!==t.attributeOldValue&&i)if("class"==i.key){const e="string"==typeof i.value?i.value.split(/\s+/):i.value;for(const t of e)l.removeClass(t,a)}else if("style"==i.key)if("string"==typeof i.value){const e=new de(l.document.stylesProcessor);e.setTo(i.value);for(const[t]of e.getStylesEntries())l.removeStyle(t,a)}else{const e=Object.keys(i.value);for(const t of e)l.removeStyle(t,a)}else l.removeAttribute(i.key,a);if(null!==t.attributeNewValue&&o)if("class"==o.key){const e="string"==typeof o.value?o.value.split(/\s+/):o.value;for(const t of e)l.addClass(t,a)}else if("style"==o.key)if("string"==typeof o.value){const e=new de(l.document.stylesProcessor);e.setTo(o.value);for(const[t,n]of e.getStylesEntries())l.setStyle(t,n,a)}else{const e=Object.keys(o.value);for(const t of e)l.setStyle(t,o.value[t],a)}else l.setAttribute(o.key,o.value,a)}),{priority:e.converterPriority||"normal"})}}(e))}markerToElement(e){return this.add(function(e){const t=Nn(e.view,"ui");return n=>{n.on(`addMarker:${e.model}`,Tn(t),{priority:e.converterPriority||"normal"}),n.on(`removeMarker:${e.model}`,((e,t,n)=>{const s=n.mapper.markerNameToElements(t.markerName);if(s){for(const e of s)n.mapper.unbindElementFromMarkerName(e,t.markerName),n.writer.clear(n.writer.createRangeOn(e),e);n.writer.clearClonedElementsGroup(t.markerName),e.stop()}}),{priority:e.converterPriority||"normal"})}}(e))}markerToHighlight(e){return this.add(function(e){return t=>{var n;t.on(`addMarker:${e.model}`,(n=e.view,(e,t,s)=>{if(!t.item)return;if(!(t.item instanceof ln||t.item instanceof bn||t.item.is("$textProxy")))return;const i=Bn(n,t,s);if(!i)return;if(!s.consumable.consume(t.item,e.name))return;const r=s.writer,o=Sn(r,i),a=r.document.selection;if(t.item instanceof ln||t.item instanceof bn)r.wrap(a.getFirstRange(),o);else{const e=s.mapper.toViewRange(t.range),n=r.wrap(e,o);for(const e of n.getItems())if(e.is("attributeElement")&&e.isSimilar(o)){s.mapper.bindElementToMarker(e,t.markerName);break}}}),{priority:e.converterPriority||"normal"}),t.on(`addMarker:${e.model}`,function(e){return(t,n,s)=>{if(!n.item)return;if(!(n.item instanceof Cn))return;const i=Bn(e,n,s);if(!i)return;if(!s.consumable.test(n.item,t.name))return;const r=s.mapper.toViewElement(n.item);if(r&&r.getCustomProperty("addHighlight")){s.consumable.consume(n.item,t.name);for(const e of Zt._createIn(n.item))s.consumable.consume(e.item,t.name);r.getCustomProperty("addHighlight")(r,i,s.writer),s.mapper.bindElementToMarker(r,n.markerName)}}}(e.view),{priority:e.converterPriority||"normal"}),t.on(`removeMarker:${e.model}`,function(e){return(t,n,s)=>{if(n.markerRange.isCollapsed)return;const i=Bn(e,n,s);if(!i)return;const r=Sn(s.writer,i),o=s.mapper.markerNameToElements(n.markerName);if(o){for(const e of o)if(s.mapper.unbindElementFromMarkerName(e,n.markerName),e.is("attributeElement"))s.writer.unwrap(s.writer.createRangeOn(e),r);else{e.getCustomProperty("removeHighlight")(e,i.id,s.writer)}s.writer.clearClonedElementsGroup(n.markerName),t.stop()}}}(e.view),{priority:e.converterPriority||"normal"})}}(e))}markerToData(e){return this.add(function(e){e=U(e);const t=e.model;let n=e.view;n||(n=n=>({group:t,name:n.substr(e.model.length+1)}));return s=>{var i;s.on(`addMarker:${t}`,(i=n,(e,t,n)=>{const s=i(t.markerName,n);if(!s)return;const r=t.markerRange;n.consumable.consume(r,e.name)&&(On(r,!1,n,t,s),On(r,!0,n,t,s),e.stop())}),{priority:e.converterPriority||"normal"}),s.on(`removeMarker:${t}`,function(e){return(t,n,s)=>{const i=e(n.markerName,s);if(!i)return;const r=s.mapper.markerNameToElements(n.markerName);if(r){for(const e of r)s.mapper.unbindElementFromMarkerName(e,n.markerName),e.is("containerElement")?(o(`data-${i.group}-start-before`,e),o(`data-${i.group}-start-after`,e),o(`data-${i.group}-end-before`,e),o(`data-${i.group}-end-after`,e)):s.writer.clear(s.writer.createRangeOn(e),e);s.writer.clearClonedElementsGroup(n.markerName),t.stop()}function o(e,t){if(t.hasAttribute(e)){const n=new Set(t.getAttribute(e).split(","));n.delete(i.name),0==n.size?s.writer.removeAttribute(e,t):s.writer.setAttribute(e,Array.from(n).join(","),t)}}}}(n),{priority:e.converterPriority||"normal"})}}(e))}}function Sn(e,t){const n=e.createAttributeElement("span",t.attributes);return t.classes&&n._addClass(t.classes),"number"==typeof t.priority&&(n._priority=t.priority),n._id=t.id,n}function Rn(e){return(t,n,s)=>{if(!s.consumable.test(n.item,t.name))return;const i=e(n.attributeOldValue,s,n),r=e(n.attributeNewValue,s,n);if(!i&&!r)return;s.consumable.consume(n.item,t.name);const o=s.writer,a=o.document.selection;if(n.item instanceof ln||n.item instanceof bn)o.wrap(a.getFirstRange(),r);else{let e=s.mapper.toViewRange(n.range);null!==n.attributeOldValue&&i&&(e=o.unwrap(e,i)),null!==n.attributeNewValue&&r&&o.wrap(e,r)}}}function xn(e,t=Ln){return(n,s,i)=>{if(!t(s.item,i.consumable,{preflight:!0}))return;const r=e(s.item,i,s);if(!r)return;t(s.item,i.consumable);const o=i.mapper.toViewPosition(s.range.start);i.mapper.bindElements(s.item,r),i.writer.insert(o,r),i.convertAttributes(s.item),$n(r,s.item.getChildren(),i,{reconversion:s.reconversion})}}function Tn(e){return(t,n,s)=>{n.isOpening=!0;const i=e(n,s);n.isOpening=!1;const r=e(n,s);if(!i||!r)return;const o=n.markerRange;if(o.isCollapsed&&!s.consumable.consume(o,t.name))return;for(const e of o)if(!s.consumable.consume(e.item,t.name))return;const a=s.mapper,l=s.writer;l.insert(a.toViewPosition(o.start),i),s.mapper.bindElementToMarker(i,n.markerName),o.isCollapsed||(l.insert(a.toViewPosition(o.end),r),s.mapper.bindElementToMarker(r,n.markerName)),t.stop()}}function On(e,t,n,s,i){const r=t?e.start:e.end,o=r.nodeAfter&&r.nodeAfter.is("element")?r.nodeAfter:null,a=r.nodeBefore&&r.nodeBefore.is("element")?r.nodeBefore:null;if(o||a){let e,r;t&&o||!t&&!a?(e=o,r=!0):(e=a,r=!1);const l=n.mapper.toViewElement(e);if(l)return void function(e,t,n,s,i,r){const o=`data-${r.group}-${t?"start":"end"}-${n?"before":"after"}`,a=e.hasAttribute(o)?e.getAttribute(o).split(","):[];a.unshift(r.name),s.writer.setAttribute(o,a.join(","),e),s.mapper.bindElementToMarker(e,i.markerName)}(l,t,r,n,s,i)}!function(e,t,n,s,i){const r=`${i.group}-${t?"start":"end"}`,o=i.name?{name:i.name}:null,a=n.writer.createUIElement(r,o);n.writer.insert(e,a),n.mapper.bindElementToMarker(a,s.markerName)}(n.mapper.toViewPosition(r),t,n,s,i)}function Mn(e){return"string"==typeof e&&(e={name:e}),{name:e.name,attributes:e.attributes?i(e.attributes):[],children:!!e.children}}function Nn(e,t){return"function"==typeof e?e:(n,s)=>function(e,t,n){"string"==typeof e&&(e={name:e});let s;const i=t.writer,r=Object.assign({},e.attributes);if("container"==n)s=i.createContainerElement(e.name,r);else if("attribute"==n){const t={priority:e.priority||Be.DEFAULT_PRIORITY};s=i.createAttributeElement(e.name,r,t)}else s=i.createUIElement(e.name,r);if(e.styles){const t=Object.keys(e.styles);for(const n of t)i.setStyle(n,e.styles[n],s)}if(e.classes){const t=e.classes;if("string"==typeof t)i.addClass(t,s);else for(const e of t)i.addClass(e,s)}return s}(e,s,t)}function In(e){return e.model.values?(t,n,s)=>{const i=e.view[t];return i?i(t,n,s):null}:e.view}function Fn(e){return"string"==typeof e?t=>({key:e,value:t}):"object"==typeof e?e.value?()=>e:t=>({key:e.key,value:t}):e}function Bn(e,t,n){const s="function"==typeof e?e(t,n):e;return s?(s.priority||(s.priority=10),s.id||(s.id=t.markerName),s):null}function Dn(e){const t=function(e){return(t,n)=>{if(!t.is("element",e.name))return!1;if("attribute"==n.type){if(e.attributes.includes(n.attributeKey))return!0}else
/* istanbul ignore else: This is always true because otherwise it would not register a reducer callback. -- @preserve */
if(e.children)return!0;return!1}}(e);return(e,n)=>{const s=[];n.reconvertedElements||(n.reconvertedElements=new Set);for(const e of n.changes){const i="attribute"==e.type?e.range.start.nodeAfter:e.position.parent;if(i&&t(i,e)){if(!n.reconvertedElements.has(i)){n.reconvertedElements.add(i);const e=Kt._createBefore(i);let t=s.length;for(let n=s.length-1;n>=0;n--){const i=s[n],r=("attribute"==i.type?i.range.start:i.position).compareWith(e);if("before"==r||"remove"==i.type&&"same"==r)break;t=n}s.splice(t,0,{type:"remove",name:i.name,position:e,length:1},{type:"reinsert",name:i.name,position:e,length:1})}}else s.push(e)}n.changes=s}}function Vn(e){return(t,n,s={})=>{const i=["insert"];for(const n of e.attributes)t.hasAttribute(n)&&i.push(`attribute:${n}`);return!!i.every((e=>n.test(t,e)))&&(s.preflight||i.forEach((e=>n.consume(t,e))),!0)}}function $n(e,t,n,s){for(const i of t)qn(e.root,i,n,s)||n.convertItem(i)}function qn(e,t,n,s){const{writer:i,mapper:r}=n;if(!s.reconversion)return!1;const o=r.toViewElement(t);return!(!o||o.root==e)&&(!!n.canReuseView(o)&&(i.move(i.createRangeOn(o),r.toViewPosition(Kt._createBefore(t))),!0))}function Ln(e,t,{preflight:n}={}){return n?t.test(e,"insert"):t.consume(e,"insert")}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */function Wn(e){const{schema:t,document:n}=e.model;for(const s of n.getRoots())if(s.isEmpty&&!t.checkChild(s,"$text")&&t.checkChild(s,"paragraph"))return e.insertElement("paragraph",s),!0;return!1}function jn(e,t,n){const s=n.createContext(e);return!!n.checkChild(s,"paragraph")&&!!n.checkChild(s.push("paragraph"),t)}function zn(e,t){const n=t.createElement("paragraph");return t.insert(n,e),t.createPositionAt(n,0)}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class Un extends kn{elementToElement(e){return this.add(Jn(e))}elementToAttribute(e){return this.add(function(e){e=U(e),Hn(e);const t=Yn(e,!1),n=Kn(e.view),s=n?`element:${n}`:"element";return n=>{n.on(s,t,{priority:e.converterPriority||"low"})}}(e))}attributeToAttribute(e){return this.add(function(e){e=U(e);let t=null;("string"==typeof e.view||e.view.key)&&(t=function(e){"string"==typeof e.view&&(e.view={key:e.view});const t=e.view.key,n=void 0===e.view.value?/[\s\S]*/:e.view.value;let s;if("class"==t||"style"==t){const e="class"==t?"classes":"styles";s={[e]:n}}else s={attributes:{[t]:n}};e.view.name&&(s.name=e.view.name);return e.view=s,t}(e));Hn(e,t);const n=Yn(e,!0);return t=>{t.on("element",n,{priority:e.converterPriority||"low"})}}(e))}elementToMarker(e){return this.add(function(e){const t=function(e){return(t,n)=>{const s="string"==typeof e?e:e(t,n);return n.writer.createElement("$marker",{"data-name":s})}}(e.model);return Jn({...e,model:t})}(e))}dataToMarker(e){return this.add(function(e){e=U(e),e.model||(e.model=t=>t?e.view+":"+t:e.view);const t={view:e.view,model:e.model},n=Gn(Xn(t,"start")),s=Gn(Xn(t,"end"));return i=>{i.on(`element:${e.view}-start`,n,{priority:e.converterPriority||"normal"}),i.on(`element:${e.view}-end`,s,{priority:e.converterPriority||"normal"});const r=O.low,o=O.highest,a=O.get(e.converterPriority)/o;i.on("element",function(e){return(t,n,s)=>{const i=`data-${e.view}`;function r(t,i){for(const r of i){const i=e.model(r,s),o=s.writer.createElement("$marker",{"data-name":i});s.writer.insert(o,t),n.modelCursor.isEqual(t)?n.modelCursor=n.modelCursor.getShiftedBy(1):n.modelCursor=n.modelCursor._getTransformedByInsertion(t,1),n.modelRange=n.modelRange._getTransformedByInsertion(t,1)[0]}}(s.consumable.test(n.viewItem,{attributes:i+"-end-after"})||s.consumable.test(n.viewItem,{attributes:i+"-start-after"})||s.consumable.test(n.viewItem,{attributes:i+"-end-before"})||s.consumable.test(n.viewItem,{attributes:i+"-start-before"}))&&(n.modelRange||Object.assign(n,s.convertChildren(n.viewItem,n.modelCursor)),s.consumable.consume(n.viewItem,{attributes:i+"-end-after"})&&r(n.modelRange.end,n.viewItem.getAttribute(i+"-end-after").split(",")),s.consumable.consume(n.viewItem,{attributes:i+"-start-after"})&&r(n.modelRange.end,n.viewItem.getAttribute(i+"-start-after").split(",")),s.consumable.consume(n.viewItem,{attributes:i+"-end-before"})&&r(n.modelRange.start,n.viewItem.getAttribute(i+"-end-before").split(",")),s.consumable.consume(n.viewItem,{attributes:i+"-start-before"})&&r(n.modelRange.start,n.viewItem.getAttribute(i+"-start-before").split(",")))}}(t),{priority:r+a})}}(e))}}function Jn(e){const t=Gn(e=U(e)),n=Kn(e.view),s=n?`element:${n}`:"element";return n=>{n.on(s,t,{priority:e.converterPriority||"normal"})}}function Kn(e){return"string"==typeof e?e:"object"==typeof e&&"string"==typeof e.name?e.name:null}function Gn(e){const t=new le(e.view);return(n,s,i)=>{const r=t.match(s.viewItem);if(!r)return;const o=r.match;if(o.name=!0,!i.consumable.test(s.viewItem,o))return;const a=function(e,t,n){return e instanceof Function?e(t,n):n.writer.createElement(e)}(e.model,s.viewItem,i);a&&i.safeInsert(a,s.modelCursor)&&(i.consumable.consume(s.viewItem,o),i.convertChildren(s.viewItem,a),i.updateConversionResult(a,s))}}function Hn(e,t=null){const n=null===t||(e=>e.getAttribute(t)),s="object"!=typeof e.model?e.model:e.model.key,i="object"!=typeof e.model||void 0===e.model.value?n:e.model.value;e.model={key:s,value:i}}function Yn(e,t){const n=new le(e.view);return(s,i,r)=>{if(!i.modelRange&&t)return;const o=n.match(i.viewItem);if(!o)return;if(!function(e,t){const n="function"==typeof e?e(t):e;if("object"==typeof n&&!Kn(n))return!1;return!n.classes&&!n.attributes&&!n.styles}(e.view,i.viewItem)?delete o.match.name:o.match.name=!0,!r.consumable.test(i.viewItem,o.match))return;const a=e.model.key,l="function"==typeof e.model.value?e.model.value(i.viewItem,r):e.model.value;if(null===l)return;i.modelRange||Object.assign(i,r.convertChildren(i.viewItem,i.modelCursor));const c=function(e,t,n,s){let i=!1;for(const r of Array.from(e.getItems({shallow:n})))s.schema.checkAttribute(r,t.key)&&(i=!0,r.hasAttribute(t.key)||s.writer.setAttribute(t.key,t.value,r));return i}(i.modelRange,{key:a,value:l},t,r);c&&(r.consumable.test(i.viewItem,{name:!0})&&(o.match.name=!0),r.consumable.consume(i.viewItem,o.match))}}function Xn(e,t){return{view:`${e.view}-${t}`,model:(t,n)=>{const s=t.getAttribute("name"),i=e.model(s,n);return n.writer.createElement("$marker",{"data-name":i})}}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */function Qn(e){e.document.registerPostFixer((t=>function(e,t){const n=t.document.selection,s=t.schema,i=[];let r=!1;for(const e of n.getRanges()){const t=Zn(e,s);t&&!t.isEqual(e)?(i.push(t),r=!0):i.push(e)}r&&e.setSelection(function(e){const t=[...e],n=new Set;let s=1;for(;s<t.length;){const e=t[s],i=t.slice(0,s);for(const[r,o]of i.entries())if(!n.has(r))if(e.isEqual(o))n.add(r);else if(e.isIntersecting(o)){n.add(r),n.add(s);const i=e.getJoined(o);t.push(i)}s++}return t.filter(((e,t)=>!n.has(t)))}(i),{backward:n.isBackward});return!1}(t,e)))}function Zn(e,t){return e.isCollapsed?function(e,t){const n=e.start,s=t.getNearestSelectionRange(n);if(!s){const e=n.getAncestors().reverse().find((e=>t.isObject(e)));return e?Zt._createOn(e):null}if(!s.isCollapsed)return s;const i=s.start;if(n.isEqual(i))return null;return new Zt(i)}(e,t):function(e,t){const{start:n,end:s}=e,i=t.checkChild(n,"$text"),r=t.checkChild(s,"$text"),o=t.getLimitElement(n),a=t.getLimitElement(s);if(o===a){if(i&&r)return null;if(function(e,t,n){const s=e.nodeAfter&&!n.isLimit(e.nodeAfter)||n.checkChild(e,"$text"),i=t.nodeBefore&&!n.isLimit(t.nodeBefore)||n.checkChild(t,"$text");return s||i}(n,s,t)){const e=n.nodeAfter&&t.isSelectable(n.nodeAfter)?null:t.getNearestSelectionRange(n,"forward"),i=s.nodeBefore&&t.isSelectable(s.nodeBefore)?null:t.getNearestSelectionRange(s,"backward"),r=e?e.start:n,o=i?i.end:s;return new Zt(r,o)}}const l=o&&!o.is("rootElement"),c=a&&!a.is("rootElement");if(l||c){const e=n.nodeAfter&&s.nodeBefore&&n.nodeAfter.parent===s.nodeBefore.parent,i=l&&(!e||!ts(n.nodeAfter,t)),r=c&&(!e||!ts(s.nodeBefore,t));let h=n,d=s;return i&&(h=Kt._createBefore(es(o,t))),r&&(d=Kt._createAfter(es(a,t))),new Zt(h,d)}return null}(e,t)}function es(e,t){let n=e,s=n;for(;t.isLimit(s)&&s.parent;)n=s,s=s.parent;return n}function ts(e,t){return e&&t.isSelectable(e)}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class ns extends(a()){constructor(e,t){super(),this.model=e,this.view=new Wt(t),this.mapper=new en,this.downcastDispatcher=new sn({mapper:this.mapper,schema:e.schema});const n=this.model.document,s=n.selection,i=this.model.markers;var r,o,a;
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */this.listenTo(this.model,"_beforeChanges",(()=>{this.view._disableRendering(!0)}),{priority:"highest"}),this.listenTo(this.model,"_afterChanges",(()=>{this.view._disableRendering(!1)}),{priority:"lowest"}),this.listenTo(n,"change",(()=>{this.view.change((e=>{this.downcastDispatcher.convertChanges(n.differ,i,e),this.downcastDispatcher.convertSelection(s,i,e)}))}),{priority:"low"}),this.listenTo(this.view.document,"selectionChange",function(e,t){return(n,s)=>{const i=s.newSelection,r=[];for(const e of i.getRanges())r.push(t.toModelRange(e));const o=e.createSelection(r,{backward:i.isBackward});o.isEqual(e.document.selection)||e.change((e=>{e.setSelection(o)}))}}(this.model,this.mapper)),this.listenTo(this.view.document,"beforeinput",(r=this.mapper,o=this.model.schema,a=this.view,(e,t)=>{if(!a.document.isComposing||f.isAndroid)for(let e=0;e<t.targetRanges.length;e++){const n=t.targetRanges[e],s=r.toModelRange(n),i=Zn(s,o);i&&!i.isEqual(s)&&(t.targetRanges[e]=r.toViewRange(i))}}),{priority:"high"}),this.downcastDispatcher.on("insert:$text",((e,t,n)=>{if(!n.consumable.consume(t.item,e.name))return;const s=n.writer,i=n.mapper.toViewPosition(t.range.start),r=s.createText(t.item.data);s.insert(i,r)}),{priority:"lowest"}),this.downcastDispatcher.on("insert",((e,t,n)=>{n.convertAttributes(t.item),t.reconversion||!t.item.is("element")||t.item.isEmpty||n.convertChildren(t.item)}),{priority:"lowest"}),this.downcastDispatcher.on("remove",((e,t,n)=>{const s=n.mapper.toViewPosition(t.position),i=t.position.getShiftedBy(t.length),r=n.mapper.toViewPosition(i,{isPhantom:!0}),o=n.writer.createRange(s,r),a=n.writer.remove(o.getTrimmed());for(const e of n.writer.createRangeIn(a).getItems())n.mapper.unbindViewElement(e,{defer:!0})}),{priority:"low"}),this.downcastDispatcher.on("cleanSelection",((e,t,n)=>{const s=n.writer,i=s.document.selection;for(const e of i.getRanges())e.isCollapsed&&e.end.parent.isAttached()&&n.writer.mergeAttributes(e.start);s.setSelection(null)})),this.downcastDispatcher.on("selection",((e,t,n)=>{const s=t.selection;if(s.isCollapsed)return;if(!n.consumable.consume(s,"selection"))return;const i=[];for(const e of s.getRanges())i.push(n.mapper.toViewRange(e));n.writer.setSelection(i,{backward:s.isBackward})}),{priority:"low"}),this.downcastDispatcher.on("selection",((e,t,n)=>{const s=t.selection;if(!s.isCollapsed)return;if(!n.consumable.consume(s,"selection"))return;const i=n.writer,r=s.getFirstPosition(),o=n.mapper.toViewPosition(r),a=i.breakAttributes(o);i.setSelection(a)}),{priority:"low"}),this.view.document.roots.bindTo(this.model.document.roots).using((e=>{if("$graveyard"==e.rootName)return null;const t=new ve(this.view.document,e.name);return t.rootName=e.rootName,this.mapper.bindElements(e,t),t}))}destroy(){this.view.destroy(),this.stopListening()}reconvertMarker(e){const t="string"==typeof e?e:e.name,s=this.model.markers.get(t);if(!s)throw new n("editingcontroller-reconvertmarker-marker-not-exist",this,{markerName:t});this.model.change((()=>{this.model.markers._refresh(s)}))}reconvertItem(e){this.model.change((()=>{this.model.document.differ._refreshItem(e)}))}}class ss{constructor(){this._consumables=new Map}add(e,t){let n;e.is("$text")||e.is("documentFragment")?this._consumables.set(e,!0):(this._consumables.has(e)?n=this._consumables.get(e):(n=new rs(e),this._consumables.set(e,n)),n.add(t))}test(e,t){const n=this._consumables.get(e);return void 0===n?null:e.is("$text")||e.is("documentFragment")?n:n.test(t)}consume(e,t){return!!this.test(e,t)&&(e.is("$text")||e.is("documentFragment")?this._consumables.set(e,!1):this._consumables.get(e).consume(t),!0)}revert(e,t){const n=this._consumables.get(e);void 0!==n&&(e.is("$text")||e.is("documentFragment")?this._consumables.set(e,!0):n.revert(t))}static consumablesFromElement(e){const t={element:e,name:!0,attributes:[],classes:[],styles:[]},n=e.getAttributeKeys();for(const e of n)"style"!=e&&"class"!=e&&t.attributes.push(e);const s=e.getClassNames();for(const e of s)t.classes.push(e);const i=e.getStyleNames();for(const e of i)t.styles.push(e);return t}static createFrom(e,t){if(t||(t=new ss),e.is("$text"))return t.add(e),t;e.is("element")&&t.add(e,ss.consumablesFromElement(e)),e.is("documentFragment")&&t.add(e);for(const n of e.getChildren())t=ss.createFrom(n,t);return t}}const is=["attributes","classes","styles"];class rs{constructor(e){this.element=e,this._canConsumeName=null,this._consumables={attributes:new Map,styles:new Map,classes:new Map}}add(e){e.name&&(this._canConsumeName=!0);for(const t of is)t in e&&this._add(t,e[t])}test(e){if(e.name&&!this._canConsumeName)return this._canConsumeName;for(const t of is)if(t in e){const n=this._test(t,e[t]);if(!0!==n)return n}return!0}consume(e){e.name&&(this._canConsumeName=!1);for(const t of is)t in e&&this._consume(t,e[t])}revert(e){e.name&&(this._canConsumeName=!0);for(const t of is)t in e&&this._revert(t,e[t])}_add(e,t){const s=i(t),r=this._consumables[e];for(const t of s){if("attributes"===e&&("class"===t||"style"===t))throw new n("viewconsumable-invalid-attribute",this);if(r.set(t,!0),"styles"===e)for(const e of this.element.document.stylesProcessor.getRelatedStyles(t))r.set(e,!0)}}_test(e,t){const n=i(t),s=this._consumables[e];for(const t of n)if("attributes"!==e||"class"!==t&&"style"!==t){const e=s.get(t);if(void 0===e)return null;if(!e)return!1}else{const e="class"==t?"classes":"styles",n=this._test(e,[...this._consumables[e].keys()]);if(!0!==n)return n}return!0}_consume(e,t){const n=i(t),s=this._consumables[e];for(const t of n)if("attributes"!==e||"class"!==t&&"style"!==t){if(s.set(t,!1),"styles"==e)for(const e of this.element.document.stylesProcessor.getRelatedStyles(t))s.set(e,!1)}else{const e="class"==t?"classes":"styles";this._consume(e,[...this._consumables[e].keys()])}}_revert(e,t){const n=i(t),s=this._consumables[e];for(const t of n)if("attributes"!==e||"class"!==t&&"style"!==t){!1===s.get(t)&&s.set(t,!0)}else{const e="class"==t?"classes":"styles";this._revert(e,[...this._consumables[e].keys()])}}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class os extends(a()){constructor(){super(),this._sourceDefinitions={},this._attributeProperties=Object.create(null),this._customChildChecks=new Map,this._customAttributeChecks=new Map,this._genericCheckSymbol=Symbol("$generic"),this.decorate("checkChild"),this.decorate("checkAttribute"),this.on("checkAttribute",((e,t)=>{t[0]=new as(t[0])}),{priority:"highest"}),this.on("checkChild",((e,t)=>{t[0]=new as(t[0]),t[1]=this.getDefinition(t[1])}),{priority:"highest"})}register(e,t){if(this._sourceDefinitions[e])throw new n("schema-cannot-register-item-twice",this,{itemName:e});this._sourceDefinitions[e]=[Object.assign({},t)],this._clearCache()}extend(e,t){if(!this._sourceDefinitions[e])throw new n("schema-cannot-extend-missing-item",this,{itemName:e});this._sourceDefinitions[e].push(Object.assign({},t)),this._clearCache()}getDefinitions(){return this._compiledDefinitions||this._compile(),this._compiledDefinitions}getDefinition(e){let t;return t="string"==typeof e?e:"is"in e&&(e.is("$text")||e.is("$textProxy"))?"$text":e.name,this.getDefinitions()[t]}isRegistered(e){return!!this.getDefinition(e)}isBlock(e){const t=this.getDefinition(e);return!(!t||!t.isBlock)}isLimit(e){const t=this.getDefinition(e);return!!t&&!(!t.isLimit&&!t.isObject)}isObject(e){const t=this.getDefinition(e);return!!t&&!!(t.isObject||t.isLimit&&t.isSelectable&&t.isContent)}isInline(e){const t=this.getDefinition(e);return!(!t||!t.isInline)}isSelectable(e){const t=this.getDefinition(e);return!!t&&!(!t.isSelectable&&!t.isObject)}isContent(e){const t=this.getDefinition(e);return!!t&&!(!t.isContent&&!t.isObject)}checkChild(e,t){return!!t&&this._checkContextMatch(e,t)}checkAttribute(e,t){const n=this.getDefinition(e.last);if(!n)return!1;const s=this._evaluateAttributeChecks(e,t);return void 0!==s?s:n.allowAttributes.includes(t)}checkMerge(e,t){if(e instanceof Kt){const t=e.nodeBefore,s=e.nodeAfter;if(!(t instanceof Cn))throw new n("schema-check-merge-no-element-before",this);if(!(s instanceof Cn))throw new n("schema-check-merge-no-element-after",this);return this.checkMerge(t,s)}if(this.isLimit(e)||this.isLimit(t))return!1;for(const n of t.getChildren())if(!this.checkChild(e,n))return!1;return!0}addChildCheck(e,t){const n=void 0!==t?t:this._genericCheckSymbol,s=this._customChildChecks.get(n)||[];s.push(e),this._customChildChecks.set(n,s)}addAttributeCheck(e,t){const n=void 0!==t?t:this._genericCheckSymbol,s=this._customAttributeChecks.get(n)||[];s.push(e),this._customAttributeChecks.set(n,s)}setAttributeProperties(e,t){this._attributeProperties[e]=Object.assign(this.getAttributeProperties(e),t)}getAttributeProperties(e){return this._attributeProperties[e]||Object.create(null)}getLimitElement(e){let t;if(e instanceof Kt)t=e.parent;else{t=(e instanceof Zt?[e]:Array.from(e.getRanges())).reduce(((e,t)=>{const n=t.getCommonAncestor();return e?e.getCommonAncestor(n,{includeSelf:!0}):n}),null)}for(;!this.isLimit(t)&&t.parent;)t=t.parent;return t}checkAttributeInSelection(e,t){if(e.isCollapsed){const n=[...e.getFirstPosition().getAncestors(),new wn("",e.getAttributes())];return this.checkAttribute(n,t)}{const n=e.getRanges();for(const e of n)for(const n of e)if(this.checkAttribute(n.item,t))return!0}return!1}*getValidRanges(e,t){e=function*(e){for(const t of e)yield*t.getMinimalFlatRanges()}(e);for(const n of e)yield*this._getValidRangesForRange(n,t)}getNearestSelectionRange(e,t="both"){if("$graveyard"==e.root.rootName)return null;if(this.checkChild(e,"$text"))return new Zt(e);let n,s;const i=e.getAncestors().reverse().find((e=>this.isLimit(e)))||e.root;"both"!=t&&"backward"!=t||(n=new Ut({boundaries:Zt._createIn(i),startPosition:e,direction:"backward"})),"both"!=t&&"forward"!=t||(s=new Ut({boundaries:Zt._createIn(i),startPosition:e}));for(const e of function*(e,t){let n=!1;for(;!n;){if(n=!0,e){const t=e.next();t.done||(n=!1,yield{walker:e,value:t.value})}if(t){const e=t.next();e.done||(n=!1,yield{walker:t,value:e.value})}}}(n,s)){const t=e.walker==n?"elementEnd":"elementStart",s=e.value;if(s.type==t&&this.isObject(s.item))return Zt._createOn(s.item);if(this.checkChild(s.nextPosition,"$text"))return new Zt(s.nextPosition)}return null}findAllowedParent(e,t){let n=e.parent;for(;n;){if(this.checkChild(n,t))return n;if(this.isLimit(n))return null;n=n.parent}return null}setAllowedAttributes(e,t,n){const s=n.model;for(const[i,r]of Object.entries(t))s.schema.checkAttribute(e,i)&&n.setAttribute(i,r,e)}removeDisallowedAttributes(e,t){for(const n of e)if(n.is("$text"))bs(this,n,t);else{const e=Zt._createIn(n).getPositions();for(const n of e){bs(this,n.nodeBefore||n.parent,t)}}}getAttributesWithProperty(e,t,n){const s={};for(const[i,r]of e.getAttributes()){const e=this.getAttributeProperties(i);void 0!==e[t]&&(void 0!==n&&n!==e[t]||(s[i]=r))}return s}createContext(e){return new as(e)}_clearCache(){this._compiledDefinitions=null}_compile(){const e={},t=this._sourceDefinitions,n=Object.keys(t);for(const s of n)e[s]=ls(t[s],s);const s=Object.values(e);for(const t of s)cs(e,t),hs(e,t),ds(e,t),us(e,t);for(const t of s)fs(e,t);for(const t of s)ms(e,t);for(const t of s)gs(e,t);for(const t of s)ps(e,t);for(const t of s)_s(e,t);this._compiledDefinitions=function(e){const t={};for(const n of Object.values(e))t[n.name]={name:n.name,isBlock:!!n.isBlock,isContent:!!n.isContent,isInline:!!n.isInline,isLimit:!!n.isLimit,isObject:!!n.isObject,isSelectable:!!n.isSelectable,allowIn:Array.from(n.allowIn).filter((t=>!!e[t])),allowChildren:Array.from(n.allowChildren).filter((t=>!!e[t])),allowAttributes:Array.from(n.allowAttributes)};return t}(e)}_checkContextMatch(e,t){const n=e.last;let s=this._evaluateChildChecks(e,t);if(s=void 0!==s?s:t.allowIn.includes(n.name),!s)return!1;const i=this.getDefinition(n),r=e.trimLast();return!!i&&(0==r.length||this._checkContextMatch(r,i))}_evaluateChildChecks(e,t){const n=this._customChildChecks.get(this._genericCheckSymbol)||[],s=this._customChildChecks.get(t.name)||[];for(const i of[...n,...s]){const n=i(e,t);if(void 0!==n)return n}}_evaluateAttributeChecks(e,t){const n=this._customAttributeChecks.get(this._genericCheckSymbol)||[],s=this._customAttributeChecks.get(t)||[];for(const i of[...n,...s]){const n=i(e,t);if(void 0!==n)return n}}*_getValidRangesForRange(e,t){let n=e.start,s=e.start;for(const i of e.getItems({shallow:!0}))i.is("element")&&(yield*this._getValidRangesForRange(Zt._createIn(i),t)),this.checkAttribute(i,t)||(n.isEqual(s)||(yield new Zt(n,s)),n=Kt._createAfter(i)),s=Kt._createAfter(i);n.isEqual(s)||(yield new Zt(n,s))}findOptimalInsertionRange(e,t){const n=e.getSelectedElement();if(n&&this.isObject(n)&&!this.isInline(n))return"before"==t||"after"==t?new Zt(Kt._createAt(n,t)):Zt._createOn(n);const s=A(e.getSelectedBlocks());if(!s)return new Zt(e.focus);if(s.isEmpty)return new Zt(Kt._createAt(s,0));const i=Kt._createAfter(s);return e.focus.isTouching(i)?new Zt(i):new Zt(Kt._createBefore(s))}}class as{constructor(e){if(e instanceof as)return e;let t;t="string"==typeof e?[e]:Array.isArray(e)?e:e.getAncestors({includeSelf:!0}),this._items=t.map(ys)}get length(){return this._items.length}get last(){return this._items[this._items.length-1]}[Symbol.iterator](){return this._items[Symbol.iterator]()}push(e){const t=new as([e]);return t._items=[...this._items,...t._items],t}trimLast(){const e=new as([]);return e._items=this._items.slice(0,-1),e}getItem(e){return this._items[e]}*getNames(){yield*this._items.map((e=>e.name))}endsWith(e){return Array.from(this.getNames()).join(" ").endsWith(e)}startsWith(e){return Array.from(this.getNames()).join(" ").startsWith(e)}}function ls(e,t){const n={name:t,allowIn:new Set,allowChildren:new Set,disallowIn:new Set,disallowChildren:new Set,allowContentOf:new Set,allowWhere:new Set,allowAttributes:new Set,disallowAttributes:new Set,allowAttributesOf:new Set,inheritTypesFrom:new Set};return function(e,t){for(const n of e){const e=Object.keys(n).filter((e=>e.startsWith("is")));for(const s of e)t[s]=!!n[s]}}(e,n),ws(e,n,"allowIn"),ws(e,n,"allowChildren"),ws(e,n,"disallowIn"),ws(e,n,"disallowChildren"),ws(e,n,"allowContentOf"),ws(e,n,"allowWhere"),ws(e,n,"allowAttributes"),ws(e,n,"disallowAttributes"),ws(e,n,"allowAttributesOf"),ws(e,n,"inheritTypesFrom"),function(e,t){for(const n of e){const e=n.inheritAllFrom;e&&(t.allowContentOf.add(e),t.allowWhere.add(e),t.allowAttributesOf.add(e),t.inheritTypesFrom.add(e))}}(e,n),n}function cs(e,t){for(const n of t.allowIn){const s=e[n];s?s.allowChildren.add(t.name):t.allowIn.delete(n)}}function hs(e,t){for(const n of t.allowChildren){const s=e[n];s?s.allowIn.add(t.name):t.allowChildren.delete(n)}}function ds(e,t){for(const n of t.disallowIn){const s=e[n];s?s.disallowChildren.add(t.name):t.disallowIn.delete(n)}}function us(e,t){for(const n of t.disallowChildren){const s=e[n];s?s.disallowIn.add(t.name):t.disallowChildren.delete(n)}}function fs(e,t){for(const e of t.disallowChildren)t.allowChildren.delete(e);for(const e of t.disallowIn)t.allowIn.delete(e);for(const e of t.disallowAttributes)t.allowAttributes.delete(e)}function ms(e,t){for(const n of t.allowContentOf){const s=e[n];s&&(s.disallowChildren.forEach((n=>{t.allowChildren.has(n)||(t.disallowChildren.add(n),e[n].disallowIn.add(t.name))})),s.allowChildren.forEach((n=>{t.disallowChildren.has(n)||(t.allowChildren.add(n),e[n].allowIn.add(t.name))})))}}function gs(e,t){for(const n of t.allowWhere){const s=e[n];s&&(s.disallowIn.forEach((n=>{t.allowIn.has(n)||(t.disallowIn.add(n),e[n].disallowChildren.add(t.name))})),s.allowIn.forEach((n=>{t.disallowIn.has(n)||(t.allowIn.add(n),e[n].allowChildren.add(t.name))})))}}function ps(e,t){for(const n of t.allowAttributesOf){const s=e[n];if(!s)return;s.allowAttributes.forEach((e=>{t.disallowAttributes.has(e)||t.allowAttributes.add(e)}))}}function _s(e,t){for(const n of t.inheritTypesFrom){const s=e[n];if(s){const e=Object.keys(s).filter((e=>e.startsWith("is")));for(const n of e)n in t||(t[n]=s[n])}}}function ws(e,t,n){for(const s of e){let e=s[n];"string"==typeof e&&(e=[e]),Array.isArray(e)&&e.forEach((e=>t[n].add(e)))}}function ys(e){return"string"==typeof e||e.is("documentFragment")?{name:"string"==typeof e?e:"$documentFragment",*getAttributeKeys(){},getAttribute(){}}:{name:e.is("element")?e.name:"$text",*getAttributeKeys(){yield*e.getAttributeKeys()},getAttribute:t=>e.getAttribute(t)}}function bs(e,t,n){for(const s of t.getAttributeKeys())e.checkAttribute(t,s)||n.removeAttribute(s,t)}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class vs extends(t()){constructor(e){super(),this._splitParts=new Map,this._cursorParents=new Map,this._modelCursor=null,this._emptyElementsToKeep=new Set,this.conversionApi={...e,consumable:null,writer:null,store:null,convertItem:(e,t)=>this._convertItem(e,t),convertChildren:(e,t)=>this._convertChildren(e,t),safeInsert:(e,t)=>this._safeInsert(e,t),updateConversionResult:(e,t)=>this._updateConversionResult(e,t),splitToAllowedParent:(e,t)=>this._splitToAllowedParent(e,t),getSplitParts:e=>this._getSplitParts(e),keepEmptyElement:e=>this._keepEmptyElement(e)}}convert(e,t,n=["$root"]){this.fire("viewCleanup",e),this._modelCursor=function(e,t){let n;for(const s of new as(e)){const e={};for(const t of s.getAttributeKeys())e[t]=s.getAttribute(t);const i=t.createElement(s.name,e);n&&t.insert(i,n),n=Kt._createAt(i,0)}return n}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */(n,t),this.conversionApi.writer=t,this.conversionApi.consumable=ss.createFrom(e),this.conversionApi.store={};const{modelRange:s}=this._convertItem(e,this._modelCursor),i=t.createDocumentFragment();if(s){this._removeEmptyElements();const e=this._modelCursor.parent,n=e._removeChildren(0,e.childCount);i._insertChild(0,n),i.markers=function(e,t){const n=new Set,s=new Map,i=Zt._createIn(e).getItems();for(const e of i)e.is("element","$marker")&&n.add(e);for(const e of n){const n=e.getAttribute("data-name"),i=t.createPositionBefore(e);s.has(n)?s.get(n).end=i.clone():s.set(n,new Zt(i.clone())),t.remove(e)}return s}(i,t)}return this._modelCursor=null,this._splitParts.clear(),this._cursorParents.clear(),this._emptyElementsToKeep.clear(),this.conversionApi.writer=null,this.conversionApi.store=null,i}_convertItem(e,t){const s={viewItem:e,modelCursor:t,modelRange:null};if(e.is("element")?this.fire(`element:${e.name}`,s,this.conversionApi):e.is("$text")?this.fire("text",s,this.conversionApi):this.fire("documentFragment",s,this.conversionApi),s.modelRange&&!(s.modelRange instanceof Zt))throw new n("view-conversion-dispatcher-incorrect-result",this);return{modelRange:s.modelRange,modelCursor:s.modelCursor}}_convertChildren(e,t){let n=t.is("position")?t:Kt._createAt(t,0);const s=new Zt(n);for(const t of Array.from(e.getChildren())){const e=this._convertItem(t,n);e.modelRange instanceof Zt&&(s.end=e.modelRange.end,n=e.modelCursor)}return{modelRange:s,modelCursor:n}}_safeInsert(e,t){const n=this._splitToAllowedParent(e,t);return!!n&&(this.conversionApi.writer.insert(e,n.position),!0)}_updateConversionResult(e,t){const n=this._getSplitParts(e),s=this.conversionApi.writer;t.modelRange||(t.modelRange=s.createRange(s.createPositionBefore(e),s.createPositionAfter(n[n.length-1])));const i=this._cursorParents.get(e);t.modelCursor=i?s.createPositionAt(i,0):t.modelRange.end}_splitToAllowedParent(e,t){const{schema:n,writer:s}=this.conversionApi;let i=n.findAllowedParent(t,e);if(i){if(i===t.parent)return{position:t};this._modelCursor.parent.getAncestors().includes(i)&&(i=null)}if(!i)return jn(t,e,n)?{position:zn(t,s)}:null;const r=this.conversionApi.writer.split(t,i),o=[];for(const e of r.range.getWalker())if("elementEnd"==e.type)o.push(e.item);else{const t=o.pop(),n=e.item;this._registerSplitPair(t,n)}const a=r.range.end.parent;return this._cursorParents.set(e,a),{position:r.position,cursorParent:a}}_registerSplitPair(e,t){this._splitParts.has(e)||this._splitParts.set(e,[e]);const n=this._splitParts.get(e);this._splitParts.set(t,n),n.push(t)}_getSplitParts(e){let t;return t=this._splitParts.has(e)?this._splitParts.get(e):[e],t}_keepEmptyElement(e){this._emptyElementsToKeep.add(e)}_removeEmptyElements(){const e=new Map;for(const t of this._splitParts.keys())if(t.isEmpty&&!this._emptyElementsToKeep.has(t)){const n=e.get(t.parent)||[];n.push(t),this._splitParts.delete(t),e.set(t.parent,n)}for(const[t,n]of e)t._removeChildrenArray(n);e.size&&this._removeEmptyElements()}}class Ps{getHtml(e){const t=v.document.implementation.createHTMLDocument("").createElement("div");return t.appendChild(e),t.innerHTML}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class As{constructor(e){this.skipComments=!0,this.domParser=new DOMParser,this.domConverter=new At(e,{renderingMode:"data"}),this.htmlWriter=new Ps}toData(e){const t=this.domConverter.viewToDom(e);return this.htmlWriter.getHtml(t)}toView(e){const t=this._toDom(e);return this.domConverter.domToView(t,{skipComments:this.skipComments})}registerRawContentMatcher(e){this.domConverter.registerRawContentMatcher(e)}useFillerType(e){this.domConverter.blockFillerMode="marked"==e?"markedNbsp":"nbsp"}_toDom(e){/<(?:html|body|head|meta)(?:\s[^>]*)?>/i.test(e.trim().slice(0,1e4))||(e=`<body>${e}</body>`);const t=this.domParser.parseFromString(e,"text/html"),n=t.createDocumentFragment(),s=t.body.childNodes;for(;s.length>0;)n.appendChild(s[0]);return n}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class Cs extends(t()){constructor(e,t){super(),this.model=e,this.mapper=new en,this.downcastDispatcher=new sn({mapper:this.mapper,schema:e.schema}),this.downcastDispatcher.on("insert:$text",((e,t,n)=>{if(!n.consumable.consume(t.item,e.name))return;const s=n.writer,i=n.mapper.toViewPosition(t.range.start),r=s.createText(t.item.data);s.insert(i,r)}),{priority:"lowest"}),this.downcastDispatcher.on("insert",((e,t,n)=>{n.convertAttributes(t.item),t.reconversion||!t.item.is("element")||t.item.isEmpty||n.convertChildren(t.item)}),{priority:"lowest"}),this.upcastDispatcher=new vs({schema:e.schema}),this.viewDocument=new Fe(t),this.stylesProcessor=t,this.htmlProcessor=new As(this.viewDocument),this.processor=this.htmlProcessor,this._viewWriter=new Ke(this.viewDocument),this.upcastDispatcher.on("text",((e,t,{schema:n,consumable:s,writer:i})=>{let r=t.modelCursor;if(!s.test(t.viewItem))return;if(!n.checkChild(r,"$text")){if(!jn(r,"$text",n))return;if(0==t.viewItem.data.trim().length)return;r=zn(r,i)}s.consume(t.viewItem);const o=i.createText(t.viewItem.data);i.insert(o,r),t.modelRange=i.createRange(r,r.getShiftedBy(o.offsetSize)),t.modelCursor=t.modelRange.end}),{priority:"lowest"}),this.upcastDispatcher.on("element",((e,t,n)=>{if(!t.modelRange&&n.consumable.consume(t.viewItem,{name:!0})){const{modelRange:e,modelCursor:s}=n.convertChildren(t.viewItem,t.modelCursor);t.modelRange=e,t.modelCursor=s}}),{priority:"lowest"}),this.upcastDispatcher.on("documentFragment",((e,t,n)=>{if(!t.modelRange&&n.consumable.consume(t.viewItem,{name:!0})){const{modelRange:e,modelCursor:s}=n.convertChildren(t.viewItem,t.modelCursor);t.modelRange=e,t.modelCursor=s}}),{priority:"lowest"}),a().prototype.decorate.call(this,"init"),a().prototype.decorate.call(this,"set"),a().prototype.decorate.call(this,"get"),a().prototype.decorate.call(this,"toView"),a().prototype.decorate.call(this,"toModel"),this.on("init",(()=>{this.fire("ready")}),{priority:"lowest"}),this.on("ready",(()=>{this.model.enqueueChange({isUndoable:!1},Wn)}),{priority:"lowest"})}get(t={}){const{rootName:s="main",trim:i="empty"}=t;if(!this._checkIfRootsExists([s]))throw new n("datacontroller-get-non-existent-root",this);const r=this.model.document.getRoot(s);return r.isAttached()||e("datacontroller-get-detached-root",this),"empty"!==i||this.model.hasContent(r,{ignoreWhitespaces:!0})?this.stringify(r,t):""}stringify(e,t={}){const n=this.toView(e,t);return this.processor.toData(n)}toView(e,t={}){const n=this.viewDocument,s=this._viewWriter;this.mapper.clearBindings();const i=Zt._createIn(e),r=new Je(n);this.mapper.bindElements(e,r);const o=e.is("documentFragment")?e.markers:function(e){const t=[],n=e.root.document;if(!n)return new Map;const s=Zt._createIn(e);for(const e of n.model.markers){const n=e.getRange(),i=n.isCollapsed,r=n.start.isEqual(s.start)||n.end.isEqual(s.end);if(i&&r)t.push([e.name,n]);else{const i=s.getIntersection(n);i&&t.push([e.name,i])}}return t.sort((([e,t],[n,s])=>{if("after"!==t.end.compareWith(s.start))return 1;if("before"!==t.start.compareWith(s.end))return-1;switch(t.start.compareWith(s.start)){case"before":return 1;case"after":return-1;default:switch(t.end.compareWith(s.end)){case"before":return 1;case"after":return-1;default:return n.localeCompare(e)}}})),new Map(t)}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */(e);return this.downcastDispatcher.convert(i,o,s,t),r}init(e){if(this.model.document.version)throw new n("datacontroller-init-document-not-empty",this);let t={};if("string"==typeof e?t.main=e:t=e,!this._checkIfRootsExists(Object.keys(t)))throw new n("datacontroller-init-non-existent-root",this);return this.model.enqueueChange({isUndoable:!1},(e=>{for(const n of Object.keys(t)){const s=this.model.document.getRoot(n);e.insert(this.parse(t[n],s),s,0)}})),Promise.resolve()}set(e,t={}){let s={};if("string"==typeof e?s.main=e:s=e,!this._checkIfRootsExists(Object.keys(s)))throw new n("datacontroller-set-non-existent-root",this);this.model.enqueueChange(t.batchType||{},(e=>{e.setSelection(null),e.removeSelectionAttribute(this.model.document.selection.getAttributeKeys());for(const t of Object.keys(s)){const n=this.model.document.getRoot(t);e.remove(e.createRangeIn(n)),e.insert(this.parse(s[t],n),n,0)}}))}parse(e,t="$root"){const n=this.processor.toView(e);return this.toModel(n,t)}toModel(e,t="$root"){return this.model.change((n=>this.upcastDispatcher.convert(e,n,t)))}addStyleProcessorRules(e){e(this.stylesProcessor)}registerRawContentMatcher(e){this.processor&&this.processor!==this.htmlProcessor&&this.processor.registerRawContentMatcher(e),this.htmlProcessor.registerRawContentMatcher(e)}destroy(){this.stopListening()}_checkIfRootsExists(e){for(const t of e)if(!this.model.document.getRoot(t))return!1;return!0}}class ks{constructor(e,t){this._helpers=new Map,this._downcast=i(e),this._createConversionHelpers({name:"downcast",dispatchers:this._downcast,isDowncast:!0}),this._upcast=i(t),this._createConversionHelpers({name:"upcast",dispatchers:this._upcast,isDowncast:!1})}addAlias(e,t){const s=this._downcast.includes(t);if(!this._upcast.includes(t)&&!s)throw new n("conversion-add-alias-dispatcher-not-registered",this);this._createConversionHelpers({name:e,dispatchers:[t],isDowncast:s})}for(e){if(!this._helpers.has(e))throw new n("conversion-for-unknown-group",this);return this._helpers.get(e)}elementToElement(e){this.for("downcast").elementToElement(e);for(const{model:t,view:n}of Es(e))this.for("upcast").elementToElement({model:t,view:n,converterPriority:e.converterPriority})}attributeToElement(e){this.for("downcast").attributeToElement(e);for(const{model:t,view:n}of Es(e))this.for("upcast").elementToAttribute({view:n,model:t,converterPriority:e.converterPriority})}attributeToAttribute(e){this.for("downcast").attributeToAttribute(e);for(const{model:t,view:n}of Es(e))this.for("upcast").attributeToAttribute({view:n,model:t})}_createConversionHelpers({name:e,dispatchers:t,isDowncast:s}){if(this._helpers.has(e))throw new n("conversion-group-exists",this);const i=s?new En(t):new Un(t);this._helpers.set(e,i)}}function*Es(e){if(e.model.values)for(const t of e.model.values){const n={key:e.model.key,value:t},s=e.view[t],i=e.upcastAlso?e.upcastAlso[t]:void 0;yield*Ss(n,s,i)}else yield*Ss(e.model,e.view,e.upcastAlso)}function*Ss(e,t,n){if(yield{model:e,view:t},n)for(const t of i(n))yield{model:e,view:t}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class Rs{constructor(e,t={}){this.skipComments=!0,this.namespaces=t.namespaces||[],this.domParser=new DOMParser,this.domConverter=new At(e,{renderingMode:"data"}),this.htmlWriter=new Ps}toData(e){const t=this.domConverter.viewToDom(e);return this.htmlWriter.getHtml(t)}toView(e){const t=this._toDom(e);return this.domConverter.domToView(t,{keepOriginalCase:!0,skipComments:this.skipComments})}registerRawContentMatcher(e){this.domConverter.registerRawContentMatcher(e)}useFillerType(e){this.domConverter.blockFillerMode="marked"==e?"markedNbsp":"nbsp"}_toDom(e){e=`<xml ${this.namespaces.map((e=>`xmlns:${e}="nsp"`)).join(" ")}>${e}</xml>`;const t=this.domParser.parseFromString(e,"text/xml"),n=t.querySelector("parsererror");if(n)throw new Error("Parse error - "+n.textContent);const s=t.createDocumentFragment(),i=t.documentElement.childNodes;for(;i.length>0;)s.appendChild(i[0]);return s}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class xs{constructor(e){this.baseVersion=e,this.isDocumentOperation=null!==this.baseVersion,this.batch=null}_validate(){}toJSON(){const e=Object.assign({},this);return e.__className=this.constructor.className,delete e.batch,delete e.isDocumentOperation,e}static get className(){return"Operation"}static fromJSON(e,t){return new this(e.baseVersion)}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */function Ts(e,t){const n=Ns(t),s=n.reduce(((e,t)=>e+t.offsetSize),0),i=e.parent;Fs(e);const r=e.index;return i._insertChild(r,n),Is(i,r+n.length),Is(i,r),new Zt(e,e.getShiftedBy(s))}function Os(e){if(!e.isFlat)throw new n("operation-utils-remove-range-not-flat",this);const t=e.start.parent;Fs(e.start),Fs(e.end);const s=t._removeChildren(e.start.index,e.end.index-e.start.index);return Is(t,e.start.index),s}function Ms(e,t){if(!e.isFlat)throw new n("operation-utils-move-range-not-flat",this);const s=Os(e);return Ts(t=t._getTransformedByDeletion(e.start,e.end.offset-e.start.offset),s)}function Ns(e){const t=[];!function e(n){if("string"==typeof n)t.push(new wn(n));else if(n instanceof zt)t.push(new wn(n.data,n.getAttributes()));else if(n instanceof an)t.push(n);else if(o(n))for(const t of n)e(t)}(e);for(let e=1;e<t.length;e++){const n=t[e],s=t[e-1];n instanceof wn&&s instanceof wn&&Bs(n,s)&&(t.splice(e-1,2,new wn(s.data+n.data,s.getAttributes())),e--)}return t}function Is(e,t){const n=e.getChild(t-1),s=e.getChild(t);if(n&&s&&n.is("$text")&&s.is("$text")&&Bs(n,s)){const i=new wn(n.data+s.data,n.getAttributes());e._removeChildren(t-1,2),e._insertChild(t-1,i)}}function Fs(e){const t=e.textNode,n=e.parent;if(t){const s=e.offset-t.startOffset,i=t.index;n._removeChildren(i,1);const r=new wn(t.data.substr(0,s),t.getAttributes()),o=new wn(t.data.substr(s),t.getAttributes());n._insertChild(i,[r,o])}}function Bs(e,t){const n=e.getAttributes(),s=t.getAttributes();for(const e of n){if(e[1]!==t.getAttribute(e[0]))return!1;s.next()}return s.next().done}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class Ds extends xs{constructor(e,t,n,s){super(s),this.sourcePosition=e.clone(),this.sourcePosition.stickiness="toNext",this.howMany=t,this.targetPosition=n.clone(),this.targetPosition.stickiness="toNone"}get type(){return"$graveyard"==this.targetPosition.root.rootName?"remove":"$graveyard"==this.sourcePosition.root.rootName?"reinsert":"move"}get affectedSelectable(){return[Zt._createFromPositionAndShift(this.sourcePosition,this.howMany),Zt._createFromPositionAndShift(this.targetPosition,0)]}clone(){return new Ds(this.sourcePosition,this.howMany,this.targetPosition,this.baseVersion)}getMovedRangeStart(){return this.targetPosition._getTransformedByDeletion(this.sourcePosition,this.howMany)}getReversed(){const e=this.sourcePosition._getTransformedByInsertion(this.targetPosition,this.howMany);return new Ds(this.getMovedRangeStart(),this.howMany,e,this.baseVersion+1)}_validate(){const e=this.sourcePosition.parent,t=this.targetPosition.parent,i=this.sourcePosition.offset,r=this.targetPosition.offset;if(i+this.howMany>e.maxOffset)throw new n("move-operation-nodes-do-not-exist",this);if(e===t&&i<r&&r<i+this.howMany)throw new n("move-operation-range-into-itself",this);if(this.sourcePosition.root==this.targetPosition.root&&"prefix"==s(this.sourcePosition.getParentPath(),this.targetPosition.getParentPath())){const e=this.sourcePosition.path.length-1;if(this.targetPosition.path[e]>=i&&this.targetPosition.path[e]<i+this.howMany)throw new n("move-operation-node-into-itself",this)}}_execute(){Ms(Zt._createFromPositionAndShift(this.sourcePosition,this.howMany),this.targetPosition)}toJSON(){const e=super.toJSON();return e.sourcePosition=this.sourcePosition.toJSON(),e.targetPosition=this.targetPosition.toJSON(),e}static get className(){return"MoveOperation"}static fromJSON(e,t){const n=Kt.fromJSON(e.sourcePosition,t),s=Kt.fromJSON(e.targetPosition,t);return new this(n,e.howMany,s,e.baseVersion)}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class Vs extends xs{constructor(e,t,n){super(n),this.position=e.clone(),this.position.stickiness="toNone",this.nodes=new An(Ns(t)),this.shouldReceiveAttributes=!1}get type(){return"insert"}get howMany(){return this.nodes.maxOffset}get affectedSelectable(){return this.position.clone()}clone(){const e=new An([...this.nodes].map((e=>e._clone(!0)))),t=new Vs(this.position,e,this.baseVersion);return t.shouldReceiveAttributes=this.shouldReceiveAttributes,t}getReversed(){const e=this.position.root.document.graveyard,t=new Kt(e,[0]);return new Ds(this.position,this.nodes.maxOffset,t,this.baseVersion+1)}_validate(){const e=this.position.parent;if(!e||e.maxOffset<this.position.offset)throw new n("insert-operation-position-invalid",this)}_execute(){const e=this.nodes;this.nodes=new An([...e].map((e=>e._clone(!0)))),Ts(this.position,e)}toJSON(){const e=super.toJSON();return e.position=this.position.toJSON(),e.nodes=this.nodes.toJSON(),e}static get className(){return"InsertOperation"}static fromJSON(e,t){const n=[];for(const t of e.nodes)t.name?n.push(Cn.fromJSON(t)):n.push(wn.fromJSON(t));const s=new Vs(Kt.fromJSON(e.position,t),n,e.baseVersion);return s.shouldReceiveAttributes=e.shouldReceiveAttributes,s}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class $s extends xs{constructor(e,t,n,s,i){super(i),this.splitPosition=e.clone(),this.splitPosition.stickiness="toNext",this.howMany=t,this.insertionPosition=n,this.graveyardPosition=s?s.clone():null,this.graveyardPosition&&(this.graveyardPosition.stickiness="toNext")}get type(){return"split"}get moveTargetPosition(){const e=this.insertionPosition.path.slice();return e.push(0),new Kt(this.insertionPosition.root,e)}get movedRange(){const e=this.splitPosition.getShiftedBy(Number.POSITIVE_INFINITY);return new Zt(this.splitPosition,e)}get affectedSelectable(){const e=[Zt._createFromPositionAndShift(this.splitPosition,0),Zt._createFromPositionAndShift(this.insertionPosition,0)];return this.graveyardPosition&&e.push(Zt._createFromPositionAndShift(this.graveyardPosition,0)),e}clone(){return new $s(this.splitPosition,this.howMany,this.insertionPosition,this.graveyardPosition,this.baseVersion)}getReversed(){const e=this.splitPosition.root.document.graveyard,t=new Kt(e,[0]);return new qs(this.moveTargetPosition,this.howMany,this.splitPosition,t,this.baseVersion+1)}_validate(){const e=this.splitPosition.parent,t=this.splitPosition.offset;if(!e||e.maxOffset<t)throw new n("split-operation-position-invalid",this);if(!e.parent)throw new n("split-operation-split-in-root",this);if(this.howMany!=e.maxOffset-this.splitPosition.offset)throw new n("split-operation-how-many-invalid",this);if(this.graveyardPosition&&!this.graveyardPosition.nodeAfter)throw new n("split-operation-graveyard-position-invalid",this)}_execute(){const e=this.splitPosition.parent;if(this.graveyardPosition)Ms(Zt._createFromPositionAndShift(this.graveyardPosition,1),this.insertionPosition);else{const t=e._clone();Ts(this.insertionPosition,t)}Ms(new Zt(Kt._createAt(e,this.splitPosition.offset),Kt._createAt(e,e.maxOffset)),this.moveTargetPosition)}toJSON(){const e=super.toJSON();return e.splitPosition=this.splitPosition.toJSON(),e.insertionPosition=this.insertionPosition.toJSON(),this.graveyardPosition&&(e.graveyardPosition=this.graveyardPosition.toJSON()),e}static get className(){return"SplitOperation"}static getInsertionPosition(e){const t=e.path.slice(0,-1);return t[t.length-1]++,new Kt(e.root,t,"toPrevious")}static fromJSON(e,t){const n=Kt.fromJSON(e.splitPosition,t),s=Kt.fromJSON(e.insertionPosition,t),i=e.graveyardPosition?Kt.fromJSON(e.graveyardPosition,t):null;return new this(n,e.howMany,s,i,e.baseVersion)}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class qs extends xs{constructor(e,t,n,s,i){super(i),this.sourcePosition=e.clone(),this.sourcePosition.stickiness="toPrevious",this.howMany=t,this.targetPosition=n.clone(),this.targetPosition.stickiness="toNext",this.graveyardPosition=s.clone()}get type(){return"merge"}get deletionPosition(){return new Kt(this.sourcePosition.root,this.sourcePosition.path.slice(0,-1))}get movedRange(){const e=this.sourcePosition.getShiftedBy(Number.POSITIVE_INFINITY);return new Zt(this.sourcePosition,e)}get affectedSelectable(){const e=this.sourcePosition.parent;return[Zt._createOn(e),Zt._createFromPositionAndShift(this.targetPosition,0),Zt._createFromPositionAndShift(this.graveyardPosition,0)]}clone(){return new qs(this.sourcePosition,this.howMany,this.targetPosition,this.graveyardPosition,this.baseVersion)}getReversed(){const e=this.targetPosition._getTransformedByMergeOperation(this),t=this.sourcePosition.path.slice(0,-1),n=new Kt(this.sourcePosition.root,t)._getTransformedByMergeOperation(this);return new $s(e,this.howMany,n,this.graveyardPosition,this.baseVersion+1)}_validate(){const e=this.sourcePosition.parent,t=this.targetPosition.parent;if(!e.parent)throw new n("merge-operation-source-position-invalid",this);if(!t.parent)throw new n("merge-operation-target-position-invalid",this);if(this.howMany!=e.maxOffset)throw new n("merge-operation-how-many-invalid",this)}_execute(){const e=this.sourcePosition.parent;Ms(Zt._createIn(e),this.targetPosition),Ms(Zt._createOn(e),this.graveyardPosition)}toJSON(){const e=super.toJSON();return e.sourcePosition=e.sourcePosition.toJSON(),e.targetPosition=e.targetPosition.toJSON(),e.graveyardPosition=e.graveyardPosition.toJSON(),e}static get className(){return"MergeOperation"}static fromJSON(e,t){const n=Kt.fromJSON(e.sourcePosition,t),s=Kt.fromJSON(e.targetPosition,t),i=Kt.fromJSON(e.graveyardPosition,t);return new this(n,e.howMany,s,i,e.baseVersion)}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class Ls extends xs{constructor(e,t,n,s,i,r){super(r),this.name=e,this.oldRange=t?t.clone():null,this.newRange=n?n.clone():null,this.affectsData=i,this._markers=s}get type(){return"marker"}get affectedSelectable(){const e=[];return this.oldRange&&e.push(this.oldRange.clone()),this.newRange&&(this.oldRange?e.push(...this.newRange.getDifference(this.oldRange)):e.push(this.newRange.clone())),e}clone(){return new Ls(this.name,this.oldRange,this.newRange,this._markers,this.affectsData,this.baseVersion)}getReversed(){return new Ls(this.name,this.newRange,this.oldRange,this._markers,this.affectsData,this.baseVersion+1)}_execute(){this.newRange?this._markers._set(this.name,this.newRange,!0,this.affectsData):this._markers._remove(this.name)}toJSON(){const e=super.toJSON();return this.oldRange&&(e.oldRange=this.oldRange.toJSON()),this.newRange&&(e.newRange=this.newRange.toJSON()),delete e._markers,e}static get className(){return"MarkerOperation"}static fromJSON(e,t){return new Ls(e.name,e.oldRange?Zt.fromJSON(e.oldRange,t):null,e.newRange?Zt.fromJSON(e.newRange,t):null,t.model.markers,e.affectsData,e.baseVersion)}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class Ws extends xs{constructor(e,t,n,s,i){super(i),this.range=e.clone(),this.key=t,this.oldValue=void 0===n?null:n,this.newValue=void 0===s?null:s}get type(){return null===this.oldValue?"addAttribute":null===this.newValue?"removeAttribute":"changeAttribute"}get affectedSelectable(){return this.range.clone()}clone(){return new Ws(this.range,this.key,this.oldValue,this.newValue,this.baseVersion)}getReversed(){return new Ws(this.range,this.key,this.newValue,this.oldValue,this.baseVersion+1)}toJSON(){const e=super.toJSON();return e.range=this.range.toJSON(),e}_validate(){if(!this.range.isFlat)throw new n("attribute-operation-range-not-flat",this);for(const e of this.range.getItems({shallow:!0})){if(null!==this.oldValue&&!J(e.getAttribute(this.key),this.oldValue))throw new n("attribute-operation-wrong-old-value",this,{item:e,key:this.key,value:this.oldValue});if(null===this.oldValue&&null!==this.newValue&&e.hasAttribute(this.key))throw new n("attribute-operation-attribute-exists",this,{node:e,key:this.key})}}_execute(){J(this.oldValue,this.newValue)||function(e,t,n){Fs(e.start),Fs(e.end);for(const s of e.getItems({shallow:!0})){const e=s.is("$textProxy")?s.textNode:s;null!==n?e._setAttribute(t,n):e._removeAttribute(t),Is(e.parent,e.index)}Is(e.end.parent,e.end.index)}(this.range,this.key,this.newValue)}static get className(){return"AttributeOperation"}static fromJSON(e,t){return new Ws(Zt.fromJSON(e.range,t),e.key,e.oldValue,e.newValue,e.baseVersion)}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class js extends xs{get type(){return"noop"}get affectedSelectable(){return null}clone(){return new js(this.baseVersion)}getReversed(){return new js(this.baseVersion+1)}_execute(){}static get className(){return"NoOperation"}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class zs extends xs{constructor(e,t,n,s){super(s),this.position=e,this.position.stickiness="toNext",this.oldName=t,this.newName=n}get type(){return"rename"}get affectedSelectable(){return this.position.nodeAfter}clone(){return new zs(this.position.clone(),this.oldName,this.newName,this.baseVersion)}getReversed(){return new zs(this.position.clone(),this.newName,this.oldName,this.baseVersion+1)}_validate(){const e=this.position.nodeAfter;if(!(e instanceof Cn))throw new n("rename-operation-wrong-position",this);if(e.name!==this.oldName)throw new n("rename-operation-wrong-name",this)}_execute(){this.position.nodeAfter.name=this.newName}toJSON(){const e=super.toJSON();return e.position=this.position.toJSON(),e}static get className(){return"RenameOperation"}static fromJSON(e,t){return new zs(Kt.fromJSON(e.position,t),e.oldName,e.newName,e.baseVersion)}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class Us extends xs{constructor(e,t,n,s,i){super(i),this.root=e,this.key=t,this.oldValue=void 0===n?null:n,this.newValue=void 0===s?null:s}get type(){return null===this.oldValue?"addRootAttribute":null===this.newValue?"removeRootAttribute":"changeRootAttribute"}get affectedSelectable(){return this.root}clone(){return new Us(this.root,this.key,this.oldValue,this.newValue,this.baseVersion)}getReversed(){return new Us(this.root,this.key,this.newValue,this.oldValue,this.baseVersion+1)}_validate(){if(this.root!=this.root.root||this.root.is("documentFragment"))throw new n("rootattribute-operation-not-a-root",this,{root:this.root,key:this.key});if(null!==this.oldValue&&this.root.getAttribute(this.key)!==this.oldValue)throw new n("rootattribute-operation-wrong-old-value",this,{root:this.root,key:this.key});if(null===this.oldValue&&null!==this.newValue&&this.root.hasAttribute(this.key))throw new n("rootattribute-operation-attribute-exists",this,{root:this.root,key:this.key})}_execute(){null!==this.newValue?this.root._setAttribute(this.key,this.newValue):this.root._removeAttribute(this.key)}toJSON(){const e=super.toJSON();return e.root=this.root.toJSON(),e}static get className(){return"RootAttributeOperation"}static fromJSON(e,t){if(!t.getRoot(e.root))throw new n("rootattribute-operation-fromjson-no-root",this,{rootName:e.root});return new Us(t.getRoot(e.root),e.key,e.oldValue,e.newValue,e.baseVersion)}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class Js extends xs{constructor(e,t,n,s,i){if(super(i),this.rootName=e,this.elementName=t,this.isAdd=n,this._document=s,!this._document.getRoot(this.rootName)){this._document.createRoot(this.elementName,this.rootName)._isAttached=!1}}get type(){return this.isAdd?"addRoot":"detachRoot"}get affectedSelectable(){return this._document.getRoot(this.rootName)}clone(){return new Js(this.rootName,this.elementName,this.isAdd,this._document,this.baseVersion)}getReversed(){return new Js(this.rootName,this.elementName,!this.isAdd,this._document,this.baseVersion+1)}_execute(){this._document.getRoot(this.rootName)._isAttached=this.isAdd}toJSON(){const e=super.toJSON();return delete e._document,e}static get className(){return"RootOperation"}static fromJSON(e,t){return new Js(e.rootName,e.elementName,e.isAdd,t,e.baseVersion)}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */const Ks={};Ks[Ws.className]=Ws,Ks[Vs.className]=Vs,Ks[Ls.className]=Ls,Ks[Ds.className]=Ds,Ks[js.className]=js,Ks[xs.className]=xs,Ks[zs.className]=zs,Ks[Us.className]=Us,Ks[Js.className]=Js,Ks[$s.className]=$s,Ks[qs.className]=qs;class Gs{static fromJSON(e,t){return Ks[e.__className].fromJSON(e,t)}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */const Hs=new Map;function Ys(e,t,n){let s=Hs.get(e);s||(s=new Map,Hs.set(e,s)),s.set(t,n)}function Xs(e){return[e]}function Qs(e,t,n={}){const s=function(e,t){const n=Hs.get(e);return n&&n.has(t)?n.get(t):Xs}(e.constructor,t.constructor);try{return s(e=e.clone(),t,n)}catch(e){throw e}}function Zs(e,t,n){e=e.slice(),t=t.slice();const s=new ei(n.document,n.useRelations,n.forceWeakRemove);s.setOriginalOperations(e),s.setOriginalOperations(t);const i=s.originalOperations;if(0==e.length||0==t.length)return{operationsA:e,operationsB:t,originalOperations:i};const r=new WeakMap;for(const t of e)r.set(t,0);const o={nextBaseVersionA:e[e.length-1].baseVersion+1,nextBaseVersionB:t[t.length-1].baseVersion+1,originalOperationsACount:e.length,originalOperationsBCount:t.length};let a=0;for(;a<e.length;){const n=e[a],i=r.get(n);if(i==t.length){a++;continue}const o=t[i],l=Qs(n,o,s.getContext(n,o,!0)),c=Qs(o,n,s.getContext(o,n,!1));s.updateRelation(n,o),s.setOriginalOperations(l,n),s.setOriginalOperations(c,o);for(const e of l)r.set(e,i+c.length);e.splice(a,1,...l),t.splice(i,1,...c)}if(si(e),si(t),n.padWithNoOps){const n=e.length-o.originalOperationsACount,s=t.length-o.originalOperationsBCount;ni(e,s-n),ni(t,n-s)}return ti(e,o.nextBaseVersionB),ti(t,o.nextBaseVersionA),{operationsA:e,operationsB:t,originalOperations:i}}class ei{constructor(e,t,n=!1){this.originalOperations=new Map,this._history=e.history,this._useRelations=t,this._forceWeakRemove=!!n,this._relations=new Map}setOriginalOperations(e,t=null){const n=t?this.originalOperations.get(t):null;for(const t of e)this.originalOperations.set(t,n||t)}updateRelation(e,t){if(e instanceof Ds)t instanceof qs?e.targetPosition.isEqual(t.sourcePosition)||t.movedRange.containsPosition(e.targetPosition)?this._setRelation(e,t,"insertAtSource"):e.targetPosition.isEqual(t.deletionPosition)?this._setRelation(e,t,"insertBetween"):e.targetPosition.isAfter(t.sourcePosition)&&this._setRelation(e,t,"moveTargetAfter"):t instanceof Ds&&(e.targetPosition.isEqual(t.sourcePosition)||e.targetPosition.isBefore(t.sourcePosition)?this._setRelation(e,t,"insertBefore"):this._setRelation(e,t,"insertAfter"));else if(e instanceof $s){if(t instanceof qs)e.splitPosition.isBefore(t.sourcePosition)&&this._setRelation(e,t,"splitBefore");else if(t instanceof Ds)if(e.splitPosition.isEqual(t.sourcePosition)||e.splitPosition.isBefore(t.sourcePosition))this._setRelation(e,t,"splitBefore");else{const n=Zt._createFromPositionAndShift(t.sourcePosition,t.howMany);if(e.splitPosition.hasSameParentAs(t.sourcePosition)&&n.containsPosition(e.splitPosition)){const s=n.end.offset-e.splitPosition.offset,i=e.splitPosition.offset-n.start.offset;this._setRelation(e,t,{howMany:s,offset:i})}}}else if(e instanceof qs)t instanceof qs?(e.targetPosition.isEqual(t.sourcePosition)||this._setRelation(e,t,"mergeTargetNotMoved"),e.sourcePosition.isEqual(t.targetPosition)&&this._setRelation(e,t,"mergeSourceNotMoved"),e.sourcePosition.isEqual(t.sourcePosition)&&this._setRelation(e,t,"mergeSameElement")):t instanceof $s?e.sourcePosition.isEqual(t.splitPosition)&&this._setRelation(e,t,"splitAtSource"):t instanceof Ds&&t.howMany>0&&(e.sourcePosition.isEqual(t.sourcePosition.getShiftedBy(t.howMany))&&this._setRelation(e,t,"mergeSourceAffected"),e.targetPosition.isEqual(t.sourcePosition)&&this._setRelation(e,t,"mergeTargetWasBefore"));else if(e instanceof Ls){const n=e.newRange;if(!n)return;if(t instanceof qs){const s=n.start.isEqual(t.targetPosition),i=n.start.isEqual(t.deletionPosition),r=n.end.isEqual(t.deletionPosition),o=n.end.isEqual(t.sourcePosition);(s||i||r||o)&&this._setRelation(e,t,{wasInLeftElement:s,wasStartBeforeMergedElement:i,wasEndBeforeMergedElement:r,wasInRightElement:o})}}}getContext(e,t,n){return{aIsStrong:n,aWasUndone:this._wasUndone(e),bWasUndone:this._wasUndone(t),abRelation:this._useRelations?this._getRelation(e,t):null,baRelation:this._useRelations?this._getRelation(t,e):null,forceWeakRemove:this._forceWeakRemove}}_wasUndone(e){const t=this.originalOperations.get(e);return t.wasUndone||this._history.isUndoneOperation(t)}_getRelation(e,t){const n=this.originalOperations.get(t),s=this._history.getUndoneOperation(n);if(!s)return null;const i=this.originalOperations.get(e),r=this._relations.get(i);return r&&r.get(s)||null}_setRelation(e,t,n){const s=this.originalOperations.get(e),i=this.originalOperations.get(t);let r=this._relations.get(s);r||(r=new Map,this._relations.set(s,r)),r.set(i,n)}}function ti(e,t){for(const n of e)n.baseVersion=t++}function ni(e,t){for(let n=0;n<t;n++)e.push(new js(0))}function si(e){const t=new Map;for(let n=0;n<e.length;n++){const s=e[n];s instanceof Ls&&(-1!==s.baseVersion?t.set(s.name,{op:s,ranges:s.newRange?[s.newRange]:[]}):(s.newRange&&t.get(s.name).ranges.push(s.newRange),e.splice(n,1),n--))}for(const{op:e,ranges:n}of t.values())n.length?e.newRange=Zt._createFromRanges(n):e.newRange=null}function ii(e,t,n){const s=e.nodes.getNode(0).getAttribute(t);if(s==n)return null;const i=new Zt(e.position,e.position.getShiftedBy(e.howMany));return new Ws(i,t,s,n,0)}function ri(e,t){return null===e.targetPosition._getTransformedByDeletion(t.sourcePosition,t.howMany)}function oi(e,t){const n=[];for(let s=0;s<e.length;s++){const i=e[s],r=new Ds(i.start,i.end.offset-i.start.offset,t,0);n.push(r);for(let t=s+1;t<e.length;t++)e[t]=e[t]._getTransformedByMove(r.sourcePosition,r.targetPosition,r.howMany)[0];t=t._getTransformedByMove(r.sourcePosition,r.targetPosition,r.howMany)}return n}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */Ys(Ws,Ws,((e,t,n)=>{if(e.key===t.key&&e.range.start.hasSameParentAs(t.range.start)){const s=e.range.getDifference(t.range).map((t=>new Ws(t,e.key,e.oldValue,e.newValue,0))),i=e.range.getIntersection(t.range);return i&&n.aIsStrong&&s.push(new Ws(i,t.key,t.newValue,e.newValue,0)),0==s.length?[new js(0)]:s}return[e]})),Ys(Ws,Vs,((e,t)=>{if(e.range.start.hasSameParentAs(t.position)&&e.range.containsPosition(t.position)){const n=e.range._getTransformedByInsertion(t.position,t.howMany,!t.shouldReceiveAttributes).map((t=>new Ws(t,e.key,e.oldValue,e.newValue,e.baseVersion)));if(t.shouldReceiveAttributes){const s=ii(t,e.key,e.oldValue);s&&n.unshift(s)}return n}return e.range=e.range._getTransformedByInsertion(t.position,t.howMany,!1)[0],[e]})),Ys(Ws,qs,((e,t)=>{const n=[];e.range.start.hasSameParentAs(t.deletionPosition)&&(e.range.containsPosition(t.deletionPosition)||e.range.start.isEqual(t.deletionPosition))&&n.push(Zt._createFromPositionAndShift(t.graveyardPosition,1));const s=e.range._getTransformedByMergeOperation(t);return s.isCollapsed||n.push(s),n.map((t=>new Ws(t,e.key,e.oldValue,e.newValue,e.baseVersion)))})),Ys(Ws,Ds,((e,t)=>{const n=function(e,t){const n=Zt._createFromPositionAndShift(t.sourcePosition,t.howMany);let s=null,i=[];n.containsRange(e,!0)?s=e:e.start.hasSameParentAs(n.start)?(i=e.getDifference(n),s=e.getIntersection(n)):i=[e];const r=[];for(let e of i){e=e._getTransformedByDeletion(t.sourcePosition,t.howMany);const n=t.getMovedRangeStart(),s=e.start.hasSameParentAs(n),i=e._getTransformedByInsertion(n,t.howMany,s);r.push(...i)}s&&r.push(s._getTransformedByMove(t.sourcePosition,t.targetPosition,t.howMany,!1)[0]);return r}(e.range,t);return n.map((t=>new Ws(t,e.key,e.oldValue,e.newValue,e.baseVersion)))})),Ys(Ws,$s,((e,t)=>{if(e.range.end.isEqual(t.insertionPosition))return t.graveyardPosition||e.range.end.offset++,[e];if(e.range.start.hasSameParentAs(t.splitPosition)&&e.range.containsPosition(t.splitPosition)){const n=e.clone();return n.range=new Zt(t.moveTargetPosition.clone(),e.range.end._getCombined(t.splitPosition,t.moveTargetPosition)),e.range.end=t.splitPosition.clone(),e.range.end.stickiness="toPrevious",[e,n]}return e.range=e.range._getTransformedBySplitOperation(t),[e]})),Ys(Vs,Ws,((e,t)=>{const n=[e];if(e.shouldReceiveAttributes&&e.position.hasSameParentAs(t.range.start)&&t.range.containsPosition(e.position)){const s=ii(e,t.key,t.newValue);s&&n.push(s)}return n})),Ys(Vs,Vs,((e,t,n)=>(e.position.isEqual(t.position)&&n.aIsStrong||(e.position=e.position._getTransformedByInsertOperation(t)),[e]))),Ys(Vs,Ds,((e,t)=>(e.position=e.position._getTransformedByMoveOperation(t),[e]))),Ys(Vs,$s,((e,t)=>(e.position=e.position._getTransformedBySplitOperation(t),[e]))),Ys(Vs,qs,((e,t)=>(e.position=e.position._getTransformedByMergeOperation(t),[e]))),Ys(Ls,Vs,((e,t)=>(e.oldRange&&(e.oldRange=e.oldRange._getTransformedByInsertOperation(t)[0]),e.newRange&&(e.newRange=e.newRange._getTransformedByInsertOperation(t)[0]),[e]))),Ys(Ls,Ls,((e,t,n)=>{if(e.name==t.name){if(!n.aIsStrong)return[new js(0)];e.oldRange=t.newRange?t.newRange.clone():null}return[e]})),Ys(Ls,qs,((e,t)=>(e.oldRange&&(e.oldRange=e.oldRange._getTransformedByMergeOperation(t)),e.newRange&&(e.newRange=e.newRange._getTransformedByMergeOperation(t)),[e]))),Ys(Ls,Ds,((e,t)=>{const n=[e];if(e.oldRange&&(e.oldRange=Zt._createFromRanges(e.oldRange._getTransformedByMoveOperation(t))),e.newRange){const s=e.newRange._getTransformedByMoveOperation(t);e.newRange=s[0];for(let t=1;t<s.length;t++){const i=e.clone();i.oldRange=null,i.newRange=s[t],i.baseVersion=-1,n.push(i)}}return n})),Ys(Ls,$s,((e,t,n)=>{if(e.oldRange&&(e.oldRange=e.oldRange._getTransformedBySplitOperation(t)),e.newRange){if(n.abRelation){const s=e.newRange._getTransformedBySplitOperation(t);return e.newRange.start.isEqual(t.splitPosition)&&n.abRelation.wasStartBeforeMergedElement?e.newRange.start=Kt._createAt(t.insertionPosition):e.newRange.start.isEqual(t.splitPosition)&&!n.abRelation.wasInLeftElement?e.newRange.start=Kt._createAt(t.moveTargetPosition):e.newRange.start=s.start,e.newRange.end.isEqual(t.splitPosition)&&n.abRelation.wasInRightElement?e.newRange.end=Kt._createAt(t.moveTargetPosition):e.newRange.end.isEqual(t.splitPosition)&&n.abRelation.wasEndBeforeMergedElement?e.newRange.end=Kt._createAt(t.insertionPosition):e.newRange.end=s.end,[e]}e.newRange=e.newRange._getTransformedBySplitOperation(t)}return[e]})),Ys(qs,Vs,((e,t)=>(e.sourcePosition.hasSameParentAs(t.position)&&(e.howMany+=t.howMany),e.sourcePosition=e.sourcePosition._getTransformedByInsertOperation(t),e.targetPosition=e.targetPosition._getTransformedByInsertOperation(t),[e]))),Ys(qs,qs,((e,t,n)=>{if(e.sourcePosition.isEqual(t.sourcePosition)&&e.targetPosition.isEqual(t.targetPosition)){if(n.bWasUndone){const n=t.graveyardPosition.path.slice();return n.push(0),e.sourcePosition=new Kt(t.graveyardPosition.root,n),e.howMany=0,[e]}return[new js(0)]}if(e.sourcePosition.isEqual(t.sourcePosition)&&!e.targetPosition.isEqual(t.targetPosition)&&!n.bWasUndone&&"splitAtSource"!=n.abRelation){const s="$graveyard"==e.targetPosition.root.rootName,i="$graveyard"==t.targetPosition.root.rootName;if(i&&!s||!(s&&!i)&&n.aIsStrong){const n=t.targetPosition._getTransformedByMergeOperation(t),s=e.targetPosition._getTransformedByMergeOperation(t);return[new Ds(n,e.howMany,s,0)]}return[new js(0)]}return e.sourcePosition.hasSameParentAs(t.targetPosition)&&(e.howMany+=t.howMany),e.sourcePosition=e.sourcePosition._getTransformedByMergeOperation(t),e.targetPosition=e.targetPosition._getTransformedByMergeOperation(t),e.graveyardPosition.isEqual(t.graveyardPosition)&&n.aIsStrong||(e.graveyardPosition=e.graveyardPosition._getTransformedByMergeOperation(t)),[e]})),Ys(qs,Ds,((e,t,n)=>{const s=Zt._createFromPositionAndShift(t.sourcePosition,t.howMany);return"remove"==t.type&&!n.bWasUndone&&e.deletionPosition.hasSameParentAs(t.sourcePosition)&&s.containsPosition(e.sourcePosition)?[new js(0)]:(t.sourcePosition.getShiftedBy(t.howMany).isEqual(e.sourcePosition)?e.sourcePosition.stickiness="toNone":t.targetPosition.isEqual(e.sourcePosition)&&"mergeSourceAffected"==n.abRelation?e.sourcePosition.stickiness="toNext":t.sourcePosition.isEqual(e.targetPosition)?(e.targetPosition.stickiness="toNone",e.howMany-=t.howMany):t.targetPosition.isEqual(e.targetPosition)&&"mergeTargetWasBefore"==n.abRelation?(e.targetPosition.stickiness="toPrevious",e.howMany+=t.howMany):(e.sourcePosition.hasSameParentAs(t.targetPosition)&&(e.howMany+=t.howMany),e.sourcePosition.hasSameParentAs(t.sourcePosition)&&(e.howMany-=t.howMany)),e.sourcePosition=e.sourcePosition._getTransformedByMoveOperation(t),e.targetPosition=e.targetPosition._getTransformedByMoveOperation(t),e.sourcePosition.stickiness="toPrevious",e.targetPosition.stickiness="toNext",e.graveyardPosition.isEqual(t.targetPosition)||(e.graveyardPosition=e.graveyardPosition._getTransformedByMoveOperation(t)),[e])})),Ys(qs,$s,((e,t,n)=>{if(t.graveyardPosition&&(e.graveyardPosition=e.graveyardPosition._getTransformedByDeletion(t.graveyardPosition,1),e.deletionPosition.isEqual(t.graveyardPosition)&&(e.howMany=t.howMany)),e.targetPosition.isEqual(t.splitPosition)){if(t.graveyardPosition&&e.deletionPosition.isEqual(t.graveyardPosition)||"mergeTargetNotMoved"==n.abRelation)return e.sourcePosition=e.sourcePosition._getTransformedBySplitOperation(t),[e]}if(e.sourcePosition.isEqual(t.splitPosition)){if("mergeSourceNotMoved"==n.abRelation)return e.howMany=0,e.targetPosition=e.targetPosition._getTransformedBySplitOperation(t),[e];if("mergeSameElement"==n.abRelation||e.sourcePosition.offset>0)return e.sourcePosition=t.moveTargetPosition.clone(),e.targetPosition=e.targetPosition._getTransformedBySplitOperation(t),[e]}return e.sourcePosition.hasSameParentAs(t.splitPosition)&&(e.howMany=t.splitPosition.offset),e.sourcePosition=e.sourcePosition._getTransformedBySplitOperation(t),e.targetPosition=e.targetPosition._getTransformedBySplitOperation(t),[e]})),Ys(Ds,Vs,((e,t)=>{const n=Zt._createFromPositionAndShift(e.sourcePosition,e.howMany)._getTransformedByInsertOperation(t,!1)[0];return e.sourcePosition=n.start,e.howMany=n.end.offset-n.start.offset,e.targetPosition.isEqual(t.position)||(e.targetPosition=e.targetPosition._getTransformedByInsertOperation(t)),[e]})),Ys(Ds,Ds,((e,t,n)=>{const i=Zt._createFromPositionAndShift(e.sourcePosition,e.howMany),r=Zt._createFromPositionAndShift(t.sourcePosition,t.howMany);let o,a=n.aIsStrong,l=!n.aIsStrong;if("insertBefore"==n.abRelation||"insertAfter"==n.baRelation?l=!0:"insertAfter"!=n.abRelation&&"insertBefore"!=n.baRelation||(l=!1),o=e.targetPosition.isEqual(t.targetPosition)&&l?e.targetPosition._getTransformedByDeletion(t.sourcePosition,t.howMany):e.targetPosition._getTransformedByMove(t.sourcePosition,t.targetPosition,t.howMany),ri(e,t)&&ri(t,e))return[t.getReversed()];if(i.containsPosition(t.targetPosition)&&i.containsRange(r,!0))return i.start=i.start._getTransformedByMove(t.sourcePosition,t.targetPosition,t.howMany),i.end=i.end._getTransformedByMove(t.sourcePosition,t.targetPosition,t.howMany),oi([i],o);if(r.containsPosition(e.targetPosition)&&r.containsRange(i,!0))return i.start=i.start._getCombined(t.sourcePosition,t.getMovedRangeStart()),i.end=i.end._getCombined(t.sourcePosition,t.getMovedRangeStart()),oi([i],o);const c=s(e.sourcePosition.getParentPath(),t.sourcePosition.getParentPath());if("prefix"==c||"extension"==c)return i.start=i.start._getTransformedByMove(t.sourcePosition,t.targetPosition,t.howMany),i.end=i.end._getTransformedByMove(t.sourcePosition,t.targetPosition,t.howMany),oi([i],o);"remove"!=e.type||"remove"==t.type||n.aWasUndone||n.forceWeakRemove?"remove"==e.type||"remove"!=t.type||n.bWasUndone||n.forceWeakRemove||(a=!1):a=!0;const h=[],d=i.getDifference(r);for(const e of d){e.start=e.start._getTransformedByDeletion(t.sourcePosition,t.howMany),e.end=e.end._getTransformedByDeletion(t.sourcePosition,t.howMany);const n="same"==s(e.start.getParentPath(),t.getMovedRangeStart().getParentPath()),i=e._getTransformedByInsertion(t.getMovedRangeStart(),t.howMany,n);h.push(...i)}const u=i.getIntersection(r);return null!==u&&a&&(u.start=u.start._getCombined(t.sourcePosition,t.getMovedRangeStart()),u.end=u.end._getCombined(t.sourcePosition,t.getMovedRangeStart()),0===h.length?h.push(u):1==h.length?r.start.isBefore(i.start)||r.start.isEqual(i.start)?h.unshift(u):h.push(u):h.splice(1,0,u)),0===h.length?[new js(e.baseVersion)]:oi(h,o)})),Ys(Ds,$s,((e,t,n)=>{let s=e.targetPosition.clone();e.targetPosition.isEqual(t.insertionPosition)&&t.graveyardPosition&&"moveTargetAfter"!=n.abRelation||(s=e.targetPosition._getTransformedBySplitOperation(t));const i=Zt._createFromPositionAndShift(e.sourcePosition,e.howMany);if(i.end.isEqual(t.insertionPosition))return t.graveyardPosition||e.howMany++,e.targetPosition=s,[e];if(i.start.hasSameParentAs(t.splitPosition)&&i.containsPosition(t.splitPosition)){let e=new Zt(t.splitPosition,i.end);e=e._getTransformedBySplitOperation(t);return oi([new Zt(i.start,t.splitPosition),e],s)}e.targetPosition.isEqual(t.splitPosition)&&"insertAtSource"==n.abRelation&&(s=t.moveTargetPosition),e.targetPosition.isEqual(t.insertionPosition)&&"insertBetween"==n.abRelation&&(s=e.targetPosition);const r=[i._getTransformedBySplitOperation(t)];if(t.graveyardPosition){const s=i.start.isEqual(t.graveyardPosition)||i.containsPosition(t.graveyardPosition);e.howMany>1&&s&&!n.aWasUndone&&r.push(Zt._createFromPositionAndShift(t.insertionPosition,1))}return oi(r,s)})),Ys(Ds,qs,((e,t,n)=>{const s=Zt._createFromPositionAndShift(e.sourcePosition,e.howMany);if(t.deletionPosition.hasSameParentAs(e.sourcePosition)&&s.containsPosition(t.sourcePosition))if("remove"!=e.type||n.forceWeakRemove){if(1==e.howMany)return n.bWasUndone?(e.sourcePosition=t.graveyardPosition.clone(),e.targetPosition=e.targetPosition._getTransformedByMergeOperation(t),[e]):[new js(0)]}else if(!n.aWasUndone){const n=[];let s=t.graveyardPosition.clone(),i=t.targetPosition._getTransformedByMergeOperation(t);const r=e.targetPosition.getTransformedByOperation(t);e.howMany>1&&(n.push(new Ds(e.sourcePosition,e.howMany-1,r,0)),s=s._getTransformedByMove(e.sourcePosition,r,e.howMany-1),i=i._getTransformedByMove(e.sourcePosition,r,e.howMany-1));const o=t.deletionPosition._getCombined(e.sourcePosition,r),a=new Ds(s,1,o,0),l=a.getMovedRangeStart().path.slice();l.push(0);const c=new Kt(a.targetPosition.root,l);i=i._getTransformedByMove(s,o,1);const h=new Ds(i,t.howMany,c,0);return n.push(a),n.push(h),n}const i=Zt._createFromPositionAndShift(e.sourcePosition,e.howMany)._getTransformedByMergeOperation(t);return e.sourcePosition=i.start,e.howMany=i.end.offset-i.start.offset,e.targetPosition=e.targetPosition._getTransformedByMergeOperation(t),[e]})),Ys(zs,Vs,((e,t)=>(e.position=e.position._getTransformedByInsertOperation(t),[e]))),Ys(zs,qs,((e,t)=>e.position.isEqual(t.deletionPosition)?(e.position=t.graveyardPosition.clone(),e.position.stickiness="toNext",[e]):(e.position=e.position._getTransformedByMergeOperation(t),[e]))),Ys(zs,Ds,((e,t)=>(e.position=e.position._getTransformedByMoveOperation(t),[e]))),Ys(zs,zs,((e,t,n)=>{if(e.position.isEqual(t.position)){if(!n.aIsStrong)return[new js(0)];e.oldName=t.newName}return[e]})),Ys(zs,$s,((e,t)=>{const n=e.position.path,i=t.splitPosition.getParentPath();if("same"==s(n,i)&&!t.graveyardPosition){const t=new zs(e.position.getShiftedBy(1),e.oldName,e.newName,0);return[e,t]}return e.position=e.position._getTransformedBySplitOperation(t),[e]})),Ys(Us,Us,((e,t,n)=>{if(e.root===t.root&&e.key===t.key){if(!n.aIsStrong||e.newValue===t.newValue)return[new js(0)];e.oldValue=t.newValue}return[e]})),Ys(Js,Js,((e,t)=>e.rootName===t.rootName&&e.isAdd===t.isAdd?[new js(0)]:[e])),Ys($s,Vs,((e,t)=>(e.splitPosition.hasSameParentAs(t.position)&&e.splitPosition.offset<t.position.offset&&(e.howMany+=t.howMany),e.splitPosition=e.splitPosition._getTransformedByInsertOperation(t),e.insertionPosition=e.insertionPosition._getTransformedByInsertOperation(t),[e]))),Ys($s,qs,((e,t,n)=>{if(!e.graveyardPosition&&!n.bWasUndone&&e.splitPosition.hasSameParentAs(t.sourcePosition)){const n=t.graveyardPosition.path.slice();n.push(0);const s=new Kt(t.graveyardPosition.root,n),i=$s.getInsertionPosition(new Kt(t.graveyardPosition.root,n)),r=new $s(s,0,i,null,0);return e.splitPosition=e.splitPosition._getTransformedByMergeOperation(t),e.insertionPosition=$s.getInsertionPosition(e.splitPosition),e.graveyardPosition=r.insertionPosition.clone(),e.graveyardPosition.stickiness="toNext",[r,e]}return e.splitPosition.hasSameParentAs(t.deletionPosition)&&!e.splitPosition.isAfter(t.deletionPosition)&&e.howMany--,e.splitPosition.hasSameParentAs(t.targetPosition)&&(e.howMany+=t.howMany),e.splitPosition=e.splitPosition._getTransformedByMergeOperation(t),e.insertionPosition=$s.getInsertionPosition(e.splitPosition),e.graveyardPosition&&(e.graveyardPosition=e.graveyardPosition._getTransformedByMergeOperation(t)),[e]})),Ys($s,Ds,((e,t,n)=>{const s=Zt._createFromPositionAndShift(t.sourcePosition,t.howMany);if(e.graveyardPosition){const i=s.start.isEqual(e.graveyardPosition)||s.containsPosition(e.graveyardPosition);if(!n.bWasUndone&&i){const n=e.splitPosition._getTransformedByMoveOperation(t),s=e.graveyardPosition._getTransformedByMoveOperation(t),i=s.path.slice();i.push(0);const r=new Kt(s.root,i);return[new Ds(n,e.howMany,r,0)]}e.graveyardPosition=e.graveyardPosition._getTransformedByMoveOperation(t)}const i=e.splitPosition.isEqual(t.targetPosition);if(i&&("insertAtSource"==n.baRelation||"splitBefore"==n.abRelation))return e.howMany+=t.howMany,e.splitPosition=e.splitPosition._getTransformedByDeletion(t.sourcePosition,t.howMany),e.insertionPosition=$s.getInsertionPosition(e.splitPosition),[e];if(i&&n.abRelation&&n.abRelation.howMany){const{howMany:t,offset:s}=n.abRelation;return e.howMany+=t,e.splitPosition=e.splitPosition.getShiftedBy(s),[e]}if(e.splitPosition.hasSameParentAs(t.sourcePosition)&&s.containsPosition(e.splitPosition)){const n=t.howMany-(e.splitPosition.offset-t.sourcePosition.offset);return e.howMany-=n,e.splitPosition.hasSameParentAs(t.targetPosition)&&e.splitPosition.offset<t.targetPosition.offset&&(e.howMany+=t.howMany),e.splitPosition=t.sourcePosition.clone(),e.insertionPosition=$s.getInsertionPosition(e.splitPosition),[e]}return t.sourcePosition.isEqual(t.targetPosition)||(e.splitPosition.hasSameParentAs(t.sourcePosition)&&e.splitPosition.offset<=t.sourcePosition.offset&&(e.howMany-=t.howMany),e.splitPosition.hasSameParentAs(t.targetPosition)&&e.splitPosition.offset<t.targetPosition.offset&&(e.howMany+=t.howMany)),e.splitPosition.stickiness="toNone",e.splitPosition=e.splitPosition._getTransformedByMoveOperation(t),e.splitPosition.stickiness="toNext",e.graveyardPosition?e.insertionPosition=e.insertionPosition._getTransformedByMoveOperation(t):e.insertionPosition=$s.getInsertionPosition(e.splitPosition),[e]})),Ys($s,$s,((e,t,n)=>{if(e.splitPosition.isEqual(t.splitPosition)){if(!e.graveyardPosition&&!t.graveyardPosition)return[new js(0)];if(e.graveyardPosition&&t.graveyardPosition&&e.graveyardPosition.isEqual(t.graveyardPosition))return[new js(0)];if("splitBefore"==n.abRelation)return e.howMany=0,e.graveyardPosition=e.graveyardPosition._getTransformedBySplitOperation(t),[e]}if(e.graveyardPosition&&t.graveyardPosition&&e.graveyardPosition.isEqual(t.graveyardPosition)){const s="$graveyard"==e.splitPosition.root.rootName,i="$graveyard"==t.splitPosition.root.rootName;if(i&&!s||!(s&&!i)&&n.aIsStrong){const n=[];return t.howMany&&n.push(new Ds(t.moveTargetPosition,t.howMany,t.splitPosition,0)),e.howMany&&n.push(new Ds(e.splitPosition,e.howMany,e.moveTargetPosition,0)),n}return[new js(0)]}if(e.graveyardPosition&&(e.graveyardPosition=e.graveyardPosition._getTransformedBySplitOperation(t)),e.splitPosition.isEqual(t.insertionPosition)&&"splitBefore"==n.abRelation)return e.howMany++,[e];if(t.splitPosition.isEqual(e.insertionPosition)&&"splitBefore"==n.baRelation){const n=t.insertionPosition.path.slice();n.push(0);const s=new Kt(t.insertionPosition.root,n);return[e,new Ds(e.insertionPosition,1,s,0)]}return e.splitPosition.hasSameParentAs(t.splitPosition)&&e.splitPosition.offset<t.splitPosition.offset&&(e.howMany-=t.howMany),e.splitPosition=e.splitPosition._getTransformedBySplitOperation(t),e.insertionPosition=$s.getInsertionPosition(e.splitPosition),[e]}));class ai extends(t(Kt)){constructor(e,t,s="toNone"){if(super(e,t,s),!this.root.is("rootElement"))throw new n("model-liveposition-root-not-rootelement",e);li.call(this)}detach(){this.stopListening()}toPosition(){return new Kt(this.root,this.path.slice(),this.stickiness)}static fromPosition(e,t){return new this(e.root,e.path.slice(),t||e.stickiness)}}function li(){this.listenTo(this.root.document.model,"applyOperation",((e,t)=>{const n=t[0];n.isDocumentOperation&&ci.call(this,n)}),{priority:"low"})}function ci(e){const t=this.getTransformedByOperation(e);if(!this.isEqual(t)){const e=this.toPosition();this.path=t.path,this.root=t.root,this.fire("change",e)}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */ai.prototype.is=function(e){return"livePosition"===e||"model:livePosition"===e||"position"==e||"model:position"===e};class hi{constructor(t={}){"string"==typeof t&&(t="transparent"===t?{isUndoable:!1}:{},e("batch-constructor-deprecated-string-type"));const{isUndoable:n=!0,isLocal:s=!0,isUndo:i=!1,isTyping:r=!1}=t;this.operations=[],this.isUndoable=n,this.isLocal=s,this.isUndo=i,this.isTyping=r}get type(){return e("batch-type-deprecated"),"default"}get baseVersion(){for(const e of this.operations)if(null!==e.baseVersion)return e.baseVersion;return null}addOperation(e){return e.batch=this,this.operations.push(e),e}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class di{constructor(e){this._changesInElement=new Map,this._elementsSnapshots=new Map,this._elementChildrenSnapshots=new Map,this._elementState=new Map,this._changedMarkers=new Map,this._changedRoots=new Map,this._changeCount=0,this._cachedChanges=null,this._cachedChangesWithGraveyard=null,this._refreshedItems=new Set,this._markerCollection=e}get isEmpty(){return 0==this._changesInElement.size&&0==this._changedMarkers.size&&0==this._changedRoots.size}bufferOperation(e){const t=e;switch(t.type){case"insert":if(this._isInInsertedElement(t.position.parent))return;this._markInsert(t.position.parent,t.position.offset,t.nodes.maxOffset);break;case"addAttribute":case"removeAttribute":case"changeAttribute":for(const e of t.range.getItems({shallow:!0}))this._isInInsertedElement(e.parent)||this._markAttribute(e);break;case"remove":case"move":case"reinsert":{if(t.sourcePosition.isEqual(t.targetPosition)||t.sourcePosition.getShiftedBy(t.howMany).isEqual(t.targetPosition))return;const e=this._isInInsertedElement(t.sourcePosition.parent),n=this._isInInsertedElement(t.targetPosition.parent);e||this._markRemove(t.sourcePosition.parent,t.sourcePosition.offset,t.howMany),n||this._markInsert(t.targetPosition.parent,t.getMovedRangeStart().offset,t.howMany);const s=Zt._createFromPositionAndShift(t.sourcePosition,t.howMany);for(const e of s.getItems({shallow:!0}))this._setElementState(e,"move");break}case"rename":{if(this._isInInsertedElement(t.position.parent))return;this._markRemove(t.position.parent,t.position.offset,1),this._markInsert(t.position.parent,t.position.offset,1);const e=Zt._createFromPositionAndShift(t.position,1);for(const t of this._markerCollection.getMarkersIntersectingRange(e)){const e=t.getData();this.bufferMarkerChange(t.name,e,e)}this._setElementState(t.position.nodeAfter,"rename");break}case"split":{const e=t.splitPosition.parent;if(!this._isInInsertedElement(e)){this._markRemove(e,t.splitPosition.offset,t.howMany);const n=Zt._createFromPositionAndShift(t.splitPosition,t.howMany);for(const e of n.getItems({shallow:!0}))this._setElementState(e,"move")}this._isInInsertedElement(t.insertionPosition.parent)||this._markInsert(t.insertionPosition.parent,t.insertionPosition.offset,1),t.graveyardPosition&&(this._markRemove(t.graveyardPosition.parent,t.graveyardPosition.offset,1),this._setElementState(t.graveyardPosition.nodeAfter,"move"));break}case"merge":{const e=t.sourcePosition.parent;this._isInInsertedElement(e.parent)||this._markRemove(e.parent,e.startOffset,1);const n=t.graveyardPosition.parent;this._markInsert(n,t.graveyardPosition.offset,1),this._setElementState(e,"move");const s=t.targetPosition.parent;if(!this._isInInsertedElement(s)){this._markInsert(s,t.targetPosition.offset,e.maxOffset);const n=Zt._createFromPositionAndShift(t.sourcePosition,t.howMany);for(const e of n.getItems({shallow:!0}))this._setElementState(e,"move")}break}case"detachRoot":case"addRoot":{const e=t.affectedSelectable;if(!e._isLoaded)return;if(e.isAttached()==t.isAdd)return;this._bufferRootStateChange(t.rootName,t.isAdd);break}case"addRootAttribute":case"removeRootAttribute":case"changeRootAttribute":{if(!t.root._isLoaded)return;const e=t.root.rootName;this._bufferRootAttributeChange(e,t.key,t.oldValue,t.newValue);break}}this._cachedChanges=null}bufferMarkerChange(e,t,n){t.range&&t.range.root.is("rootElement")&&!t.range.root._isLoaded&&(t.range=null),n.range&&n.range.root.is("rootElement")&&!n.range.root._isLoaded&&(n.range=null);let s=this._changedMarkers.get(e);s?s.newMarkerData=n:(s={newMarkerData:n,oldMarkerData:t},this._changedMarkers.set(e,s)),null==s.oldMarkerData.range&&null==n.range&&this._changedMarkers.delete(e)}getMarkersToRemove(){const e=[];for(const[t,n]of this._changedMarkers)null!=n.oldMarkerData.range&&e.push({name:t,range:n.oldMarkerData.range});return e}getMarkersToAdd(){const e=[];for(const[t,n]of this._changedMarkers)null!=n.newMarkerData.range&&e.push({name:t,range:n.newMarkerData.range});return e}getChangedMarkers(){return Array.from(this._changedMarkers).map((([e,t])=>({name:e,data:{oldRange:t.oldMarkerData.range,newRange:t.newMarkerData.range}})))}hasDataChanges(){if(this.getChanges().length)return!0;if(this._changedRoots.size>0)return!0;for(const{newMarkerData:e,oldMarkerData:t}of this._changedMarkers.values()){if(e.affectsData!==t.affectsData)return!0;if(e.affectsData){const n=e.range&&!t.range,s=!e.range&&t.range,i=e.range&&t.range&&!e.range.isEqual(t.range);if(n||s||i)return!0}}return!1}getChanges(e={}){if(this._cachedChanges)return e.includeChangesInGraveyard?this._cachedChangesWithGraveyard.slice():this._cachedChanges.slice();let t=[];for(const e of this._changesInElement.keys()){const n=this._changesInElement.get(e).sort(((e,t)=>e.offset===t.offset?e.type!=t.type?"remove"==e.type?-1:1:0:e.offset<t.offset?-1:1)),s=this._elementChildrenSnapshots.get(e),i=fi(e.getChildren()),r=mi(s.length,n);let o=0,a=0;for(const n of r)if("i"===n){const n=this._getDiffActionForNode(i[o].node,"insert"),s=this._elementsSnapshots.get(i[o].node),r=this._getInsertDiff(e,o,n,i[o],s);t.push(r),o++}else if("r"===n){const n=this._getDiffActionForNode(s[a].node,"remove"),i=this._getRemoveDiff(e,o,n,s[a]);t.push(i),a++}else if("a"===n){const n=s[a].attributes,r=i[o].attributes;let l;if("$text"==i[o].name)l=new Zt(Kt._createAt(e,o),Kt._createAt(e,o+1));else{const t=e.offsetToIndex(o);l=new Zt(Kt._createAt(e,o),Kt._createAt(e.getChild(t),0))}const c=this._getAttributesDiff(l,n,r);t.push(...c),o++,a++}else o++,a++}t.sort(((e,t)=>e.position.root!=t.position.root?e.position.root.rootName<t.position.root.rootName?-1:1:e.position.isEqual(t.position)?e.changeCount-t.changeCount:e.position.isBefore(t.position)?-1:1));for(let e=1,n=0;e<t.length;e++){const s=t[n],i=t[e],r="remove"==s.type&&"remove"==i.type&&"$text"==s.name&&"$text"==i.name&&s.position.isEqual(i.position),o="insert"==s.type&&"insert"==i.type&&"$text"==s.name&&"$text"==i.name&&s.position.parent==i.position.parent&&s.position.offset+s.length==i.position.offset,a="attribute"==s.type&&"attribute"==i.type&&s.position.parent==i.position.parent&&s.range.isFlat&&i.range.isFlat&&s.position.offset+s.length==i.position.offset&&s.attributeKey==i.attributeKey&&s.attributeOldValue==i.attributeOldValue&&s.attributeNewValue==i.attributeNewValue;r||o||a?(s.length++,a&&(s.range.end=s.range.end.getShiftedBy(1)),t[e]=null):n=e}t=t.filter((e=>e));for(const e of t)delete e.changeCount,"attribute"==e.type&&(delete e.position,delete e.length);return this._changeCount=0,this._cachedChangesWithGraveyard=t,this._cachedChanges=t.filter(gi),e.includeChangesInGraveyard?this._cachedChangesWithGraveyard.slice():this._cachedChanges.slice()}getChangedRoots(){return Array.from(this._changedRoots.values()).map((e=>{const t={...e};return void 0!==t.state&&delete t.attributes,t}))}getRefreshedItems(){return new Set(this._refreshedItems)}reset(){this._changesInElement.clear(),this._elementChildrenSnapshots.clear(),this._elementsSnapshots.clear(),this._elementState.clear(),this._changedMarkers.clear(),this._changedRoots.clear(),this._refreshedItems.clear(),this._cachedChanges=null}_refreshItem(e){if(this._isInInsertedElement(e.parent))return;this._markRemove(e.parent,e.startOffset,e.offsetSize),this._markInsert(e.parent,e.startOffset,e.offsetSize),this._refreshedItems.add(e),this._setElementState(e,"refresh");const t=Zt._createOn(e);for(const e of this._markerCollection.getMarkersIntersectingRange(t)){const t=e.getData();this.bufferMarkerChange(e.name,t,t)}this._cachedChanges=null}_bufferRootLoad(e){if(e.isAttached()){this._bufferRootStateChange(e.rootName,!0),this._markInsert(e,0,e.maxOffset);for(const t of e.getAttributeKeys())this._bufferRootAttributeChange(e.rootName,t,null,e.getAttribute(t));for(const t of this._markerCollection)if(t.getRange().root==e){const e=t.getData();this.bufferMarkerChange(t.name,{...e,range:null},e)}}}_bufferRootStateChange(e,t){if(!this._changedRoots.has(e))return void this._changedRoots.set(e,{name:e,state:t?"attached":"detached"});const n=this._changedRoots.get(e);void 0!==n.state?(delete n.state,void 0===n.attributes&&this._changedRoots.delete(e)):n.state=t?"attached":"detached"}_bufferRootAttributeChange(e,t,n,s){const i=this._changedRoots.get(e)||{name:e},r=i.attributes||{};if(r[t]){const e=r[t];s===e.oldValue?delete r[t]:e.newValue=s}else r[t]={oldValue:n,newValue:s};0===Object.entries(r).length?(delete i.attributes,void 0===i.state&&this._changedRoots.delete(e)):(i.attributes=r,this._changedRoots.set(e,i))}_markInsert(e,t,n){if(e.root.is("rootElement")&&!e.root._isLoaded)return;const s={type:"insert",offset:t,howMany:n,count:this._changeCount++};this._markChange(e,s)}_markRemove(e,t,n){if(e.root.is("rootElement")&&!e.root._isLoaded)return;const s={type:"remove",offset:t,howMany:n,count:this._changeCount++};this._markChange(e,s),this._removeAllNestedChanges(e,t,n)}_markAttribute(e){if(e.root.is("rootElement")&&!e.root._isLoaded)return;const t={type:"attribute",offset:e.startOffset,howMany:e.offsetSize,count:this._changeCount++};this._markChange(e.parent,t)}_markChange(e,t){this._makeSnapshots(e);const n=this._getChangesForElement(e);this._handleChange(t,n),n.push(t);for(let e=0;e<n.length;e++)n[e].howMany<1&&(n.splice(e,1),e--)}_setElementState(e,t){if(!e.is("element"))return;const n=di._statesPriority.indexOf(this._elementState.get(e));di._statesPriority.indexOf(t)>n&&this._elementState.set(e,t)}_getDiffActionForNode(e,t){if(!e.is("element"))return t;if(!this._elementsSnapshots.has(e))return t;const n=this._elementState.get(e);return n&&"move"!=n?n:t}_getChangesForElement(e){let t;return this._changesInElement.has(e)?t=this._changesInElement.get(e):(t=[],this._changesInElement.set(e,t)),t}_makeSnapshots(e){if(this._elementChildrenSnapshots.has(e))return;const t=fi(e.getChildren());this._elementChildrenSnapshots.set(e,t);for(const e of t)this._elementsSnapshots.set(e.node,e)}_handleChange(e,t){e.nodesToHandle=e.howMany;for(const n of t){const s=e.offset+e.howMany,i=n.offset+n.howMany;if("insert"==e.type&&("insert"==n.type&&(e.offset<=n.offset?n.offset+=e.howMany:e.offset<i&&(n.howMany+=e.nodesToHandle,e.nodesToHandle=0)),"remove"==n.type&&e.offset<n.offset&&(n.offset+=e.howMany),"attribute"==n.type))if(e.offset<=n.offset)n.offset+=e.howMany;else if(e.offset<i){const i=n.howMany;n.howMany=e.offset-n.offset,t.unshift({type:"attribute",offset:s,howMany:i-n.howMany,count:this._changeCount++})}if("remove"==e.type){if("insert"==n.type)if(s<=n.offset)n.offset-=e.howMany;else if(s<=i)if(e.offset<n.offset){const t=s-n.offset;n.offset=e.offset,n.howMany-=t,e.nodesToHandle-=t}else n.howMany-=e.nodesToHandle,e.nodesToHandle=0;else if(e.offset<=n.offset)e.nodesToHandle-=n.howMany,n.howMany=0;else if(e.offset<i){const t=i-e.offset;n.howMany-=t,e.nodesToHandle-=t}if("remove"==n.type&&(s<=n.offset?n.offset-=e.howMany:e.offset<n.offset&&(e.nodesToHandle+=n.howMany,n.howMany=0)),"attribute"==n.type)if(s<=n.offset)n.offset-=e.howMany;else if(e.offset<n.offset){const t=s-n.offset;n.offset=e.offset,n.howMany-=t}else if(e.offset<i)if(s<=i){const s=n.howMany;n.howMany=e.offset-n.offset;const i=s-n.howMany-e.nodesToHandle;t.unshift({type:"attribute",offset:e.offset,howMany:i,count:this._changeCount++})}else n.howMany-=i-e.offset}if("attribute"==e.type){if("insert"==n.type)if(e.offset<n.offset&&s>n.offset){if(s>i){const e={type:"attribute",offset:i,howMany:s-i,count:this._changeCount++};this._handleChange(e,t),t.push(e)}e.nodesToHandle=n.offset-e.offset,e.howMany=e.nodesToHandle}else e.offset>=n.offset&&e.offset<i&&(s>i?(e.nodesToHandle=s-i,e.offset=i):e.nodesToHandle=0);if("remove"==n.type&&e.offset<n.offset&&s>n.offset){const i={type:"attribute",offset:n.offset,howMany:s-n.offset,count:this._changeCount++};this._handleChange(i,t),t.push(i),e.nodesToHandle=n.offset-e.offset,e.howMany=e.nodesToHandle}"attribute"==n.type&&(e.offset>=n.offset&&s<=i?(e.nodesToHandle=0,e.howMany=0,e.offset=0):e.offset<=n.offset&&s>=i&&(n.howMany=0))}}e.howMany=e.nodesToHandle,delete e.nodesToHandle}_getInsertDiff(e,t,n,s,i){const r={type:"insert",position:Kt._createAt(e,t),name:s.name,attributes:new Map(s.attributes),length:1,changeCount:this._changeCount++,action:n};return"insert"!=n&&i&&(r.before={name:i.name,attributes:new Map(i.attributes)}),r}_getRemoveDiff(e,t,n,s){return{type:"remove",action:n,position:Kt._createAt(e,t),name:s.name,attributes:new Map(s.attributes),length:1,changeCount:this._changeCount++}}_getAttributesDiff(e,t,n){const s=[];n=new Map(n);for(const[i,r]of t){const t=n.has(i)?n.get(i):null;t!==r&&s.push({type:"attribute",position:e.start,range:e.clone(),length:1,attributeKey:i,attributeOldValue:r,attributeNewValue:t,changeCount:this._changeCount++}),n.delete(i)}for(const[t,i]of n)s.push({type:"attribute",position:e.start,range:e.clone(),length:1,attributeKey:t,attributeOldValue:null,attributeNewValue:i,changeCount:this._changeCount++});return s}_isInInsertedElement(e){const t=e.parent;if(!t)return!1;const n=this._changesInElement.get(t),s=e.startOffset;if(n)for(const e of n)if("insert"==e.type&&s>=e.offset&&s<e.offset+e.howMany)return!0;return this._isInInsertedElement(t)}_removeAllNestedChanges(e,t,n){const s=new Zt(Kt._createAt(e,t),Kt._createAt(e,t+n));for(const e of s.getItems({shallow:!0}))e.is("element")&&(this._changesInElement.delete(e),this._removeAllNestedChanges(e,0,e.maxOffset))}}function ui(e){return{node:e,name:e.is("$text")?"$text":e.name,attributes:new Map(e.getAttributes())}}function fi(e){const t=[];for(const n of e)if(n.is("$text"))for(let e=0;e<n.data.length;++e)t.push(ui(n));else t.push(ui(n));return t}function mi(e,t){const n=[];let s=0,i=0;for(const e of t){if(e.offset>s){for(let t=0;t<e.offset-s;t++)n.push("e");i+=e.offset-s}if("insert"==e.type){for(let t=0;t<e.howMany;t++)n.push("i");s=e.offset+e.howMany}else if("remove"==e.type){for(let t=0;t<e.howMany;t++)n.push("r");s=e.offset,i+=e.howMany}else{if(e.howMany>1500)for(let t=0;t<e.howMany;t++)n.push("a");else n.push(..."a".repeat(e.howMany).split(""));s=e.offset+e.howMany,i+=e.howMany}}if(i<e)for(let t=0;t<e-i-s;t++)n.push("e");return n}function gi(e){const t="position"in e&&"$graveyard"==e.position.root.rootName,n="range"in e&&"$graveyard"==e.range.root.rootName;return!t&&!n}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */di._statesPriority=[void 0,"refresh","rename","move"];class pi{constructor(){this._operations=[],this._undoPairs=new Map,this._undoneOperations=new Set,this._baseVersionToOperationIndex=new Map,this._version=0,this._gaps=new Map}get version(){return this._version}set version(e){this._operations.length&&e>this._version+1&&this._gaps.set(this._version,e),this._version=e}get lastOperation(){return this._operations[this._operations.length-1]}addOperation(e){if(e.baseVersion!==this.version)throw new n("model-document-history-addoperation-incorrect-version",this,{operation:e,historyVersion:this.version});this._operations.push(e),this._version++,this._baseVersionToOperationIndex.set(e.baseVersion,this._operations.length-1)}getOperations(e,t=this.version){if(!this._operations.length)return[];const n=this._operations[0];void 0===e&&(e=n.baseVersion);let s=t-1;for(const[t,n]of this._gaps)e>t&&e<n&&(e=n),s>t&&s<n&&(s=t-1);if(s<n.baseVersion||e>this.lastOperation.baseVersion)return[];let i=this._baseVersionToOperationIndex.get(e);void 0===i&&(i=0);let r=this._baseVersionToOperationIndex.get(s);return void 0===r&&(r=this._operations.length-1),this._operations.slice(i,r+1)}getOperation(e){const t=this._baseVersionToOperationIndex.get(e);if(void 0!==t)return this._operations[t]}setOperationAsUndone(e,t){this._undoPairs.set(t,e),this._undoneOperations.add(e)}isUndoingOperation(e){return this._undoPairs.has(e)}isUndoneOperation(e){return this._undoneOperations.has(e)}getUndoneOperation(e){return this._undoPairs.get(e)}reset(){this._version=0,this._undoPairs=new Map,this._operations=[],this._undoneOperations=new Set,this._gaps=new Map,this._baseVersionToOperationIndex=new Map}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class _i extends Cn{constructor(e,t,n="main"){super(t),this._isAttached=!0,this._isLoaded=!0,this._document=e,this.rootName=n}get document(){return this._document}isAttached(){return this._isAttached}toJSON(){return this.rootName}}_i.prototype.is=function(e,t){return t?t===this.name&&("rootElement"===e||"model:rootElement"===e||"element"===e||"model:element"===e):"rootElement"===e||"model:rootElement"===e||"element"===e||"model:element"===e||"node"===e||"model:node"===e};
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */
const wi="$graveyard";class yi extends(t()){constructor(e){super(),this.model=e,this.history=new pi,this.selection=new bn(this),this.roots=new h({idProperty:"rootName"}),this.differ=new di(e.markers),this.isReadOnly=!1,this._postFixers=new Set,this._hasSelectionChangedFromTheLastChangeBlock=!1,this.createRoot("$root",wi),this.listenTo(e,"applyOperation",((e,t)=>{const n=t[0];n.isDocumentOperation&&this.differ.bufferOperation(n)}),{priority:"high"}),this.listenTo(e,"applyOperation",((e,t)=>{const n=t[0];n.isDocumentOperation&&this.history.addOperation(n)}),{priority:"low"}),this.listenTo(this.selection,"change",(()=>{this._hasSelectionChangedFromTheLastChangeBlock=!0})),this.listenTo(e.markers,"update",((e,t,n,s,i)=>{const r={...t.getData(),range:s};this.differ.bufferMarkerChange(t.name,i,r),null===n&&t.on("change",((e,n)=>{const s=t.getData();this.differ.bufferMarkerChange(t.name,{...s,range:n},s)}))})),this.registerPostFixer((e=>{let t=!1;for(const n of this.roots)n.isAttached()||n.isEmpty||(e.remove(e.createRangeIn(n)),t=!0);for(const n of this.model.markers)n.getRange().root.isAttached()||(e.removeMarker(n),t=!0);return t}))}get version(){return this.history.version}set version(e){this.history.version=e}get graveyard(){return this.getRoot(wi)}createRoot(e="$root",t="main"){if(this.roots.get(t))throw new n("model-document-createroot-name-exists",this,{name:t});const s=new _i(this,e,t);return this.roots.add(s),s}destroy(){this.selection.destroy(),this.stopListening()}getRoot(e="main"){return this.roots.get(e)}getRootNames(e=!1){return this.getRoots(e).map((e=>e.rootName))}getRoots(e=!1){return this.roots.filter((t=>t!=this.graveyard&&(e||t.isAttached())&&t._isLoaded))}registerPostFixer(e){this._postFixers.add(e)}toJSON(){const e=F(this);return e.selection="[engine.model.DocumentSelection]",e.model="[engine.model.Model]",e}_handleChangeBlock(e){this._hasDocumentChangedFromTheLastChangeBlock()&&(this._callPostFixers(e),this.selection.refresh(),this.differ.hasDataChanges()?this.fire("change:data",e.batch):this.fire("change",e.batch),this.selection.refresh(),this.differ.reset()),this._hasSelectionChangedFromTheLastChangeBlock=!1}_hasDocumentChangedFromTheLastChangeBlock(){return!this.differ.isEmpty||this._hasSelectionChangedFromTheLastChangeBlock}_getDefaultRoot(){const e=this.getRoots();return e.length?e[0]:this.graveyard}_getDefaultRange(){const e=this._getDefaultRoot(),t=this.model,n=t.schema,s=t.createPositionFromPath(e,[0]);return n.getNearestSelectionRange(s)||t.createRange(s)}_validateSelectionRange(e){return e.start.isValid()&&e.end.isValid()&&bi(e.start)&&bi(e.end)}_callPostFixers(e){let t=!1;do{for(const n of this._postFixers)if(this.selection.refresh(),t=n(e),t)break}while(t)}}function bi(e){const t=e.textNode;if(t){const n=t.data,s=e.offset-t.startOffset;return!M(n,s)&&!N(n,s)}return!0}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class vi extends(t()){constructor(){super(...arguments),this._markers=new Map}[Symbol.iterator](){return this._markers.values()}has(e){const t=e instanceof Pi?e.name:e;return this._markers.has(t)}get(e){return this._markers.get(e)||null}_set(e,t,s=!1,i=!1){const r=e instanceof Pi?e.name:e;if(r.includes(","))throw new n("markercollection-incorrect-marker-name",this);const o=this._markers.get(r);if(o){const e=o.getData(),n=o.getRange();let a=!1;return n.isEqual(t)||(o._attachLiveRange(gn.fromRange(t)),a=!0),s!=o.managedUsingOperations&&(o._managedUsingOperations=s,a=!0),"boolean"==typeof i&&i!=o.affectsData&&(o._affectsData=i,a=!0),a&&this.fire(`update:${r}`,o,n,t,e),o}const a=gn.fromRange(t),l=new Pi(r,a,s,i);return this._markers.set(r,l),this.fire(`update:${r}`,l,null,t,{...l.getData(),range:null}),l}_remove(e){const t=e instanceof Pi?e.name:e,n=this._markers.get(t);return!!n&&(this._markers.delete(t),this.fire(`update:${t}`,n,n.getRange(),null,n.getData()),this._destroyMarker(n),!0)}_refresh(e){const t=e instanceof Pi?e.name:e,s=this._markers.get(t);if(!s)throw new n("markercollection-refresh-marker-not-exists",this);const i=s.getRange();this.fire(`update:${t}`,s,i,i,s.getData())}*getMarkersAtPosition(e){for(const t of this)t.getRange().containsPosition(e)&&(yield t)}*getMarkersIntersectingRange(e){for(const t of this)null!==t.getRange().getIntersection(e)&&(yield t)}destroy(){for(const e of this._markers.values())this._destroyMarker(e);this._markers=null,this.stopListening()}*getMarkersGroup(e){for(const t of this._markers.values())t.name.startsWith(e+":")&&(yield t)}_destroyMarker(e){e.stopListening(),e._detachLiveRange()}}class Pi extends(t(jt)){constructor(e,t,n,s){super(),this.name=e,this._liveRange=this._attachLiveRange(t),this._managedUsingOperations=n,this._affectsData=s}get managedUsingOperations(){if(!this._liveRange)throw new n("marker-destroyed",this);return this._managedUsingOperations}get affectsData(){if(!this._liveRange)throw new n("marker-destroyed",this);return this._affectsData}getData(){return{range:this.getRange(),affectsData:this.affectsData,managedUsingOperations:this.managedUsingOperations}}getStart(){if(!this._liveRange)throw new n("marker-destroyed",this);return this._liveRange.start.clone()}getEnd(){if(!this._liveRange)throw new n("marker-destroyed",this);return this._liveRange.end.clone()}getRange(){if(!this._liveRange)throw new n("marker-destroyed",this);return this._liveRange.toRange()}_attachLiveRange(e){return this._liveRange&&this._detachLiveRange(),e.delegate("change:range").to(this),e.delegate("change:content").to(this),this._liveRange=e,e}_detachLiveRange(){this._liveRange.stopDelegating("change:range",this),this._liveRange.stopDelegating("change:content",this),this._liveRange.detach(),this._liveRange=null}}Pi.prototype.is=function(e){return"marker"===e||"model:marker"===e};
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */
class Ai extends xs{constructor(e,t){super(null),this.sourcePosition=e.clone(),this.howMany=t}get type(){return"detach"}get affectedSelectable(){return null}toJSON(){const e=super.toJSON();return e.sourcePosition=this.sourcePosition.toJSON(),e}_validate(){if(this.sourcePosition.root.document)throw new n("detach-operation-on-document-node",this)}_execute(){Os(Zt._createFromPositionAndShift(this.sourcePosition,this.howMany))}static get className(){return"DetachOperation"}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class Ci extends jt{constructor(e){super(),this.markers=new Map,this._children=new An,e&&this._insertChild(0,e)}[Symbol.iterator](){return this.getChildren()}get childCount(){return this._children.length}get maxOffset(){return this._children.maxOffset}get isEmpty(){return 0===this.childCount}get nextSibling(){return null}get previousSibling(){return null}get root(){return this}get parent(){return null}get document(){return null}isAttached(){return!1}getAncestors(){return[]}getChild(e){return this._children.getNode(e)}getChildAtOffset(e){return this._children.getNodeAtOffset(e)}getChildren(){return this._children[Symbol.iterator]()}getChildIndex(e){return this._children.getNodeIndex(e)}getChildStartOffset(e){return this._children.getNodeStartOffset(e)}getPath(){return[]}getNodeByPath(e){let t=this;for(const n of e)t=t.getChildAtOffset(n);return t}offsetToIndex(e){return this._children.offsetToIndex(e)}toJSON(){const e=[];for(const t of this._children)e.push(t.toJSON());return e}static fromJSON(e){const t=[];for(const n of e)n.name?t.push(Cn.fromJSON(n)):t.push(wn.fromJSON(n));return new Ci(t)}_appendChild(e){this._insertChild(this.childCount,e)}_insertChild(e,t){const n=function(e){if("string"==typeof e)return[new wn(e)];o(e)||(e=[e]);return Array.from(e).map((e=>"string"==typeof e?new wn(e):e instanceof zt?new wn(e.data,e.getAttributes()):e))}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */(t);for(const e of n)null!==e.parent&&e._remove(),e.parent=this;this._children._insertNodes(e,n)}_removeChildren(e,t=1){const n=this._children._removeNodes(e,t);for(const e of n)e.parent=null;return n}_removeChildrenArray(e){this._children._removeNodesArray(e);for(const t of e)t.parent=null}}Ci.prototype.is=function(e){return"documentFragment"===e||"model:documentFragment"===e};class ki{constructor(e,t){this.model=e,this.batch=t}createText(e,t){return new wn(e,t)}createElement(e,t){return new Cn(e,t)}createDocumentFragment(){return new Ci}cloneElement(e,t=!0){return e._clone(t)}insert(e,t,s=0){if(this._assertWriterUsedCorrectly(),e instanceof wn&&""==e.data)return;const i=Kt._createAt(t,s);if(e.parent){if(Ti(e.root,i.root))return void this.move(Zt._createOn(e),i);if(e.root.document)throw new n("model-writer-insert-forbidden-move",this);this.remove(e)}const r=i.root.document?i.root.document.version:null,o=e instanceof Ci?e._removeChildren(0,e.childCount):e,a=new Vs(i,o,r);if(e instanceof wn&&(a.shouldReceiveAttributes=!0),this.batch.addOperation(a),this.model.applyOperation(a),e instanceof Ci)for(const[t,n]of e.markers){const e=Kt._createAt(n.root,0),s={range:new Zt(n.start._getCombined(e,i),n.end._getCombined(e,i)),usingOperation:!0,affectsData:!0};this.model.markers.has(t)?this.updateMarker(t,s):this.addMarker(t,s)}}insertText(e,t,n,s){t instanceof Ci||t instanceof Cn||t instanceof Kt?this.insert(this.createText(e),t,n):this.insert(this.createText(e,t),n,s)}insertElement(e,t,n,s){t instanceof Ci||t instanceof Cn||t instanceof Kt?this.insert(this.createElement(e),t,n):this.insert(this.createElement(e,t),n,s)}append(e,t){this.insert(e,t,"end")}appendText(e,t,n){t instanceof Ci||t instanceof Cn?this.insert(this.createText(e),t,"end"):this.insert(this.createText(e,t),n,"end")}appendElement(e,t,n){t instanceof Ci||t instanceof Cn?this.insert(this.createElement(e),t,"end"):this.insert(this.createElement(e,t),n,"end")}setAttribute(e,t,n){if(this._assertWriterUsedCorrectly(),n instanceof Zt){const s=n.getMinimalFlatRanges();for(const n of s)Ei(this,e,t,n)}else Si(this,e,t,n)}setAttributes(e,t){for(const[n,s]of r(e))this.setAttribute(n,s,t)}removeAttribute(e,t){if(this._assertWriterUsedCorrectly(),t instanceof Zt){const n=t.getMinimalFlatRanges();for(const t of n)Ei(this,e,null,t)}else Si(this,e,null,t)}clearAttributes(e){this._assertWriterUsedCorrectly();const t=e=>{for(const t of e.getAttributeKeys())this.removeAttribute(t,e)};if(e instanceof Zt)for(const n of e.getItems())t(n);else t(e)}move(e,t,s){if(this._assertWriterUsedCorrectly(),!(e instanceof Zt))throw new n("writer-move-invalid-range",this);if(!e.isFlat)throw new n("writer-move-range-not-flat",this);const i=Kt._createAt(t,s);if(i.isEqual(e.start))return;if(this._addOperationForAffectedMarkers("move",e),!Ti(e.root,i.root))throw new n("writer-move-different-document",this);const r=e.root.document?e.root.document.version:null,o=new Ds(e.start,e.end.offset-e.start.offset,i,r);this.batch.addOperation(o),this.model.applyOperation(o)}remove(e){this._assertWriterUsedCorrectly();const t=(e instanceof Zt?e:Zt._createOn(e)).getMinimalFlatRanges().reverse();for(const e of t)this._addOperationForAffectedMarkers("move",e),xi(e.start,e.end.offset-e.start.offset,this.batch,this.model)}merge(e){this._assertWriterUsedCorrectly();const t=e.nodeBefore,s=e.nodeAfter;if(this._addOperationForAffectedMarkers("merge",e),!(t instanceof Cn))throw new n("writer-merge-no-element-before",this);if(!(s instanceof Cn))throw new n("writer-merge-no-element-after",this);e.root.document?this._merge(e):this._mergeDetached(e)}createPositionFromPath(e,t,n){return this.model.createPositionFromPath(e,t,n)}createPositionAt(e,t){return this.model.createPositionAt(e,t)}createPositionAfter(e){return this.model.createPositionAfter(e)}createPositionBefore(e){return this.model.createPositionBefore(e)}createRange(e,t){return this.model.createRange(e,t)}createRangeIn(e){return this.model.createRangeIn(e)}createRangeOn(e){return this.model.createRangeOn(e)}createSelection(...e){return this.model.createSelection(...e)}_mergeDetached(e){const t=e.nodeBefore,n=e.nodeAfter;this.move(Zt._createIn(n),Kt._createAt(t,"end")),this.remove(n)}_merge(e){const t=Kt._createAt(e.nodeBefore,"end"),n=Kt._createAt(e.nodeAfter,0),s=e.root.document.graveyard,i=new Kt(s,[0]),r=e.root.document.version,o=new qs(n,e.nodeAfter.maxOffset,t,i,r);this.batch.addOperation(o),this.model.applyOperation(o)}rename(e,t){if(this._assertWriterUsedCorrectly(),!(e instanceof Cn))throw new n("writer-rename-not-element-instance",this);const s=e.root.document?e.root.document.version:null,i=new zs(Kt._createBefore(e),e.name,t,s);this.batch.addOperation(i),this.model.applyOperation(i)}split(e,t){this._assertWriterUsedCorrectly();let s,i,r=e.parent;if(!r.parent)throw new n("writer-split-element-no-parent",this);if(t||(t=r.parent),!e.parent.getAncestors({includeSelf:!0}).includes(t))throw new n("writer-split-invalid-limit-element",this);do{const t=r.root.document?r.root.document.version:null,n=r.maxOffset-e.offset,o=$s.getInsertionPosition(e),a=new $s(e,n,o,null,t);this.batch.addOperation(a),this.model.applyOperation(a),s||i||(s=r,i=e.parent.nextSibling),r=(e=this.createPositionAfter(e.parent)).parent}while(r!==t);return{position:e,range:new Zt(Kt._createAt(s,"end"),Kt._createAt(i,0))}}wrap(e,t){if(this._assertWriterUsedCorrectly(),!e.isFlat)throw new n("writer-wrap-range-not-flat",this);const s=t instanceof Cn?t:new Cn(t);if(s.childCount>0)throw new n("writer-wrap-element-not-empty",this);if(null!==s.parent)throw new n("writer-wrap-element-attached",this);this.insert(s,e.start);const i=new Zt(e.start.getShiftedBy(1),e.end.getShiftedBy(1));this.move(i,Kt._createAt(s,0))}unwrap(e){if(this._assertWriterUsedCorrectly(),null===e.parent)throw new n("writer-unwrap-element-no-parent",this);this.move(Zt._createIn(e),this.createPositionAfter(e)),this.remove(e)}addMarker(e,t){if(this._assertWriterUsedCorrectly(),!t||"boolean"!=typeof t.usingOperation)throw new n("writer-addmarker-no-usingoperation",this);const s=t.usingOperation,i=t.range,r=void 0!==t.affectsData&&t.affectsData;if(this.model.markers.has(e))throw new n("writer-addmarker-marker-exists",this);if(!i)throw new n("writer-addmarker-no-range",this);return s?(Ri(this,e,null,i,r),this.model.markers.get(e)):this.model.markers._set(e,i,s,r)}updateMarker(t,s){this._assertWriterUsedCorrectly();const i="string"==typeof t?t:t.name,r=this.model.markers.get(i);if(!r)throw new n("writer-updatemarker-marker-not-exists",this);if(!s)return e("writer-updatemarker-reconvert-using-editingcontroller",{markerName:i}),void this.model.markers._refresh(r);const o="boolean"==typeof s.usingOperation,a="boolean"==typeof s.affectsData,l=a?s.affectsData:r.affectsData;if(!o&&!s.range&&!a)throw new n("writer-updatemarker-wrong-options",this);const c=r.getRange(),h=s.range?s.range:c;o&&s.usingOperation!==r.managedUsingOperations?s.usingOperation?Ri(this,i,null,h,l):(Ri(this,i,c,null,l),this.model.markers._set(i,h,void 0,l)):r.managedUsingOperations?Ri(this,i,c,h,l):this.model.markers._set(i,h,void 0,l)}removeMarker(e){this._assertWriterUsedCorrectly();const t="string"==typeof e?e:e.name;if(!this.model.markers.has(t))throw new n("writer-removemarker-no-marker",this);const s=this.model.markers.get(t);if(!s.managedUsingOperations)return void this.model.markers._remove(t);Ri(this,t,s.getRange(),null,s.affectsData)}addRoot(e,t="$root"){this._assertWriterUsedCorrectly();const s=this.model.document.getRoot(e);if(s&&s.isAttached())throw new n("writer-addroot-root-exists",this);const i=this.model.document,r=new Js(e,t,!0,i,i.version);return this.batch.addOperation(r),this.model.applyOperation(r),this.model.document.getRoot(e)}detachRoot(e){this._assertWriterUsedCorrectly();const t="string"==typeof e?this.model.document.getRoot(e):e;if(!t||!t.isAttached())throw new n("writer-detachroot-no-root",this);for(const e of this.model.markers)e.getRange().root===t&&this.removeMarker(e);for(const e of t.getAttributeKeys())this.removeAttribute(e,t);this.remove(this.createRangeIn(t));const s=this.model.document,i=new Js(t.rootName,t.name,!1,s,s.version);this.batch.addOperation(i),this.model.applyOperation(i)}setSelection(...e){this._assertWriterUsedCorrectly(),this.model.document.selection._setTo(...e)}setSelectionFocus(e,t){this._assertWriterUsedCorrectly(),this.model.document.selection._setFocus(e,t)}setSelectionAttribute(e,t){if(this._assertWriterUsedCorrectly(),"string"==typeof e)this._setSelectionAttribute(e,t);else for(const[t,n]of r(e))this._setSelectionAttribute(t,n)}removeSelectionAttribute(e){if(this._assertWriterUsedCorrectly(),"string"==typeof e)this._removeSelectionAttribute(e);else for(const t of e)this._removeSelectionAttribute(t)}overrideSelectionGravity(){return this.model.document.selection._overrideGravity()}restoreSelectionGravity(e){this.model.document.selection._restoreGravity(e)}_setSelectionAttribute(e,t){const n=this.model.document.selection;if(n.isCollapsed&&n.anchor.parent.isEmpty){const s=bn._getStoreAttributeKey(e);this.setAttribute(s,t,n.anchor.parent)}n._setAttribute(e,t)}_removeSelectionAttribute(e){const t=this.model.document.selection;if(t.isCollapsed&&t.anchor.parent.isEmpty){const n=bn._getStoreAttributeKey(e);this.removeAttribute(n,t.anchor.parent)}t._removeAttribute(e)}_assertWriterUsedCorrectly(){if(this.model._currentWriter!==this)throw new n("writer-incorrect-use",this)}_addOperationForAffectedMarkers(e,t){for(const n of this.model.markers){if(!n.managedUsingOperations)continue;const s=n.getRange();let i=!1;if("move"===e){const e=t;i=e.containsPosition(s.start)||e.start.isEqual(s.start)||e.containsPosition(s.end)||e.end.isEqual(s.end)}else{const e=t,n=e.nodeBefore,r=e.nodeAfter,o=s.start.parent==n&&s.start.isAtEnd,a=s.end.parent==r&&0==s.end.offset,l=s.end.nodeAfter==r,c=s.start.nodeAfter==r;i=o||a||l||c}i&&this.updateMarker(n.name,{range:s})}}}function Ei(e,t,n,s){const i=e.model,r=i.document;let o,a,l,c=s.start;for(const e of s.getWalker({shallow:!0}))l=e.item.getAttribute(t),o&&a!=l&&(a!=n&&h(),c=o),o=e.nextPosition,a=l;function h(){const s=new Zt(c,o),l=s.root.document?r.version:null,h=new Ws(s,t,a,n,l);e.batch.addOperation(h),i.applyOperation(h)}o instanceof Kt&&o!=c&&a!=n&&h()}function Si(e,t,n,s){const i=e.model,r=i.document,o=s.getAttribute(t);let a,l;if(o!=n){if(s.root===s){const e=s.document?r.version:null;l=new Us(s,t,o,n,e)}else{a=new Zt(Kt._createBefore(s),e.createPositionAfter(s));const i=a.root.document?r.version:null;l=new Ws(a,t,o,n,i)}e.batch.addOperation(l),i.applyOperation(l)}}function Ri(e,t,n,s,i){const r=e.model,o=r.document,a=new Ls(t,n,s,r.markers,!!i,o.version);e.batch.addOperation(a),r.applyOperation(a)}function xi(e,t,n,s){let i;if(e.root.document){const n=s.document,r=new Kt(n.graveyard,[0]);i=new Ds(e,t,r,n.version)}else i=new Ai(e,t);n.addOperation(i),s.applyOperation(i)}function Ti(e,t){return e===t||e instanceof _i&&t instanceof _i}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */function Oi(e,t,n={}){if(t.isCollapsed)return;const s=t.getFirstRange();if("$graveyard"==s.root.rootName)return;const i=e.schema;e.change((e=>{if(!n.doNotResetEntireContent&&function(e,t){const n=e.getLimitElement(t);if(!t.containsEntireContent(n))return!1;const s=t.getFirstRange();if(s.start.parent==s.end.parent)return!1;return e.checkChild(n,"paragraph")}(i,t))return void function(e,t){const n=e.model.schema.getLimitElement(t);e.remove(e.createRangeIn(n)),Fi(e,e.createPositionAt(n,0),t)}(e,t);const r={};if(!n.doNotAutoparagraph){const e=t.getSelectedElement();e&&Object.assign(r,i.getAttributesWithProperty(e,"copyOnReplace",!0))}const[o,a]=function(e){const t=e.root.document.model,n=e.start;let s=e.end;if(t.hasContent(e,{ignoreMarkers:!0})){const n=function(e){const t=e.parent,n=t.root.document.model.schema,s=t.getAncestors({parentFirst:!0,includeSelf:!0});for(const e of s){if(n.isLimit(e))return null;if(n.isBlock(e))return e}}(s);if(n&&s.isTouching(t.createPositionAt(n,0))){const n=t.createSelection(e);t.modifySelection(n,{direction:"backward"});const i=n.getLastPosition(),r=t.createRange(i,s);t.hasContent(r,{ignoreMarkers:!0})||(s=i)}}return[ai.fromPosition(n,"toPrevious"),ai.fromPosition(s,"toNext")]}(s);o.isTouching(a)||e.remove(e.createRange(o,a)),n.leaveUnmerged||(!function(e,t,n){const s=e.model;if(!Ii(e.model.schema,t,n))return;const[i,r]=function(e,t){const n=e.getAncestors(),s=t.getAncestors();let i=0;for(;n[i]&&n[i]==s[i];)i++;return[n[i],s[i]]}(t,n);if(!i||!r)return;!s.hasContent(i,{ignoreMarkers:!0})&&s.hasContent(r,{ignoreMarkers:!0})?Ni(e,t,n,i.parent):Mi(e,t,n,i.parent)}(e,o,a),i.removeDisallowedAttributes(o.parent.getChildren(),e)),Bi(e,t,o),!n.doNotAutoparagraph&&function(e,t){const n=e.checkChild(t,"$text"),s=e.checkChild(t,"paragraph");return!n&&s}(i,o)&&Fi(e,o,t,r),o.detach(),a.detach()}))}function Mi(e,t,n,s){const i=t.parent,r=n.parent;if(i!=s&&r!=s){for(t=e.createPositionAfter(i),(n=e.createPositionBefore(r)).isEqual(t)||e.insert(r,t),e.merge(t);n.parent.isEmpty;){const t=n.parent;n=e.createPositionBefore(t),e.remove(t)}Ii(e.model.schema,t,n)&&Mi(e,t,n,s)}}function Ni(e,t,n,s){const i=t.parent,r=n.parent;if(i!=s&&r!=s){for(t=e.createPositionAfter(i),(n=e.createPositionBefore(r)).isEqual(t)||e.insert(i,n);t.parent.isEmpty;){const n=t.parent;t=e.createPositionBefore(n),e.remove(n)}n=e.createPositionBefore(r),function(e,t){const n=t.nodeBefore,s=t.nodeAfter;n.name!=s.name&&e.rename(n,s.name);e.clearAttributes(n),e.setAttributes(Object.fromEntries(s.getAttributes()),n),e.merge(t)}(e,n),Ii(e.model.schema,t,n)&&Ni(e,t,n,s)}}function Ii(e,t,n){const s=t.parent,i=n.parent;return s!=i&&(!e.isLimit(s)&&!e.isLimit(i)&&function(e,t,n){const s=new Zt(e,t);for(const e of s.getWalker())if(n.isLimit(e.item))return!1;return!0}(t,n,e))}function Fi(e,t,n,s={}){const i=e.createElement("paragraph");e.model.schema.setAllowedAttributes(i,s,e),e.insert(i,t),Bi(e,n,e.createPositionAt(i,0))}function Bi(e,t,n){t instanceof bn?e.setSelection(n):t.setTo(n)}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */function Di(e,t){const n=[];Array.from(e.getItems({direction:"backward"})).map((e=>t.createRangeOn(e))).filter((t=>(t.start.isAfter(e.start)||t.start.isEqual(e.start))&&(t.end.isBefore(e.end)||t.end.isEqual(e.end)))).forEach((e=>{n.push(e.start.parent),t.remove(e)})),n.forEach((e=>{let n=e;for(;n.parent&&n.isEmpty;){const e=t.createRangeOn(n);n=n.parent,t.remove(e)}}))}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class Vi{constructor(e,t,n){this._firstNode=null,this._lastNode=null,this._lastAutoParagraph=null,this._filterAttributesOf=[],this._affectedStart=null,this._affectedEnd=null,this._nodeToSelect=null,this.model=e,this.writer=t,this.position=n,this.canMergeWith=new Set([this.position.parent]),this.schema=e.schema,this._documentFragment=t.createDocumentFragment(),this._documentFragmentPosition=t.createPositionAt(this._documentFragment,0)}handleNodes(e){for(const t of Array.from(e))this._handleNode(t);this._insertPartialFragment(),this._lastAutoParagraph&&this._updateLastNodeFromAutoParagraph(this._lastAutoParagraph),this._mergeOnRight(),this.schema.removeDisallowedAttributes(this._filterAttributesOf,this.writer),this._filterAttributesOf=[]}_updateLastNodeFromAutoParagraph(e){const t=this.writer.createPositionAfter(this._lastNode),s=this.writer.createPositionAfter(e);if(s.isAfter(t)){
/* istanbul ignore if -- @preserve */
if(this._lastNode=e,this.position.parent!=e||!this.position.isAtEnd)throw new n("insertcontent-invalid-insertion-position",this);this.position=s,this._setAffectedBoundaries(this.position)}}getSelectionRange(){return this._nodeToSelect?Zt._createOn(this._nodeToSelect):this.model.schema.getNearestSelectionRange(this.position)}getAffectedRange(){return this._affectedStart?new Zt(this._affectedStart,this._affectedEnd):null}destroy(){this._affectedStart&&this._affectedStart.detach(),this._affectedEnd&&this._affectedEnd.detach()}_handleNode(e){this._checkAndSplitToAllowedPosition(e)?(this._appendToFragment(e),this._firstNode||(this._firstNode=e),this._lastNode=e):this.schema.isObject(e)||this._handleDisallowedNode(e)}_insertPartialFragment(){if(this._documentFragment.isEmpty)return;const e=ai.fromPosition(this.position,"toNext");this._setAffectedBoundaries(this.position),this._documentFragment.getChild(0)==this._firstNode&&(this.writer.insert(this._firstNode,this.position),this._mergeOnLeft(),this.position=e.toPosition()),this._documentFragment.isEmpty||this.writer.insert(this._documentFragment,this.position),this._documentFragmentPosition=this.writer.createPositionAt(this._documentFragment,0),this.position=e.toPosition(),e.detach()}_handleDisallowedNode(e){e.is("element")&&this.handleNodes(e.getChildren())}_appendToFragment(e){
/* istanbul ignore if -- @preserve */
if(!this.schema.checkChild(this.position,e))throw new n("insertcontent-wrong-position",this,{node:e,position:this.position});this.writer.insert(e,this._documentFragmentPosition),this._documentFragmentPosition=this._documentFragmentPosition.getShiftedBy(e.offsetSize),this.schema.isObject(e)&&!this.schema.checkChild(this.position,"$text")?this._nodeToSelect=e:this._nodeToSelect=null,this._filterAttributesOf.push(e)}_setAffectedBoundaries(e){this._affectedStart||(this._affectedStart=ai.fromPosition(e,"toPrevious")),this._affectedEnd&&!this._affectedEnd.isBefore(e)||(this._affectedEnd&&this._affectedEnd.detach(),this._affectedEnd=ai.fromPosition(e,"toNext"))}_mergeOnLeft(){const e=this._firstNode;if(!(e instanceof Cn))return;if(!this._canMergeLeft(e))return;const t=ai._createBefore(e);t.stickiness="toNext";const n=ai.fromPosition(this.position,"toNext");this._affectedStart.isEqual(t)&&(this._affectedStart.detach(),this._affectedStart=ai._createAt(t.nodeBefore,"end","toPrevious")),this._firstNode===this._lastNode&&(this._firstNode=t.nodeBefore,this._lastNode=t.nodeBefore),this.writer.merge(t),t.isEqual(this._affectedEnd)&&this._firstNode===this._lastNode&&(this._affectedEnd.detach(),this._affectedEnd=ai._createAt(t.nodeBefore,"end","toNext")),this.position=n.toPosition(),n.detach(),this._filterAttributesOf.push(this.position.parent),t.detach()}_mergeOnRight(){const e=this._lastNode;if(!(e instanceof Cn))return;if(!this._canMergeRight(e))return;const t=ai._createAfter(e);
/* istanbul ignore if -- @preserve */
if(t.stickiness="toNext",!this.position.isEqual(t))throw new n("insertcontent-invalid-insertion-position",this);this.position=Kt._createAt(t.nodeBefore,"end");const s=ai.fromPosition(this.position,"toPrevious");this._affectedEnd.isEqual(t)&&(this._affectedEnd.detach(),this._affectedEnd=ai._createAt(t.nodeBefore,"end","toNext")),this._firstNode===this._lastNode&&(this._firstNode=t.nodeBefore,this._lastNode=t.nodeBefore),this.writer.merge(t),t.getShiftedBy(-1).isEqual(this._affectedStart)&&this._firstNode===this._lastNode&&(this._affectedStart.detach(),this._affectedStart=ai._createAt(t.nodeBefore,0,"toPrevious")),this.position=s.toPosition(),s.detach(),this._filterAttributesOf.push(this.position.parent),t.detach()}_canMergeLeft(e){const t=e.previousSibling;return t instanceof Cn&&this.canMergeWith.has(t)&&this.model.schema.checkMerge(t,e)}_canMergeRight(e){const t=e.nextSibling;return t instanceof Cn&&this.canMergeWith.has(t)&&this.model.schema.checkMerge(e,t)}_insertAutoParagraph(){this._insertPartialFragment();const e=this.writer.createElement("paragraph");this.writer.insert(e,this.position),this._setAffectedBoundaries(this.position),this._lastAutoParagraph=e,this.position=this.writer.createPositionAt(e,0)}_checkAndSplitToAllowedPosition(e){const t=this._getAllowedIn(this.position.parent,e);if(!t)return!1;for(t!=this.position.parent&&this._insertPartialFragment();t!=this.position.parent;)if(this.position.isAtStart){const e=this.position.parent;this.position=this.writer.createPositionBefore(e),e.isEmpty&&e.parent===t&&this.writer.remove(e)}else if(this.position.isAtEnd)this.position=this.writer.createPositionAfter(this.position.parent);else{const e=this.writer.createPositionAfter(this.position.parent);this._setAffectedBoundaries(this.position),this.writer.split(this.position),this.position=e,this.canMergeWith.add(this.position.nodeAfter)}return this.schema.checkChild(this.position.parent,e)||this._insertAutoParagraph(),!0}_getAllowedIn(e,t){return this.schema.checkChild(e,t)||this.schema.checkChild(e,"paragraph")&&this.schema.checkChild("paragraph",t)?e:this.schema.isLimit(e)?null:this._getAllowedIn(e.parent,t)}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */function $i(e,t,s,i={}){if(!e.schema.isObject(t))throw new n("insertobject-element-not-an-object",e,{object:t});const r=s||e.document.selection;let o=r;i.findOptimalPosition&&e.schema.isBlock(t)&&(o=e.createSelection(e.schema.findOptimalInsertionRange(r,i.findOptimalPosition)));const a=A(r.getSelectedBlocks()),l={};return a&&Object.assign(l,e.schema.getAttributesWithProperty(a,"copyOnReplace",!0)),e.change((s=>{o.isCollapsed||e.deleteContent(o,{doNotAutoparagraph:!0});let r=t;const a=o.anchor.parent;!e.schema.checkChild(a,t)&&e.schema.checkChild(a,"paragraph")&&e.schema.checkChild("paragraph",t)&&(r=s.createElement("paragraph"),s.insert(t,r)),e.schema.setAllowedAttributes(r,l,s);const c=e.insertContent(r,o);return c.isCollapsed||i.setSelection&&function(e,t,s,i){const r=e.model;if("on"==s)return void e.setSelection(t,"on");if("after"!=s)throw new n("insertobject-invalid-place-parameter-value",r);let o=t.nextSibling;if(r.schema.isInline(t))return void e.setSelection(t,"after");const a=o&&r.schema.checkChild(o,"$text");!a&&r.schema.checkChild(t.parent,"paragraph")&&(o=e.createElement("paragraph"),r.schema.setAllowedAttributes(o,i,e),r.insertContent(o,e.createPositionAfter(t)));o&&e.setSelection(o,0)}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */(s,t,i.setSelection,l),c}))}const qi=' ,.?!:;"-()';function Li(e,t){const{isForward:n,walker:s,unit:i,schema:r,treatEmojiAsSingleUnit:o}=e,{type:a,item:l,nextPosition:c}=t;if("text"==a)return"word"===e.unit?function(e,t){let n=e.position.textNode;n||(n=t?e.position.nodeAfter:e.position.nodeBefore);for(;n&&n.is("$text");){const s=e.position.offset-n.startOffset;if(zi(n,s,t))n=t?e.position.nodeAfter:e.position.nodeBefore;else{if(ji(n.data,s,t))break;e.next()}}return e.position}(s,n):function(e,t,n){const s=e.position.textNode;if(s){const i=s.data;let r=e.position.offset-s.startOffset;for(;M(i,r)||"character"==t&&N(i,r)||n&&I(i,r);)e.next(),r=e.position.offset-s.startOffset}return e.position}(s,i,o);if(a==(n?"elementStart":"elementEnd")){if(r.isSelectable(l))return Kt._createAt(l,n?"after":"before");if(r.checkChild(c,"$text"))return c}else{if(r.isLimit(l))return void s.skip((()=>!0));if(r.checkChild(c,"$text"))return c}}function Wi(e,t){const n=e.root,s=Kt._createAt(n,t?"end":0);return t?new Zt(e,s):new Zt(s,e)}function ji(e,t,n){const s=t+(n?0:-1);return qi.includes(e.charAt(s))}function zi(e,t,n){return t===(n?e.offsetSize:0)}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class Ui extends(a()){constructor(){super(),this.markers=new vi,this.document=new yi(this),this.schema=new os,this._pendingChanges=[],this._currentWriter=null,["deleteContent","modifySelection","getSelectedContent","applyOperation"].forEach((e=>this.decorate(e))),this.on("applyOperation",((e,t)=>{t[0]._validate()}),{priority:"highest"}),this.schema.register("$root",{isLimit:!0}),this.schema.register("$container",{allowIn:["$root","$container"]}),this.schema.register("$block",{allowIn:["$root","$container"],isBlock:!0}),this.schema.register("$blockObject",{allowWhere:"$block",isBlock:!0,isObject:!0}),this.schema.register("$inlineObject",{allowWhere:"$text",allowAttributesOf:"$text",isInline:!0,isObject:!0}),this.schema.register("$text",{allowIn:"$block",isInline:!0,isContent:!0}),this.schema.register("$clipboardHolder",{allowContentOf:"$root",allowChildren:"$text",isLimit:!0}),this.schema.register("$documentFragment",{allowContentOf:"$root",allowChildren:"$text",isLimit:!0}),this.schema.register("$marker"),this.schema.addChildCheck((()=>!0),"$marker"),Qn(this),this.document.registerPostFixer(Wn),this.on("insertContent",((e,[t,n])=>{e.return=function(e,t,n){return e.change((s=>{const i=n||e.document.selection;i.isCollapsed||e.deleteContent(i,{doNotAutoparagraph:!0});const r=new Vi(e,s,i.anchor),o=[];let a;if(t.is("documentFragment")){if(t.markers.size){const e=[];for(const[n,s]of t.markers){const{start:t,end:i}=s,r=t.isEqual(i);e.push({position:t,name:n,isCollapsed:r},{position:i,name:n,isCollapsed:r})}e.sort((({position:e},{position:t})=>e.isBefore(t)?1:-1));for(const{position:n,name:i,isCollapsed:r}of e){let e=null,a=null;const l=n.parent===t&&n.isAtStart,c=n.parent===t&&n.isAtEnd;l||c?r&&(a=l?"start":"end"):(e=s.createElement("$marker"),s.insert(e,n)),o.push({name:i,element:e,collapsed:a})}}a=t.getChildren()}else a=[t];r.handleNodes(a);let l=r.getSelectionRange();if(t.is("documentFragment")&&o.length){const e=l?gn.fromRange(l):null,t={};for(let e=o.length-1;e>=0;e--){const{name:n,element:i,collapsed:a}=o[e],l=!t[n];if(l&&(t[n]=[]),i){const e=s.createPositionAt(i,"before");t[n].push(e),s.remove(i)}else{const e=r.getAffectedRange();if(!e){a&&t[n].push(r.position);continue}a?t[n].push(e[a]):t[n].push(l?e.start:e.end)}}for(const[e,[n,i]]of Object.entries(t))n&&i&&n.root===i.root&&n.root.document&&!s.model.markers.has(e)&&s.addMarker(e,{usingOperation:!0,affectsData:!0,range:new Zt(n,i)});e&&(l=e.toRange(),e.detach())}
/* istanbul ignore else -- @preserve */l&&(i instanceof bn?s.setSelection(l):i.setTo(l));const c=r.getAffectedRange()||e.createRange(i.anchor);return r.destroy(),c}))}(this,t,n)})),this.on("insertObject",((e,[t,n,s])=>{e.return=$i(this,t,n,s)})),this.on("canEditAt",(e=>{const t=!this.document.isReadOnly;e.return=t,t||e.stop()}))}change(e){try{return 0===this._pendingChanges.length?(this._pendingChanges.push({batch:new hi,callback:e}),this._runPendingChanges()[0]):e(this._currentWriter)}catch(e){
/* istanbul ignore next -- @preserve */
n.rethrowUnexpectedError(e,this)}}enqueueChange(e,t){try{e?"function"==typeof e?(t=e,e=new hi):e instanceof hi||(e=new hi(e)):e=new hi,this._pendingChanges.push({batch:e,callback:t}),1==this._pendingChanges.length&&this._runPendingChanges()}catch(e){
/* istanbul ignore next -- @preserve */
n.rethrowUnexpectedError(e,this)}}applyOperation(e){e._execute()}insertContent(e,t,n,...s){const i=Ji(t,n);return this.fire("insertContent",[e,i,n,...s])}insertObject(e,t,n,s,...i){const r=Ji(t,n);return this.fire("insertObject",[e,r,s,s,...i])}deleteContent(e,t){Oi(this,e,t)}modifySelection(e,t){!function(e,t,n={}){const s=e.schema,i="backward"!=n.direction,r=n.unit?n.unit:"character",o=!!n.treatEmojiAsSingleUnit,a=t.focus,l=new Ut({boundaries:Wi(a,i),singleCharacters:!0,direction:i?"forward":"backward"}),c={walker:l,schema:s,isForward:i,unit:r,treatEmojiAsSingleUnit:o};let h;for(;h=l.next();){if(h.done)return;const n=Li(c,h.value);if(n)return void(t instanceof bn?e.change((e=>{e.setSelectionFocus(n)})):t.setFocus(n))}}(this,e,t)}getSelectedContent(e){return function(e,t){return e.change((e=>{const n=e.createDocumentFragment(),s=t.getFirstRange();if(!s||s.isCollapsed)return n;const i=s.start.root,r=s.start.getCommonPath(s.end),o=i.getNodeByPath(r);let a;a=s.start.parent==s.end.parent?s:e.createRange(e.createPositionAt(o,s.start.path[r.length]),e.createPositionAt(o,s.end.path[r.length]+1));const l=a.end.offset-a.start.offset;for(const t of a.getItems({shallow:!0}))t.is("$textProxy")?e.appendText(t.data,t.getAttributes(),n):e.append(e.cloneElement(t,!0),n);if(a!=s){const t=s._getTransformedByMove(a.start,e.createPositionAt(n,0),l)[0],i=e.createRange(e.createPositionAt(n,0),t.start);Di(e.createRange(t.end,e.createPositionAt(n,"end")),e),Di(i,e)}return n}))}(this,e)}hasContent(e,t={}){const n=e instanceof Zt?e:Zt._createIn(e);if(n.isCollapsed)return!1;const{ignoreWhitespaces:s=!1,ignoreMarkers:i=!1}=t;if(!i)for(const e of this.markers.getMarkersIntersectingRange(n))if(e.affectsData)return!0;for(const e of n.getItems())if(this.schema.isContent(e)){if(!e.is("$textProxy"))return!0;if(!s)return!0;if(-1!==e.data.search(/\S/))return!0}return!1}canEditAt(e){const t=Ji(e);return this.fire("canEditAt",[t])}createPositionFromPath(e,t,n){return new Kt(e,t,n)}createPositionAt(e,t){return Kt._createAt(e,t)}createPositionAfter(e){return Kt._createAfter(e)}createPositionBefore(e){return Kt._createBefore(e)}createRange(e,t){return new Zt(e,t)}createRangeIn(e){return Zt._createIn(e)}createRangeOn(e){return Zt._createOn(e)}createSelection(...e){return new ln(...e)}createBatch(e){return new hi(e)}createOperationFromJSON(e){return Gs.fromJSON(e,this.document)}destroy(){this.document.destroy(),this.stopListening()}_runPendingChanges(){const e=[];this.fire("_beforeChanges");try{for(;this._pendingChanges.length;){const t=this._pendingChanges[0].batch;this._currentWriter=new ki(this,t);const n=this._pendingChanges[0].callback(this._currentWriter);e.push(n),this.document._handleChangeBlock(this._currentWriter),this._pendingChanges.shift(),this._currentWriter=null}}finally{this._pendingChanges.length=0,this._currentWriter=null,this.fire("_afterChanges")}return e}}function Ji(e,t){if(e)return e instanceof ln||e instanceof bn?e:e instanceof an?t||0===t?new ln(e,t):e.is("rootElement")?new ln(e,"in"):new ln(e,"on"):new ln(e)}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class Ki extends xt{constructor(){super(...arguments),this.domEventType="click"}onDomEvent(e){this.fire(e.type,e)}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class Gi extends xt{constructor(){super(...arguments),this.domEventType=["mousedown","mouseup","mouseover","mouseout"]}onDomEvent(e){this.fire(e.type,e)}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class Hi{constructor(e){this.document=e}createDocumentFragment(e){return new Je(this.document,e)}createElement(e,t,n){return new ge(this.document,e,t,n)}createText(e){return new oe(this.document,e)}clone(e,t=!1){return e._clone(t)}appendChild(e,t){return t._appendChild(e)}insertChild(e,t,n){return n._insertChild(e,t)}removeChildren(e,t,n){return n._removeChildren(e,t)}remove(e){const t=e.parent;return t?this.removeChildren(t.getChildIndex(e),1,t):[]}replace(e,t){const n=e.parent;if(n){const s=n.getChildIndex(e);return this.removeChildren(s,1,n),this.insertChild(s,t,n),!0}return!1}unwrapElement(e){const t=e.parent;if(t){const n=t.getChildIndex(e);this.remove(e),this.insertChild(n,e.getChildren(),t)}}rename(e,t){const n=new ge(this.document,e,t.getAttributes(),t.getChildren());return this.replace(t,n)?n:null}setAttribute(e,t,n){n._setAttribute(e,t)}removeAttribute(e,t){t._removeAttribute(e)}addClass(e,t){t._addClass(e)}removeClass(e,t){t._removeClass(e)}setStyle(e,t,n){L(e)&&void 0===n?t._setStyle(e):n._setStyle(e,t)}removeStyle(e,t){t._removeStyle(e)}setCustomProperty(e,t,n){n._setCustomProperty(e,t)}removeCustomProperty(e,t){return t._removeCustomProperty(e)}createPositionAt(e,t){return Ae._createAt(e,t)}createPositionAfter(e){return Ae._createAfter(e)}createPositionBefore(e){return Ae._createBefore(e)}createRange(e,t){return new Ce(e,t)}createRangeOn(e){return Ce._createOn(e)}createRangeIn(e){return Ce._createIn(e)}createSelection(...e){return new Ee(...e)}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */const Yi=/^#([0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/i,Xi=/^rgb\([ ]?([0-9]{1,3}[ %]?,[ ]?){2,3}[0-9]{1,3}[ %]?\)$/i,Qi=/^rgba\([ ]?([0-9]{1,3}[ %]?,[ ]?){3}(1|[0-9]+%|[0]?\.?[0-9]+)\)$/i,Zi=/^hsl\([ ]?([0-9]{1,3}[ %]?[,]?[ ]*){3}(1|[0-9]+%|[0]?\.?[0-9]+)?\)$/i,er=/^hsla\([ ]?([0-9]{1,3}[ %]?,[ ]?){2,3}(1|[0-9]+%|[0]?\.?[0-9]+)\)$/i,tr=/\w+\((?:[^()]|\([^()]*\))*\)|\S+/gi,nr=new Set(["black","silver","gray","white","maroon","red","purple","fuchsia","green","lime","olive","yellow","navy","blue","teal","aqua","orange","aliceblue","antiquewhite","aquamarine","azure","beige","bisque","blanchedalmond","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkgrey","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dimgrey","dodgerblue","firebrick","floralwhite","forestgreen","gainsboro","ghostwhite","gold","goldenrod","greenyellow","grey","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightslategrey","lightsteelblue","lightyellow","limegreen","linen","magenta","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","oldlace","olivedrab","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","skyblue","slateblue","slategray","slategrey","snow","springgreen","steelblue","tan","thistle","tomato","turquoise","violet","wheat","whitesmoke","yellowgreen","activeborder","activecaption","appworkspace","background","buttonface","buttonhighlight","buttonshadow","buttontext","captiontext","graytext","highlight","highlighttext","inactiveborder","inactivecaption","inactivecaptiontext","infobackground","infotext","menu","menutext","scrollbar","threeddarkshadow","threedface","threedhighlight","threedlightshadow","threedshadow","window","windowframe","windowtext","rebeccapurple","currentcolor","transparent"]);function sr(e){return e.startsWith("#")?Yi.test(e):e.startsWith("rgb")?Xi.test(e)||Qi.test(e):e.startsWith("hsl")?Zi.test(e)||er.test(e):nr.has(e.toLowerCase())}const ir=["none","hidden","dotted","dashed","solid","double","groove","ridge","inset","outset"];function rr(e){return ir.includes(e)}const or=/^([+-]?[0-9]*([.][0-9]+)?(px|cm|mm|in|pc|pt|ch|em|ex|rem|vh|vw|vmin|vmax)|0)$/;function ar(e){return or.test(e)}const lr=/^[+-]?[0-9]*([.][0-9]+)?%$/;function cr(e){return lr.test(e)}const hr=["repeat-x","repeat-y","repeat","space","round","no-repeat"];function dr(e){return hr.includes(e)}const ur=["center","top","bottom","left","right"];function fr(e){return ur.includes(e)}const mr=["fixed","scroll","local"];function gr(e){return mr.includes(e)}const pr=/^url\(/;function _r(e){return pr.test(e)}function wr(e=""){if(""===e)return{top:void 0,right:void 0,bottom:void 0,left:void 0};const t=Pr(e),n=t[0],s=t[2]||n,i=t[1]||n;return{top:n,bottom:s,right:i,left:t[3]||i}}function yr(e){return t=>{const{top:n,right:s,bottom:i,left:r}=t,o=[];return[n,s,r,i].every((e=>!!e))?o.push([e,br(t)]):(n&&o.push([e+"-top",n]),s&&o.push([e+"-right",s]),i&&o.push([e+"-bottom",i]),r&&o.push([e+"-left",r])),o}}function br({top:e,right:t,bottom:n,left:s}){const i=[];return s!==t?i.push(e,t,n,s):n!==e?i.push(e,t,n):t!==e?i.push(e,t):i.push(e),i.join(" ")}function vr(e){return t=>({path:e,value:wr(t)})}function Pr(e){const t=e.trim().slice(0,1500).matchAll(tr);return Array.from(t).map((e=>e[0]))}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */function Ar(e){e.setNormalizer("background",(e=>{const t={},n=Pr(e);for(const e of n)dr(e)?(t.repeat=t.repeat||[],t.repeat.push(e)):fr(e)?(t.position=t.position||[],t.position.push(e)):gr(e)?t.attachment=e:sr(e)?t.color=e:_r(e)&&(t.image=e);return{path:"background",value:t}})),e.setNormalizer("background-color",(e=>({path:"background.color",value:e}))),e.setReducer("background",(e=>{const t=[];return t.push(["background-color",e.color]),t})),e.setStyleRelation("background",["background-color"])}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */
function Cr(e){e.setNormalizer("border",(e=>{const{color:t,style:n,width:s}=Or(e);return{path:"border",value:{color:wr(t),style:wr(n),width:wr(s)}}})),e.setNormalizer("border-top",kr("top")),e.setNormalizer("border-right",kr("right")),e.setNormalizer("border-bottom",kr("bottom")),e.setNormalizer("border-left",kr("left")),e.setNormalizer("border-color",Er("color")),e.setNormalizer("border-width",Er("width")),e.setNormalizer("border-style",Er("style")),e.setNormalizer("border-top-color",Rr("color","top")),e.setNormalizer("border-top-style",Rr("style","top")),e.setNormalizer("border-top-width",Rr("width","top")),e.setNormalizer("border-right-color",Rr("color","right")),e.setNormalizer("border-right-style",Rr("style","right")),e.setNormalizer("border-right-width",Rr("width","right")),e.setNormalizer("border-bottom-color",Rr("color","bottom")),e.setNormalizer("border-bottom-style",Rr("style","bottom")),e.setNormalizer("border-bottom-width",Rr("width","bottom")),e.setNormalizer("border-left-color",Rr("color","left")),e.setNormalizer("border-left-style",Rr("style","left")),e.setNormalizer("border-left-width",Rr("width","left")),e.setExtractor("border-top",xr("top")),e.setExtractor("border-right",xr("right")),e.setExtractor("border-bottom",xr("bottom")),e.setExtractor("border-left",xr("left")),e.setExtractor("border-top-color","border.color.top"),e.setExtractor("border-right-color","border.color.right"),e.setExtractor("border-bottom-color","border.color.bottom"),e.setExtractor("border-left-color","border.color.left"),e.setExtractor("border-top-width","border.width.top"),e.setExtractor("border-right-width","border.width.right"),e.setExtractor("border-bottom-width","border.width.bottom"),e.setExtractor("border-left-width","border.width.left"),e.setExtractor("border-top-style","border.style.top"),e.setExtractor("border-right-style","border.style.right"),e.setExtractor("border-bottom-style","border.style.bottom"),e.setExtractor("border-left-style","border.style.left"),e.setReducer("border-color",yr("border-color")),e.setReducer("border-style",yr("border-style")),e.setReducer("border-width",yr("border-width")),e.setReducer("border-top",Mr("top")),e.setReducer("border-right",Mr("right")),e.setReducer("border-bottom",Mr("bottom")),e.setReducer("border-left",Mr("left")),e.setReducer("border",function(){return t=>{const n=Tr(t,"top"),s=Tr(t,"right"),i=Tr(t,"bottom"),r=Tr(t,"left"),o=[n,s,i,r],a={width:e(o,"width"),style:e(o,"style"),color:e(o,"color")},l=Nr(a,"all");if(l.length)return l;const c=Object.entries(a).reduce(((e,[t,n])=>(n&&(e.push([`border-${t}`,n]),o.forEach((e=>delete e[t]))),e)),[]);return[...c,...Nr(n,"top"),...Nr(s,"right"),...Nr(i,"bottom"),...Nr(r,"left")]};function e(e,t){return e.map((e=>e[t])).reduce(((e,t)=>e==t?e:null))}}()),e.setStyleRelation("border",["border-color","border-style","border-width","border-top","border-right","border-bottom","border-left","border-top-color","border-right-color","border-bottom-color","border-left-color","border-top-style","border-right-style","border-bottom-style","border-left-style","border-top-width","border-right-width","border-bottom-width","border-left-width"]),e.setStyleRelation("border-color",["border-top-color","border-right-color","border-bottom-color","border-left-color"]),e.setStyleRelation("border-style",["border-top-style","border-right-style","border-bottom-style","border-left-style"]),e.setStyleRelation("border-width",["border-top-width","border-right-width","border-bottom-width","border-left-width"]),e.setStyleRelation("border-top",["border-top-color","border-top-style","border-top-width"]),e.setStyleRelation("border-right",["border-right-color","border-right-style","border-right-width"]),e.setStyleRelation("border-bottom",["border-bottom-color","border-bottom-style","border-bottom-width"]),e.setStyleRelation("border-left",["border-left-color","border-left-style","border-left-width"])}function kr(e){return t=>{const{color:n,style:s,width:i}=Or(t),r={};return void 0!==n&&(r.color={[e]:n}),void 0!==s&&(r.style={[e]:s}),void 0!==i&&(r.width={[e]:i}),{path:"border",value:r}}}function Er(e){return t=>({path:"border",value:Sr(t,e)})}function Sr(e,t){return{[t]:wr(e)}}function Rr(e,t){return n=>({path:"border",value:{[e]:{[t]:n}}})}function xr(e){return(t,n)=>{if(n.border)return Tr(n.border,e)}}function Tr(e,t){const n={};return e.width&&e.width[t]&&(n.width=e.width[t]),e.style&&e.style[t]&&(n.style=e.style[t]),e.color&&e.color[t]&&(n.color=e.color[t]),n}function Or(e){const t={},n=Pr(e);for(const e of n)ar(e)||/thin|medium|thick/.test(e)?t.width=e:rr(e)?t.style=e:t.color=e;return t}function Mr(e){return t=>Nr(t,e)}function Nr(e,t){const n=[];if(e&&e.width&&n.push("width"),e&&e.style&&n.push("style"),e&&e.color&&n.push("color"),3==n.length){const s=n.map((t=>e[t])).join(" ");return["all"==t?["border",s]:[`border-${t}`,s]]}return"all"==t?[]:n.map((n=>[`border-${t}-${n}`,e[n]]))}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */function Ir(e){e.setNormalizer("margin",vr("margin")),e.setNormalizer("margin-top",(e=>({path:"margin.top",value:e}))),e.setNormalizer("margin-right",(e=>({path:"margin.right",value:e}))),e.setNormalizer("margin-bottom",(e=>({path:"margin.bottom",value:e}))),e.setNormalizer("margin-left",(e=>({path:"margin.left",value:e}))),e.setReducer("margin",yr("margin")),e.setStyleRelation("margin",["margin-top","margin-right","margin-bottom","margin-left"])}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */function Fr(e){e.setNormalizer("padding",vr("padding")),e.setNormalizer("padding-top",(e=>({path:"padding.top",value:e}))),e.setNormalizer("padding-right",(e=>({path:"padding.right",value:e}))),e.setNormalizer("padding-bottom",(e=>({path:"padding.bottom",value:e}))),e.setNormalizer("padding-left",(e=>({path:"padding.left",value:e}))),e.setReducer("padding",yr("padding")),e.setStyleRelation("padding",["padding-top","padding-right","padding-bottom","padding-left"])}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */const Br="[",Dr="]",Vr="{",$r="}",qr={container:_e,attribute:Be,empty:$e,ui:Le,raw:ze},Lr={setContentOf:(e,t)=>{e.innerHTML=t}};function Wr(e,t={}){if(!(e instanceof Wt))throw new TypeError("View needs to be an instance of module:engine/view/view~View.");const n=e.document,s=!!t.withoutSelection,i=t.rootName||"main",r=n.getRoot(i),o={showType:t.showType,showPriority:t.showPriority,renderUIElements:t.renderUIElements,renderRawElements:t.renderRawElements,ignoreRoot:!0,domConverter:t.domConverter};return s?Wr._stringify(r,null,o):Wr._stringify(r,n.selection,o)}function jr(e,t,n={}){if(!(e instanceof Wt))throw new TypeError("View needs to be an instance of module:engine/view/view~View.");const s=e.document,i=n.rootName||"main",r=s.getRoot(i);e.change((e=>{const n=jr._parse(t,{rootElement:r});n.view&&n.selection&&e.setSelection(n.selection)}))}function zr(e,t=null,n={}){let s;s=t instanceof Ae||t instanceof Ce?new Se(t):t;return new Kr(e,s,n).stringify()}function Ur(e,t={}){const n=new Fe(new ue);t.order=t.order||[];const s=new Jr({sameSelectionCharacters:t.sameSelectionCharacters}),i=new Rs(n,{namespaces:Object.keys(qr)});t.inlineObjectElements&&i.domConverter.inlineObjectElements.push(...t.inlineObjectElements);let r=i.toView(e);if(r=Gr(r),t.rootElement){const e=t.rootElement,n=r._removeChildren(0,r.childCount);e._removeChildren(0,e.childCount),e._appendChild(n),r=e}const o=s.parse(r,t.order);if(r.is("documentFragment")&&1===r.childCount&&(r=r.getChild(0)),o.length){return{view:r,selection:new Se(o,{backward:!!t.lastRangeBackward})}}return r.parent&&r._remove(),r}Wr._stringify=zr,jr._parse=Ur;class Jr{constructor(e){this.sameSelectionCharacters=!!e.sameSelectionCharacters}parse(e,t){this._positions=[],this._getPositions(e);let n=this._createRanges();if(t.length){if(t.length!=n.length)throw new Error(`Parse error - there are ${n.length} ranges found, but ranges order array contains ${t.length} elements.`);n=this._sortRanges(n,t)}return n}_getPositions(e){if(e.is("documentFragment")||e.is("element")){const t=[...e.getChildren()];for(const e of t)this._getPositions(e)}if(e.is("$text")){const t=new RegExp(`[${Vr}${$r}\\${Dr}\\${Br}]`,"g");let n,s=e.data,i=0;const r=[];for(;n=t.exec(s);){const e=n.index,t=n[0];r.push({bracket:t,textOffset:e-i}),i++}s=s.replace(t,""),e._data=s;const o=e.index,a=e.parent;s||e._remove();for(const t of r)if(s)if(this.sameSelectionCharacters||!this.sameSelectionCharacters&&(t.bracket==Vr||t.bracket==$r))this._positions.push({bracket:t.bracket,position:new Ae(e,t.textOffset)});else{if(!this.sameSelectionCharacters&&0!==t.textOffset&&t.textOffset!==s.length)throw new Error(`Parse error - range delimiter '${t.bracket}' is placed inside text node.`);const e=0===t.textOffset?o:o+1;this._positions.push({bracket:t.bracket,position:new Ae(a,e)})}else{if(!this.sameSelectionCharacters&&t.bracket==Vr||t.bracket==$r)throw new Error(`Parse error - text range delimiter '${t.bracket}' is placed inside empty text node. `);this._positions.push({bracket:t.bracket,position:new Ae(a,o)})}}}_sortRanges(e,t){const n=[];let s=0;for(const i of t){if(void 0===e[i-1])throw new Error("Parse error - provided ranges order is invalid.");n[i-1]=e[s],s++}return n}_createRanges(){const e=[];let t=null;for(const n of this._positions){if(!t&&(n.bracket==Dr||n.bracket==$r))throw new Error(`Parse error - end of range was found '${n.bracket}' but range was not started before.`);if(t&&(n.bracket==Br||n.bracket==Vr))throw new Error(`Parse error - start of range was found '${n.bracket}' but one range is already started.`);n.bracket==Br||n.bracket==Vr?t=new Ce(n.position,n.position):(t.end=n.position,e.push(t),t=null)}if(null!==t)throw new Error("Parse error - range was started but no end delimiter was found.");return e}}class Kr{constructor(e,t,n){this.root=e,this.selection=t,this.ranges=[],t&&(this.ranges=[...t.getRanges()]),this.showType=!!n.showType,this.showPriority=!!n.showPriority,this.showAttributeElementId=!!n.showAttributeElementId,this.ignoreRoot=!!n.ignoreRoot,this.sameSelectionCharacters=!!n.sameSelectionCharacters,this.renderUIElements=!!n.renderUIElements,this.renderRawElements=!!n.renderRawElements,this.domConverter=n.domConverter||Lr}stringify(){let e="";return this._walkView(this.root,(t=>{e+=t})),e}_walkView(e,t){const n=this.ignoreRoot&&this.root===e;if(e.is("element")||e.is("documentFragment")){if(e.is("element")&&!n&&t(this._stringifyElementOpen(e)),this.renderUIElements&&e.is("uiElement"))t(e.render(document,this.domConverter).innerHTML);else if(this.renderRawElements&&e.is("rawElement")){const n=document.createElement("div");e.render(n,this.domConverter),t(n.innerHTML)}else{let n=0;t(this._stringifyElementRanges(e,n));for(const s of e.getChildren())this._walkView(s,t),n++,t(this._stringifyElementRanges(e,n))}e.is("element")&&!n&&t(this._stringifyElementClose(e))}e.is("$text")&&t(this._stringifyTextRanges(e))}_stringifyElementRanges(e,t){let n="",s="",i="";for(const r of this.ranges)r.start.parent==e&&r.start.offset===t&&(r.isCollapsed?i+=Br+Dr:n+=Br),r.end.parent!==e||r.end.offset!==t||r.isCollapsed||(s+=Dr);return s+i+n}_stringifyTextRanges(e){const t=e.data.length,n=e.data.split("");let s,i;this.sameSelectionCharacters?(s=Br,i=Dr):(s=Vr,i=$r),n[t]="";const r=n.map((e=>({letter:e,start:"",end:"",collapsed:""})));for(const n of this.ranges){const o=n.start,a=n.end;o.parent==e&&o.offset>=0&&o.offset<=t&&(n.isCollapsed?r[a.offset].collapsed+=s+i:r[o.offset].start+=s),a.parent==e&&a.offset>=0&&a.offset<=t&&!n.isCollapsed&&(r[a.offset].end+=i)}return r.map((e=>e.end+e.collapsed+e.start+e.letter)).join("")}_stringifyElementOpen(e){const t=this._stringifyElementPriority(e),n=this._stringifyElementId(e);return`<${[[this._stringifyElementType(e),e.name].filter((e=>""!==e)).join(":"),t,n,this._stringifyElementAttributes(e)].filter((e=>""!==e)).join(" ")}>`}_stringifyElementClose(e){return`</${[this._stringifyElementType(e),e.name].filter((e=>""!==e)).join(":")}>`}_stringifyElementType(e){if(this.showType)for(const t in qr)if(e instanceof qr[t])return t;return""}_stringifyElementPriority(e){return this.showPriority&&e.is("attributeElement")?`view-priority="${e.priority}"`:""}_stringifyElementId(e){return this.showAttributeElementId&&e.is("attributeElement")&&e.id?`view-id="${e.id}"`:""}_stringifyElementAttributes(e){const t=[],n=[...e.getAttributeKeys()].sort();for(const s of n){let n;n="class"===s?[...e.getClassNames()].sort().join(" "):"style"===s?[...e.getStyleNames()].sort().map((t=>`${t}:${e.getStyle(t).replace(/"/g,"&quot;")}`)).join(";"):e.getAttribute(s),t.push(`${s}="${n}"`)}return t.join(" ")}}function Gr(e){if(e.is("element")||e.is("documentFragment")){const t=e.is("documentFragment")?new Je(e.document):function(e,t){const n=function(e){const t=e.name.split(":"),n=function(e){const t=parseInt(e,10);if(!isNaN(t))return t;return null}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */(e.getAttribute("view-priority")),s=e.hasAttribute("view-id")?e.getAttribute("view-id"):null;if(e._removeAttribute("view-priority"),e._removeAttribute("view-id"),1==t.length)return{name:t[0],type:null!==n?"attribute":null,priority:n,id:s};const i=function(e){return e in qr?e:null}(t[0]);if(i)return{name:t[1],type:i,priority:n,id:s};throw new Error(`Parse error - cannot parse element's name: ${e.name}.`)}(t),s=qr[n.type],i=s?new s(e,n.name):new ge(e,n.name);i.is("attributeElement")&&(null!==n.priority&&(i._priority=n.priority),null!==n.id&&(i._id=n.id));for(const e of t.getAttributeKeys())i._setAttribute(e,t.getAttribute(e));return i}(e.document,e);for(const n of[...e.getChildren()]){if(t.is("emptyElement"))throw new Error("Parse error - cannot parse inside EmptyElement.");if(t.is("uiElement"))throw new Error("Parse error - cannot parse inside UIElement.");if(t.is("rawElement"))throw new Error("Parse error - cannot parse inside RawElement.");t._appendChild(Gr(n))}return t}return e}function Hr(e,t={}){if(!(e instanceof Ui))throw new TypeError("Model needs to be an instance of module:engine/model/model~Model.");const n=t.rootName||"main",s=e.document.getRoot(n);return Hr._stringify(s,t.withoutSelection?null:e.document.selection,t.convertMarkers?e.markers:null)}function Yr(e,t,n={}){if(!(e instanceof Ui))throw new TypeError("Model needs to be an instance of module:engine/model/model~Model.");let s,i=null;const r=e.document.getRoot(n.rootName||"main"),o=Yr._parse(t,e.schema,{lastRangeBackward:n.lastRangeBackward,selectionAttributes:n.selectionAttributes,context:[r.name],inlineObjectElements:n.inlineObjectElements});function a(t){if(t.remove(t.createRangeIn(r)),t.insert(s,r),t.setSelection(null),t.removeSelectionAttribute(e.document.selection.getAttributeKeys()),i){const e=[];for(const t of i.getRanges()){const n=new Kt(r,t.start.path),s=new Kt(r,t.end.path);e.push(new Zt(n,s))}t.setSelection(e,{backward:i.isBackward}),n.selectionAttributes&&t.setSelectionAttribute(i.getAttributes())}}"model"in o?(s=o.model,i=o.selection):s=o,void 0!==n.batchType?e.enqueueChange(n.batchType,a):e.change(a)}function Xr(e,t=null,n=null){const s=new Ui,i=new en;let r,o=null;if(e instanceof _i||e instanceof Ci)r=s.createRangeIn(e);else if(e.parent)r=new Zt(s.createPositionBefore(e),s.createPositionAfter(e));else{const t=new Ci(e);r=s.createRangeIn(t)}t instanceof ln||t instanceof bn?o=t:(t instanceof Zt||t instanceof Kt)&&(o=new ln(t));const a=new ue,l=new Wt(a),c=l.document,h=new ve(c,"div");h.rootName="main",c.roots.add(h);const d=new sn({mapper:i,schema:s.schema});i.bindElements(e.root,h),d.on("insert:$text",((e,t,n)=>{if(!n.consumable.consume(t.item,e.name))return;const s=n.writer,i=n.mapper.toViewPosition(t.range.start),r=s.createText(t.item.data);s.insert(i,r)})),d.on("insert",((e,t,n)=>{n.convertAttributes(t.item),t.reconversion||!t.item.is("element")||t.item.isEmpty||n.convertChildren(t.item)}),{priority:"lowest"}),d.on("attribute",((e,t,n)=>{if(t.item instanceof ln||t.item instanceof bn||t.item.is("$textProxy")){const s=Rn(((e,{writer:n})=>n.createAttributeElement("model-text-with-attributes",{[t.attributeKey]:to(e)})));s(e,t,n)}})),d.on("insert",xn((e=>{const t=no(e.getAttributes(),to);return new _e(c,e.name,t)}))),d.on("selection",((e,t,n)=>{const s=t.selection;if(s.isCollapsed)return;if(!n.consumable.consume(s,"selection"))return;const i=[];for(const e of s.getRanges())i.push(n.mapper.toViewRange(e));n.writer.setSelection(i,{backward:s.isBackward})})),d.on("selection",((e,t,n)=>{const s=t.selection;if(!s.isCollapsed)return;if(!n.consumable.consume(s,"selection"))return;const i=n.writer,r=s.getFirstPosition(),o=n.mapper.toViewPosition(r),a=i.breakAttributes(o);i.setSelection(a)})),d.on("addMarker",Tn(((e,{writer:t})=>{const n=e.markerName+":"+(e.isOpening?"start":"end");return t.createUIElement(n)})));const u=new Map;if(n)for(const e of Array.from(n).sort(((e,t)=>e.name<t.name?1:-1)))u.set(e.name,e.getRange());const f=l._writer;d.convert(r,u,f),o&&d.convertSelection(o,n||s.markers,f);let m=zr(h,c.selection,{sameSelectionCharacters:!0});return m=m.substr(5,m.length-11),l.destroy(),m.replace(new RegExp("model-text-with-attributes","g"),"$text")}function Qr(e,t,n={}){const s=new en,i=Ur(e=e.replace(new RegExp("\\$text","g"),"model-text-with-attributes"),{sameSelectionCharacters:!0,lastRangeBackward:!!n.lastRangeBackward,inlineObjectElements:n.inlineObjectElements});let o,a=null,l=null;"view"in i&&"selection"in i?(o=i.view,a=i.selection):o=i;const c=new Ui,h=new vs({schema:t});h.on("documentFragment",function(e){return(t,n,s)=>{const i=s.convertChildren(n.viewItem,n.modelCursor);e.bindElements(n.modelCursor.parent,n.viewItem),n=Object.assign(n,i),t.stop()}}(s)),h.on("element:model-text-with-attributes",Zr()),h.on("element",function(e){return(t,n,s)=>{const i=n.viewItem.name;if(!s.schema.checkChild(n.modelCursor,i))throw new Error(`Element '${i}' was not allowed in given position.`);const r=no(n.viewItem.getAttributes(),eo),o=s.writer.createElement(n.viewItem.name,r);s.writer.insert(o,n.modelCursor),e.bindElements(o,n.viewItem),s.convertChildren(n.viewItem,o),n.modelRange=Zt._createOn(o),n.modelCursor=n.modelRange.end,t.stop()}}(s)),h.on("text",Zr());let d=c.change((e=>h.convert(o.root,e,n.context||"$root")));if(s.bindElements(d,o.root),1==d.childCount&&(d=d.getChild(0)),a){const e=[];for(const t of a.getRanges())e.push(s.toModelRange(t));l=new ln(e,{backward:a.isBackward});for(const[e,t]of r(n.selectionAttributes||[]))l.setAttribute(e,t)}return l?{model:d,selection:l}:d}function Zr(){return(e,t,n)=>{if(!n.schema.checkChild(t.modelCursor,"$text"))throw new Error("Text was not allowed in given position.");let s;if(t.viewItem.is("element")){const e=no(t.viewItem.getAttributes(),eo),i=t.viewItem.getChild(0);s=n.writer.createText(i.data,e)}else s=n.writer.createText(t.viewItem.data);n.writer.insert(s,t.modelCursor),t.modelRange=Zt._createFromPositionAndShift(t.modelCursor,s.offsetSize),t.modelCursor=t.modelRange.end,e.stop()}}function eo(e){try{return JSON.parse(e)}catch(t){return e}}function to(e){return L(e)?JSON.stringify(e):e}function*no(e,t){for(const[n,s]of e)yield[n,t(s)]}Hr._stringify=Xr,Yr._parse=Qr;export{Be as AttributeElement,Ws as AttributeOperation,Re as BubblingEventInfo,Ki as ClickObserver,ks as Conversion,Cs as DataController,Dt as DataTransfer,Ci as DocumentFragment,bn as DocumentSelection,At as DomConverter,Rt as DomEventData,xt as DomEventObserver,Ke as DowncastWriter,ns as EditingController,Wt as EditingView,Cn as Element,It as FocusObserver,pi as History,As as HtmlDataProcessor,Vs as InsertOperation,ai as LivePosition,gn as LiveRange,Ls as MarkerOperation,le as Matcher,qs as MergeOperation,Ui as Model,Gi as MouseObserver,Ds as MoveOperation,js as NoOperation,St as Observer,Gs as OperationFactory,Kt as Position,Zt as Range,zs as RenameOperation,ft as Renderer,Us as RootAttributeOperation,Js as RootOperation,$s as SplitOperation,de as StylesMap,ue as StylesProcessor,Lt as TabObserver,wn as Text,zt as TextProxy,Ut as TreeWalker,Hi as UpcastWriter,Be as ViewAttributeElement,_e as ViewContainerElement,Fe as ViewDocument,Je as ViewDocumentFragment,ye as ViewEditableElement,ge as ViewElement,$e as ViewEmptyElement,ze as ViewRawElement,ve as ViewRootEditableElement,oe as ViewText,Pe as ViewTreeWalker,Le as ViewUIElement,Rs as XmlDataProcessor,Hr as _getModelData,Wr as _getViewData,Qr as _parseModel,Ur as _parseView,Yr as _setModelData,jr as _setViewData,Xr as _stringifyModel,zr as _stringifyView,Ar as addBackgroundRules,Cr as addBorderRules,Ir as addMarginRules,Fr as addPaddingRules,Wn as autoParagraphEmptyRoots,X as disablePlaceholder,Y as enablePlaceholder,br as getBoxSidesShorthandValue,yr as getBoxSidesValueReducer,wr as getBoxSidesValues,we as getFillerOffset,vr as getPositionShorthandNormalizer,Pr as getShorthandValues,Z as hidePlaceholder,gr as isAttachment,sr as isColor,ar as isLength,rr as isLineStyle,jn as isParagraphable,cr as isPercentage,fr as isPosition,dr as isRepeat,_r as isURL,ee as needsPlaceholder,Q as showPlaceholder,Zs as transformSets,zn as wrapInParagraph};