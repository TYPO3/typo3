import{Command as N,Plugin as b,icons as p}from"@ckeditor/ckeditor5-core";import{Paragraph as V}from"@ckeditor/ckeditor5-paragraph";import{first as v,priorities as R,Collection as M}from"@ckeditor/ckeditor5-utils";import{ViewModel as A,createDropdown as I,addListToDropdown as O,MenuBarMenuView as D,MenuBarMenuListView as F,MenuBarMenuListItemView as L,MenuBarMenuListItemButtonView as S,ButtonView as $}from"@ckeditor/ckeditor5-ui";import{DowncastWriter as z,enablePlaceholder as W,hidePlaceholder as E,needsPlaceholder as q,showPlaceholder as U}from"@ckeditor/ckeditor5-engine";/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class j extends N{constructor(e,t){super(e),this.modelElements=t}refresh(){const e=v(this.editor.model.document.selection.getSelectedBlocks());this.value=!!e&&this.modelElements.includes(e.name)&&e.name,this.isEnabled=!!e&&this.modelElements.some(t=>C(e,t,this.editor.model.schema))}execute(e){const t=this.editor.model,n=t.document,o=e.value;t.change(i=>{const a=Array.from(n.selection.getSelectedBlocks()).filter(s=>C(s,o,t.schema));for(const s of a)s.is("element",o)||i.rename(s,o)})}}function C(r,e,t){return t.checkChild(r.parent,e)&&!t.isObject(r)}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/const y="paragraph";class k extends b{static get pluginName(){return"HeadingEditing"}static get isOfficialPlugin(){return!0}constructor(e){super(e),e.config.define("heading",{options:[{model:"paragraph",title:"Paragraph",class:"ck-heading_paragraph"},{model:"heading1",view:"h2",title:"Heading 1",class:"ck-heading_heading1"},{model:"heading2",view:"h3",title:"Heading 2",class:"ck-heading_heading2"},{model:"heading3",view:"h4",title:"Heading 3",class:"ck-heading_heading3"}]})}static get requires(){return[V]}init(){const e=this.editor,t=e.config.get("heading.options"),n=[];for(const o of t)o.model!=="paragraph"&&(e.model.schema.register(o.model,{inheritAllFrom:"$block"}),e.conversion.elementToElement(o),n.push(o.model));this._addDefaultH1Conversion(e),e.commands.add("heading",new j(e,n))}afterInit(){const e=this.editor,t=e.commands.get("enter"),n=e.config.get("heading.options");t&&this.listenTo(t,"afterExecute",(o,i)=>{const a=e.model.document.selection.getFirstPosition().parent;n.some(d=>a.is("element",d.model))&&!a.is("element",y)&&a.childCount===0&&i.writer.rename(a,y)})}_addDefaultH1Conversion(e){e.conversion.for("upcast").elementToElement({model:"heading1",view:"h1",converterPriority:R.low+1})}}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/function x(r){const e=r.t,t={Paragraph:e("Paragraph"),"Heading 1":e("Heading 1"),"Heading 2":e("Heading 2"),"Heading 3":e("Heading 3"),"Heading 4":e("Heading 4"),"Heading 5":e("Heading 5"),"Heading 6":e("Heading 6")};return r.config.get("heading.options").map(n=>{const o=t[n.title];return o&&o!=n.title&&(n.title=o),n})}function G(r,{insertAt:e}={}){if(typeof document>"u")return;const t=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css",window.litNonce&&n.setAttribute("nonce",window.litNonce),e==="top"&&t.firstChild?t.insertBefore(n,t.firstChild):t.appendChild(n),n.styleSheet?n.styleSheet.cssText=r:n.appendChild(document.createTextNode(r))}G(".ck.ck-heading_heading1 .ck-button__label{font-size:20px}.ck.ck-heading_heading2 .ck-button__label{font-size:17px}.ck.ck-heading_heading3 .ck-button__label{font-size:14px}.ck[class*=ck-heading_heading]{font-weight:700}.ck.ck-dropdown.ck-heading-dropdown .ck-dropdown__button .ck-button__label{width:8em}.ck.ck-dropdown.ck-heading-dropdown .ck-dropdown__panel .ck-list__item{min-width:18em}");/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class P extends b{static get pluginName(){return"HeadingUI"}static get isOfficialPlugin(){return!0}init(){const e=this.editor,t=e.t,n=x(e),o=t("Choose heading"),i=t("Heading");e.ui.componentFactory.add("heading",a=>{const s={},d=new M,c=e.commands.get("heading"),g=e.commands.get("paragraph"),u=[c];for(const m of n){const h={type:"button",model:new A({label:m.title,class:m.class,role:"menuitemradio",withText:!0})};m.model==="paragraph"?(h.model.bind("isOn").to(g,"value"),h.model.set("commandName","paragraph"),u.push(g)):(h.model.bind("isOn").to(c,"value",f=>f===m.model),h.model.set({commandName:"heading",commandValue:m.model})),d.add(h),s[m.model]=m.title}const l=I(a);return O(l,d,{ariaLabel:i,role:"menu"}),l.buttonView.set({ariaLabel:i,ariaLabelledBy:void 0,isOn:!1,withText:!0,tooltip:i}),l.extendTemplate({attributes:{class:["ck-heading-dropdown"]}}),l.bind("isEnabled").toMany(u,"isEnabled",(...m)=>m.some(h=>h)),l.buttonView.bind("label").to(c,"value",g,"value",(m,h)=>{const f=h?"paragraph":m;return typeof f=="boolean"||!s[f]?o:s[f]}),l.buttonView.bind("ariaLabel").to(c,"value",g,"value",(m,h)=>{const f=h?"paragraph":m;return typeof f=="boolean"||!s[f]?i:`${s[f]}, ${i}`}),this.listenTo(l,"execute",m=>{const{commandName:h,commandValue:f}=m.source;e.execute(h,f?{value:f}:void 0),e.editing.view.focus()}),l}),e.ui.componentFactory.add("menuBar:heading",a=>{const s=new D(a),d=e.commands.get("heading"),c=e.commands.get("paragraph"),g=[d],u=new F(a);s.set({class:"ck-heading-dropdown"}),u.set({ariaLabel:t("Heading"),role:"menu"}),s.buttonView.set({label:t("Heading")}),s.panelView.children.add(u);for(const l of n){const m=new L(a,s),h=new S(a);m.children.add(h),u.items.add(m),h.set({isToggleable:!0,label:l.title,role:"menuitemradio",class:l.class}),h.delegate("execute").to(s),h.on("execute",()=>{const f=l.model==="paragraph"?"paragraph":"heading";e.execute(f,{value:l.model}),e.editing.view.focus()}),l.model==="paragraph"?(h.bind("isOn").to(c,"value"),g.push(c)):h.bind("isOn").to(d,"value",f=>f===l.model)}return s.bind("isEnabled").toMany(g,"isEnabled",(...l)=>l.some(m=>m)),s})}}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class J extends b{static get requires(){return[k,P]}static get pluginName(){return"Heading"}static get isOfficialPlugin(){return!0}}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/const K={heading1:p.heading1,heading2:p.heading2,heading3:p.heading3,heading4:p.heading4,heading5:p.heading5,heading6:p.heading6};class Q extends b{init(){x(this.editor).filter(t=>t.model!=="paragraph").map(t=>this._createButton(t))}_createButton(e){const t=this.editor;t.ui.componentFactory.add(e.model,n=>{const o=new $(n),i=t.commands.get("heading");return o.label=e.title,o.icon=e.icon||K[e.model],o.tooltip=!0,o.isToggleable=!0,o.bind("isEnabled").to(i),o.bind("isOn").to(i,"value",a=>a==e.model),o.on("execute",()=>{t.execute("heading",{value:e.model}),t.editing.view.focus()}),o})}}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/const _=new Set(["paragraph","heading1","heading2","heading3","heading4","heading5","heading6"]);class X extends b{constructor(){super(...arguments),this._bodyPlaceholder=new Map}static get pluginName(){return"Title"}static get isOfficialPlugin(){return!0}static get requires(){return["Paragraph"]}init(){const e=this.editor,t=e.model;t.schema.register("title",{isBlock:!0,allowIn:"$root"}),t.schema.register("title-content",{isBlock:!0,allowIn:"title",allowAttributes:["alignment"]}),t.schema.extend("$text",{allowIn:"title-content"}),t.schema.addAttributeCheck(n=>{if(n.endsWith("title-content $text"))return!1}),e.editing.mapper.on("modelToViewPosition",T(e.editing.view)),e.data.mapper.on("modelToViewPosition",T(e.editing.view)),e.conversion.for("downcast").elementToElement({model:"title-content",view:"h1"}),e.conversion.for("downcast").add(n=>n.on("insert:title",(o,i,a)=>{a.consumable.consume(i.item,o.name)})),e.data.upcastDispatcher.on("element:h1",w,{priority:"high"}),e.data.upcastDispatcher.on("element:h2",w,{priority:"high"}),e.data.upcastDispatcher.on("element:h3",w,{priority:"high"}),t.document.registerPostFixer(n=>this._fixTitleContent(n)),t.document.registerPostFixer(n=>this._fixTitleElement(n)),t.document.registerPostFixer(n=>this._fixBodyElement(n)),t.document.registerPostFixer(n=>this._fixExtraParagraph(n)),this._attachPlaceholders(),this._attachTabPressHandling()}getTitle(e={}){const t=e.rootName?e.rootName:void 0,o=this._getTitleElement(t).getChild(0);return this.editor.data.stringify(o,e)}getBody(e={}){const t=this.editor,n=t.data,o=t.model,i=e.rootName?e.rootName:void 0,a=t.model.document.getRoot(i),s=t.editing.view,d=new z(s.document),c=o.createRangeIn(a),g=d.createDocumentFragment(),u=o.createPositionAfter(a.getChild(0)),l=o.createRange(u,o.createPositionAt(a,"end")),m=new Map;for(const h of o.markers){const f=l.getIntersection(h.getRange());f&&m.set(h.name,f)}return n.mapper.clearBindings(),n.mapper.bindElements(a,g),n.downcastDispatcher.convert(c,m,d,e),d.remove(d.createRangeOn(g.getChild(0))),t.data.processor.toData(g)}_getTitleElement(e){const t=this.editor.model.document.getRoot(e);for(const n of t.getChildren())if(H(n))return n}_fixTitleContent(e){let t=!1;for(const n of this.editor.model.document.getRootNames()){const o=this._getTitleElement(n);if(!o||o.maxOffset===1)continue;const i=Array.from(o.getChildren());i.shift();for(const a of i)e.move(e.createRangeOn(a),o,"after"),e.rename(a,"paragraph");t=!0}return t}_fixTitleElement(e){let t=!1;const n=this.editor.model;for(const o of this.editor.model.document.getRoots()){const i=Array.from(o.getChildren()).filter(H),a=i[0],s=o.getChild(0);if(s.is("element","title")){i.length>1&&(B(i,e,n),t=!0);continue}if(!a&&!_.has(s.name)){const d=e.createElement("title");e.insert(d,o),e.insertElement("title-content",d),t=!0;continue}_.has(s.name)?Y(s,e,n):e.move(e.createRangeOn(a),o,0),B(i,e,n),t=!0}return t}_fixBodyElement(e){let t=!1;for(const n of this.editor.model.document.getRootNames()){const o=this.editor.model.document.getRoot(n);if(o.childCount<2){const i=e.createElement("paragraph");e.insert(i,o,1),this._bodyPlaceholder.set(n,i),t=!0}}return t}_fixExtraParagraph(e){let t=!1;for(const n of this.editor.model.document.getRootNames()){const o=this.editor.model.document.getRoot(n),i=this._bodyPlaceholder.get(n);ee(i,o)&&(this._bodyPlaceholder.delete(n),e.remove(i),t=!0)}return t}_attachPlaceholders(){const e=this.editor,t=e.t,n=e.editing.view,o=e.sourceElement,i=e.config.get("title.placeholder")||t("Type your title"),a=e.config.get("placeholder")||o&&o.tagName.toLowerCase()==="textarea"&&o.getAttribute("placeholder")||t("Type or paste your content here.");e.editing.downcastDispatcher.on("insert:title-content",(d,c,g)=>{const u=g.mapper.toViewElement(c.item);u.placeholder=i,W({view:n,element:u,keepOnFocus:!0})});const s=new Map;n.document.registerPostFixer(d=>{let c=!1;for(const g of n.document.roots){if(g.isEmpty)continue;const u=g.getChild(1),l=s.get(g.rootName);u!==l&&(l&&(E(d,l),d.removeAttribute("data-placeholder",l)),d.setAttribute("data-placeholder",a,u),s.set(g.rootName,u),c=!0),q(u,!0)&&g.childCount===2&&u.name==="p"?c=U(d,u)?!0:c:c=E(d,u)?!0:c}return c})}_attachTabPressHandling(){const e=this.editor,t=e.model;e.keystrokes.set("TAB",(n,o)=>{t.change(i=>{const a=t.document.selection,s=Array.from(a.getSelectedBlocks());if(s.length===1&&s[0].is("element","title-content")){const c=a.getFirstPosition().root.getChild(1);i.setSelection(c,0),o()}})}),e.keystrokes.set("SHIFT + TAB",(n,o)=>{t.change(i=>{const a=t.document.selection;if(!a.isCollapsed)return;const s=v(a.getSelectedBlocks()),d=a.getFirstPosition(),c=e.model.document.getRoot(d.root.rootName),g=c.getChild(0),u=c.getChild(1);s===u&&d.isAtStart&&(i.setSelection(g.getChild(0),0),o())})})}}function w(r,e,t){const n=e.modelCursor,o=e.viewItem;if(!n.isAtStart||!n.parent.is("element","$root")||!t.consumable.consume(o,{name:!0}))return;const i=t.writer,a=i.createElement("title"),s=i.createElement("title-content");i.append(s,a),i.insert(a,n),t.convertChildren(o,s),t.updateConversionResult(a,e)}function T(r){return(e,t)=>{const n=t.modelPosition.parent;if(!n.is("element","title"))return;const o=n.parent,i=t.mapper.toViewElement(o);t.viewPosition=r.createPositionAt(i,0),e.stop()}}function H(r){return r.is("element","title")}function Y(r,e,t){const n=e.createElement("title");e.insert(n,r,"before"),e.insert(r,n,0),e.rename(r,"title-content"),t.schema.removeDisallowedAttributes([r],e)}function B(r,e,t){let n=!1;for(const o of r)o.index!==0&&(Z(o,e,t),n=!0);return n}function Z(r,e,t){const n=r.getChild(0);if(n.isEmpty){e.remove(r);return}e.move(e.createRangeOn(n),r,"before"),e.rename(n,"paragraph"),e.remove(r),t.schema.removeDisallowedAttributes([n],e)}function ee(r,e){return!(!r||!r.is("element","paragraph")||r.childCount||e.childCount<=2||e.getChild(e.childCount-1)!==r)}export{J as Heading,Q as HeadingButtonsUI,k as HeadingEditing,P as HeadingUI,X as Title};
