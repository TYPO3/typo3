import{Command as e,Plugin as t}from"@ckeditor/ckeditor5-core";import{getLanguageDirection as a,Collection as n}from"@ckeditor/ckeditor5-utils";import{createDropdown as i,addListToDropdown as o,MenuBarMenuView as r,MenuBarMenuListView as g,ListSeparatorView as s,MenuBarMenuListItemView as l,MenuBarMenuListItemButtonView as u,ViewModel as d}from"@ckeditor/ckeditor5-ui";
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */function c(e,t){return`${e}:${t=t||a(e)}`}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */
class m extends e{refresh(){const e=this.editor.model,t=e.document;this.value=this._getValueFromFirstAllowedNode(),this.isEnabled=e.schema.checkAttributeInSelection(t.selection,"language")}execute({languageCode:e,textDirection:t}={}){const a=this.editor.model,n=a.document.selection,i=!!e&&c(e,t);a.change((e=>{if(n.isCollapsed)i?e.setSelectionAttribute("language",i):e.removeSelectionAttribute("language");else{const t=a.schema.getValidRanges(n.getRanges(),"language");for(const a of t)i?e.setAttribute("language",i,a):e.removeAttribute("language",a)}}))}_getValueFromFirstAllowedNode(){const e=this.editor.model,t=e.schema,a=e.document.selection;if(a.isCollapsed)return a.getAttribute("language")||!1;for(const e of a.getRanges())for(const a of e.getItems())if(t.checkAttribute(a,"language"))return a.getAttribute("language")||!1;return!1}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class b extends t{static get pluginName(){return"TextPartLanguageEditing"}static get isOfficialPlugin(){return!0}constructor(e){super(e),e.config.define("language",{textPartLanguage:[{title:"Arabic",languageCode:"ar"},{title:"French",languageCode:"fr"},{title:"Spanish",languageCode:"es"}]})}init(){const e=this.editor;e.model.schema.extend("$text",{allowAttributes:"language"}),e.model.schema.setAttributeProperties("language",{copyOnEnter:!0}),this._defineConverters(),e.commands.add("textPartLanguage",new m(e))}_defineConverters(){const e=this.editor.conversion;e.for("upcast").elementToAttribute({model:{key:"language",value:e=>c(e.getAttribute("lang"),e.getAttribute("dir"))},view:{name:"span",attributes:{lang:/[\s\S]+/}}}),e.for("downcast").attributeToElement({model:"language",view:(e,{writer:t},a)=>{if(!e)return;if(!a.item.is("$textProxy")&&!a.item.is("documentSelection"))return;const{languageCode:n,textDirection:i}=function(e){const[t,a]=e.split(":");return{languageCode:t,textDirection:a}}(e);return t.createAttributeElement("span",{lang:n,dir:i})}})}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class f extends t{static get pluginName(){return"TextPartLanguageUI"}static get isOfficialPlugin(){return!0}init(){const e=this.editor,t=e.t,a=t("Choose language"),n=t("Language");e.ui.componentFactory.add("textPartLanguage",(t=>{const{definitions:r,titles:g}=this._getItemMetadata(),s=e.commands.get("textPartLanguage"),l=i(t);return o(l,r,{ariaLabel:n,role:"menu"}),l.buttonView.set({ariaLabel:n,ariaLabelledBy:void 0,isOn:!1,withText:!0,tooltip:n}),l.extendTemplate({attributes:{class:["ck-text-fragment-language-dropdown"]}}),l.bind("isEnabled").to(s,"isEnabled"),l.buttonView.bind("label").to(s,"value",(e=>e&&g[e]||a)),l.buttonView.bind("ariaLabel").to(s,"value",(e=>{const t=e&&g[e];return t?`${t}, ${n}`:n})),this.listenTo(l,"execute",(t=>{s.execute({languageCode:t.source.languageCode,textDirection:t.source.textDirection}),e.editing.view.focus()})),l})),e.ui.componentFactory.add("menuBar:textPartLanguage",(a=>{const{definitions:i}=this._getItemMetadata(),o=e.commands.get("textPartLanguage"),d=new r(a);d.buttonView.set({label:n});const c=new g(a);c.set({ariaLabel:t("Language"),role:"menu"});for(const e of i){if("button"!=e.type){c.items.add(new s(a));continue}const t=new l(a,d),n=new u(a);n.set({role:"menuitemradio",isToggleable:!0}),n.bind(...Object.keys(e.model)).to(e.model),n.delegate("execute").to(d),t.children.add(n),c.items.add(t)}return d.bind("isEnabled").to(o,"isEnabled"),d.panelView.children.add(c),d.on("execute",(t=>{o.execute({languageCode:t.source.languageCode,textDirection:t.source.textDirection}),e.editing.view.focus()})),d}))}_getItemMetadata(){const e=this.editor,t=new n,a={},i=e.commands.get("textPartLanguage"),o=e.config.get("language.textPartLanguage"),r=(0,e.locale.t)("Remove language");t.add({type:"button",model:new d({label:r,languageCode:!1,withText:!0})}),t.add({type:"separator"});for(const e of o){const n={type:"button",model:new d({label:e.title,languageCode:e.languageCode,role:"menuitemradio",textDirection:e.textDirection,withText:!0})},o=c(e.languageCode,e.textDirection);n.model.bind("isOn").to(i,"value",(e=>e===o)),t.add(n),a[o]=e.title}return{definitions:t,titles:a}}}
/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class x extends t{static get requires(){return[b,f]}static get pluginName(){return"TextPartLanguage"}static get isOfficialPlugin(){return!0}}export{x as TextPartLanguage,b as TextPartLanguageEditing,f as TextPartLanguageUI};