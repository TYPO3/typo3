import{Plugin as a}from"@ckeditor/ckeditor5-core";import{Template as h,View as u}from"@ckeditor/ckeditor5-ui";import{env as l}from"@ckeditor/ckeditor5-utils";import{throttle as g,isElement as p}from"lodash-es";/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/function c(r){if(r.is("$text")||r.is("$textProxy"))return r.data;const t=r;let e="",s=null;for(const i of t.getChildren()){const o=c(i);s&&s.is("element")&&(e+=`
`),e+=o,s=i}return e}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class f extends a{constructor(t){super(t),this.set("characters",0),this.set("words",0),Object.defineProperties(this,{characters:{get(){return this.characters=this._getCharacters(this._getText())}},words:{get(){return this.words=this._getWords(this._getText())}}}),this.set("_wordsLabel",void 0),this.set("_charactersLabel",void 0),this._config=t.config.get("wordCount")||{},this._outputView=void 0,this._wordsMatchRegExp=l.features.isRegExpUnicodePropertySupported?new RegExp("([\\p{L}\\p{N}]+\\S?)+","gu"):/([a-zA-Z0-9À-ž]+\S?)+/gu}static get pluginName(){return"WordCount"}static get isOfficialPlugin(){return!0}init(){this.editor.model.document.on("change:data",g(this._refreshStats.bind(this),250)),typeof this._config.onUpdate=="function"&&this.on("update",(e,s)=>{this._config.onUpdate(s)}),p(this._config.container)&&this._config.container.appendChild(this.wordCountContainer)}destroy(){this._outputView&&(this._outputView.element.remove(),this._outputView.destroy()),super.destroy()}get wordCountContainer(){const t=this.editor,e=t.t,s=t.config.get("wordCount.displayWords"),i=t.config.get("wordCount.displayCharacters"),o=h.bind(this,this),n=[];return this._outputView||(this._outputView=new u,(s||s===void 0)&&(this.bind("_wordsLabel").to(this,"words",d=>e("Words: %0",d)),n.push({tag:"div",children:[{text:[o.to("_wordsLabel")]}],attributes:{class:"ck-word-count__words"}})),(i||i===void 0)&&(this.bind("_charactersLabel").to(this,"characters",d=>e("Characters: %0",d)),n.push({tag:"div",children:[{text:[o.to("_charactersLabel")]}],attributes:{class:"ck-word-count__characters"}})),this._outputView.setTemplate({tag:"div",attributes:{class:["ck","ck-word-count"]},children:n}),this._outputView.render()),this._outputView.element}_getText(){let t="";for(const e of this.editor.model.document.getRoots())t!==""&&(t+=`
`),t+=c(e);return t}_getCharacters(t){return t.replace(/\n/g,"").length}_getWords(t){return(t.match(this._wordsMatchRegExp)||[]).length}_refreshStats(){const t=this._getText(),e=this.words=this._getWords(t),s=this.characters=this._getCharacters(t);this.fire("update",{words:e,characters:s})}}export{f as WordCount};
