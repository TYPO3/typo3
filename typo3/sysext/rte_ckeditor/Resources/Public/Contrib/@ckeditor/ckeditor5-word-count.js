import{Plugin as t}from"@ckeditor/ckeditor5-core";import{Template as e,View as r}from"@ckeditor/ckeditor5-ui";import{env as s}from"@ckeditor/ckeditor5-utils";import{throttle as i,isElement as o}from"lodash-es";
/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function n(t){if(t.is("$text")||t.is("$textProxy"))return t.data;const e=t;let r="",s=null;for(const t of e.getChildren()){const e=n(t);s&&s.is("element")&&(r+="\n"),r+=e,s=t}return r}
/**
 * @license Copyright (c) 2003-2023, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class h extends t{constructor(t){super(t),this.set("characters",0),this.set("words",0),Object.defineProperties(this,{characters:{get(){return this.characters=this._getCharacters(this._getText())}},words:{get(){return this.words=this._getWords(this._getText())}}}),this.set("_wordsLabel",void 0),this.set("_charactersLabel",void 0),this._config=t.config.get("wordCount")||{},this._outputView=void 0,this._wordsMatchRegExp=s.features.isRegExpUnicodePropertySupported?new RegExp("([\\p{L}\\p{N}]+\\S?)+","gu"):/([a-zA-Z0-9À-ž]+\S?)+/gu}static get pluginName(){return"WordCount"}init(){this.editor.model.document.on("change:data",i(this._refreshStats.bind(this),250)),"function"==typeof this._config.onUpdate&&this.on("update",((t,e)=>{this._config.onUpdate(e)})),o(this._config.container)&&this._config.container.appendChild(this.wordCountContainer)}destroy(){this._outputView&&(this._outputView.element.remove(),this._outputView.destroy()),super.destroy()}get wordCountContainer(){const t=this.editor,s=t.t,i=t.config.get("wordCount.displayWords"),o=t.config.get("wordCount.displayCharacters"),n=e.bind(this,this),h=[];return this._outputView||(this._outputView=new r,(i||void 0===i)&&(this.bind("_wordsLabel").to(this,"words",(t=>s("Words: %0",t))),h.push({tag:"div",children:[{text:[n.to("_wordsLabel")]}],attributes:{class:"ck-word-count__words"}})),(o||void 0===o)&&(this.bind("_charactersLabel").to(this,"characters",(t=>s("Characters: %0",t))),h.push({tag:"div",children:[{text:[n.to("_charactersLabel")]}],attributes:{class:"ck-word-count__characters"}})),this._outputView.setTemplate({tag:"div",attributes:{class:["ck","ck-word-count"]},children:h}),this._outputView.render()),this._outputView.element}_getText(){let t="";for(const e of this.editor.model.document.getRoots())""!==t&&(t+="\n"),t+=n(e);return t}_getCharacters(t){return t.replace(/\n/g,"").length}_getWords(t){return(t.match(this._wordsMatchRegExp)||[]).length}_refreshStats(){const t=this._getText(),e=this.words=this._getWords(t),r=this.characters=this._getCharacters(t);this.fire("update",{words:e,characters:r})}}export{h as WordCount};