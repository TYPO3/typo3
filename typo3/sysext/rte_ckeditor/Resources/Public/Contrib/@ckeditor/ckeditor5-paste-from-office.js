import{Plugin as T}from"@ckeditor/ckeditor5-core";import{ClipboardPipeline as P}from"@ckeditor/ckeditor5-clipboard";import{UpcastWriter as h,Matcher as b,ViewDocument as x,DomConverter as v}from"@ckeditor/ckeditor5-engine";/**
* @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/function R(e,t){const n=[];for(const s of t.createRangeIn(e)){const i=s.item;i.is("element","a")&&!i.hasAttribute("href")&&(i.hasAttribute("id")||i.hasAttribute("name"))&&n.push(i)}for(const s of n){const i=s.parent.getChildIndex(s)+1,r=s.getChildren();t.insertChild(i,r,s.parent)}}/**
* @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/function S(e){const t=parseFloat(e);return e.endsWith("pt")?y(t*96/72):e.endsWith("pc")?y(t*12*96/72):e.endsWith("in")?y(t*96):e.endsWith("cm")?y(t*96/2.54):e.endsWith("mm")?y(t/10*96/2.54):e}function I(e){return e!==void 0&&e.endsWith("px")}function y(e){return Math.round(e)+"px"}/**
* @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/function W(e,t,n){if(!e.childCount)return;const s=new h(e.document),i=N(e,s);if(!i.length)return;const r={},l=[];for(const o of i)if(o.indent!==void 0){$(o)||(l.length=0);const a=`${o.id}:${o.indent}`,c=Math.min(o.indent-1,l.length);if(c<l.length&&l[c].id!==o.id&&(l.length=c),c<l.length-1)l.length=c+1;else{const m=B(o,t);if(c>l.length-1||l[c].listElement.name!=m.type){c==0&&m.type=="ol"&&o.id!==void 0&&r[a]&&(m.startIndex=r[a]);const d=j(m,s,n);if(I(o.marginLeft)&&(c==0||I(l[c-1].marginLeft))){let u=o.marginLeft;c>0&&(u=y(parseFloat(u)-parseFloat(l[c-1].marginLeft))),s.setStyle("padding-left",u,d)}if(l.length==0){const u=o.element.parent,g=u.getChildIndex(o.element)+1;s.insertChild(g,d,u)}else{const u=l[c-1].listItemElements;s.appendChild(d,u[u.length-1])}l[c]={...o,listElement:d,listItemElements:[]},c==0&&o.id!==void 0&&(r[a]=m.startIndex||1)}}const f=o.element.name=="li"?o.element:s.createElement("li");s.appendChild(f,l[c].listElement),l[c].listItemElements.push(f),c==0&&o.id!==void 0&&r[a]++,o.element!=f&&s.appendChild(o.element,f),F(o.element,s),s.removeStyle("text-indent",o.element),s.removeStyle("margin-left",o.element)}else{const a=l.find(c=>c.marginLeft==o.marginLeft);if(a){const c=a.listItemElements;s.appendChild(o.element,c[c.length-1]),s.removeStyle("margin-left",o.element)}else l.length=0}}function k(e,t){for(const n of t.createRangeIn(e)){const s=n.item;if(s.is("element","li")){const i=s.getChild(0);i&&i.is("element","p")&&t.unwrapElement(i)}}}function N(e,t){const n=t.createRangeIn(e),s=[],i=new Set;for(const r of n.getItems()){if(!r.is("element")||!r.name.match(/^(p|h\d+|li|div)$/))continue;let l=H(r);if(l!==void 0&&parseFloat(l)==0&&!Array.from(r.getClassNames()).find(o=>o.startsWith("MsoList"))&&(l=void 0),r.hasStyle("mso-list")||l!==void 0&&i.has(l)){const o=_(r);s.push({element:r,id:o.id,order:o.order,indent:o.indent,marginLeft:l}),l!==void 0&&i.add(l)}else i.clear()}return s}function $(e){const t=e.element.previousSibling;return C(t||e.element.parent)}function C(e){return e.is("element","ol")||e.is("element","ul")}function B(e,t){const n=new RegExp(`@list l${e.id}:level${e.indent}\\s*({[^}]*)`,"gi"),s=/mso-level-number-format:([^;]{0,100});/gi,i=/mso-level-start-at:\s{0,100}([0-9]{0,10})\s{0,100};/gi,r=new RegExp(`@list\\s+l${e.id}:level\\d\\s*{[^{]*mso-level-text:"%\\d\\\\.`,"gi"),l=new RegExp(`@list l${e.id}:level\\d\\s*{[^{]*mso-level-number-format:`,"gi"),o=r.exec(t),a=l.exec(t),c=o&&!a,f=n.exec(t);let m="decimal",d="ol",u=null;if(f&&f[1]){const g=s.exec(f[1]);if(g&&g[1]&&(m=g[1].trim(),d=m!=="bullet"&&m!=="image"?"ol":"ul"),m==="bullet"){const p=D(e.element);p&&(m=p)}else{const p=i.exec(f[1]);p&&p[1]&&(u=parseInt(p[1]))}c&&(d="ol")}return{type:d,startIndex:u,style:z(m),isLegalStyleList:c}}function D(e){if(e.name=="li"&&e.parent.name=="ul"&&e.parent.hasAttribute("type"))return e.parent.getAttribute("type");const t=O(e);if(!t)return null;const n=t._data;return n==="o"?"circle":n==="\xB7"?"disc":n==="\xA7"?"square":null}function O(e){if(e.getChild(0).is("$text"))return null;for(const t of e.getChildren()){if(!t.is("element","span"))continue;const n=t.getChild(0);if(n)return n.is("$text")?n:n.getChild(0)}/* istanbul ignore next -- @preserve */return null}function z(e){if(e.startsWith("arabic-leading-zero"))return"decimal-leading-zero";switch(e){case"alpha-upper":return"upper-alpha";case"alpha-lower":return"lower-alpha";case"roman-upper":return"upper-roman";case"roman-lower":return"lower-roman";case"circle":case"disc":case"square":return e;default:return null}}function j(e,t,n){const s=t.createElement(e.type);return e.style&&t.setStyle("list-style-type",e.style,s),e.startIndex&&e.startIndex>1&&t.setAttribute("start",e.startIndex,s),e.isLegalStyleList&&n&&t.addClass("legal-list",s),s}function _(e){const t=e.getStyle("mso-list");if(t===void 0)return{};const n=t.match(/(^|\s{1,100})l(\d+)/i),s=t.match(/\s{0,100}lfo(\d+)/i),i=t.match(/\s{0,100}level(\d+)/i);return n&&s&&i?{id:n[2],order:s[1],indent:parseInt(i[1])}:{indent:1}}function F(e,t){const n=new b({name:"span",styles:{"mso-list":"Ignore"}}),s=t.createRangeIn(e);for(const i of s)i.type==="elementStart"&&n.match(i.item)&&t.remove(i.item)}function H(e){const t=e.getStyle("margin-left");return t===void 0||t.endsWith("px")?t:S(t)}/**
* @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/function V(e,t){if(!e.childCount)return;const n=new h(e.document),s=G(e,n);U(s,e,n),J(s,e,n),X(e,n);const i=K(e,n);i.length&&Y(i,Q(t),n)}function q(e){return btoa(e.match(/\w{2}/g).map(t=>String.fromCharCode(parseInt(t,16))).join(""))}function G(e,t){const n=t.createRangeIn(e),s=new b({name:/v:(.+)/}),i=[];for(const r of n){if(r.type!="elementStart")continue;const l=r.item,o=l.previousSibling,a=o&&o.is("element")?o.name:null,c=["Chart"],f=s.match(l),m=l.getAttribute("o:gfxdata"),d=a==="v:shapetype",u=m&&c.some(g=>l.getAttribute("id").includes(g));f&&m&&!d&&!u&&i.push(r.item.getAttribute("id"))}return i}function U(e,t,n){const s=n.createRangeIn(t),i=new b({name:"img"}),r=[];for(const l of s)if(l.item.is("element")&&i.match(l.item)){const o=l.item,a=o.getAttribute("v:shapes")?o.getAttribute("v:shapes").split(" "):[];a.length&&a.every(c=>e.indexOf(c)>-1)?r.push(o):o.getAttribute("src")||r.push(o)}for(const l of r)n.remove(l)}function X(e,t){const n=t.createRangeIn(e),s=new b({name:/v:(.+)/}),i=[];for(const r of n)r.type=="elementStart"&&s.match(r.item)&&i.push(r.item);for(const r of i)t.remove(r)}function J(e,t,n){const s=n.createRangeIn(t),i=[];for(const o of s)if(o.type=="elementStart"&&o.item.is("element","v:shape")){const a=o.item.getAttribute("id");if(e.includes(a))continue;r(o.item.parent.getChildren(),a)||i.push(o.item)}for(const o of i){const a={src:l(o)};o.hasAttribute("alt")&&(a.alt=o.getAttribute("alt"));const c=n.createElement("img",a);n.insertChild(o.index+1,c,o.parent)}function r(o,a){for(const c of o){/* istanbul ignore else -- @preserve */if(c.is("element")&&(c.name=="img"&&c.getAttribute("v:shapes")==a||r(c.getChildren(),a)))return!0}return!1}function l(o){for(const a of o.getChildren()){/* istanbul ignore else -- @preserve */if(a.is("element")&&a.getAttribute("src"))return a.getAttribute("src")}}}function K(e,t){const n=t.createRangeIn(e),s=new b({name:"img"}),i=[];let r=0;for(const l of n)l.item.is("element")&&s.match(l.item)&&(l.item.getAttribute("src").startsWith("file://")&&i.push({element:l.item,imageIndex:r}),r++);return i}function Q(e){if(!e)return[];const t=/{\\pict[\s\S]+?\\bliptag-?\d+(\\blipupi-?\d+)?({\\\*\\blipuid\s?[\da-fA-F]+)?[\s}]*?/,n=new RegExp("(?:("+t.source+"))([\\da-fA-F\\s]+)\\}","g"),s=e.match(n),i=[];if(s)for(const r of s){let l=!1;r.includes("\\pngblip")?l="image/png":r.includes("\\jpegblip")&&(l="image/jpeg"),l&&i.push({hex:r.replace(t,"").replace(/[^\da-fA-F]/g,""),type:l})}return i}function Y(e,t,n){for(let s=0;s<e.length;s++){const{element:i,imageIndex:r}=e[s],l=t[r];if(l){const o=`data:${l.type};base64,${q(l.hex)}`;n.setAttribute("src",o,i)}}}/**
* @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/function Z(e){const t=[],n=new h(e.document);for(const{item:s}of n.createRangeIn(e))if(s.is("element")){for(const i of s.getClassNames())/\bmso/gi.exec(i)&&n.removeClass(i,s);for(const i of s.getStyleNames())/\bmso/gi.exec(i)&&n.removeStyle(i,s);(s.is("element","w:sdt")||s.is("element","w:sdtpr")&&s.isEmpty||s.is("element","o:p")&&s.isEmpty)&&t.push(s)}for(const s of t){const i=s.parent,r=i.getChildIndex(s);n.insertChild(r,s.getChildren(),i),n.remove(s)}}/**
* @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/function ee(e,t){for(const n of t.createRangeIn(e).getItems()){if(!n.is("element","table")&&!n.is("element","td")&&!n.is("element","th"))continue;const s=["left","top","right","bottom"];if(s.every(r=>!n.hasStyle(`border-${r}-style`)))t.setStyle("border-style","none",n);else for(const r of s)n.hasStyle(`border-${r}-style`)||t.setStyle(`border-${r}-style`,"none",n);const i=["width","height",...s.map(r=>`border-${r}-width`),...s.map(r=>`padding-${r}`)];for(const r of i)n.hasStyle(r)&&t.setStyle(r,S(n.getStyle(r)),n)}}/**
* @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/const te=/<meta\s*name="?generator"?\s*content="?microsoft\s*word\s*\d+"?\/?>/i,ne=/xmlns:o="urn:schemas-microsoft-com/i;class A{document;hasMultiLevelListPlugin;constructor(t,n=!1){this.document=t,this.hasMultiLevelListPlugin=n}isActive(t){return te.test(t)||ne.test(t)}execute(t){const n=new h(this.document),{body:s,stylesString:i}=t._parsedData;R(s,n),W(s,i,this.hasMultiLevelListPlugin),V(s,t.dataTransfer.getData("text/rtf")),ee(s,n),Z(s),t.content=s}}/**
* @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/function se(e,t){for(const n of e.getChildren())if(n.is("element","b")&&n.getStyle("font-weight")==="normal"){const s=e.getChildIndex(n);t.remove(n),t.insertChild(s,n.getChildren(),e)}}/**
* @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/function ie(e,t){const n=new x(t.document.stylesProcessor),s=new v(n,{renderingMode:"data"}),i=s.blockElements,r=s.inlineObjectElements,l=[];for(const o of t.createRangeIn(e)){const a=o.item;if(a.is("element","br")){const c=L(a,"forward",t,{blockElements:i,inlineObjectElements:r}),f=L(a,"backward",t,{blockElements:i,inlineObjectElements:r}),m=E(c,i);(E(f,i)||m)&&l.push(a)}}for(const o of l)o.hasClass("Apple-interchange-newline")?t.remove(o):t.replace(o,t.createElement("p"))}function L(e,t,n,{blockElements:s,inlineObjectElements:i}){let r=n.createPositionAt(e,t=="forward"?"after":"before");return r=r.getLastMatchingPosition(({item:l})=>l.is("element")&&!s.includes(l.name)&&!i.includes(l.name),{direction:t}),t=="forward"?r.nodeAfter:r.nodeBefore}function E(e,t){return!!e&&e.is("element")&&t.includes(e.name)}/**
* @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/const oe=/id=("|')docs-internal-guid-[-0-9a-f]+("|')/i;class re{document;constructor(t){this.document=t}isActive(t){return oe.test(t)}execute(t){const n=new h(this.document),{body:s}=t._parsedData;se(s,n),k(s,n),ie(s,n),t.content=s}}/**
* @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/function le(e,t){for(const n of e.getChildren())n.is("element","table")&&n.hasAttribute("xmlns")&&t.removeAttribute("xmlns",n)}/**
* @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/function ce(e,t){for(const n of e.getChildren())if(n.is("element","google-sheets-html-origin")){const s=e.getChildIndex(n);t.remove(n),t.insertChild(s,n.getChildren(),e)}}/**
* @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/function ae(e,t){for(const n of e.getChildren())n.is("element","table")&&n.getStyle("width")==="0px"&&t.removeStyle("width",n)}/**
* @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/function me(e,t){for(const n of Array.from(e.getChildren()))n.is("element","style")&&t.remove(n)}/**
* @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/const fe=/<google-sheets-html-origin/i;class ue{document;constructor(t){this.document=t}isActive(t){return fe.test(t)}execute(t){const n=new h(this.document),{body:s}=t._parsedData;ce(s,n),le(s,n),ae(s,n),me(s,n),t.content=s}}/**
* @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/function de(e){return w(w(e)).replace(/(<span\s+style=['"]mso-spacerun:yes['"]>[^\S\r\n]*?)[\r\n]+([^\S\r\n]*<\/span>)/g,"$1$2").replace(/<span\s+style=['"]mso-spacerun:yes['"]><\/span>/g,"").replace(/(<span\s+style=['"]letter-spacing:[^'"]+?['"]>)[\r\n]+(<\/span>)/g,"$1 $2").replace(/ <\//g,"\xA0</").replace(/ <o:p><\/o:p>/g,"\xA0<o:p></o:p>").replace(/<o:p>(&nbsp;|\u00A0)<\/o:p>/g,"").replace(/>([^\S\r\n]*[\r\n]\s*)</g,"><")}function ge(e){e.querySelectorAll("span[style*=spacerun]").forEach(t=>{const n=t,s=n.innerText.length||0;n.innerText=Array(s+1).join("\xA0 ").substr(0,s)})}function w(e){return e.replace(/<span(?: class="Apple-converted-space"|)>(\s+)<\/span>/g,(t,n)=>n.length===1?" ":Array(n.length+1).join("\xA0 ").substr(0,n.length))}/**
* @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/function M(e,t){const n=new DOMParser;e=e.replace(/<!--\[if gte vml 1]>/g,""),e=e.replace(/<o:SmartTagType(?:\s+[^\s>=]+(?:="[^"]*")?)*\s*\/?>/gi,"");const s=de(ye(e)),i=n.parseFromString(s,"text/html");ge(i);const r=i.body.innerHTML,l=pe(i,t),o=he(i);return{body:l,bodyString:r,styles:o.styles,stylesString:o.stylesString}}function pe(e,t){const n=new x(t),s=new v(n,{renderingMode:"data"}),i=e.createDocumentFragment(),r=e.body.childNodes;for(;r.length>0;)i.appendChild(r[0]);return s.domToView(i,{skipComments:!0})}function he(e){const t=[],n=[],s=Array.from(e.getElementsByTagName("style"));for(const i of s)i.sheet&&i.sheet.cssRules&&i.sheet.cssRules.length&&(t.push(i.sheet),n.push(i.innerHTML));return{styles:t,stylesString:n.join(" ")}}function ye(e){const t="</body>",n="</html>",s=e.indexOf(t);if(s<0)return e;const i=e.indexOf(n,s+t.length);return e.substring(0,s+t.length)+(i>=0?e.substring(i):"")}/**
* @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class be extends T{static get pluginName(){return"PasteFromOffice"}static get isOfficialPlugin(){return!0}static get requires(){return[P]}init(){const t=this.editor,n=t.plugins.get("ClipboardPipeline"),s=t.editing.view.document,i=[],r=this.editor.plugins.has("MultiLevelList");i.push(new A(s,r)),i.push(new re(s)),i.push(new ue(s)),n.on("inputTransformation",(l,o)=>{if(o._isTransformedWithPasteFromOffice||t.model.document.selection.getFirstPosition().parent.is("element","codeBlock"))return;const c=o.dataTransfer.getData("text/html"),f=i.find(m=>m.isActive(c));f&&(o._parsedData||(o._parsedData=M(c,s.stylesProcessor)),f.execute(o),o._isTransformedWithPasteFromOffice=!0)},{priority:"high"})}}export{A as MSWordNormalizer,be as PasteFromOffice,M as parseHtml};
