import{Command as B,Plugin as f,icons as d}from"@ckeditor/ckeditor5-core";import{logWarning as T,CKEditorError as b,first as E}from"@ckeditor/ckeditor5-utils";import{ButtonView as k,createDropdown as D,addToolbarToDropdown as V,MenuBarMenuView as M,MenuBarMenuListView as N,MenuBarMenuListItemView as O,MenuBarMenuListItemButtonView as _}from"@ckeditor/ckeditor5-ui";/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/const h=["left","right","center","justify"];function w(i){return h.includes(i)}function A(i,e){return e.contentLanguageDirection=="rtl"?i==="right":i==="left"}function v(i){const e=i.map(t=>{let o;return typeof t=="string"?o={name:t}:o=t,o}).filter(t=>{const o=h.includes(t.name);return o||T("alignment-config-name-not-recognized",{option:t}),o}),n=e.filter(t=>!!t.className).length;if(n&&n<e.length)throw new b("alignment-config-classnames-are-missing",{configuredOptions:i});return e.forEach((t,o,a)=>{const s=a.slice(o+1);if(s.some(r=>r.name==t.name))throw new b("alignment-config-name-already-defined",{option:t,configuredOptions:i});if(t.className&&s.some(l=>l.className==t.className))throw new b("alignment-config-classname-already-defined",{option:t,configuredOptions:i})}),e}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/const p="alignment";class I extends B{refresh(){const n=this.editor.locale,t=E(this.editor.model.document.selection.getSelectedBlocks());this.isEnabled=!!t&&this._canBeAligned(t),this.isEnabled&&t.hasAttribute("alignment")?this.value=t.getAttribute("alignment"):this.value=n.contentLanguageDirection==="rtl"?"right":"left"}execute(e={}){const n=this.editor,t=n.locale,o=n.model,a=o.document,s=e.value;o.change(c=>{const r=Array.from(a.selection.getSelectedBlocks()).filter(g=>this._canBeAligned(g)),l=r[0].getAttribute("alignment");A(s,t)||l===s||!s?L(r,c):C(r,c,s)})}_canBeAligned(e){return this.editor.model.schema.checkAttribute(e,p)}}function L(i,e){for(const n of i)e.removeAttribute(p,n)}function C(i,e,n){for(const t of i)e.setAttribute(p,n,t)}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class y extends f{static get pluginName(){return"AlignmentEditing"}static get isOfficialPlugin(){return!0}constructor(e){super(e),e.config.define("alignment",{options:h.map(n=>({name:n}))})}init(){const e=this.editor,n=e.locale,t=e.model.schema,a=v(e.config.get("alignment.options")).filter(l=>w(l.name)&&!A(l.name,n)),s=a.some(l=>!!l.className);t.extend("$block",{allowAttributes:"alignment"}),e.model.schema.setAttributeProperties("alignment",{isFormatting:!0}),s?e.conversion.attributeToAttribute(S(a)):e.conversion.for("downcast").attributeToAttribute(z(a));const c=F(a);for(const l of c)e.conversion.for("upcast").attributeToAttribute(l);const r=P(a);for(const l of r)e.conversion.for("upcast").attributeToAttribute(l);e.commands.add("alignment",new I(e))}}function z(i){const e={};for(const{name:t}of i)e[t]={key:"style",value:{"text-align":t}};return{model:{key:"alignment",values:i.map(t=>t.name)},view:e}}function F(i){const e=[];for(const{name:n}of i)e.push({view:{key:"style",value:{"text-align":n}},model:{key:"alignment",value:n}});return e}function P(i){const e=[];for(const{name:n}of i)e.push({view:{key:"align",value:n},model:{key:"alignment",value:n}});return e}function S(i){const e={};for(const t of i)e[t.name]={key:"class",value:t.className};return{model:{key:"alignment",values:i.map(t=>t.name)},view:e}}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/const m=new Map([["left",d.alignLeft],["right",d.alignRight],["center",d.alignCenter],["justify",d.alignJustify]]);class x extends f{get localizedOptionTitles(){const e=this.editor.t;return{left:e("Align left"),right:e("Align right"),center:e("Align center"),justify:e("Justify")}}static get pluginName(){return"AlignmentUI"}static get isOfficialPlugin(){return!0}init(){const e=this.editor,n=v(e.config.get("alignment.options"));n.map(t=>t.name).filter(w).forEach(t=>this._addButton(t)),this._addToolbarDropdown(n),this._addMenuBarMenu(n)}_addButton(e){this.editor.ui.componentFactory.add(`alignment:${e}`,t=>this._createButton(t,e))}_createButton(e,n,t={}){const o=this.editor,a=o.commands.get("alignment"),s=new k(e);return s.set({label:this.localizedOptionTitles[n],icon:m.get(n),tooltip:!0,isToggleable:!0,...t}),s.bind("isEnabled").to(a),s.bind("isOn").to(a,"value",c=>c===n),this.listenTo(s,"execute",()=>{o.execute("alignment",{value:n}),o.editing.view.focus()}),s}_addToolbarDropdown(e){const n=this.editor;n.ui.componentFactory.add("alignment",o=>{const a=D(o),s=o.uiLanguageDirection==="rtl"?"w":"e",c=o.t;V(a,()=>e.map(u=>this._createButton(o,u.name,{tooltipPosition:s})),{enableActiveItemFocusOnDropdownOpen:!0,isVertical:!0,ariaLabel:c("Text alignment toolbar")}),a.buttonView.set({label:c("Text alignment"),tooltip:!0}),a.extendTemplate({attributes:{class:"ck-alignment-dropdown"}});const r=o.contentLanguageDirection==="rtl"?m.get("right"):m.get("left"),l=n.commands.get("alignment");return a.buttonView.bind("icon").to(l,"value",u=>m.get(u)||r),a.bind("isEnabled").to(l,"isEnabled"),this.listenTo(a,"execute",()=>{n.editing.view.focus()}),a})}_addMenuBarMenu(e){const n=this.editor;n.ui.componentFactory.add("menuBar:alignment",t=>{const o=n.commands.get("alignment"),a=t.t,s=new M(t),c=new N(t);s.bind("isEnabled").to(o),c.set({ariaLabel:a("Text alignment"),role:"menu"}),s.buttonView.set({label:a("Text alignment")});for(const r of e){const l=new O(t,s),u=new _(t);u.delegate("execute").to(s),u.set({label:this.localizedOptionTitles[r.name],icon:m.get(r.name),role:"menuitemcheckbox",isToggleable:!0}),u.on("execute",()=>{n.execute("alignment",{value:r.name}),n.editing.view.focus()}),u.bind("isOn").to(o,"value",g=>g===r.name),u.bind("isEnabled").to(o,"isEnabled"),l.children.add(u),c.items.add(l)}return s.panelView.children.add(c),s})}}/**
* @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
* For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
*/class U extends f{static get requires(){return[y,x]}static get pluginName(){return"Alignment"}static get isOfficialPlugin(){return!0}}export{U as Alignment,y as AlignmentEditing,x as AlignmentUI};
