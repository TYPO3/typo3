/*
 * This file is part of the TYPO3 CMS project.
 *
 * It is free software; you can redistribute it and/or modify it under
 * the terms of the GNU General Public License, either version 2
 * of the License, or any later version.
 *
 * For the full copyright and license information, please read the
 * LICENSE.txt file that was distributed with this source code.
 *
 * The TYPO3 project - inspiring people to share!
 */
import $ from"jquery";import*as Helper from"@typo3/form/backend/form-editor/helper.js";import Modal from"@typo3/backend/modal.js";import Severity from"@typo3/backend/severity.js";let configuration=null;const defaultConfiguration={domElementClassNames:{buttonDefault:"btn-default",buttonInfo:"btn-info",buttonWarning:"btn-warning"},domElementDataAttributeNames:{elementType:"element-type",fullElementType:"data-element-type"},domElementDataAttributeValues:{rowItem:"rowItem",rowLink:"rowLink",rowsContainer:"rowsContainer",templateInsertElements:"Modal-InsertElements",templateInsertPages:"Modal-InsertPages",templateValidationErrors:"Modal-ValidationErrors"}};let formEditorApp=null;function getFormEditorApp(){return formEditorApp}function getHelper(e){return getUtility().isUndefinedOrNull(e)?Helper.setConfiguration(configuration):Helper.setConfiguration(e)}function getUtility(){return getFormEditorApp().getUtility()}function assert(e,t,o){return getFormEditorApp().assert(e,t,o)}function getRootFormElement(){return getFormEditorApp().getRootFormElement()}function getPublisherSubscriber(){return getFormEditorApp().getPublisherSubscriber()}function getFormElementDefinition(e,t){return getFormEditorApp().getFormElementDefinition(e,t)}function showRemoveElementModal(e,t){const o=[];assert(getUtility().isNonEmptyString(e),'Invalid parameter "publisherTopicName"',1478889049),assert("array"===$.type(t),'Invalid parameter "formElement"',1478889044),o.push({text:getFormElementDefinition(getRootFormElement(),"modalRemoveElementCancelButton"),active:!0,btnClass:getHelper().getDomElementClassName("buttonDefault"),name:"cancel",trigger:(e,t)=>{t.hideModal()}}),o.push({text:getFormElementDefinition(getRootFormElement(),"modalRemoveElementConfirmButton"),active:!0,btnClass:getHelper().getDomElementClassName("buttonWarning"),name:"confirm",trigger:(o,n)=>{getPublisherSubscriber().publish(e,t),n.hideModal()}}),Modal.show(getFormElementDefinition(getRootFormElement(),"modalRemoveElementDialogTitle"),getFormElementDefinition(getRootFormElement(),"modalRemoveElementDialogMessage"),Severity.warning,o)}function insertElementsModalSetup(e,t,o){if(assert(getUtility().isNonEmptyString(t),'Invalid parameter "publisherTopicName"',1478910954),"object"===$.type(o))for(const t of Object.keys(o)){if("disableElementTypes"===t&&"array"===$.type(o[t]))for(let n=0,l=o[t].length;n<l;++n)$(getHelper().getDomElementDataAttribute("fullElementType","bracesWithKeyValue",[o[t][n]]),e).addClass(getHelper().getDomElementClassName("disabled"));"onlyEnableElementTypes"===t&&"array"===$.type(o[t])&&$(getHelper().getDomElementDataAttribute("fullElementType","bracesWithKey"),e).each((function(){for(let e=0,n=o[t].length;e<n;++e){const n=$(this);n.data(getHelper().getDomElementDataAttribute("elementType"))!==o[t][e]&&n.addClass(getHelper().getDomElementClassName("disabled"))}}))}$("button",e).on("click",(function(){getPublisherSubscriber().publish(t,[$(this).data(getHelper().getDomElementDataAttribute("elementType"))]),$("button",e).off(),Modal.currentModal.hideModal()}))}function _validationErrorsModalSetup(e,t){let o,n;assert("array"===$.type(t),'Invalid parameter "validationResults"',1479161268);const l=$(getHelper().getDomElementDataIdentifierSelector("rowItem"),e).clone();$(getHelper().getDomElementDataIdentifierSelector("rowItem"),e).remove();for(let r=0,i=t.length;r<i;++r){let i=!1;for(let e=0,o=t[r].validationResults.length;e<o;++e)if(t[r].validationResults[e].validationResults&&t[r].validationResults[e].validationResults.length>0){i=!0;break}i&&(o=getFormEditorApp().getFormElementByIdentifierPath(t[r].formElementIdentifierPath),n=l.clone(),$(getHelper().getDomElementDataIdentifierSelector("rowLink"),n).attr(getHelper().getDomElementDataAttribute("elementIdentifier"),t[r].formElementIdentifierPath).get(0).replaceChildren(_buildTitleByFormElement(o)),$(getHelper().getDomElementDataIdentifierSelector("rowsContainer"),e).append(n))}$("a",e).on("click",(function(){getPublisherSubscriber().publish("view/modal/validationErrors/element/clicked",[$(this).attr(getHelper().getDomElementDataAttribute("elementIdentifier"))]),$("a",e).off(),Modal.currentModal.hideModal()}))}function _buildTitleByFormElement(e){assert("object"===$.type(e),'Invalid parameter "formElement"',1479162557);const t=document.createElement("span");return t.textContent=e.get("label")?e.get("label"):e.get("identifier"),t}export function showRemoveFormElementModal(e){showRemoveElementModal("view/modal/removeFormElement/perform",[e])}export function showRemoveCollectionElementModal(e,t,o){assert(getUtility().isNonEmptyString(e),'Invalid parameter "collectionElementIdentifier"',1478894420),assert(getUtility().isNonEmptyString(t),'Invalid parameter "collectionName"',1478894421),showRemoveElementModal("view/modal/removeCollectionElement/perform",[e,t,o])}export function showCloseConfirmationModal(){const e=[];e.push({text:getFormElementDefinition(getRootFormElement(),"modalCloseCancelButton"),active:!0,btnClass:getHelper().getDomElementClassName("buttonDefault"),name:"cancel",trigger:(e,t)=>{t.hideModal()}}),e.push({text:getFormElementDefinition(getRootFormElement(),"modalCloseConfirmButton"),active:!0,btnClass:getHelper().getDomElementClassName("buttonWarning"),name:"confirm",trigger:(e,t)=>{getPublisherSubscriber().publish("view/modal/close/perform",[]),t.hideModal()}}),Modal.show(getFormElementDefinition(getRootFormElement(),"modalCloseDialogTitle"),getFormElementDefinition(getRootFormElement(),"modalCloseDialogMessage"),Severity.warning,e)}export function showInsertElementsModal(e,t){const o=getHelper().getTemplate("templateInsertElements");if(o.length>0){const n=$(o.html());insertElementsModalSetup(n,e,t),Modal.show(getFormElementDefinition(getRootFormElement(),"modalInsertElementsDialogTitle"),$(n),Severity.info)}}export function showInsertPagesModal(e){const t=getHelper().getTemplate("templateInsertPages");if(t.length>0){const o=$(t.html());insertElementsModalSetup(o,e),Modal.show(getFormElementDefinition(getRootFormElement(),"modalInsertPagesDialogTitle"),$(o),Severity.info)}}export function showValidationErrorsModal(e){const t=[];t.push({text:getFormElementDefinition(getRootFormElement(),"modalValidationErrorsConfirmButton"),active:!0,btnClass:getHelper().getDomElementClassName("buttonDefault"),name:"confirm",trigger:function(e,t){t.hideModal()}});const o=getHelper().getTemplate("templateValidationErrors");if(o.length>0){const n=$(o.html()).clone();_validationErrorsModalSetup(n,e),Modal.show(getFormElementDefinition(getRootFormElement(),"modalValidationErrorsDialogTitle"),n,Severity.error,t)}}export function bootstrap(e,t){return formEditorApp=e,configuration=$.extend(!0,defaultConfiguration,t||{}),Helper.bootstrap(formEditorApp),this}