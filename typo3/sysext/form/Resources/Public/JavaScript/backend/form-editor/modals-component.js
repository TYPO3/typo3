/*
 * This file is part of the TYPO3 CMS project.
 *
 * It is free software; you can redistribute it and/or modify it under
 * the terms of the GNU General Public License, either version 2
 * of the License, or any later version.
 *
 * For the full copyright and license information, please read the
 * LICENSE.txt file that was distributed with this source code.
 *
 * The TYPO3 project - inspiring people to share!
 */
import o from"jquery";import*as h from"@typo3/form/backend/form-editor/helper.js";import d from"@typo3/backend/modal.js";import b from"@typo3/backend/severity.js";let I=null;const M={domElementClassNames:{buttonDefault:"btn-default",buttonInfo:"btn-info",buttonWarning:"btn-warning"},domElementDataAttributeNames:{elementType:"element-type",fullElementType:"data-element-type"},domElementDataAttributeValues:{rowItem:"rowItem",rowLink:"rowLink",rowsContainer:"rowsContainer",templateInsertElements:"Modal-InsertElements",templateInsertPages:"Modal-InsertPages",templateValidationErrors:"Modal-ValidationErrors"}};let D=null;function f(){return D}function a(e){return c().isUndefinedOrNull(e)?h.setConfiguration(I):h.setConfiguration(e)}function c(){return f().getUtility()}function u(e,t,n){return f().assert(e,t,n)}function i(){return f().getRootFormElement()}function E(){return f().getPublisherSubscriber()}function m(e,t){return f().getFormElementDefinition(e,t)}function v(e,t){const n=[];u(c().isNonEmptyString(e),'Invalid parameter "publisherTopicName"',1478889049),u(o.type(t)==="array",'Invalid parameter "formElement"',1478889044),n.push({text:m(i(),"modalRemoveElementCancelButton"),active:!0,btnClass:a().getDomElementClassName("buttonDefault"),name:"cancel",trigger:(l,r)=>{r.hideModal()}}),n.push({text:m(i(),"modalRemoveElementConfirmButton"),active:!0,btnClass:a().getDomElementClassName("buttonWarning"),name:"confirm",trigger:(l,r)=>{E().publish(e,t),r.hideModal()}}),d.show(m(i(),"modalRemoveElementDialogTitle"),m(i(),"modalRemoveElementDialogMessage"),b.warning,n)}function w(e,t,n){if(u(c().isNonEmptyString(t),'Invalid parameter "publisherTopicName"',1478910954),o.type(n)==="object")for(const l of Object.keys(n)){if(l==="disableElementTypes"&&o.type(n[l])==="array")for(let r=0,s=n[l].length;r<s;++r)o(a().getDomElementDataAttribute("fullElementType","bracesWithKeyValue",[n[l][r]]),e).addClass(a().getDomElementClassName("disabled"));l==="onlyEnableElementTypes"&&o.type(n[l])==="array"&&o(a().getDomElementDataAttribute("fullElementType","bracesWithKey"),e).each(function(){for(let r=0,s=n[l].length;r<s;++r){const g=o(this);g.data(a().getDomElementDataAttribute("elementType"))!==n[l][r]&&g.addClass(a().getDomElementClassName("disabled"))}})}o(e).on("typo3:form:insert-element-click",function(l){E().publish(t,[l.detail.item.identifier])})}function T(e,t){let n,l;u(o.type(t)==="array",'Invalid parameter "validationResults"',1479161268);const r=o(a().getDomElementDataIdentifierSelector("rowItem"),e).clone();o(a().getDomElementDataIdentifierSelector("rowItem"),e).remove();for(let s=0,g=t.length;s<g;++s){let y=!1;for(let p=0,C=t[s].validationResults.length;p<C;++p)if(t[s].validationResults[p].validationResults&&t[s].validationResults[p].validationResults.length>0){y=!0;break}y&&(n=f().getFormElementByIdentifierPath(t[s].formElementIdentifierPath),l=r.clone(),o(a().getDomElementDataIdentifierSelector("rowLink"),l).attr(a().getDomElementDataAttribute("elementIdentifier"),t[s].formElementIdentifierPath).get(0).replaceChildren(N(n)),o(a().getDomElementDataIdentifierSelector("rowsContainer"),e).append(l))}o("a",e).on("click",function(){E().publish("view/modal/validationErrors/element/clicked",[o(this).attr(a().getDomElementDataAttribute("elementIdentifier"))]),o("a",e).off(),d.currentModal.hideModal()})}function N(e){u(o.type(e)==="object",'Invalid parameter "formElement"',1479162557);const t=document.createElement("span");return t.textContent=e.get("label")?e.get("label"):e.get("identifier"),t}function S(e){v("view/modal/removeFormElement/perform",[e])}function B(e,t,n){u(c().isNonEmptyString(e),'Invalid parameter "collectionElementIdentifier"',1478894420),u(c().isNonEmptyString(t),'Invalid parameter "collectionName"',1478894421),v("view/modal/removeCollectionElement/perform",[e,t,n])}function P(){const e=[];e.push({text:m(i(),"modalCloseCancelButton"),active:!0,btnClass:a().getDomElementClassName("buttonDefault"),name:"cancel",trigger:(t,n)=>{n.hideModal()}}),e.push({text:m(i(),"modalCloseConfirmButton"),active:!0,btnClass:a().getDomElementClassName("buttonWarning"),name:"confirm",trigger:(t,n)=>{E().publish("view/modal/close/perform",[]),n.hideModal()}}),d.show(m(i(),"modalCloseDialogTitle"),m(i(),"modalCloseDialogMessage"),b.warning,e)}function R(e,t){const n=a().getTemplate("templateInsertElements");if(n.length>0){const l=o(n.html());w(l,e,t),d.advanced({title:m(i(),"modalInsertElementsDialogTitle"),size:d.sizes.large,content:o(l)})}}function k(e){const t=a().getTemplate("templateInsertPages");if(t.length>0){const n=o(t.html());w(n,e),d.advanced({title:m(i(),"modalInsertPagesDialogTitle"),size:d.sizes.small,content:o(n)})}}function F(e){const t=[];t.push({text:m(i(),"modalValidationErrorsConfirmButton"),active:!0,btnClass:a().getDomElementClassName("buttonDefault"),name:"confirm",trigger:function(l,r){r.hideModal()}});const n=a().getTemplate("templateValidationErrors");if(n.length>0){const l=o(n.html()).clone();T(l,e),d.show(m(i(),"modalValidationErrorsDialogTitle"),l,b.error,t)}}function x(e,t){return D=e,I=o.extend(!0,M,t||{}),h.bootstrap(D),this}export{x as bootstrap,P as showCloseConfirmationModal,R as showInsertElementsModal,k as showInsertPagesModal,B as showRemoveCollectionElementModal,S as showRemoveFormElementModal,F as showValidationErrorsModal};
