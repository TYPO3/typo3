/*
 * This file is part of the TYPO3 CMS project.
 *
 * It is free software; you can redistribute it and/or modify it under
 * the terms of the GNU General Public License, either version 2
 * of the License, or any later version.
 *
 * For the full copyright and license information, please read the
 * LICENSE.txt file that was distributed with this source code.
 *
 * The TYPO3 project - inspiring people to share!
 */
import l from"jquery";import*as b from"@typo3/form/backend/form-editor/helper.js";import d from"@typo3/backend/modal.js";import g from"@typo3/backend/severity.js";let I=null;const M={domElementClassNames:{buttonDefault:"btn-default",buttonInfo:"btn-info",buttonWarning:"btn-warning"},domElementDataAttributeNames:{elementType:"element-type",fullElementType:"data-element-type"},domElementDataAttributeValues:{rowItem:"rowItem",rowLink:"rowLink",rowsContainer:"rowsContainer",templateInsertElements:"Modal-InsertElements",templateInsertPages:"Modal-InsertPages",templateValidationErrors:"Modal-ValidationErrors"}};let D=null;function f(){return D}function a(e){return c().isUndefinedOrNull(e)?b.setConfiguration(I):b.setConfiguration(e)}function c(){return f().getUtility()}function u(e,t,n){return f().assert(e,t,n)}function i(){return f().getRootFormElement()}function h(){return f().getPublisherSubscriber()}function m(e,t){return f().getFormElementDefinition(e,t)}function w(e,t){const n=[];u(c().isNonEmptyString(e),'Invalid parameter "publisherTopicName"',1478889049),u(l.type(t)==="array",'Invalid parameter "formElement"',1478889044),n.push({text:m(i(),"modalRemoveElementCancelButton"),active:!0,btnClass:a().getDomElementClassName("buttonDefault"),name:"cancel",trigger:(o,r)=>{r.hideModal()}}),n.push({text:m(i(),"modalRemoveElementConfirmButton"),active:!0,btnClass:a().getDomElementClassName("buttonWarning"),name:"confirm",trigger:(o,r)=>{h().publish(e,t),r.hideModal()}}),d.show(m(i(),"modalRemoveElementDialogTitle"),m(i(),"modalRemoveElementDialogMessage"),g.warning,n)}function v(e,t,n){if(u(c().isNonEmptyString(t),'Invalid parameter "publisherTopicName"',1478910954),l.type(n)==="object")for(const o of Object.keys(n)){if(o==="disableElementTypes"&&l.type(n[o])==="array")for(let r=0,s=n[o].length;r<s;++r)l(a().getDomElementDataAttribute("fullElementType","bracesWithKeyValue",[n[o][r]]),e).addClass(a().getDomElementClassName("disabled"));o==="onlyEnableElementTypes"&&l.type(n[o])==="array"&&l(a().getDomElementDataAttribute("fullElementType","bracesWithKey"),e).each(function(){for(let r=0,s=n[o].length;r<s;++r){const p=l(this);p.data(a().getDomElementDataAttribute("elementType"))!==n[o][r]&&p.addClass(a().getDomElementClassName("disabled"))}})}l("button",e).on("click",function(){h().publish(t,[l(this).data(a().getDomElementDataAttribute("elementType"))]),l("button",e).off(),d.currentModal.hideModal()})}function T(e,t){let n,o;u(l.type(t)==="array",'Invalid parameter "validationResults"',1479161268);const r=l(a().getDomElementDataIdentifierSelector("rowItem"),e).clone();l(a().getDomElementDataIdentifierSelector("rowItem"),e).remove();for(let s=0,p=t.length;s<p;++s){let y=!1;for(let E=0,C=t[s].validationResults.length;E<C;++E)if(t[s].validationResults[E].validationResults&&t[s].validationResults[E].validationResults.length>0){y=!0;break}y&&(n=f().getFormElementByIdentifierPath(t[s].formElementIdentifierPath),o=r.clone(),l(a().getDomElementDataIdentifierSelector("rowLink"),o).attr(a().getDomElementDataAttribute("elementIdentifier"),t[s].formElementIdentifierPath).get(0).replaceChildren(N(n)),l(a().getDomElementDataIdentifierSelector("rowsContainer"),e).append(o))}l("a",e).on("click",function(){h().publish("view/modal/validationErrors/element/clicked",[l(this).attr(a().getDomElementDataAttribute("elementIdentifier"))]),l("a",e).off(),d.currentModal.hideModal()})}function N(e){u(l.type(e)==="object",'Invalid parameter "formElement"',1479162557);const t=document.createElement("span");return t.textContent=e.get("label")?e.get("label"):e.get("identifier"),t}function S(e){w("view/modal/removeFormElement/perform",[e])}function B(e,t,n){u(c().isNonEmptyString(e),'Invalid parameter "collectionElementIdentifier"',1478894420),u(c().isNonEmptyString(t),'Invalid parameter "collectionName"',1478894421),w("view/modal/removeCollectionElement/perform",[e,t,n])}function P(){const e=[];e.push({text:m(i(),"modalCloseCancelButton"),active:!0,btnClass:a().getDomElementClassName("buttonDefault"),name:"cancel",trigger:(t,n)=>{n.hideModal()}}),e.push({text:m(i(),"modalCloseConfirmButton"),active:!0,btnClass:a().getDomElementClassName("buttonWarning"),name:"confirm",trigger:(t,n)=>{h().publish("view/modal/close/perform",[]),n.hideModal()}}),d.show(m(i(),"modalCloseDialogTitle"),m(i(),"modalCloseDialogMessage"),g.warning,e)}function R(e,t){const n=a().getTemplate("templateInsertElements");if(n.length>0){const o=l(n.html());v(o,e,t),d.show(m(i(),"modalInsertElementsDialogTitle"),l(o),g.info)}}function k(e){const t=a().getTemplate("templateInsertPages");if(t.length>0){const n=l(t.html());v(n,e),d.show(m(i(),"modalInsertPagesDialogTitle"),l(n),g.info)}}function A(e){const t=[];t.push({text:m(i(),"modalValidationErrorsConfirmButton"),active:!0,btnClass:a().getDomElementClassName("buttonDefault"),name:"confirm",trigger:function(o,r){r.hideModal()}});const n=a().getTemplate("templateValidationErrors");if(n.length>0){const o=l(n.html()).clone();T(o,e),d.show(m(i(),"modalValidationErrorsDialogTitle"),o,g.error,t)}}function F(e,t){return D=e,I=l.extend(!0,M,t||{}),b.bootstrap(D),this}export{F as bootstrap,P as showCloseConfirmationModal,R as showInsertElementsModal,k as showInsertPagesModal,B as showRemoveCollectionElementModal,S as showRemoveFormElementModal,A as showValidationErrorsModal};
