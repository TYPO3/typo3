/*
 * This file is part of the TYPO3 CMS project.
 *
 * It is free software; you can redistribute it and/or modify it under
 * the terms of the GNU General Public License, either version 2
 * of the License, or any later version.
 *
 * For the full copyright and license information, please read the
 * LICENSE.txt file that was distributed with this source code.
 *
 * The TYPO3 project - inspiring people to share!
 */
import t from"jquery";import*as M from"@typo3/form/backend/form-editor/helper.js";import v from"@typo3/backend/icons.js";import B from"@typo3/backend/modal.js";import{MessageUtility as ge}from"@typo3/backend/utility/message-utility.js";import Y from"sortablejs";import{selector as J}from"@typo3/core/literals.js";const be={domElementClassNames:{buttonFormElementRemove:"formeditor-inspector-element-remove-button",collectionElement:"formeditor-inspector-collection-element",finisherEditorPrefix:"t3-form-inspector-finishers-editor-",inspectorEditor:"formeditor-inspector-element",inspectorInputGroup:"input-group",validatorEditorPrefix:"formeditor-inspector-validators-editor-"},domElementDataAttributeNames:{contentElementSelectorTarget:"data-insert-target",finisher:"data-finisher-identifier",validator:"data-validator-identifier",randomId:"data-random-id",randomIdTarget:"data-random-id-attribute",randomIdIndex:"data-random-id-number",maximumFileSize:"data-maximumFileSize"},domElementDataAttributeValues:{collapse:"actions-view-table-expand",editorControlsInputGroup:"inspectorEditorControlsGroup",editorWrapper:"editorWrapper",editorControlsWrapper:"inspectorEditorControlsWrapper",formElementHeaderEditor:"inspectorFormElementHeaderEditor",formElementSelectorControlsWrapper:"inspectorEditorFormElementSelectorControlsWrapper",formElementSelectorSplitButtonContainer:"inspectorEditorFormElementSelectorSplitButtonContainer",formElementSelectorSplitButtonListContainer:"inspectorEditorFormElementSelectorSplitButtonListContainer",iconNotAvailable:"actions-close",inspector:"inspector","Inspector-CheckboxEditor":"Inspector-CheckboxEditor","Inspector-CollectionElementHeaderEditor":"Inspector-CollectionElementHeaderEditor","Inspector-FinishersEditor":"Inspector-FinishersEditor","Inspector-FormElementHeaderEditor":"Inspector-FormElementHeaderEditor","Inspector-PropertyGridEditor":"Inspector-PropertyGridEditor","Inspector-RemoveElementEditor":"Inspector-RemoveElementEditor","Inspector-RequiredValidatorEditor":"Inspector-RequiredValidatorEditor","Inspector-SingleSelectEditor":"Inspector-SingleSelectEditor","Inspector-MultiSelectEditor":"Inspector-MultiSelectEditor","Inspector-GridColumnViewPortConfigurationEditor":"Inspector-GridColumnViewPortConfigurationEditor","Inspector-TextareaEditor":"Inspector-TextareaEditor","Inspector-TextEditor":"Inspector-TextEditor","Inspector-Typo3WinBrowserEditor":"Inspector-Typo3WinBrowserEditor","Inspector-ValidatorsEditor":"Inspector-ValidatorsEditor","Inspector-ValidationErrorMessageEditor":"Inspector-ValidationErrorMessageEditor",inspectorFinishers:"inspectorFinishers",inspectorValidators:"inspectorValidators",propertyGridEditorHeaderRow:"headerRow",propertyGridEditorAddRow:"addRow",propertyGridEditorAddRowItem:"addRowItem",propertyGridEditorContainer:"propertyGridContainer",propertyGridEditorDeleteRow:"deleteRow",propertyGridEditorLabel:"label",propertyGridEditorRowItem:"rowItem",propertyGridEditorColumn:"column",propertyGridEditorSelectValue:"selectValue",propertyGridEditorSortRow:"sortRow",propertyGridEditorValue:"value",viewportButton:"viewportButton"},domElementIdNames:{finisherPrefix:"t3-form-inspector-finishers-",validatorPrefix:"t3-form-inspector-validators-"},isSortable:!0};let L=null,W=null;function g(){return W}function x(){return g().getViewModel()}function n(e){return d().isUndefinedOrNull(e)?M.setConfiguration(L):M.setConfiguration(e)}function d(){return g().getUtility()}function m(e,r,a){return g().assert(e,r,a)}function Q(){return g().getRootFormElement()}function E(){return g().getCurrentlySelectedFormElement()}function N(){return g().getPublisherSubscriber()}function P(e,r){return g().getFormElementDefinition(e,r)}function X(e,r,a,l){switch(e.templateName){case"Inspector-FormElementHeaderEditor":ee(e,r);break;case"Inspector-CollectionElementHeaderEditor":te(e,r,a,l);break;case"Inspector-MaximumFileSizeEditor":re(e,r);break;case"Inspector-TextEditor":ne(e,r,a,l);break;case"Inspector-FinishersEditor":$("finishers",e,r);break;case"Inspector-ValidatorsEditor":$("validators",e,r);break;case"Inspector-ValidationErrorMessageEditor":ae(e,r);break;case"Inspector-RemoveElementEditor":fe(e,r,a,l);break;case"Inspector-RequiredValidatorEditor":me(e,r,a,l);break;case"Inspector-CheckboxEditor":de(e,r,a,l);break;case"Inspector-CountrySelectEditor":oe(e,r,a,l);break;case"Inspector-SingleSelectEditor":le(e,r,a,l);break;case"Inspector-MultiSelectEditor":ie(e,r,a,l);break;case"Inspector-GridColumnViewPortConfigurationEditor":pe(e,r);break;case"Inspector-PropertyGridEditor":se(e,r,a,l);break;case"Inspector-TextareaEditor":ce(e,r,a,l);break;case"Inspector-Typo3WinBrowserEditor":Ee(e,r,a,l);break;default:break}N().publish("view/inspector/editor/insert/perform",[e,r,a,l])}function he(e,r){B.advanced({type:B.types.iframe,content:TYPO3.settings.FormEditor.typo3WinBrowserUrl+"&mode="+e+"&bparams="+r,size:B.sizes.large})}function ve(){window.addEventListener("message",function(e){if(!ge.verifyOrigin(e.origin))throw"Denied message sent by "+e.origin;if(e.data.actionName==="typo3:elementBrowser:elementAdded"){if(typeof e.data.fieldName>"u")throw"fieldName not defined in message";if(typeof e.data.value>"u")throw"value not defined in message";const r=e.data.value.split("_");t(n().getDomElementDataAttribute("contentElementSelectorTarget","bracesWithKeyValue",[e.data.fieldName])).val(r.pop()).trigger("paste")}})}function De(e,r){return e==="finishers"?n().getDomElementClassName("finisherEditorPrefix")+r:n().getDomElementClassName("validatorEditorPrefix")+r}function z(e,r,a){return e==="finishers"?n().getDomElementIdName("finisherPrefix",a)+r:n().getDomElementIdName("validatorPrefix",a)+r}function Ie(e,r){e.addClass(n().getDomElementClassName("sortable")),new Y(e.get(0),{draggable:n().getDomElementClassName("collectionElement",!0),filter:"input,textarea,select",preventOnFilter:!1,animation:200,fallbackTolerance:200,swapThreshold:.6,dragClass:"formeditor-sortable-drag",ghostClass:"formeditor-sortable-ghost",onEnd:function(a){let l;r==="finishers"?l=n().getDomElementDataAttribute("finisher"):l=n().getDomElementDataAttribute("validator");const o=t(a.item).attr(l),p=t(a.item).prevAll(n().getDomElementClassName("collectionElement",!0)).first().attr(l),s=t(a.item).nextAll(n().getDomElementClassName("collectionElement",!0)).first().attr(l);N().publish("view/inspector/collectionElements/dnd/update",[o,p,s,r])}})}function G(e,r,a,l){let o;if(r){const s=[];t(n().getDomElementDataIdentifierSelector("propertyGridEditorContainer")+" "+n().getDomElementDataIdentifierSelector("propertyGridEditorSelectValue")+":checked",t(e)).each(function(){o=t(this).closest(n().getDomElementDataIdentifierSelector("propertyGridEditorRowItem")).find(n().getDomElementDataIdentifierSelector("propertyGridEditorValue")).val(),d().canBeInterpretedAsInteger(o)&&(o=parseInt(o,10)),s.push(o)}),E().set(l+"defaultValue",s)}else o=t(n().getDomElementDataIdentifierSelector("propertyGridEditorContainer")+" "+n().getDomElementDataIdentifierSelector("propertyGridEditorSelectValue")+":checked",t(e)).first().closest(n().getDomElementDataIdentifierSelector("propertyGridEditorRowItem")).find(n().getDomElementDataIdentifierSelector("propertyGridEditorValue")).val(),d().canBeInterpretedAsInteger(o)&&(o=parseInt(o,10)),E().set(l+"defaultValue",o,!0);const p=[];t(n().getDomElementDataIdentifierSelector("propertyGridEditorContainer")+" "+n().getDomElementDataIdentifierSelector("propertyGridEditorRowItem"),t(e)).each(function(){let s=t(this).find(n().getDomElementDataIdentifierSelector("propertyGridEditorValue")).val();const i=t(this).find(n().getDomElementDataIdentifierSelector("propertyGridEditorLabel")).val();s===""&&(s=i);const c={};c[s]=i,p.push({_label:i,_value:s})}),E().set(l+a,p),S(l+a,e)}function C(e){return t(n().getDomElementDataIdentifierSelector("editorWrapper"),t(e))}function V(e){return t(n().getDomElementDataIdentifierSelector("editorControlsWrapper"),t(e))}function S(e,r){let a,l,o;o=g().validateCurrentlySelectedFormElementProperty(e),o.length>0?(n().getTemplatePropertyDomElement("validationErrors",r).html('<span class="text-danger">'+o[0]+"</span>"),x().setElementValidationErrorClass(V(r),"hasError")):(n().getTemplatePropertyDomElement("validationErrors",r).html(""),x().removeElementValidationErrorClass(V(r),"hasError")),o=g().validateFormElement(E()),l=e.split("."),l=l[0]+"."+l[1],a=!1;for(let p=0,s=o.length;p<s;++p)if(o[p].propertyPath.indexOf(l,0)===0&&o[p].validationResults&&o[p].validationResults.length>0){a=!0;break}a?x().setElementValidationErrorClass(V(r).closest(n().getDomElementClassName("collectionElement",!0))):x().removeElementValidationErrorClass(V(r).closest(n().getDomElementClassName("collectionElement",!0)))}function Z(e,r){m(t.type(e)==="array",'Invalid configuration "errorCodes"',1489932939),m(t.type(r)==="array",'Invalid configuration "propertyData"',1489932940);for(let a=0,l=e.length;a<l;++a)for(let o=0,p=r.length;o<p;++o)if(parseInt(e[a],10)===parseInt(r[o].code,10)&&d().isNonEmptyString(r[o].message))return r[o].message;return null}function K(e,r,a){if(m(t.type(r)==="array",'Invalid configuration "propertyData"',1489932942),!d().isUndefinedOrNull(e)&&t.type(e)==="array"){const l=[];for(let o=0,p=e.length;o<p;++o){let s=!1;for(let i=0,c=r.length;i<c;++i)parseInt(e[o],10)===parseInt(r[i].code,10)&&(s=!0,d().isNonEmptyString(a)?r[i].message=a:(r.splice(i,1),--c));s||d().isNonEmptyString(a)&&l.push({code:e[o],message:a})}r=r.concat(l)}return r}function H(e){m(t.type(e)==="object",'Invalid input "html"',1523904699),t(n().getDomElementClassName("inspectorEditor",!0)).each(function(){const r=t(this),a={};t(n().getDomElementDataAttribute("randomId","bracesWithKey"),r).each(function(){const l=t(this),o=l.attr(n().getDomElementDataAttribute("randomIdTarget")),p=l.attr(n().getDomElementDataAttribute("randomIdIndex"));l.is("["+o+"]")||(p in a||(a[p]="fe"+Math.floor(Math.random()*42)+Date.now()),l.attr(o,a[p]))})})}function R(){return t(n().getDomElementDataIdentifierSelector("inspector"))}function A(){return t(n().getDomElementDataIdentifierSelector("inspectorFinishers"),R())}function F(){return t(n().getDomElementDataIdentifierSelector("inspectorValidators"),R())}function j(e,r){return e==="finishers"?t(n().getDomElementDataAttribute("finisher","bracesWithKeyValue",[r]),A()):t(n().getDomElementDataAttribute("validator","bracesWithKeyValue",[r]),F())}function Pe(e,r){d().isUndefinedOrNull(e)&&(e=E()),R().off().empty();const a=P(e,void 0);if(t.type(a.editors)==="array"){for(let l=0,o=a.editors.length;l<o;++l){const p=n().getTemplate(a.editors[l].templateName).clone();if(!p.length)continue;const s=t(p.html());t(s).first().addClass(n().getDomElementClassName("inspectorEditor")),R().append(t(s)),H(s),X(a.editors[l],s)}t.type(r)==="function"&&r()}}function Se(e,r){let a,l,o;m(d().isNonEmptyString(e),'Invalid parameter "collectionName"',1478354853),m(d().isNonEmptyString(r),'Invalid parameter "collectionElementIdentifier"',1478354854);const p=g().getPropertyCollectionElementConfiguration(r,e);if(t.type(p.editors)!=="array")return;const s=t("<div></div>").addClass(n().getDomElementClassName("collectionElement")).addClass("panel").addClass("panel-default");e==="finishers"?(o=A(),s.attr(n().getDomElementDataAttribute("finisher"),r)):(o=F(),s.attr(n().getDomElementDataAttribute("validator"),r)),o.append(s);const i=p.editors.length;i>0&&p.editors[0].identifier==="header"&&(l=document.createElement("div"),l.classList.add("panel-body"),a=document.createElement("div"),a.classList.add("panel-collapse","collapse"),a.id=z(e,r),a.appendChild(l));for(let c=0;c<i;++c){const u=n().getTemplate(p.editors[c].templateName).clone();if(!u.length)continue;const f=t(u.html());t(f).first().addClass(De(e,p.editors[c].identifier)).addClass(n().getDomElementClassName("inspectorEditor")),c===0&&a?j(e,r).append(f).append(a):c===i-1&&a&&p.editors[c].identifier==="removeButton"||c>0&&a?l.append(f.get(0)):j(e,r).append(f),H(f),X(p.editors[c],f,r,e)}(i===2&&p.editors[0].identifier==="header"&&p.editors[1].identifier==="removeButton"||i===1&&p.editors[0].identifier==="header")&&t(n().getDomElementDataIdentifierSelector("collapse"),s).remove(),L.isSortable&&Ie(o,e)}function $(e,r,a){let l,o,p;m(d().isNonEmptyString(e),'Invalid configuration "collectionName"',1478362968),m(t.type(r)==="object",'Invalid parameter "editorConfiguration"',1475423098),m(t.type(a)==="object",'Invalid parameter "editorHtml"',1475423099),m(d().isNonEmptyString(r.label),'Invalid configuration "label"',1475423100),m(t.type(r.selectOptions)==="array",'Invalid configuration "selectOptions"',1475423101),e==="finishers"?(o=A(),l=Q().get(e)):(o=F(),l=E().get(e)),o.off().empty(),n().getTemplatePropertyDomElement("label",a).text(r.label);const s=n().getTemplatePropertyDomElement("selectOptions",a),i=!d().isUndefinedOrNull(l)&&l.length>0;if(i)for(let c=0,u=l.length;c<u;++c)N().publish("view/inspector/collectionElement/existing/selected",[l[c].identifier,e]);p=!0;for(let c=0,u=r.selectOptions.length;c<u;++c){let f=!0;if(!d().isUndefinedOrNull(l)){for(let y=0,b=l.length;y<b;++y)if(l[y].identifier===r.selectOptions[c].value){f=!1;break}}f&&(s.append(new Option(r.selectOptions[c].label,r.selectOptions[c].value)),r.selectOptions[c].value!==""&&(p=!1))}if(p){n().getTemplatePropertyDomElement("select-group",a).off().empty().remove();const c=n().getTemplatePropertyDomElement("label-no-select",a);i?c.text(r.label):c.remove();return}n().getTemplatePropertyDomElement("label-no-select",a).remove(),s.on("change",function(){if(t(this).val()!==""){const c=t(this).val();t(J`option[value="${c}"]`,t(this)).remove(),g().getPublisherSubscriber().publish("view/inspector/collectionElement/new/selected",[c,e])}})}function ee(e,r){m(t.type(e)==="object",'Invalid parameter "editorConfiguration"',1475421525),m(t.type(r)==="object",'Invalid parameter "editorHtml"',1475421526),v.getIcon(P(E(),"iconIdentifier"),v.sizes.small,null,v.states.default).then(function(a){n().getTemplatePropertyDomElement("header-label",r).append(t(a).addClass(n().getDomElementClassName("icon"))).append(ye()).append("<code>"+E().get("identifier")+"</code>")})}function te(e,r,a,l){m(t.type(e)==="object",'Invalid parameter "editorConfiguration"',1475421258),m(d().isNonEmptyString(e.label),'Invalid configuration "label"',1475421257),m(t.type(r)==="object",'Invalid parameter "editorHtml"',1475421259);const o=function(s){const i=n().getTemplatePropertyDomElement("panel-icon",r);s?i.replaceWith(s):i.remove();const c=g().getPropertyCollectionElementConfiguration(a,l).editors;if(!(c.length===2&&c[0].identifier==="header"&&c[1].identifier==="removeButton"||c.length===1&&c[0].identifier==="header")){const y=document.createElement("button");y.classList.add("panel-button","collapsed"),y.setAttribute("type","button"),y.setAttribute("data-bs-toggle","collapse"),y.setAttribute("data-bs-target",z(l,a,!0)),y.setAttribute("aria-expaned","false"),y.setAttribute("aria-controls",z(l,a));const b=document.createElement("span");b.classList.add("caret"),n().getTemplatePropertyDomElement("panel-heading-row",r).find(".panel-title").before(b),n().getTemplatePropertyDomElement("panel-heading-row",r).wrapInner(y)}const f=j(l,a).get(0).querySelector(".formeditor-inspector-element-remove-button");if(f){const y=f.querySelector("button");y.classList.add("btn-sm"),y.querySelector(".btn-label").classList.add("visually-hidden");const b=document.createElement("div");b.classList.add("panel-actions"),b.append(y),n().getTemplatePropertyDomElement("panel-heading-row",r).append(b)}f?.remove()},p=g().getFormEditorDefinition(l,a);"iconIdentifier"in p?v.getIcon(p.iconIdentifier,v.sizes.small,null,v.states.default).then(function(s){o(s)}):o(),e.label&&n().getTemplatePropertyDomElement("panel-title",r).removeAttr("data-template-property").append(e.label)}function re(e,r){if(m(t.type(e)==="object",'Invalid parameter "editorConfiguration"',1475421258),m(d().isNonEmptyString(e.label),'Invalid configuration "label"',1475421257),m(t.type(r)==="object",'Invalid parameter "editorHtml"',1475421259),e.label){const a=n().getTemplatePropertyDomElement("label",r),l=a.attr(n().getDomElementDataAttribute("maximumFileSize"));a.append(e.label.replace("{0}",l))}}function ne(e,r,a,l){m(t.type(e)==="object",'Invalid parameter "editorConfiguration"',1475421053),m(t.type(r)==="object",'Invalid parameter "editorHtml"',1475421054),m(d().isNonEmptyString(e.label),'Invalid configuration "label"',1475421055),m(d().isNonEmptyString(e.propertyPath),'Invalid configuration "propertyPath"',1475421056),n().getTemplatePropertyDomElement("label",r).append(e.label),d().isNonEmptyString(e.fieldExplanationText)?n().getTemplatePropertyDomElement("fieldExplanationText",r).text(e.fieldExplanationText):n().getTemplatePropertyDomElement("fieldExplanationText",r).remove(),d().isNonEmptyString(e.placeholder)&&n().getTemplatePropertyDomElement("propertyPath",r).attr("placeholder",e.placeholder);const o=g().buildPropertyPath(e.propertyPath,a,l),p=E().get(o);if(S(o,r),n().getTemplatePropertyDomElement("propertyPath",r).val(p),!d().isUndefinedOrNull(e.additionalElementPropertyPaths)&&t.type(e.additionalElementPropertyPaths)==="array")for(let s=0,i=e.additionalElementPropertyPaths.length;s<i;++s)E().set(e.additionalElementPropertyPaths[s],p);ue(e,r,o),n().getTemplatePropertyDomElement("propertyPath",r).on("keyup paste",function(){if(e.doNotSetIfPropertyValueIsEmpty&&!d().isNonEmptyString(t(this).val())?E().unset(o):E().set(o,t(this).val()),S(o,r),!d().isUndefinedOrNull(e.additionalElementPropertyPaths)&&t.type(e.additionalElementPropertyPaths)==="array")for(let s=0,i=e.additionalElementPropertyPaths.length;s<i;++s)e.doNotSetIfPropertyValueIsEmpty&&!d().isNonEmptyString(t(this).val())?E().unset(e.additionalElementPropertyPaths[s]):E().set(e.additionalElementPropertyPaths[s],t(this).val())})}function ae(e,r){m(t.type(e)==="object",'Invalid parameter "editorConfiguration"',1489874121),m(t.type(r)==="object",'Invalid parameter "editorHtml"',1489874122),m(d().isNonEmptyString(e.label),'Invalid configuration "label"',1489874123),m(d().isNonEmptyString(e.propertyPath),'Invalid configuration "propertyPath"',1489874124),n().getTemplatePropertyDomElement("label",r).append(e.label),d().isNonEmptyString(e.fieldExplanationText)?n().getTemplatePropertyDomElement("fieldExplanationText",r).text(e.fieldExplanationText):n().getTemplatePropertyDomElement("fieldExplanationText",r).remove();const a=g().buildPropertyPath(e.propertyPath);let l=E().get(a);if(!d().isUndefinedOrNull(l)&&t.type(l)==="array"){const o=Z(e.errorCodes,l);d().isUndefinedOrNull(o)||n().getTemplatePropertyDomElement("propertyPath",r).val(o)}n().getTemplatePropertyDomElement("propertyPath",r).on("keyup paste",function(){l=E().get(a),d().isUndefinedOrNull(l)&&(l=[]),E().set(a,K(e.errorCodes,l,t(this).val()))})}function oe(e,r,a,l){m(t.type(e)==="object",'Invalid parameter "editorConfiguration"',1674826430),m(t.type(r)==="object",'Invalid parameter "editorHtml"',1674826431),m(d().isNonEmptyString(e.label),'Invalid configuration "label"',1674826432);const o=g().buildPropertyPath(e.propertyPath,a,l);n().getTemplatePropertyDomElement("label",r).append(e.label);const p=n().getTemplatePropertyDomElement("selectOptions",r),s=E().get(o)||{},i=t("option",p);p.empty();for(let c=0,u=i.length;c<u;++c){let f=!1;for(const b of Object.keys(s))if(i[c].value===s[b]){f=!0;break}const y=new Option(i[c].text,c.toString(),!1,f);t(y).data({value:i[c].value}),p.append(y)}p.on("change",function(){const c=[];t("option:selected",t(this)).each(function(){c.push(t(this).data("value"))}),E().set(o,c)})}function le(e,r,a,l){m(t.type(e)==="object",'Invalid parameter "editorConfiguration"',1475421048),m(t.type(r)==="object",'Invalid parameter "editorHtml"',1475421049),m(d().isNonEmptyString(e.label),'Invalid configuration "label"',1475421050),m(d().isNonEmptyString(e.propertyPath),'Invalid configuration "propertyPath"',1475421051),m(t.type(e.selectOptions)==="array",'Invalid configuration "selectOptions"',1475421052);const o=g().buildPropertyPath(e.propertyPath,a,l);n().getTemplatePropertyDomElement("label",r).append(e.label);const p=n().getTemplatePropertyDomElement("selectOptions",r),s=E().get(o);for(let i=0,c=e.selectOptions.length;i<c;++i){let u;e.selectOptions[i].value===s?u=new Option(e.selectOptions[i].label,i.toString(),!1,!0):u=new Option(e.selectOptions[i].label,i.toString()),t(u).data({value:e.selectOptions[i].value}),p.append(u)}p.on("change",function(){E().set(o,t("option:selected",t(this)).data("value"))})}function ie(e,r,a,l){m(t.type(e)==="object",'Invalid parameter "editorConfiguration"',1485712399),m(t.type(r)==="object",'Invalid parameter "editorHtml"',1485712400),m(d().isNonEmptyString(e.label),'Invalid configuration "label"',1485712401),m(d().isNonEmptyString(e.propertyPath),'Invalid configuration "propertyPath"',1485712402),m(t.type(e.selectOptions)==="array",'Invalid configuration "selectOptions"',1485712403);const o=g().buildPropertyPath(e.propertyPath,a,l);n().getTemplatePropertyDomElement("label",r).append(e.label);const p=n().getTemplatePropertyDomElement("selectOptions",r),s=E().get(o)||{};for(let i=0,c=e.selectOptions.length;i<c;++i){let u=null;for(const f of Object.keys(s))if(e.selectOptions[i].value===s[f]){u=new Option(e.selectOptions[i].label,i.toString(),!1,!0);break}u||(u=new Option(e.selectOptions[i].label,i.toString())),t(u).data({value:e.selectOptions[i].value}),p.append(u)}p.on("change",function(){const i=[];t("option:selected",t(this)).each(function(){i.push(t(this).data("value"))}),E().set(o,i)})}function pe(e,r){if(m(t.type(e)==="object",'Invalid parameter "editorConfiguration"',1489528242),m(t.type(r)==="object",'Invalid parameter "editorHtml"',1489528243),m(d().isNonEmptyString(e.label),'Invalid configuration "label"',1489528244),m(t.type(e.configurationOptions.viewPorts)==="array",'Invalid configurationOptions "viewPorts"',1489528245),m(!d().isUndefinedOrNull(e.configurationOptions.numbersOfColumnsToUse.label),'Invalid configurationOptions "numbersOfColumnsToUse"',1489528246),m(!d().isUndefinedOrNull(e.configurationOptions.numbersOfColumnsToUse.propertyPath),'Invalid configuration "selectOptions"',1489528247),!P(E().get("__parentRenderable"),"_isGridRowFormElement")){r.remove();return}n().getTemplatePropertyDomElement("label",r).append(e.label);const a=t(n().getDomElementDataIdentifierSelector("viewportButton"),t(r)).clone();t(n().getDomElementDataIdentifierSelector("viewportButton"),t(r)).remove();const l=n().getTemplatePropertyDomElement("numbersOfColumnsToUse",t(r)).clone();n().getTemplatePropertyDomElement("numbersOfColumnsToUse",t(r)).remove();const o=V(r),p=function(s){n().getTemplatePropertyDomElement("numbersOfColumnsToUse",t(r)).off().empty().remove();const i=t(l).clone(!0,!0);C(r).after(i),t("input",i).focus(),n().getTemplatePropertyDomElement("numbersOfColumnsToUse-label",i).append(e.configurationOptions.numbersOfColumnsToUse.label.replace("{@viewPortLabel}",s.data("viewPortLabel"))),n().getTemplatePropertyDomElement("numbersOfColumnsToUse-fieldExplanationText",i).append(e.configurationOptions.numbersOfColumnsToUse.fieldExplanationText);const c=e.configurationOptions.numbersOfColumnsToUse.propertyPath.replace("{@viewPortIdentifier}",s.data("viewPortIdentifier"));n().getTemplatePropertyDomElement("numbersOfColumnsToUse-propertyPath",i).val(E().get(c)),n().getTemplatePropertyDomElement("numbersOfColumnsToUse-propertyPath",i).on("keyup paste change",function(){const u=t(this);t.isNumeric(u.val())||u.val(""),E().set(c,u.val())})};for(let s=0,i=e.configurationOptions.viewPorts.length;s<i;++s){const c=e.configurationOptions.viewPorts[s].viewPortIdentifier,u=e.configurationOptions.viewPorts[s].label,f=t(a).clone(!0,!0);if(f.text(c),f.data("viewPortIdentifier",c),f.data("viewPortLabel",u),f.attr("title",u),o.append(f),s===i-1){const y=t(l).clone(!0,!0);C(r).after(y),p(f),f.addClass(n().getDomElementClassName("active"))}t("button",o).on("click",function(){const y=t(this);t("button",o).removeClass(n().getDomElementClassName("active")),y.addClass(n().getDomElementClassName("active")),p(y)})}}function se(e,r,a,l){m(t.type(e)==="object",'Invalid parameter "editorConfiguration"',1475419226),m(t.type(r)==="object",'Invalid parameter "editorHtml"',1475419227),m(t.type(e.enableAddRow)==="boolean",'Invalid configuration "enableAddRow"',1475419228),m(t.type(e.enableDeleteRow)==="boolean",'Invalid configuration "enableDeleteRow"',1475419230),m(t.type(e.isSortable)==="boolean",'Invalid configuration "isSortable"',1475419229),m(d().isNonEmptyString(e.propertyPath),'Invalid configuration "propertyPath"',1475419231),m(d().isNonEmptyString(e.label),'Invalid configuration "label"',1475419232),n().getTemplatePropertyDomElement("label",r).append(e.label),d().isNonEmptyString(e.fieldExplanationText)?n().getTemplatePropertyDomElement("fieldExplanationText",r).text(e.fieldExplanationText):n().getTemplatePropertyDomElement("fieldExplanationText",r).remove();let o=g().buildPropertyPath(void 0,a,l,void 0,!0);d().isNonEmptyString(o)&&(o=o+".");let p;d().isUndefinedOrNull(e.useLabelAsFallbackValue)?p=!0:p=e.useLabelAsFallbackValue;let s=[{name:"label",title:"Label"},{name:"value",title:"Value"},{name:"selected",title:"Selected"}];d().isNonEmptyArray(e.gridColumns)&&(s=e.gridColumns);const i=s.map(function(h){return h.name}),c=s.map(function(h){return h.title||null});t([n().getDomElementDataIdentifierSelector("propertyGridEditorHeaderRow"),n().getDomElementDataIdentifierSelector("propertyGridEditorRowItem"),n().getDomElementDataIdentifierSelector("propertyGridEditorAddRowItem")].join(","),t(r)).each(function(h,T){const O=t(n().getDomElementDataIdentifierSelector("propertyGridEditorColumn"),T),I=O.last().nextAll(),k={};O.detach().each(function(q,U){const w=t(U),_=w.data("column");i.includes(_)&&(k[_]=w)}),i.forEach(function(q,U){const w=k[q];w.is("th")&&w.append(c[U]),w.appendTo(T)}),I.appendTo(T)});let u;d().isUndefinedOrNull(e.multiSelection)?u=!1:u=!!e.multiSelection;const f=t(n().getDomElementDataIdentifierSelector("propertyGridEditorRowItem"),t(r)).clone();if(t(n().getDomElementDataIdentifierSelector("propertyGridEditorRowItem"),t(r)).remove(),e.enableDeleteRow?t(n().getDomElementDataIdentifierSelector("propertyGridEditorDeleteRow"),t(f)).on("click",function(){t(this).closest(n().getDomElementDataIdentifierSelector("propertyGridEditorRowItem")).off().empty().remove(),G(t(r),u,e.propertyPath,o)}):t(n().getDomElementDataIdentifierSelector("propertyGridEditorDeleteRow"),t(f)).parent().off().empty(),e.isSortable?t(r).get(0).querySelectorAll(n().getDomElementDataIdentifierSelector("propertyGridEditorContainer")+" tbody").forEach(function(h){new Y(h,{group:n().getDomElementDataAttributeValue("propertyGridEditorContainer"),handle:n().getDomElementDataIdentifierSelector("propertyGridEditorSortRow"),draggable:n().getDomElementDataIdentifierSelector("propertyGridEditorRowItem"),pull:"clone",swapThreshold:.6,dragClass:"formeditor-sortable-drag",ghostClass:"formeditor-sortable-ghost",onUpdate:function(){G(t(r),u,e.propertyPath,o)}})}):t(n().getDomElementDataIdentifierSelector("propertyGridEditorSortRow"),t(f)).parent().off().empty(),t(n().getDomElementDataIdentifierSelector("propertyGridEditorSelectValue"),t(f)).on("change",function(){u||t(n().getDomElementDataIdentifierSelector("propertyGridEditorSelectValue")+":checked",t(r)).not(t(this)).prop("checked",!1),G(t(r),u,e.propertyPath,o)}),t(n().getDomElementDataIdentifierSelector("propertyGridEditorLabel")+","+n().getDomElementDataIdentifierSelector("propertyGridEditorValue"),t(f)).on("keyup paste",function(){G(t(r),u,e.propertyPath,o)}),p&&t(n().getDomElementDataIdentifierSelector("propertyGridEditorLabel"),t(f)).on("focusout",function(){t(this).closest(n().getDomElementDataIdentifierSelector("propertyGridEditorRowItem")).find(n().getDomElementDataIdentifierSelector("propertyGridEditorValue")).val()===""&&t(this).closest(n().getDomElementDataIdentifierSelector("propertyGridEditorRowItem")).find(n().getDomElementDataIdentifierSelector("propertyGridEditorValue")).val(t(this).val())}),e.enableAddRow){const h=t(n().getDomElementDataIdentifierSelector("propertyGridEditorAddRowItem"),t(r)).clone();t(n().getDomElementDataIdentifierSelector("propertyGridEditorAddRowItem"),t(r)).remove(),t(n().getDomElementDataIdentifierSelector("propertyGridEditorAddRow"),t(h)).on("click",function(){t(this).closest(n().getDomElementDataIdentifierSelector("propertyGridEditorAddRowItem")).before(t(f).clone(!0,!0)),G(t(r),u,e.propertyPath,o)}),t(n().getDomElementDataIdentifierSelector("propertyGridEditorContainer"),t(r)).prepend(t(h).clone(!0,!0))}else t(n().getDomElementDataIdentifierSelector("propertyGridEditorAddRowItem"),t(r)).remove();let y={};u?d().isUndefinedOrNull(E().get(o+"defaultValue"))||(y=E().get(o+"defaultValue")):d().isUndefinedOrNull(E().get(o+"defaultValue"))||(y={0:E().get(o+"defaultValue")});const b=E().get(o+e.propertyPath)||{},D=function(h,T){let O=!1;const I=t(f).clone(!0,!0);for(const k of Object.keys(y))if(y[k]===T){O=!0;break}t(n().getDomElementDataIdentifierSelector("propertyGridEditorLabel"),t(I)).val(h),t(n().getDomElementDataIdentifierSelector("propertyGridEditorValue"),t(I)).val(T),O&&t(n().getDomElementDataIdentifierSelector("propertyGridEditorSelectValue"),t(I)).prop("checked",!0),e.enableAddRow?t(n().getDomElementDataIdentifierSelector("propertyGridEditorAddRowItem"),t(r)).before(t(I)):t(n().getDomElementDataIdentifierSelector("propertyGridEditorContainer"),t(r)).prepend(t(I))};if(t.type(b)==="object")for(const h of Object.keys(b))D(b[h],h);else if(t.type(b)==="array")for(const h in b)b.hasOwnProperty(h)&&(d().isUndefinedOrNull(b[h]._label)?D(b[h],h):D(b[h]._label,b[h]._value));S(o+e.propertyPath,r)}function me(e,r,a,l){m(t.type(e)==="object",'Invalid parameter "editorConfiguration"',1475417093),m(t.type(r)==="object",'Invalid parameter "editorHtml"',1475417094),m(d().isNonEmptyString(e.validatorIdentifier),'Invalid configuration "validatorIdentifier"',1475417095),m(d().isNonEmptyString(e.label),'Invalid configuration "label"',1475417096);const o=e.validatorIdentifier;n().getTemplatePropertyDomElement("label",r).append(e.label);let p,s,i;d().isNonEmptyString(e.propertyPath)&&(s=g().buildPropertyPath(e.propertyPath,a,l)),d().isNonEmptyString(e.propertyValue)?p=e.propertyValue:p="";const c=g().buildPropertyPath(e.configurationOptions.validationErrorMessage.propertyPath),u=n().getTemplatePropertyDomElement("validationErrorMessage",t(r)).clone();n().getTemplatePropertyDomElement("validationErrorMessage",t(r)).remove();const f=function(){const y=t(u).clone(!0,!0);C(r).after(y),n().getTemplatePropertyDomElement("validationErrorMessage-label",y).append(e.configurationOptions.validationErrorMessage.label),n().getTemplatePropertyDomElement("validationErrorMessage-fieldExplanationText",y).append(e.configurationOptions.validationErrorMessage.fieldExplanationText),i=E().get(c),d().isUndefinedOrNull(i)&&(i=[]);const b=Z(e.configurationOptions.validationErrorMessage.errorCodes,i);d().isUndefinedOrNull(b)||n().getTemplatePropertyDomElement("validationErrorMessage-propertyPath",y).val(b),n().getTemplatePropertyDomElement("validationErrorMessage-propertyPath",y).on("keyup paste",function(){let D=E().get(c);d().isUndefinedOrNull(D)&&(D=[]),E().set(c,K(e.configurationOptions.validationErrorMessage.errorCodes,D,t(this).val()))})};g().getIndexFromPropertyCollectionElement(o,"validators")!==-1&&(t('input[type="checkbox"]',t(r)).prop("checked",!0),d().isNonEmptyString(s)&&E().set(s,p),f()),t('input[type="checkbox"]',t(r)).on("change",function(){n().getTemplatePropertyDomElement("validationErrorMessage",t(r)).off().empty().remove(),t(this).is(":checked")?(f(),N().publish("view/inspector/collectionElement/new/selected",[o,"validators"]),d().isNonEmptyString(s)&&E().set(s,p)):(N().publish("view/inspector/removeCollectionElement/perform",[o,"validators"]),d().isNonEmptyString(s)&&E().unset(s),i=E().get(c),d().isUndefinedOrNull(i)&&(i=[]),E().set(c,K(e.configurationOptions.validationErrorMessage.errorCodes,i,"")))})}function de(e,r,a,l){m(t.type(e)==="object",'Invalid parameter "editorConfiguration"',1476218671),m(t.type(r)==="object",'Invalid parameter "editorHtml"',1476218672),m(d().isNonEmptyString(e.label),'Invalid configuration "label"',1476218673),m(d().isNonEmptyString(e.propertyPath),'Invalid configuration "propertyPath"',1476218674),n().getTemplatePropertyDomElement("label",r).append(e.label),d().isNonEmptyString(e.fieldExplanationText)?n().getTemplatePropertyDomElement("fieldExplanationText",r).text(e.fieldExplanationText):n().getTemplatePropertyDomElement("fieldExplanationText",r).remove();const o=g().buildPropertyPath(e.propertyPath,a,l),p=E().get(o);(t.type(p)==="boolean"&&p||p==="true"||p===1||p==="1")&&t('input[type="checkbox"]',t(r)).prop("checked",!0),t('input[type="checkbox"]',t(r)).on("change",function(){t(this).is(":checked")?E().set(o,!0):E().set(o,!1)})}function ce(e,r,a,l){m(t.type(e)==="object",'Invalid parameter "editorConfiguration"',1475412567),m(t.type(r)==="object",'Invalid parameter "editorHtml"',1475412568),m(d().isNonEmptyString(e.propertyPath),'Invalid configuration "propertyPath"',1475416098),m(d().isNonEmptyString(e.label),'Invalid configuration "label"',1475416099);const o=g().buildPropertyPath(e.propertyPath,a,l);n().getTemplatePropertyDomElement("label",r).append(e.label),d().isNonEmptyString(e.fieldExplanationText)?n().getTemplatePropertyDomElement("fieldExplanationText",r).text(e.fieldExplanationText):n().getTemplatePropertyDomElement("fieldExplanationText",r).remove();const p=E().get(o);t("textarea",t(r)).val(p),t("textarea",t(r)).on("keyup paste",function(){E().set(o,t(this).val())})}function Ee(e,r,a,l){m(t.type(e)==="object",'Invalid parameter "editorConfiguration"',1477300587),m(t.type(r)==="object",'Invalid parameter "editorHtml"',1477300588),m(d().isNonEmptyString(e.label),'Invalid configuration "label"',1477300589),m(d().isNonEmptyString(e.buttonLabel),'Invalid configuration "buttonLabel"',1477318981),m(d().isNonEmptyString(e.propertyPath),'Invalid configuration "propertyPath"',1477300590),n().getTemplatePropertyDomElement("label",r).append(e.label),n().getTemplatePropertyDomElement("buttonLabel",r).append(e.buttonLabel),d().isNonEmptyString(e.fieldExplanationText)?n().getTemplatePropertyDomElement("fieldExplanationText",r).text(e.fieldExplanationText):n().getTemplatePropertyDomElement("fieldExplanationText",r).remove(),t("form",t(r)).prop("name",e.propertyPath),v.getIcon(e.iconIdentifier,v.sizes.small).then(function(s){n().getTemplatePropertyDomElement("image",r).append(t(s))}),n().getTemplatePropertyDomElement("onclick",r).on("click",function(){const s=Math.floor(Math.random()*1e5+1);t(this).closest(n().getDomElementDataIdentifierSelector("editorControlsWrapper")).find(n().getDomElementDataAttribute("contentElementSelectorTarget","bracesWithKey")).attr(n().getDomElementDataAttribute("contentElementSelectorTarget"),s),he("db",s+"|||"+e.browsableType)}),ve();const o=g().buildPropertyPath(e.propertyPath,a,l),p=E().get(o);S(o,r),n().getTemplatePropertyDomElement("propertyPath",r).val(p),n().getTemplatePropertyDomElement("propertyPath",r).on("keyup paste",function(){E().set(o,t(this).val()),S(o,r)})}function fe(e,r,a,l){m(t.type(e)==="object",'Invalid parameter "editorConfiguration"',1475412563),m(t.type(r)==="object",'Invalid parameter "editorHtml"',1475412564),d().isUndefinedOrNull(a)?t("button",t(r)).addClass(n().getDomElementClassName("buttonFormElementRemove")+" "+n().getDomElementClassName("buttonFormEditor")):t("button",t(r)).addClass(n().getDomElementClassName("buttonCollectionElementRemove")),t("button",t(r)).on("click",function(){d().isUndefinedOrNull(a)?x().showRemoveFormElementModal():x().showRemoveCollectionElementModal(a,l)})}function ue(e,r,a){m(t.type(e)==="object",'Invalid parameter "editorConfiguration"',1484574704),m(t.type(r)==="object",'Invalid parameter "editorHtml"',1484574705),m(d().isNonEmptyString(a),'Invalid parameter "propertyPath"',1484574706);const l=t(n().getDomElementDataIdentifierSelector("formElementSelectorControlsWrapper"),r);if(e.enableFormelementSelectionButton===!0){if(l.length===0)return;const o=t(n().getDomElementDataIdentifierSelector("formElementSelectorSplitButtonListContainer"),r);o.off().empty();const p=g().getNonCompositeNonToplevelFormElements();p.length===0?v.getIcon(n().getDomElementDataAttributeValue("iconNotAvailable"),v.sizes.small,null,v.states.default).then(function(s){const i=t('<li data-no-sorting><span class="dropdown-item"></span></li>');i.find("span").append(t(s)).append(" "+P(Q(),"inspectorEditorFormElementSelectorNoElements")),o.append(i)}):t.each(p,function(s,i){v.getIcon(P(i,"iconIdentifier"),v.sizes.small,null,v.states.default).then(function(c){const u=t('<li data-no-sorting><a href="#" class="dropdown-item" data-formelement-identifier="'+i.get("identifier")+'"></a></li>');t(J`[data-formelement-identifier="${i.get("identifier")}"]`,u).append(t(c)).append(" "+i.get("label")),t("a",u).on("click",function(){let f;f=E().get(a)||"",f.length===0?f="{"+t(this).attr("data-formelement-identifier")+"}":f=f+" {"+t(this).attr("data-formelement-identifier")+"}",E().set(a,f),n().getTemplatePropertyDomElement("propertyPath",r).val(f),S(a,r)}),o.append(u)})})}else t(n().getDomElementDataIdentifierSelector("editorControlsInputGroup"),r).removeClass(n().getDomElementClassName("inspectorInputGroup")),l.off().empty().remove()}function ye(e){d().isUndefinedOrNull(e)&&(e=E()),m(t.type(e)==="object",'Invalid parameter "formElement"',1478967319);let r;e.get("type")==="Form"?r=e.get("type"):r=P(e,"label")?P(e,"label"):e.get("identifier");const a=document.createElement("span");return a.textContent=r,a}function Te(e,r){return W=e,L=t.extend(!0,be,r||{}),M.bootstrap(W),this}export{Te as bootstrap,ye as buildTitleByFormElement,j as getCollectionElementDomElement,A as getFinishersContainerDomElement,R as getInspectorDomElement,F as getValidatorsContainerDomElement,de as renderCheckboxEditor,Se as renderCollectionElementEditors,te as renderCollectionElementHeaderEditor,$ as renderCollectionElementSelectionEditor,oe as renderCountrySelectEditor,Pe as renderEditors,re as renderFileMaxSizeEditor,ee as renderFormElementHeaderEditor,ue as renderFormElementSelectorEditorAddition,pe as renderGridColumnViewPortConfigurationEditor,ie as renderMultiSelectEditor,se as renderPropertyGridEditor,fe as renderRemoveElementEditor,me as renderRequiredValidatorEditor,le as renderSingleSelectEditor,ne as renderTextEditor,ce as renderTextareaEditor,Ee as renderTypo3WinBrowserEditor,ae as renderValidationErrorMessageEditor};
