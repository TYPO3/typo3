/*
 * This file is part of the TYPO3 CMS project.
 *
 * It is free software; you can redistribute it and/or modify it under
 * the terms of the GNU General Public License, either version 2
 * of the License, or any later version.
 *
 * For the full copyright and license information, please read the
 * LICENSE.txt file that was distributed with this source code.
 *
 * The TYPO3 project - inspiring people to share!
 */
import n from"jquery";import*as A from"@typo3/form/backend/form-editor/helper.js";import h from"@typo3/backend/icons.js";import M from"@typo3/backend/modal.js";import{MessageUtility as me}from"@typo3/backend/utility/message-utility.js";import ce from"sortablejs";import{selector as z}from"@typo3/core/literals.js";import{PropertyGridEditorUpdateEvent as de}from"@typo3/form/backend/form-editor/component/property-grid-editor.js";const Ee={domElementClassNames:{buttonFormElementRemove:"formeditor-inspector-element-remove-button",collectionElement:"formeditor-inspector-collection-element",finisherEditorPrefix:"t3-form-inspector-finishers-editor-",inspectorEditor:"formeditor-inspector-element",inspectorInputGroup:"input-group",validatorEditorPrefix:"formeditor-inspector-validators-editor-"},domElementDataAttributeNames:{contentElementSelectorTarget:"data-insert-target",finisher:"data-finisher-identifier",validator:"data-validator-identifier",randomId:"data-random-id",randomIdTarget:"data-random-id-attribute",randomIdIndex:"data-random-id-number",maximumFileSize:"data-maximumFileSize"},domElementDataAttributeValues:{collapse:"actions-view-table-expand",editorControlsInputGroup:"inspectorEditorControlsGroup",editorWrapper:"editorWrapper",editorControlsWrapper:"inspectorEditorControlsWrapper",formElementHeaderEditor:"inspectorFormElementHeaderEditor",formElementSelectorControlsWrapper:"inspectorEditorFormElementSelectorControlsWrapper",formElementSelectorSplitButtonContainer:"inspectorEditorFormElementSelectorSplitButtonContainer",formElementSelectorSplitButtonListContainer:"inspectorEditorFormElementSelectorSplitButtonListContainer",iconNotAvailable:"actions-close",inspector:"inspector","Inspector-CheckboxEditor":"Inspector-CheckboxEditor","Inspector-CollectionElementHeaderEditor":"Inspector-CollectionElementHeaderEditor","Inspector-FinishersEditor":"Inspector-FinishersEditor","Inspector-FormElementHeaderEditor":"Inspector-FormElementHeaderEditor","Inspector-PropertyGridEditor":"Inspector-PropertyGridEditor","Inspector-RemoveElementEditor":"Inspector-RemoveElementEditor","Inspector-RequiredValidatorEditor":"Inspector-RequiredValidatorEditor","Inspector-SingleSelectEditor":"Inspector-SingleSelectEditor","Inspector-MultiSelectEditor":"Inspector-MultiSelectEditor","Inspector-GridColumnViewPortConfigurationEditor":"Inspector-GridColumnViewPortConfigurationEditor","Inspector-TextareaEditor":"Inspector-TextareaEditor","Inspector-TextEditor":"Inspector-TextEditor","Inspector-Typo3WinBrowserEditor":"Inspector-Typo3WinBrowserEditor","Inspector-ValidatorsEditor":"Inspector-ValidatorsEditor","Inspector-ValidationErrorMessageEditor":"Inspector-ValidationErrorMessageEditor",inspectorFinishers:"inspectorFinishers",inspectorValidators:"inspectorValidators",viewportButton:"viewportButton"},domElementIdNames:{finisherPrefix:"t3-form-inspector-finishers-",validatorPrefix:"t3-form-inspector-validators-"},isSortable:!0};let j=null,U=null;function b(){return U}function x(){return b().getViewModel()}function a(e){return m().isUndefinedOrNull(e)?A.setConfiguration(j):A.setConfiguration(e)}function m(){return b().getUtility()}function i(e,t,r){return b().assert(e,t,r)}function q(){return b().getRootFormElement()}function f(){return b().getCurrentlySelectedFormElement()}function O(){return b().getPublisherSubscriber()}function I(e,t){return b().getFormElementDefinition(e,t)}function _(e,t,r,l){switch(e.templateName){case"Inspector-FormElementHeaderEditor":Y(e,t);break;case"Inspector-CollectionElementHeaderEditor":J(e,t,r,l);break;case"Inspector-MaximumFileSizeEditor":Q(e,t);break;case"Inspector-TextEditor":X(e,t,r,l);break;case"Inspector-FinishersEditor":W("finishers",e,t);break;case"Inspector-ValidatorsEditor":W("validators",e,t);break;case"Inspector-ValidationErrorMessageEditor":Z(e,t);break;case"Inspector-RemoveElementEditor":se(e,t,r,l);break;case"Inspector-RequiredValidatorEditor":ae(e,t,r,l);break;case"Inspector-CheckboxEditor":re(e,t,r,l);break;case"Inspector-CountrySelectEditor":C(e,t,r,l);break;case"Inspector-SingleSelectEditor":H(e,t,r,l);break;case"Inspector-MultiSelectEditor":ee(e,t,r,l);break;case"Inspector-GridColumnViewPortConfigurationEditor":te(e,t);break;case"Inspector-PropertyGridEditor":ne(e,t,r,l);break;case"Inspector-TextareaEditor":le(e,t,r,l);break;case"Inspector-Typo3WinBrowserEditor":oe(e,t,r,l);break;default:break}O().publish("view/inspector/editor/insert/perform",[e,t,r,l])}function ue(e,t){M.advanced({type:M.types.iframe,content:TYPO3.settings.FormEditor.typo3WinBrowserUrl+"&mode="+e+"&bparams="+t,size:M.sizes.large})}function fe(){window.addEventListener("message",function(e){if(!me.verifyOrigin(e.origin))throw"Denied message sent by "+e.origin;if(e.data.actionName==="typo3:elementBrowser:elementAdded"){if(typeof e.data.fieldName>"u")throw"fieldName not defined in message";if(typeof e.data.value>"u")throw"value not defined in message";const t=e.data.value.split("_");n(a().getDomElementDataAttribute("contentElementSelectorTarget","bracesWithKeyValue",[e.data.fieldName])).val(t.pop()).trigger("paste")}})}function ye(e,t){return e==="finishers"?a().getDomElementClassName("finisherEditorPrefix")+t:a().getDomElementClassName("validatorEditorPrefix")+t}function R(e,t,r){return e==="finishers"?a().getDomElementIdName("finisherPrefix",r)+t:a().getDomElementIdName("validatorPrefix",r)+t}function be(e,t){e.addClass(a().getDomElementClassName("sortable")),new ce(e.get(0),{draggable:a().getDomElementClassName("collectionElement",!0),filter:"input,textarea,select",preventOnFilter:!1,animation:200,fallbackTolerance:200,swapThreshold:.6,dragClass:"formeditor-sortable-drag",ghostClass:"formeditor-sortable-ghost",onEnd:function(r){let l;t==="finishers"?l=a().getDomElementDataAttribute("finisher"):l=a().getDomElementDataAttribute("validator");const o=n(r.item).attr(l),p=n(r.item).prevAll(a().getDomElementClassName("collectionElement",!0)).first().attr(l),c=n(r.item).nextAll(a().getDomElementClassName("collectionElement",!0)).first().attr(l);O().publish("view/inspector/collectionElements/dnd/update",[o,p,c,t])}})}function L(e){return n(a().getDomElementDataIdentifierSelector("editorWrapper"),n(e))}function N(e){return n(a().getDomElementDataIdentifierSelector("editorControlsWrapper"),n(e))}function T(e,t){let r,l,o;o=b().validateCurrentlySelectedFormElementProperty(e),o.length>0?(a().getTemplatePropertyDomElement("validationErrors",t).html('<span class="text-danger">'+o[0]+"</span>"),x().setElementValidationErrorClass(N(t),"hasError")):(a().getTemplatePropertyDomElement("validationErrors",t).html(""),x().removeElementValidationErrorClass(N(t),"hasError")),o=b().validateFormElement(f()),l=e.split("."),l=l[0]+"."+l[1],r=!1;for(let p=0,c=o.length;p<c;++p)if(o[p].propertyPath.indexOf(l,0)===0&&o[p].validationResults&&o[p].validationResults.length>0){r=!0;break}r?x().setElementValidationErrorClass(N(t).closest(a().getDomElementClassName("collectionElement",!0))):x().removeElementValidationErrorClass(N(t).closest(a().getDomElementClassName("collectionElement",!0)))}function K(e,t){i(n.type(e)==="array",'Invalid configuration "errorCodes"',1489932939),i(n.type(t)==="array",'Invalid configuration "propertyData"',1489932940);for(let r=0,l=e.length;r<l;++r)for(let o=0,p=t.length;o<p;++o)if(parseInt(e[r],10)===parseInt(t[o].code,10)&&m().isNonEmptyString(t[o].message))return t[o].message;return null}function B(e,t,r){if(i(n.type(t)==="array",'Invalid configuration "propertyData"',1489932942),!m().isUndefinedOrNull(e)&&n.type(e)==="array"){const l=[];for(let o=0,p=e.length;o<p;++o){let c=!1;for(let s=0,d=t.length;s<d;++s)parseInt(e[o],10)===parseInt(t[s].code,10)&&(c=!0,m().isNonEmptyString(r)?t[s].message=r:(t.splice(s,1),--d));c||m().isNonEmptyString(r)&&l.push({code:e[o],message:r})}t=t.concat(l)}return t}function $(e){i(n.type(e)==="object",'Invalid input "html"',1523904699),n(a().getDomElementClassName("inspectorEditor",!0)).each(function(){const t=n(this),r={};n(a().getDomElementDataAttribute("randomId","bracesWithKey"),t).each(function(){const l=n(this),o=l.attr(a().getDomElementDataAttribute("randomIdTarget")),p=l.attr(a().getDomElementDataAttribute("randomIdIndex"));l.is("["+o+"]")||(p in r||(r[p]="fe"+Math.floor(Math.random()*42)+Date.now()),l.attr(o,r[p]))})})}function w(){return n(a().getDomElementDataIdentifierSelector("inspector"))}function k(){return n(a().getDomElementDataIdentifierSelector("inspectorFinishers"),w())}function V(){return n(a().getDomElementDataIdentifierSelector("inspectorValidators"),w())}function F(e,t){return e==="finishers"?n(a().getDomElementDataAttribute("finisher","bracesWithKeyValue",[t]),k()):n(a().getDomElementDataAttribute("validator","bracesWithKeyValue",[t]),V())}function ge(e,t){m().isUndefinedOrNull(e)&&(e=f()),w().off().empty();const r=I(e,void 0);if(n.type(r.editors)==="array"){for(let l=0,o=r.editors.length;l<o;++l){const p=a().getTemplate(r.editors[l].templateName).clone();if(!p.length)continue;const c=n(p.html());n(c).first().addClass(a().getDomElementClassName("inspectorEditor")),w().append(n(c)),$(c),_(r.editors[l],c)}n.type(t)==="function"&&t()}}function ve(e,t){let r,l,o;i(m().isNonEmptyString(e),'Invalid parameter "collectionName"',1478354853),i(m().isNonEmptyString(t),'Invalid parameter "collectionElementIdentifier"',1478354854);const p=b().getPropertyCollectionElementConfiguration(t,e);if(n.type(p.editors)!=="array")return;const c=n("<div></div>").addClass(a().getDomElementClassName("collectionElement")).addClass("panel").addClass("panel-default");e==="finishers"?(o=k(),c.attr(a().getDomElementDataAttribute("finisher"),t)):(o=V(),c.attr(a().getDomElementDataAttribute("validator"),t)),o.append(c);const s=p.editors.length;s>0&&p.editors[0].identifier==="header"&&(l=document.createElement("div"),l.classList.add("panel-body"),r=document.createElement("div"),r.classList.add("panel-collapse","collapse"),r.id=R(e,t),r.appendChild(l));for(let d=0;d<s;++d){const y=a().getTemplate(p.editors[d].templateName).clone();if(!y.length)continue;const E=n(y.html());n(E).first().addClass(ye(e,p.editors[d].identifier)).addClass(a().getDomElementClassName("inspectorEditor")),d===0&&r?F(e,t).append(E).append(r):d===s-1&&r&&p.editors[d].identifier==="removeButton"||d>0&&r?l.append(E.get(0)):F(e,t).append(E),$(E),_(p.editors[d],E,t,e)}(s===2&&p.editors[0].identifier==="header"&&p.editors[1].identifier==="removeButton"||s===1&&p.editors[0].identifier==="header")&&n(a().getDomElementDataIdentifierSelector("collapse"),c).remove(),j.isSortable&&be(o,e)}function W(e,t,r){let l,o,p;i(m().isNonEmptyString(e),'Invalid configuration "collectionName"',1478362968),i(n.type(t)==="object",'Invalid parameter "editorConfiguration"',1475423098),i(n.type(r)==="object",'Invalid parameter "editorHtml"',1475423099),i(m().isNonEmptyString(t.label),'Invalid configuration "label"',1475423100),i(n.type(t.selectOptions)==="array",'Invalid configuration "selectOptions"',1475423101),e==="finishers"?(o=k(),l=q().get(e)):(o=V(),l=f().get(e)),o.off().empty(),a().getTemplatePropertyDomElement("label",r).text(t.label);const c=a().getTemplatePropertyDomElement("selectOptions",r),s=!m().isUndefinedOrNull(l)&&l.length>0;if(s)for(let d=0,y=l.length;d<y;++d)O().publish("view/inspector/collectionElement/existing/selected",[l[d].identifier,e]);p=!0;for(let d=0,y=t.selectOptions.length;d<y;++d){let E=!0;if(!m().isUndefinedOrNull(l)){for(let u=0,v=l.length;u<v;++u)if(l[u].identifier===t.selectOptions[d].value){E=!1;break}}E&&(c.append(new Option(t.selectOptions[d].label,t.selectOptions[d].value)),t.selectOptions[d].value!==""&&(p=!1))}if(p){a().getTemplatePropertyDomElement("select-group",r).off().empty().remove();const d=a().getTemplatePropertyDomElement("label-no-select",r);s?d.text(t.label):d.remove();return}a().getTemplatePropertyDomElement("label-no-select",r).remove(),c.on("change",function(){if(n(this).val()!==""){const d=n(this).val();n(z`option[value="${d}"]`,n(this)).remove(),b().getPublisherSubscriber().publish("view/inspector/collectionElement/new/selected",[d,e])}})}function Y(e,t){i(n.type(e)==="object",'Invalid parameter "editorConfiguration"',1475421525),i(n.type(t)==="object",'Invalid parameter "editorHtml"',1475421526),h.getIcon(I(f(),"iconIdentifier"),h.sizes.small,null,h.states.default).then(function(r){a().getTemplatePropertyDomElement("header-label",t).append(n(r).addClass(a().getDomElementClassName("icon"))).append(pe()).append("<code>"+f().get("identifier")+"</code>")})}function J(e,t,r,l){i(n.type(e)==="object",'Invalid parameter "editorConfiguration"',1475421258),i(m().isNonEmptyString(e.label),'Invalid configuration "label"',1475421257),i(n.type(t)==="object",'Invalid parameter "editorHtml"',1475421259);const o=function(c){const s=a().getTemplatePropertyDomElement("panel-icon",t);c?s.replaceWith(c):s.remove();const d=b().getPropertyCollectionElementConfiguration(r,l).editors;if(!(d.length===2&&d[0].identifier==="header"&&d[1].identifier==="removeButton"||d.length===1&&d[0].identifier==="header")){const u=document.createElement("button");u.classList.add("panel-button","collapsed"),u.setAttribute("type","button"),u.setAttribute("data-bs-toggle","collapse"),u.setAttribute("data-bs-target",R(l,r,!0)),u.setAttribute("aria-expaned","false"),u.setAttribute("aria-controls",R(l,r));const v=document.createElement("span");v.classList.add("caret"),a().getTemplatePropertyDomElement("panel-heading-row",t).find(".panel-title").before(v),a().getTemplatePropertyDomElement("panel-heading-row",t).wrapInner(u)}const E=F(l,r).get(0).querySelector(".formeditor-inspector-element-remove-button");if(E){const u=E.querySelector("button");u.classList.add("btn-sm"),u.querySelector(".btn-label").classList.add("visually-hidden");const v=document.createElement("div");v.classList.add("panel-actions"),v.append(u),a().getTemplatePropertyDomElement("panel-heading-row",t).append(v)}E?.remove()},p=b().getFormEditorDefinition(l,r);"iconIdentifier"in p?h.getIcon(p.iconIdentifier,h.sizes.small,null,h.states.default).then(function(c){o(c)}):o(),e.label&&a().getTemplatePropertyDomElement("panel-title",t).removeAttr("data-template-property").append(e.label)}function Q(e,t){if(i(n.type(e)==="object",'Invalid parameter "editorConfiguration"',1475421258),i(m().isNonEmptyString(e.label),'Invalid configuration "label"',1475421257),i(n.type(t)==="object",'Invalid parameter "editorHtml"',1475421259),e.label){const r=a().getTemplatePropertyDomElement("label",t),l=r.attr(a().getDomElementDataAttribute("maximumFileSize"));r.append(e.label.replace("{0}",l))}}function X(e,t,r,l){i(n.type(e)==="object",'Invalid parameter "editorConfiguration"',1475421053),i(n.type(t)==="object",'Invalid parameter "editorHtml"',1475421054),i(m().isNonEmptyString(e.label),'Invalid configuration "label"',1475421055),i(m().isNonEmptyString(e.propertyPath),'Invalid configuration "propertyPath"',1475421056),a().getTemplatePropertyDomElement("label",t).append(e.label),m().isNonEmptyString(e.fieldExplanationText)?a().getTemplatePropertyDomElement("fieldExplanationText",t).text(e.fieldExplanationText):a().getTemplatePropertyDomElement("fieldExplanationText",t).remove(),m().isNonEmptyString(e.placeholder)&&a().getTemplatePropertyDomElement("propertyPath",t).attr("placeholder",e.placeholder);const o=b().buildPropertyPath(e.propertyPath,r,l),p=f().get(o);if(T(o,t),a().getTemplatePropertyDomElement("propertyPath",t).val(p),!m().isUndefinedOrNull(e.additionalElementPropertyPaths)&&n.type(e.additionalElementPropertyPaths)==="array")for(let c=0,s=e.additionalElementPropertyPaths.length;c<s;++c)f().set(e.additionalElementPropertyPaths[c],p);ie(e,t,o),a().getTemplatePropertyDomElement("propertyPath",t).on("keyup paste",function(){if(e.doNotSetIfPropertyValueIsEmpty&&!m().isNonEmptyString(n(this).val())?f().unset(o):f().set(o,n(this).val()),T(o,t),!m().isUndefinedOrNull(e.additionalElementPropertyPaths)&&n.type(e.additionalElementPropertyPaths)==="array")for(let c=0,s=e.additionalElementPropertyPaths.length;c<s;++c)e.doNotSetIfPropertyValueIsEmpty&&!m().isNonEmptyString(n(this).val())?f().unset(e.additionalElementPropertyPaths[c]):f().set(e.additionalElementPropertyPaths[c],n(this).val())})}function Z(e,t){i(n.type(e)==="object",'Invalid parameter "editorConfiguration"',1489874121),i(n.type(t)==="object",'Invalid parameter "editorHtml"',1489874122),i(m().isNonEmptyString(e.label),'Invalid configuration "label"',1489874123),i(m().isNonEmptyString(e.propertyPath),'Invalid configuration "propertyPath"',1489874124),a().getTemplatePropertyDomElement("label",t).append(e.label),m().isNonEmptyString(e.fieldExplanationText)?a().getTemplatePropertyDomElement("fieldExplanationText",t).text(e.fieldExplanationText):a().getTemplatePropertyDomElement("fieldExplanationText",t).remove();const r=b().buildPropertyPath(e.propertyPath);let l=f().get(r);if(!m().isUndefinedOrNull(l)&&n.type(l)==="array"){const o=K(e.errorCodes,l);m().isUndefinedOrNull(o)||a().getTemplatePropertyDomElement("propertyPath",t).val(o)}a().getTemplatePropertyDomElement("propertyPath",t).on("keyup paste",function(){l=f().get(r),m().isUndefinedOrNull(l)&&(l=[]),f().set(r,B(e.errorCodes,l,n(this).val()))})}function C(e,t,r,l){i(n.type(e)==="object",'Invalid parameter "editorConfiguration"',1674826430),i(n.type(t)==="object",'Invalid parameter "editorHtml"',1674826431),i(m().isNonEmptyString(e.label),'Invalid configuration "label"',1674826432);const o=b().buildPropertyPath(e.propertyPath,r,l);a().getTemplatePropertyDomElement("label",t).append(e.label);const p=a().getTemplatePropertyDomElement("selectOptions",t),c=f().get(o)||{},s=n("option",p);p.empty();for(let d=0,y=s.length;d<y;++d){let E=!1;for(const v of Object.keys(c))if(s[d].value===c[v]){E=!0;break}const u=new Option(s[d].text,d.toString(),!1,E);n(u).data({value:s[d].value}),p.append(u)}p.on("change",function(){const d=[];n("option:selected",n(this)).each(function(){d.push(n(this).data("value"))}),f().set(o,d)})}function H(e,t,r,l){i(n.type(e)==="object",'Invalid parameter "editorConfiguration"',1475421048),i(n.type(t)==="object",'Invalid parameter "editorHtml"',1475421049),i(m().isNonEmptyString(e.label),'Invalid configuration "label"',1475421050),i(m().isNonEmptyString(e.propertyPath),'Invalid configuration "propertyPath"',1475421051),i(n.type(e.selectOptions)==="array",'Invalid configuration "selectOptions"',1475421052);const o=b().buildPropertyPath(e.propertyPath,r,l);a().getTemplatePropertyDomElement("label",t).append(e.label);const p=a().getTemplatePropertyDomElement("selectOptions",t),c=f().get(o);for(let s=0,d=e.selectOptions.length;s<d;++s){let y;e.selectOptions[s].value===c?y=new Option(e.selectOptions[s].label,s.toString(),!1,!0):y=new Option(e.selectOptions[s].label,s.toString()),n(y).data({value:e.selectOptions[s].value}),p.append(y)}p.on("change",function(){f().set(o,n("option:selected",n(this)).data("value"))})}function ee(e,t,r,l){i(n.type(e)==="object",'Invalid parameter "editorConfiguration"',1485712399),i(n.type(t)==="object",'Invalid parameter "editorHtml"',1485712400),i(m().isNonEmptyString(e.label),'Invalid configuration "label"',1485712401),i(m().isNonEmptyString(e.propertyPath),'Invalid configuration "propertyPath"',1485712402),i(n.type(e.selectOptions)==="array",'Invalid configuration "selectOptions"',1485712403);const o=b().buildPropertyPath(e.propertyPath,r,l);a().getTemplatePropertyDomElement("label",t).append(e.label);const p=a().getTemplatePropertyDomElement("selectOptions",t),c=f().get(o)||{};for(let s=0,d=e.selectOptions.length;s<d;++s){let y=null;for(const E of Object.keys(c))if(e.selectOptions[s].value===c[E]){y=new Option(e.selectOptions[s].label,s.toString(),!1,!0);break}y||(y=new Option(e.selectOptions[s].label,s.toString())),n(y).data({value:e.selectOptions[s].value}),p.append(y)}p.on("change",function(){const s=[];n("option:selected",n(this)).each(function(){s.push(n(this).data("value"))}),f().set(o,s)})}function te(e,t){if(i(n.type(e)==="object",'Invalid parameter "editorConfiguration"',1489528242),i(n.type(t)==="object",'Invalid parameter "editorHtml"',1489528243),i(m().isNonEmptyString(e.label),'Invalid configuration "label"',1489528244),i(n.type(e.configurationOptions.viewPorts)==="array",'Invalid configurationOptions "viewPorts"',1489528245),i(!m().isUndefinedOrNull(e.configurationOptions.numbersOfColumnsToUse.label),'Invalid configurationOptions "numbersOfColumnsToUse"',1489528246),i(!m().isUndefinedOrNull(e.configurationOptions.numbersOfColumnsToUse.propertyPath),'Invalid configuration "selectOptions"',1489528247),!I(f().get("__parentRenderable"),"_isGridRowFormElement")){t.remove();return}a().getTemplatePropertyDomElement("label",t).append(e.label);const r=n(a().getDomElementDataIdentifierSelector("viewportButton"),n(t)).clone();n(a().getDomElementDataIdentifierSelector("viewportButton"),n(t)).remove();const l=a().getTemplatePropertyDomElement("numbersOfColumnsToUse",n(t)).clone();a().getTemplatePropertyDomElement("numbersOfColumnsToUse",n(t)).remove();const o=N(t),p=function(c){a().getTemplatePropertyDomElement("numbersOfColumnsToUse",n(t)).off().empty().remove();const s=n(l).clone(!0,!0);L(t).after(s),n("input",s).focus(),a().getTemplatePropertyDomElement("numbersOfColumnsToUse-label",s).append(e.configurationOptions.numbersOfColumnsToUse.label.replace("{@viewPortLabel}",c.data("viewPortLabel"))),a().getTemplatePropertyDomElement("numbersOfColumnsToUse-fieldExplanationText",s).append(e.configurationOptions.numbersOfColumnsToUse.fieldExplanationText);const d=e.configurationOptions.numbersOfColumnsToUse.propertyPath.replace("{@viewPortIdentifier}",c.data("viewPortIdentifier"));a().getTemplatePropertyDomElement("numbersOfColumnsToUse-propertyPath",s).val(f().get(d)),a().getTemplatePropertyDomElement("numbersOfColumnsToUse-propertyPath",s).on("keyup paste change",function(){const y=n(this);n.isNumeric(y.val())||y.val(""),f().set(d,y.val())})};for(let c=0,s=e.configurationOptions.viewPorts.length;c<s;++c){const d=e.configurationOptions.viewPorts[c].viewPortIdentifier,y=e.configurationOptions.viewPorts[c].label,E=n(r).clone(!0,!0);if(E.text(d),E.data("viewPortIdentifier",d),E.data("viewPortLabel",y),E.attr("title",y),o.append(E),c===s-1){const u=n(l).clone(!0,!0);L(t).after(u),p(E),E.addClass(a().getDomElementClassName("active"))}n("button",o).on("click",function(){const u=n(this);n("button",o).removeClass(a().getDomElementClassName("active")),u.addClass(a().getDomElementClassName("active")),p(u)})}}function ne(e,t,r,l){i(n.type(e)==="object",'Invalid parameter "editorConfiguration"',1475419226),i(n.type(t)==="object",'Invalid parameter "editorHtml"',1475419227),i(n.type(e.enableAddRow)==="boolean",'Invalid configuration "enableAddRow"',1475419228),i(n.type(e.enableDeleteRow)==="boolean",'Invalid configuration "enableDeleteRow"',1475419230),i(n.type(e.isSortable)==="boolean",'Invalid configuration "isSortable"',1475419229),i(m().isNonEmptyString(e.propertyPath),'Invalid configuration "propertyPath"',1475419231),i(m().isNonEmptyString(e.label),'Invalid configuration "label"',1475419232),a().getTemplatePropertyDomElement("label",t).append(e.label),m().isNonEmptyString(e.fieldExplanationText)?a().getTemplatePropertyDomElement("fieldExplanationText",t).text(e.fieldExplanationText):a().getTemplatePropertyDomElement("fieldExplanationText",t).remove();const o=(()=>{const u=b().buildPropertyPath(void 0,r,l,void 0,!0);return m().isNonEmptyString(u)?u+".":u})(),p=m().isUndefinedOrNull(e.multiSelection)?!1:!!e.multiSelection,c=m().isNonEmptyArray(e.gridColumns)?e.gridColumns.some(u=>u.name==="selected"):!0,s=(()=>{const u=f().get(o+"defaultValue");return m().isUndefinedOrNull(u)?{}:p?u:{0:u}})(),d=(()=>{const u=f(),v=o+e.propertyPath,P=u.get(v)||{};let S;return Array.isArray(P)?S=P.map((g,D)=>({id:"fe"+Math.floor(Math.random()*42)+Date.now(),label:m().isUndefinedOrNull(g._label)?g:g._label,value:m().isUndefinedOrNull(g._label)?D:g._value,selected:!1})):typeof P=="object"&&(S=Object.entries(P).map(([g,D])=>({id:"fe"+Math.floor(Math.random()*42)+Date.now(),label:D,value:g,selected:!1}))),S.map(g=>{for(const D of Object.keys(s))if(s[D]===g.value){g.selected=!0;break}return g})})(),y=m().isUndefinedOrNull(e.useLabelAsFallbackValue)?!0:e.useLabelAsFallbackValue,E=t instanceof HTMLElement?t.querySelector("typo3-form-property-grid-editor"):t.get(0).querySelector("typo3-form-property-grid-editor");E.enableAddRow=e.enableAddRow,E.enableSelection=c,E.enableMultiSelection=p,E.enableSorting=e.isSortable??!1,E.enableDeleteRow=e.enableDeleteRow??!1,E.enableLabelAsFallbackValue=y,E.entries=d,m().isNonEmptyArray(e.gridColumns)&&e.gridColumns.forEach(u=>{u.name==="label"&&(E.labelLabel=u.title),u.name==="value"&&(E.labelValue=u.title),u.name==="selected"&&(E.labelSelected=u.title)}),E.addEventListener(de.eventName,u=>{const v=u.data,P=[],S=[];for(const g of v){const D=g.label,G=g.value===""?g.label:m().canBeInterpretedAsInteger(g.value)?parseInt(g.value,10):g.value;g.selected&&P.push(G),S.push({_label:D,_value:G})}p?f().set(o+"defaultValue",P):f().set(o+"defaultValue",P[0]??"",!0),f().set(o+e.propertyPath,S),T(o+e.propertyPath,t)}),T(o+e.propertyPath,t)}function ae(e,t,r,l){i(n.type(e)==="object",'Invalid parameter "editorConfiguration"',1475417093),i(n.type(t)==="object",'Invalid parameter "editorHtml"',1475417094),i(m().isNonEmptyString(e.validatorIdentifier),'Invalid configuration "validatorIdentifier"',1475417095),i(m().isNonEmptyString(e.label),'Invalid configuration "label"',1475417096);const o=e.validatorIdentifier;a().getTemplatePropertyDomElement("label",t).append(e.label);let p,c,s;m().isNonEmptyString(e.propertyPath)&&(c=b().buildPropertyPath(e.propertyPath,r,l)),m().isNonEmptyString(e.propertyValue)?p=e.propertyValue:p="";const d=b().buildPropertyPath(e.configurationOptions.validationErrorMessage.propertyPath),y=a().getTemplatePropertyDomElement("validationErrorMessage",n(t)).clone();a().getTemplatePropertyDomElement("validationErrorMessage",n(t)).remove();const E=function(){const u=n(y).clone(!0,!0);L(t).after(u),a().getTemplatePropertyDomElement("validationErrorMessage-label",u).append(e.configurationOptions.validationErrorMessage.label),a().getTemplatePropertyDomElement("validationErrorMessage-fieldExplanationText",u).append(e.configurationOptions.validationErrorMessage.fieldExplanationText),s=f().get(d),m().isUndefinedOrNull(s)&&(s=[]);const v=K(e.configurationOptions.validationErrorMessage.errorCodes,s);m().isUndefinedOrNull(v)||a().getTemplatePropertyDomElement("validationErrorMessage-propertyPath",u).val(v),a().getTemplatePropertyDomElement("validationErrorMessage-propertyPath",u).on("keyup paste",function(){let P=f().get(d);m().isUndefinedOrNull(P)&&(P=[]),f().set(d,B(e.configurationOptions.validationErrorMessage.errorCodes,P,n(this).val()))})};b().getIndexFromPropertyCollectionElement(o,"validators")!==-1&&(n('input[type="checkbox"]',n(t)).prop("checked",!0),m().isNonEmptyString(c)&&f().set(c,p),E()),n('input[type="checkbox"]',n(t)).on("change",function(){a().getTemplatePropertyDomElement("validationErrorMessage",n(t)).off().empty().remove(),n(this).is(":checked")?(E(),O().publish("view/inspector/collectionElement/new/selected",[o,"validators"]),m().isNonEmptyString(c)&&f().set(c,p)):(O().publish("view/inspector/removeCollectionElement/perform",[o,"validators"]),m().isNonEmptyString(c)&&f().unset(c),s=f().get(d),m().isUndefinedOrNull(s)&&(s=[]),f().set(d,B(e.configurationOptions.validationErrorMessage.errorCodes,s,"")))})}function re(e,t,r,l){i(n.type(e)==="object",'Invalid parameter "editorConfiguration"',1476218671),i(n.type(t)==="object",'Invalid parameter "editorHtml"',1476218672),i(m().isNonEmptyString(e.label),'Invalid configuration "label"',1476218673),i(m().isNonEmptyString(e.propertyPath),'Invalid configuration "propertyPath"',1476218674),a().getTemplatePropertyDomElement("label",t).append(e.label),m().isNonEmptyString(e.fieldExplanationText)?a().getTemplatePropertyDomElement("fieldExplanationText",t).text(e.fieldExplanationText):a().getTemplatePropertyDomElement("fieldExplanationText",t).remove();const o=b().buildPropertyPath(e.propertyPath,r,l),p=f().get(o);(n.type(p)==="boolean"&&p||p==="true"||p===1||p==="1")&&n('input[type="checkbox"]',n(t)).prop("checked",!0),n('input[type="checkbox"]',n(t)).on("change",function(){n(this).is(":checked")?f().set(o,!0):f().set(o,!1)})}function le(e,t,r,l){i(n.type(e)==="object",'Invalid parameter "editorConfiguration"',1475412567),i(n.type(t)==="object",'Invalid parameter "editorHtml"',1475412568),i(m().isNonEmptyString(e.propertyPath),'Invalid configuration "propertyPath"',1475416098),i(m().isNonEmptyString(e.label),'Invalid configuration "label"',1475416099);const o=b().buildPropertyPath(e.propertyPath,r,l);a().getTemplatePropertyDomElement("label",t).append(e.label),m().isNonEmptyString(e.fieldExplanationText)?a().getTemplatePropertyDomElement("fieldExplanationText",t).text(e.fieldExplanationText):a().getTemplatePropertyDomElement("fieldExplanationText",t).remove();const p=f().get(o);n("textarea",n(t)).val(p),n("textarea",n(t)).on("keyup paste",function(){f().set(o,n(this).val())})}function oe(e,t,r,l){i(n.type(e)==="object",'Invalid parameter "editorConfiguration"',1477300587),i(n.type(t)==="object",'Invalid parameter "editorHtml"',1477300588),i(m().isNonEmptyString(e.label),'Invalid configuration "label"',1477300589),i(m().isNonEmptyString(e.buttonLabel),'Invalid configuration "buttonLabel"',1477318981),i(m().isNonEmptyString(e.propertyPath),'Invalid configuration "propertyPath"',1477300590),a().getTemplatePropertyDomElement("label",t).append(e.label),a().getTemplatePropertyDomElement("buttonLabel",t).append(e.buttonLabel),m().isNonEmptyString(e.fieldExplanationText)?a().getTemplatePropertyDomElement("fieldExplanationText",t).text(e.fieldExplanationText):a().getTemplatePropertyDomElement("fieldExplanationText",t).remove(),n("form",n(t)).prop("name",e.propertyPath),h.getIcon(e.iconIdentifier,h.sizes.small).then(function(c){a().getTemplatePropertyDomElement("image",t).append(n(c))}),a().getTemplatePropertyDomElement("onclick",t).on("click",function(){const c=Math.floor(Math.random()*1e5+1);n(this).closest(a().getDomElementDataIdentifierSelector("editorControlsWrapper")).find(a().getDomElementDataAttribute("contentElementSelectorTarget","bracesWithKey")).attr(a().getDomElementDataAttribute("contentElementSelectorTarget"),c),ue("db",c+"|||"+e.browsableType)}),fe();const o=b().buildPropertyPath(e.propertyPath,r,l),p=f().get(o);T(o,t),a().getTemplatePropertyDomElement("propertyPath",t).val(p),a().getTemplatePropertyDomElement("propertyPath",t).on("keyup paste",function(){f().set(o,n(this).val()),T(o,t)})}function se(e,t,r,l){i(n.type(e)==="object",'Invalid parameter "editorConfiguration"',1475412563),i(n.type(t)==="object",'Invalid parameter "editorHtml"',1475412564),m().isUndefinedOrNull(r)?n("button",n(t)).addClass(a().getDomElementClassName("buttonFormElementRemove")+" "+a().getDomElementClassName("buttonFormEditor")):n("button",n(t)).addClass(a().getDomElementClassName("buttonCollectionElementRemove")),n("button",n(t)).on("click",function(){m().isUndefinedOrNull(r)?x().showRemoveFormElementModal():x().showRemoveCollectionElementModal(r,l)})}function ie(e,t,r){i(n.type(e)==="object",'Invalid parameter "editorConfiguration"',1484574704),i(n.type(t)==="object",'Invalid parameter "editorHtml"',1484574705),i(m().isNonEmptyString(r),'Invalid parameter "propertyPath"',1484574706);const l=n(a().getDomElementDataIdentifierSelector("formElementSelectorControlsWrapper"),t);if(e.enableFormelementSelectionButton===!0){if(l.length===0)return;const o=n(a().getDomElementDataIdentifierSelector("formElementSelectorSplitButtonListContainer"),t);o.off().empty();const p=b().getNonCompositeNonToplevelFormElements();p.length===0?h.getIcon(a().getDomElementDataAttributeValue("iconNotAvailable"),h.sizes.small,null,h.states.default).then(function(c){const s=n('<li data-no-sorting><span class="dropdown-item"></span></li>');s.find("span").append(n(c)).append(" "+I(q(),"inspectorEditorFormElementSelectorNoElements")),o.append(s)}):n.each(p,function(c,s){h.getIcon(I(s,"iconIdentifier"),h.sizes.small,null,h.states.default).then(function(d){const y=n('<li data-no-sorting><a href="#" class="dropdown-item" data-formelement-identifier="'+s.get("identifier")+'"></a></li>');n(z`[data-formelement-identifier="${s.get("identifier")}"]`,y).append(n(d)).append(" "+s.get("label")),n("a",y).on("click",function(){let E;E=f().get(r)||"",E.length===0?E="{"+n(this).attr("data-formelement-identifier")+"}":E=E+" {"+n(this).attr("data-formelement-identifier")+"}",f().set(r,E),a().getTemplatePropertyDomElement("propertyPath",t).val(E),T(r,t)}),o.append(y)})})}else n(a().getDomElementDataIdentifierSelector("editorControlsInputGroup"),t).removeClass(a().getDomElementClassName("inspectorInputGroup")),l.off().empty().remove()}function pe(e){m().isUndefinedOrNull(e)&&(e=f()),i(n.type(e)==="object",'Invalid parameter "formElement"',1478967319);let t;e.get("type")==="Form"?t=e.get("type"):t=I(e,"label")?I(e,"label"):e.get("identifier");const r=document.createElement("span");return r.textContent=t,r}function he(e,t){return U=e,j=n.extend(!0,Ee,t||{}),A.bootstrap(U),this}export{he as bootstrap,pe as buildTitleByFormElement,F as getCollectionElementDomElement,k as getFinishersContainerDomElement,w as getInspectorDomElement,V as getValidatorsContainerDomElement,re as renderCheckboxEditor,ve as renderCollectionElementEditors,J as renderCollectionElementHeaderEditor,W as renderCollectionElementSelectionEditor,C as renderCountrySelectEditor,ge as renderEditors,Q as renderFileMaxSizeEditor,Y as renderFormElementHeaderEditor,ie as renderFormElementSelectorEditorAddition,te as renderGridColumnViewPortConfigurationEditor,ee as renderMultiSelectEditor,ne as renderPropertyGridEditor,se as renderRemoveElementEditor,ae as renderRequiredValidatorEditor,H as renderSingleSelectEditor,X as renderTextEditor,le as renderTextareaEditor,oe as renderTypo3WinBrowserEditor,Z as renderValidationErrorMessageEditor};
