/*
 * This file is part of the TYPO3 CMS project.
 *
 * It is free software; you can redistribute it and/or modify it under
 * the terms of the GNU General Public License, either version 2
 * of the License, or any later version.
 *
 * For the full copyright and license information, please read the
 * LICENSE.txt file that was distributed with this source code.
 *
 * The TYPO3 project - inspiring people to share!
 */
import n from"jquery";import*as M from"@typo3/form/backend/form-editor/helper.js";import D from"@typo3/backend/icons.js";import A from"@typo3/backend/modal.js";import{MessageUtility as ie}from"@typo3/backend/utility/message-utility.js";import me from"sortablejs";import{selector as ce}from"@typo3/core/literals.js";import{PropertyGridEditorUpdateEvent as de}from"@typo3/form/backend/form-editor/component/property-grid-editor.js";import{FormElementSelectorSelectedEvent as Ee}from"@typo3/form/backend/form-editor/component/form-element-selector.js";const ue={domElementClassNames:{buttonFormElementRemove:"formeditor-inspector-element-remove-button",collectionElement:"formeditor-inspector-collection-element",finisherEditorPrefix:"t3-form-inspector-finishers-editor-",inspectorEditor:"formeditor-inspector-element",inspectorInputGroup:"input-group",validatorEditorPrefix:"formeditor-inspector-validators-editor-"},domElementDataAttributeNames:{contentElementSelectorTarget:"data-insert-target",finisher:"data-finisher-identifier",validator:"data-validator-identifier",randomId:"data-random-id",randomIdTarget:"data-random-id-attribute",randomIdIndex:"data-random-id-number",maximumFileSize:"data-maximumFileSize"},domElementDataAttributeValues:{collapse:"actions-view-table-expand",editorControlsInputGroup:"inspectorEditorControlsGroup",editorWrapper:"editorWrapper",editorControlsWrapper:"inspectorEditorControlsWrapper",formElementHeaderEditor:"inspectorFormElementHeaderEditor",formElementSelectorControlsWrapper:"inspectorEditorFormElementSelectorControlsWrapper",formElementSelectorSplitButtonContainer:"inspectorEditorFormElementSelectorSplitButtonContainer",formElementSelectorSplitButtonListContainer:"inspectorEditorFormElementSelectorSplitButtonListContainer",iconNotAvailable:"actions-close",inspector:"inspector","Inspector-CheckboxEditor":"Inspector-CheckboxEditor","Inspector-CollectionElementHeaderEditor":"Inspector-CollectionElementHeaderEditor","Inspector-FinishersEditor":"Inspector-FinishersEditor","Inspector-FormElementHeaderEditor":"Inspector-FormElementHeaderEditor","Inspector-PropertyGridEditor":"Inspector-PropertyGridEditor","Inspector-RemoveElementEditor":"Inspector-RemoveElementEditor","Inspector-RequiredValidatorEditor":"Inspector-RequiredValidatorEditor","Inspector-SingleSelectEditor":"Inspector-SingleSelectEditor","Inspector-MultiSelectEditor":"Inspector-MultiSelectEditor","Inspector-GridColumnViewPortConfigurationEditor":"Inspector-GridColumnViewPortConfigurationEditor","Inspector-TextareaEditor":"Inspector-TextareaEditor","Inspector-TextEditor":"Inspector-TextEditor","Inspector-Typo3WinBrowserEditor":"Inspector-Typo3WinBrowserEditor","Inspector-ValidatorsEditor":"Inspector-ValidatorsEditor","Inspector-ValidationErrorMessageEditor":"Inspector-ValidationErrorMessageEditor",inspectorFinishers:"inspectorFinishers",inspectorValidators:"inspectorValidators",viewportButton:"viewportButton"},domElementIdNames:{finisherPrefix:"t3-form-inspector-finishers-",validatorPrefix:"t3-form-inspector-validators-"},isSortable:!0};let j=null,U=null;function b(){return U}function S(){return b().getViewModel()}function a(e){return i().isUndefinedOrNull(e)?M.setConfiguration(j):M.setConfiguration(e)}function i(){return b().getUtility()}function p(e,t,r){return b().assert(e,t,r)}function ye(){return b().getRootFormElement()}function y(){return b().getCurrentlySelectedFormElement()}function O(){return b().getPublisherSubscriber()}function x(e,t){return b().getFormElementDefinition(e,t)}function q(e,t,r,l){switch(e.templateName){case"Inspector-FormElementHeaderEditor":K(e,t);break;case"Inspector-CollectionElementHeaderEditor":$(e,t,r,l);break;case"Inspector-MaximumFileSizeEditor":Y(e,t);break;case"Inspector-TextEditor":J(e,t,r,l);break;case"Inspector-FinishersEditor":W("finishers",e,t);break;case"Inspector-ValidatorsEditor":W("validators",e,t);break;case"Inspector-ValidationErrorMessageEditor":Q(e,t);break;case"Inspector-RemoveElementEditor":le(e,t,r,l);break;case"Inspector-RequiredValidatorEditor":te(e,t,r,l);break;case"Inspector-CheckboxEditor":ne(e,t,r,l);break;case"Inspector-CountrySelectEditor":X(e,t,r,l);break;case"Inspector-SingleSelectEditor":Z(e,t,r,l);break;case"Inspector-MultiSelectEditor":C(e,t,r,l);break;case"Inspector-GridColumnViewPortConfigurationEditor":H(e,t);break;case"Inspector-PropertyGridEditor":ee(e,t,r,l);break;case"Inspector-TextareaEditor":ae(e,t,r,l);break;case"Inspector-Typo3WinBrowserEditor":re(e,t,r,l);break;default:break}O().publish("view/inspector/editor/insert/perform",[e,t,r,l])}function fe(e,t){A.advanced({type:A.types.iframe,content:TYPO3.settings.FormEditor.typo3WinBrowserUrl+"&mode="+e+"&bparams="+t,size:A.sizes.large})}function be(){window.addEventListener("message",function(e){if(!ie.verifyOrigin(e.origin))throw"Denied message sent by "+e.origin;if(e.data.actionName==="typo3:elementBrowser:elementAdded"){if(typeof e.data.fieldName>"u")throw"fieldName not defined in message";if(typeof e.data.value>"u")throw"value not defined in message";const t=e.data.value.split("_");n(a().getDomElementDataAttribute("contentElementSelectorTarget","bracesWithKeyValue",[e.data.fieldName])).val(t.pop()).trigger("paste")}})}function ve(e,t){return e==="finishers"?a().getDomElementClassName("finisherEditorPrefix")+t:a().getDomElementClassName("validatorEditorPrefix")+t}function B(e,t,r){return e==="finishers"?a().getDomElementIdName("finisherPrefix",r)+t:a().getDomElementIdName("validatorPrefix",r)+t}function he(e,t){e.addClass(a().getDomElementClassName("sortable")),new me(e.get(0),{draggable:a().getDomElementClassName("collectionElement",!0),filter:"input,textarea,select",preventOnFilter:!1,animation:200,fallbackTolerance:200,swapThreshold:.6,dragClass:"formeditor-sortable-drag",ghostClass:"formeditor-sortable-ghost",onEnd:function(r){let l;t==="finishers"?l=a().getDomElementDataAttribute("finisher"):l=a().getDomElementDataAttribute("validator");const o=n(r.item).attr(l),s=n(r.item).prevAll(a().getDomElementClassName("collectionElement",!0)).first().attr(l),c=n(r.item).nextAll(a().getDomElementClassName("collectionElement",!0)).first().attr(l);O().publish("view/inspector/collectionElements/dnd/update",[o,s,c,t])}})}function L(e){return n(a().getDomElementDataIdentifierSelector("editorWrapper"),n(e))}function N(e){return n(a().getDomElementDataIdentifierSelector("editorControlsWrapper"),n(e))}function g(e,t){let r,l,o;o=b().validateCurrentlySelectedFormElementProperty(e),o.length>0?(a().getTemplatePropertyDomElement("validationErrors",t).html('<span class="text-danger">'+o[0]+"</span>"),S().setElementValidationErrorClass(N(t),"hasError")):(a().getTemplatePropertyDomElement("validationErrors",t).html(""),S().removeElementValidationErrorClass(N(t),"hasError")),o=b().validateFormElement(y()),l=e.split("."),l=l[0]+"."+l[1],r=!1;for(let s=0,c=o.length;s<c;++s)if(o[s].propertyPath.indexOf(l,0)===0&&o[s].validationResults&&o[s].validationResults.length>0){r=!0;break}r?S().setElementValidationErrorClass(N(t).closest(a().getDomElementClassName("collectionElement",!0))):S().removeElementValidationErrorClass(N(t).closest(a().getDomElementClassName("collectionElement",!0)))}function z(e,t){p(n.type(e)==="array",'Invalid configuration "errorCodes"',1489932939),p(n.type(t)==="array",'Invalid configuration "propertyData"',1489932940);for(let r=0,l=e.length;r<l;++r)for(let o=0,s=t.length;o<s;++o)if(parseInt(e[r],10)===parseInt(t[o].code,10)&&i().isNonEmptyString(t[o].message))return t[o].message;return null}function R(e,t,r){if(p(n.type(t)==="array",'Invalid configuration "propertyData"',1489932942),!i().isUndefinedOrNull(e)&&n.type(e)==="array"){const l=[];for(let o=0,s=e.length;o<s;++o){let c=!1;for(let m=0,d=t.length;m<d;++m)parseInt(e[o],10)===parseInt(t[m].code,10)&&(c=!0,i().isNonEmptyString(r)?t[m].message=r:(t.splice(m,1),--d));c||i().isNonEmptyString(r)&&l.push({code:e[o],message:r})}t=t.concat(l)}return t}function _(e){p(n.type(e)==="object",'Invalid input "html"',1523904699),n(a().getDomElementClassName("inspectorEditor",!0)).each(function(){const t=n(this),r={};n(a().getDomElementDataAttribute("randomId","bracesWithKey"),t).each(function(){const l=n(this),o=l.attr(a().getDomElementDataAttribute("randomIdTarget")),s=l.attr(a().getDomElementDataAttribute("randomIdIndex"));l.is("["+o+"]")||(s in r||(r[s]="fe"+Math.floor(Math.random()*42)+Date.now()),l.attr(o,r[s]))})})}function w(){return n(a().getDomElementDataIdentifierSelector("inspector"))}function F(){return n(a().getDomElementDataIdentifierSelector("inspectorFinishers"),w())}function V(){return n(a().getDomElementDataIdentifierSelector("inspectorValidators"),w())}function k(e,t){return e==="finishers"?n(a().getDomElementDataAttribute("finisher","bracesWithKeyValue",[t]),F()):n(a().getDomElementDataAttribute("validator","bracesWithKeyValue",[t]),V())}function ge(e,t){i().isUndefinedOrNull(e)&&(e=y()),w().off().empty();const r=x(e,void 0);if(n.type(r.editors)==="array"){for(let l=0,o=r.editors.length;l<o;++l){const s=a().getTemplate(r.editors[l].templateName).clone();if(!s.length)continue;const c=n(s.html());n(c).first().addClass(a().getDomElementClassName("inspectorEditor")),w().append(n(c)),_(c),q(r.editors[l],c)}n.type(t)==="function"&&t()}}function Pe(e,t){let r,l,o;p(i().isNonEmptyString(e),'Invalid parameter "collectionName"',1478354853),p(i().isNonEmptyString(t),'Invalid parameter "collectionElementIdentifier"',1478354854);const s=b().getPropertyCollectionElementConfiguration(t,e);if(n.type(s.editors)!=="array")return;const c=n("<div></div>").addClass(a().getDomElementClassName("collectionElement")).addClass("panel").addClass("panel-default");e==="finishers"?(o=F(),c.attr(a().getDomElementDataAttribute("finisher"),t)):(o=V(),c.attr(a().getDomElementDataAttribute("validator"),t)),o.append(c);const m=s.editors.length;m>0&&s.editors[0].identifier==="header"&&(l=document.createElement("div"),l.classList.add("panel-body"),r=document.createElement("div"),r.classList.add("panel-collapse","collapse"),r.id=B(e,t),r.appendChild(l));for(let d=0;d<m;++d){const f=a().getTemplate(s.editors[d].templateName).clone();if(!f.length)continue;const u=n(f.html());n(u).first().addClass(ve(e,s.editors[d].identifier)).addClass(a().getDomElementClassName("inspectorEditor")),d===0&&r?k(e,t).append(u).append(r):d===m-1&&r&&s.editors[d].identifier==="removeButton"||d>0&&r?l.append(u.get(0)):k(e,t).append(u),_(u),q(s.editors[d],u,t,e)}(m===2&&s.editors[0].identifier==="header"&&s.editors[1].identifier==="removeButton"||m===1&&s.editors[0].identifier==="header")&&n(a().getDomElementDataIdentifierSelector("collapse"),c).remove(),j.isSortable&&he(o,e)}function W(e,t,r){let l,o,s;p(i().isNonEmptyString(e),'Invalid configuration "collectionName"',1478362968),p(n.type(t)==="object",'Invalid parameter "editorConfiguration"',1475423098),p(n.type(r)==="object",'Invalid parameter "editorHtml"',1475423099),p(i().isNonEmptyString(t.label),'Invalid configuration "label"',1475423100),p(n.type(t.selectOptions)==="array",'Invalid configuration "selectOptions"',1475423101),e==="finishers"?(o=F(),l=ye().get(e)):(o=V(),l=y().get(e)),o.off().empty(),a().getTemplatePropertyDomElement("label",r).text(t.label);const c=a().getTemplatePropertyDomElement("selectOptions",r),m=!i().isUndefinedOrNull(l)&&l.length>0;if(m)for(let d=0,f=l.length;d<f;++d)O().publish("view/inspector/collectionElement/existing/selected",[l[d].identifier,e]);s=!0;for(let d=0,f=t.selectOptions.length;d<f;++d){let u=!0;if(!i().isUndefinedOrNull(l)){for(let E=0,h=l.length;E<h;++E)if(l[E].identifier===t.selectOptions[d].value){u=!1;break}}u&&(c.append(new Option(t.selectOptions[d].label,t.selectOptions[d].value)),t.selectOptions[d].value!==""&&(s=!1))}if(s){a().getTemplatePropertyDomElement("select-group",r).off().empty().remove();const d=a().getTemplatePropertyDomElement("label-no-select",r);m?d.text(t.label):d.remove();return}a().getTemplatePropertyDomElement("label-no-select",r).remove(),c.on("change",function(){if(n(this).val()!==""){const d=n(this).val();n(ce`option[value="${d}"]`,n(this)).remove(),b().getPublisherSubscriber().publish("view/inspector/collectionElement/new/selected",[d,e])}})}function K(e,t){p(n.type(e)==="object",'Invalid parameter "editorConfiguration"',1475421525),p(n.type(t)==="object",'Invalid parameter "editorHtml"',1475421526),D.getIcon(x(y(),"iconIdentifier"),D.sizes.small,null,D.states.default).then(function(r){a().getTemplatePropertyDomElement("header-label",t).append(n(r).addClass(a().getDomElementClassName("icon"))).append(pe()).append("<code>"+y().get("identifier")+"</code>")})}function $(e,t,r,l){p(n.type(e)==="object",'Invalid parameter "editorConfiguration"',1475421258),p(i().isNonEmptyString(e.label),'Invalid configuration "label"',1475421257),p(n.type(t)==="object",'Invalid parameter "editorHtml"',1475421259);const o=function(c){const m=a().getTemplatePropertyDomElement("panel-icon",t);c?m.replaceWith(c):m.remove();const d=b().getPropertyCollectionElementConfiguration(r,l).editors;if(!(d.length===2&&d[0].identifier==="header"&&d[1].identifier==="removeButton"||d.length===1&&d[0].identifier==="header")){const E=document.createElement("button");E.classList.add("panel-button","collapsed"),E.setAttribute("type","button"),E.setAttribute("data-bs-toggle","collapse"),E.setAttribute("data-bs-target",B(l,r,!0)),E.setAttribute("aria-expaned","false"),E.setAttribute("aria-controls",B(l,r));const h=document.createElement("span");h.classList.add("caret"),a().getTemplatePropertyDomElement("panel-heading-row",t).find(".panel-title").before(h),a().getTemplatePropertyDomElement("panel-heading-row",t).wrapInner(E)}const u=k(l,r).get(0).querySelector(".formeditor-inspector-element-remove-button");if(u){const E=u.querySelector("button");E.classList.add("btn-sm"),E.querySelector(".btn-label").classList.add("visually-hidden");const h=document.createElement("div");h.classList.add("panel-actions"),h.append(E),a().getTemplatePropertyDomElement("panel-heading-row",t).append(h)}u?.remove()},s=b().getFormEditorDefinition(l,r);"iconIdentifier"in s?D.getIcon(s.iconIdentifier,D.sizes.small,null,D.states.default).then(function(c){o(c)}):o(),e.label&&a().getTemplatePropertyDomElement("panel-title",t).removeAttr("data-template-property").append(e.label)}function Y(e,t){if(p(n.type(e)==="object",'Invalid parameter "editorConfiguration"',1475421258),p(i().isNonEmptyString(e.label),'Invalid configuration "label"',1475421257),p(n.type(t)==="object",'Invalid parameter "editorHtml"',1475421259),e.label){const r=a().getTemplatePropertyDomElement("label",t),l=r.attr(a().getDomElementDataAttribute("maximumFileSize"));r.append(e.label.replace("{0}",l))}}function J(e,t,r,l){p(n.type(e)==="object",'Invalid parameter "editorConfiguration"',1475421053),p(n.type(t)==="object",'Invalid parameter "editorHtml"',1475421054),p(i().isNonEmptyString(e.label),'Invalid configuration "label"',1475421055),p(i().isNonEmptyString(e.propertyPath),'Invalid configuration "propertyPath"',1475421056),a().getTemplatePropertyDomElement("label",t).append(e.label),i().isNonEmptyString(e.fieldExplanationText)?a().getTemplatePropertyDomElement("fieldExplanationText",t).text(e.fieldExplanationText):a().getTemplatePropertyDomElement("fieldExplanationText",t).remove(),i().isNonEmptyString(e.placeholder)&&a().getTemplatePropertyDomElement("propertyPath",t).attr("placeholder",e.placeholder);const o=b().buildPropertyPath(e.propertyPath,r,l),s=y().get(o);if(g(o,t),a().getTemplatePropertyDomElement("propertyPath",t).val(s),!i().isUndefinedOrNull(e.additionalElementPropertyPaths)&&n.type(e.additionalElementPropertyPaths)==="array")for(let c=0,m=e.additionalElementPropertyPaths.length;c<m;++c)y().set(e.additionalElementPropertyPaths[c],s);oe(e,t,o),a().getTemplatePropertyDomElement("propertyPath",t).on("keyup paste",function(){if(e.doNotSetIfPropertyValueIsEmpty&&!i().isNonEmptyString(n(this).val())?y().unset(o):y().set(o,n(this).val()),g(o,t),!i().isUndefinedOrNull(e.additionalElementPropertyPaths)&&n.type(e.additionalElementPropertyPaths)==="array")for(let c=0,m=e.additionalElementPropertyPaths.length;c<m;++c)e.doNotSetIfPropertyValueIsEmpty&&!i().isNonEmptyString(n(this).val())?y().unset(e.additionalElementPropertyPaths[c]):y().set(e.additionalElementPropertyPaths[c],n(this).val())})}function Q(e,t){p(n.type(e)==="object",'Invalid parameter "editorConfiguration"',1489874121),p(n.type(t)==="object",'Invalid parameter "editorHtml"',1489874122),p(i().isNonEmptyString(e.label),'Invalid configuration "label"',1489874123),p(i().isNonEmptyString(e.propertyPath),'Invalid configuration "propertyPath"',1489874124),a().getTemplatePropertyDomElement("label",t).append(e.label),i().isNonEmptyString(e.fieldExplanationText)?a().getTemplatePropertyDomElement("fieldExplanationText",t).text(e.fieldExplanationText):a().getTemplatePropertyDomElement("fieldExplanationText",t).remove();const r=b().buildPropertyPath(e.propertyPath);let l=y().get(r);if(!i().isUndefinedOrNull(l)&&n.type(l)==="array"){const o=z(e.errorCodes,l);i().isUndefinedOrNull(o)||a().getTemplatePropertyDomElement("propertyPath",t).val(o)}a().getTemplatePropertyDomElement("propertyPath",t).on("keyup paste",function(){l=y().get(r),i().isUndefinedOrNull(l)&&(l=[]),y().set(r,R(e.errorCodes,l,n(this).val()))})}function X(e,t,r,l){p(n.type(e)==="object",'Invalid parameter "editorConfiguration"',1674826430),p(n.type(t)==="object",'Invalid parameter "editorHtml"',1674826431),p(i().isNonEmptyString(e.label),'Invalid configuration "label"',1674826432);const o=b().buildPropertyPath(e.propertyPath,r,l);a().getTemplatePropertyDomElement("label",t).append(e.label);const s=a().getTemplatePropertyDomElement("selectOptions",t),c=y().get(o)||{};g(o,t);const m=n("option",s);s.empty();for(let d=0,f=m.length;d<f;++d){let u=!1;for(const h of Object.keys(c))if(m[d].value===c[h]){u=!0;break}const E=new Option(m[d].text,d.toString(),!1,u);n(E).data({value:m[d].value}),s.append(E)}s.on("change",function(){const d=[];n("option:selected",n(this)).each(function(){d.push(n(this).data("value"))}),y().set(o,d),g(o,t)})}function Z(e,t,r,l){p(n.type(e)==="object",'Invalid parameter "editorConfiguration"',1475421048),p(n.type(t)==="object",'Invalid parameter "editorHtml"',1475421049),p(i().isNonEmptyString(e.label),'Invalid configuration "label"',1475421050),p(i().isNonEmptyString(e.propertyPath),'Invalid configuration "propertyPath"',1475421051),p(n.type(e.selectOptions)==="array",'Invalid configuration "selectOptions"',1475421052);const o=b().buildPropertyPath(e.propertyPath,r,l);a().getTemplatePropertyDomElement("label",t).append(e.label);const s=a().getTemplatePropertyDomElement("selectOptions",t),c=y().get(o);g(o,t);for(let m=0,d=e.selectOptions.length;m<d;++m){let f;e.selectOptions[m].value===c?f=new Option(e.selectOptions[m].label,m.toString(),!1,!0):f=new Option(e.selectOptions[m].label,m.toString()),n(f).data({value:e.selectOptions[m].value}),s.append(f)}s.on("change",function(){y().set(o,n("option:selected",n(this)).data("value")),g(o,t)})}function C(e,t,r,l){p(n.type(e)==="object",'Invalid parameter "editorConfiguration"',1485712399),p(n.type(t)==="object",'Invalid parameter "editorHtml"',1485712400),p(i().isNonEmptyString(e.label),'Invalid configuration "label"',1485712401),p(i().isNonEmptyString(e.propertyPath),'Invalid configuration "propertyPath"',1485712402),p(n.type(e.selectOptions)==="array",'Invalid configuration "selectOptions"',1485712403);const o=b().buildPropertyPath(e.propertyPath,r,l);a().getTemplatePropertyDomElement("label",t).append(e.label);const s=a().getTemplatePropertyDomElement("selectOptions",t),c=y().get(o)||{};g(o,t);for(let m=0,d=e.selectOptions.length;m<d;++m){let f=null;for(const u of Object.keys(c))if(e.selectOptions[m].value===c[u]){f=new Option(e.selectOptions[m].label,m.toString(),!1,!0);break}f||(f=new Option(e.selectOptions[m].label,m.toString())),n(f).data({value:e.selectOptions[m].value}),s.append(f)}s.on("change",function(){const m=[];n("option:selected",n(this)).each(function(){m.push(n(this).data("value"))}),y().set(o,m),g(o,t)})}function H(e,t){if(p(n.type(e)==="object",'Invalid parameter "editorConfiguration"',1489528242),p(n.type(t)==="object",'Invalid parameter "editorHtml"',1489528243),p(i().isNonEmptyString(e.label),'Invalid configuration "label"',1489528244),p(n.type(e.configurationOptions.viewPorts)==="array",'Invalid configurationOptions "viewPorts"',1489528245),p(!i().isUndefinedOrNull(e.configurationOptions.numbersOfColumnsToUse.label),'Invalid configurationOptions "numbersOfColumnsToUse"',1489528246),p(!i().isUndefinedOrNull(e.configurationOptions.numbersOfColumnsToUse.propertyPath),'Invalid configuration "selectOptions"',1489528247),!x(y().get("__parentRenderable"),"_isGridRowFormElement")){t.remove();return}a().getTemplatePropertyDomElement("label",t).append(e.label);const r=n(a().getDomElementDataIdentifierSelector("viewportButton"),n(t)).clone();n(a().getDomElementDataIdentifierSelector("viewportButton"),n(t)).remove();const l=a().getTemplatePropertyDomElement("numbersOfColumnsToUse",n(t)).clone();a().getTemplatePropertyDomElement("numbersOfColumnsToUse",n(t)).remove();const o=N(t),s=function(c){a().getTemplatePropertyDomElement("numbersOfColumnsToUse",n(t)).off().empty().remove();const m=n(l).clone(!0,!0);L(t).after(m),n("input",m).focus(),a().getTemplatePropertyDomElement("numbersOfColumnsToUse-label",m).append(e.configurationOptions.numbersOfColumnsToUse.label.replace("{@viewPortLabel}",c.data("viewPortLabel"))),a().getTemplatePropertyDomElement("numbersOfColumnsToUse-fieldExplanationText",m).append(e.configurationOptions.numbersOfColumnsToUse.fieldExplanationText);const d=e.configurationOptions.numbersOfColumnsToUse.propertyPath.replace("{@viewPortIdentifier}",c.data("viewPortIdentifier"));a().getTemplatePropertyDomElement("numbersOfColumnsToUse-propertyPath",m).val(y().get(d)),a().getTemplatePropertyDomElement("numbersOfColumnsToUse-propertyPath",m).on("keyup paste change",function(){const f=n(this);n.isNumeric(f.val())||f.val(""),y().set(d,f.val())})};for(let c=0,m=e.configurationOptions.viewPorts.length;c<m;++c){const d=e.configurationOptions.viewPorts[c].viewPortIdentifier,f=e.configurationOptions.viewPorts[c].label,u=n(r).clone(!0,!0);if(u.text(d),u.data("viewPortIdentifier",d),u.data("viewPortLabel",f),u.attr("title",f),o.append(u),c===m-1){const E=n(l).clone(!0,!0);L(t).after(E),s(u),u.addClass(a().getDomElementClassName("active"))}n("button",o).on("click",function(){const E=n(this);n("button",o).removeClass(a().getDomElementClassName("active")),E.addClass(a().getDomElementClassName("active")),s(E)})}}function ee(e,t,r,l){p(n.type(e)==="object",'Invalid parameter "editorConfiguration"',1475419226),p(n.type(t)==="object",'Invalid parameter "editorHtml"',1475419227),p(n.type(e.enableAddRow)==="boolean",'Invalid configuration "enableAddRow"',1475419228),p(n.type(e.enableDeleteRow)==="boolean",'Invalid configuration "enableDeleteRow"',1475419230),p(n.type(e.isSortable)==="boolean",'Invalid configuration "isSortable"',1475419229),p(i().isNonEmptyString(e.propertyPath),'Invalid configuration "propertyPath"',1475419231),p(i().isNonEmptyString(e.label),'Invalid configuration "label"',1475419232),a().getTemplatePropertyDomElement("label",t).append(e.label),i().isNonEmptyString(e.fieldExplanationText)?a().getTemplatePropertyDomElement("fieldExplanationText",t).text(e.fieldExplanationText):a().getTemplatePropertyDomElement("fieldExplanationText",t).remove();const o=(()=>{const E=b().buildPropertyPath(void 0,r,l,void 0,!0);return i().isNonEmptyString(E)?E+".":E})(),s=i().isUndefinedOrNull(e.multiSelection)?!1:!!e.multiSelection,c=i().isNonEmptyArray(e.gridColumns)?e.gridColumns.some(E=>E.name==="selected"):!0,m=(()=>{const E=y().get(o+"defaultValue");return i().isUndefinedOrNull(E)?{}:s?E:{0:E}})(),d=(()=>{const E=y(),h=o+e.propertyPath,P=E.get(h)||{};let T;return Array.isArray(P)?T=P.map((v,I)=>({id:"fe"+Math.floor(Math.random()*42)+Date.now(),label:i().isUndefinedOrNull(v._label)?v:v._label,value:i().isUndefinedOrNull(v._label)?I:v._value,selected:!1})):typeof P=="object"&&(T=Object.entries(P).map(([v,I])=>({id:"fe"+Math.floor(Math.random()*42)+Date.now(),label:I,value:v,selected:!1}))),T.map(v=>{for(const I of Object.keys(m))if(m[I]===v.value){v.selected=!0;break}return v})})(),f=i().isUndefinedOrNull(e.useLabelAsFallbackValue)?!0:e.useLabelAsFallbackValue,u=t instanceof HTMLElement?t.querySelector("typo3-form-property-grid-editor"):t.get(0).querySelector("typo3-form-property-grid-editor");u.enableAddRow=e.enableAddRow,u.enableSelection=c,u.enableMultiSelection=s,u.enableSorting=e.isSortable??!1,u.enableDeleteRow=e.enableDeleteRow??!1,u.enableLabelAsFallbackValue=f,u.entries=d,i().isNonEmptyArray(e.gridColumns)&&e.gridColumns.forEach(E=>{E.name==="label"&&(u.labelLabel=E.title,u.enableLabelFormElementSelectionButton=E.enableFormelementSelectionButton),E.name==="value"&&(u.labelValue=E.title,u.enableValueFormElementSelectionButton=E.enableFormelementSelectionButton),E.name==="selected"&&(u.labelSelected=E.title)}),(u.enableLabelFormElementSelectionButton||u.enableValueFormElementSelectionButton)&&(u.formElements=se()),u.addEventListener(de.eventName,E=>{const h=E.data,P=[],T=[];for(const v of h){const I=v.label,G=v.value===""?v.label:i().canBeInterpretedAsInteger(v.value)?parseInt(v.value,10):v.value;v.selected&&P.push(G),T.push({_label:I,_value:G})}s?y().set(o+"defaultValue",P):y().set(o+"defaultValue",P[0]??"",!0),y().set(o+e.propertyPath,T),g(o+e.propertyPath,t)}),g(o+e.propertyPath,t)}function te(e,t,r,l){p(n.type(e)==="object",'Invalid parameter "editorConfiguration"',1475417093),p(n.type(t)==="object",'Invalid parameter "editorHtml"',1475417094),p(i().isNonEmptyString(e.validatorIdentifier),'Invalid configuration "validatorIdentifier"',1475417095),p(i().isNonEmptyString(e.label),'Invalid configuration "label"',1475417096);const o=e.validatorIdentifier;a().getTemplatePropertyDomElement("label",t).append(e.label);let s,c,m;i().isNonEmptyString(e.propertyPath)&&(c=b().buildPropertyPath(e.propertyPath,r,l)),i().isNonEmptyString(e.propertyValue)?s=e.propertyValue:s="";const d=b().buildPropertyPath(e.configurationOptions.validationErrorMessage.propertyPath),f=a().getTemplatePropertyDomElement("validationErrorMessage",n(t)).clone();a().getTemplatePropertyDomElement("validationErrorMessage",n(t)).remove();const u=function(){const E=n(f).clone(!0,!0);L(t).after(E),a().getTemplatePropertyDomElement("validationErrorMessage-label",E).append(e.configurationOptions.validationErrorMessage.label),a().getTemplatePropertyDomElement("validationErrorMessage-fieldExplanationText",E).append(e.configurationOptions.validationErrorMessage.fieldExplanationText),m=y().get(d),i().isUndefinedOrNull(m)&&(m=[]);const h=z(e.configurationOptions.validationErrorMessage.errorCodes,m);i().isUndefinedOrNull(h)||a().getTemplatePropertyDomElement("validationErrorMessage-propertyPath",E).val(h),a().getTemplatePropertyDomElement("validationErrorMessage-propertyPath",E).on("keyup paste",function(){let P=y().get(d);i().isUndefinedOrNull(P)&&(P=[]),y().set(d,R(e.configurationOptions.validationErrorMessage.errorCodes,P,n(this).val()))})};b().getIndexFromPropertyCollectionElement(o,"validators")!==-1&&(n('input[type="checkbox"]',n(t)).prop("checked",!0),u()),n('input[type="checkbox"]',n(t)).on("change",function(){a().getTemplatePropertyDomElement("validationErrorMessage",n(t)).off().empty().remove(),n(this).is(":checked")?(u(),O().publish("view/inspector/collectionElement/new/selected",[o,"validators"]),i().isNonEmptyString(c)&&y().set(c,s)):(O().publish("view/inspector/removeCollectionElement/perform",[o,"validators"]),i().isNonEmptyString(c)&&y().unset(c),m=y().get(d),i().isUndefinedOrNull(m)&&(m=[]),y().set(d,R(e.configurationOptions.validationErrorMessage.errorCodes,m,"")))})}function ne(e,t,r,l){p(n.type(e)==="object",'Invalid parameter "editorConfiguration"',1476218671),p(n.type(t)==="object",'Invalid parameter "editorHtml"',1476218672),p(i().isNonEmptyString(e.label),'Invalid configuration "label"',1476218673),p(i().isNonEmptyString(e.propertyPath),'Invalid configuration "propertyPath"',1476218674),a().getTemplatePropertyDomElement("label",t).append(e.label),i().isNonEmptyString(e.fieldExplanationText)?a().getTemplatePropertyDomElement("fieldExplanationText",t).text(e.fieldExplanationText):a().getTemplatePropertyDomElement("fieldExplanationText",t).remove();const o=b().buildPropertyPath(e.propertyPath,r,l),s=y().get(o);(e.propertyPath==="renderingOptions.enabled"&&i().isUndefinedOrNull(s)||n.type(s)==="boolean"&&s||s==="true"||s===1||s==="1")&&n('input[type="checkbox"]',n(t)).prop("checked",!0),n('input[type="checkbox"]',n(t)).on("change",function(){n(this).is(":checked")?y().set(o,!0):y().set(o,!1)})}function ae(e,t,r,l){p(n.type(e)==="object",'Invalid parameter "editorConfiguration"',1475412567),p(n.type(t)==="object",'Invalid parameter "editorHtml"',1475412568),p(i().isNonEmptyString(e.propertyPath),'Invalid configuration "propertyPath"',1475416098),p(i().isNonEmptyString(e.label),'Invalid configuration "label"',1475416099);const o=b().buildPropertyPath(e.propertyPath,r,l);a().getTemplatePropertyDomElement("label",t).append(e.label),i().isNonEmptyString(e.fieldExplanationText)?a().getTemplatePropertyDomElement("fieldExplanationText",t).text(e.fieldExplanationText):a().getTemplatePropertyDomElement("fieldExplanationText",t).remove();const s=y().get(o);n("textarea",n(t)).val(s),g(o,t),n("textarea",n(t)).on("keyup paste",function(){y().set(o,n(this).val()),g(o,t)})}function re(e,t,r,l){p(n.type(e)==="object",'Invalid parameter "editorConfiguration"',1477300587),p(n.type(t)==="object",'Invalid parameter "editorHtml"',1477300588),p(i().isNonEmptyString(e.label),'Invalid configuration "label"',1477300589),p(i().isNonEmptyString(e.buttonLabel),'Invalid configuration "buttonLabel"',1477318981),p(i().isNonEmptyString(e.propertyPath),'Invalid configuration "propertyPath"',1477300590),a().getTemplatePropertyDomElement("label",t).append(e.label),a().getTemplatePropertyDomElement("buttonLabel",t).append(e.buttonLabel),i().isNonEmptyString(e.fieldExplanationText)?a().getTemplatePropertyDomElement("fieldExplanationText",t).text(e.fieldExplanationText):a().getTemplatePropertyDomElement("fieldExplanationText",t).remove(),n("form",n(t)).prop("name",e.propertyPath),D.getIcon(e.iconIdentifier,D.sizes.small).then(function(c){a().getTemplatePropertyDomElement("image",t).append(n(c))}),a().getTemplatePropertyDomElement("onclick",t).on("click",function(){const c=Math.floor(Math.random()*1e5+1);n(this).closest(a().getDomElementDataIdentifierSelector("editorControlsWrapper")).find(a().getDomElementDataAttribute("contentElementSelectorTarget","bracesWithKey")).attr(a().getDomElementDataAttribute("contentElementSelectorTarget"),c),fe("db",c+"|||"+e.browsableType)}),be();const o=b().buildPropertyPath(e.propertyPath,r,l),s=y().get(o);g(o,t),a().getTemplatePropertyDomElement("propertyPath",t).val(s),a().getTemplatePropertyDomElement("propertyPath",t).on("keyup paste",function(){y().set(o,n(this).val()),g(o,t)})}function le(e,t,r,l){p(n.type(e)==="object",'Invalid parameter "editorConfiguration"',1475412563),p(n.type(t)==="object",'Invalid parameter "editorHtml"',1475412564),i().isUndefinedOrNull(r)?n("button",n(t)).addClass(a().getDomElementClassName("buttonFormElementRemove")+" "+a().getDomElementClassName("buttonFormEditor")):n("button",n(t)).addClass(a().getDomElementClassName("buttonCollectionElementRemove")),n("button",n(t)).on("click",function(){i().isUndefinedOrNull(r)?S().showRemoveFormElementModal():S().showRemoveCollectionElementModal(r,l)})}function oe(e,t,r){p(n.type(e)==="object",'Invalid parameter "editorConfiguration"',1484574704),p(n.type(t)==="object",'Invalid parameter "editorHtml"',1484574705),p(i().isNonEmptyString(r),'Invalid parameter "propertyPath"',1484574706);const l=t instanceof HTMLElement?t.querySelector("typo3-form-element-selector"):t.get(0).querySelector("typo3-form-element-selector");l&&(e.enableFormelementSelectionButton===!0?(l.elements=se(),l.addEventListener(Ee.eventName,o=>{let s;s=y().get(r)||"",s.length===0?s=`{${o.value}}`:s=`${s} {${o.value}}`,y().set(r,s),a().getTemplatePropertyDomElement("propertyPath",t).val(s),g(r,t)})):l.remove())}function se(){return b().getNonCompositeNonToplevelFormElements().map(t=>({icon:x(t,"iconIdentifier"),label:t.get("label"),value:t.get("identifier")}))}function pe(e){i().isUndefinedOrNull(e)&&(e=y()),p(n.type(e)==="object",'Invalid parameter "formElement"',1478967319);let t;e.get("type")==="Form"?t=e.get("type"):t=x(e,"label")?x(e,"label"):e.get("identifier");const r=document.createElement("span");return r.textContent=t,r}function De(e,t){return U=e,j=n.extend(!0,ue,t||{}),M.bootstrap(U),this}export{De as bootstrap,pe as buildTitleByFormElement,k as getCollectionElementDomElement,F as getFinishersContainerDomElement,w as getInspectorDomElement,V as getValidatorsContainerDomElement,ne as renderCheckboxEditor,Pe as renderCollectionElementEditors,$ as renderCollectionElementHeaderEditor,W as renderCollectionElementSelectionEditor,X as renderCountrySelectEditor,ge as renderEditors,Y as renderFileMaxSizeEditor,K as renderFormElementHeaderEditor,oe as renderFormElementSelectorEditorAddition,H as renderGridColumnViewPortConfigurationEditor,C as renderMultiSelectEditor,ee as renderPropertyGridEditor,le as renderRemoveElementEditor,te as renderRequiredValidatorEditor,Z as renderSingleSelectEditor,J as renderTextEditor,ae as renderTextareaEditor,re as renderTypo3WinBrowserEditor,Q as renderValidationErrorMessageEditor};
