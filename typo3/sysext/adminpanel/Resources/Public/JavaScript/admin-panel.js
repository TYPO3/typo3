/*
 * This file is part of the TYPO3 CMS project.
 *
 * It is free software; you can redistribute it and/or modify it under
 * the terms of the GNU General Public License, either version 2
 * of the License, or any later version.
 *
 * For the full copyright and license information, please read the
 * LICENSE.txt file that was distributed with this source code.
 *
 * The TYPO3 project - inspiring people to share!
 */
"use strict";(()=>{const e="form[data-typo3-role=typo3-adminPanel]",t="[data-typo3-role=typo3-adminPanel-module-trigger]",i=".typo3-adminPanel-module",s="[data-typo3-role=typo3-adminPanel-content-tab]",a="[data-typo3-role=typo3-adminPanel-saveButton]",n="[data-typo3-role=typo3-adminPanel-trigger]",l="[data-typo3-role=typo3-adminPanel-popup-trigger]",o="[data-typo3-role=typo3-adminPanel-panel-trigger]",r=".typo3-adminPanel-panel",c="[data-typo3-role=typo3-adminPanel-content-settings]",d=".typo3-adminPanel-content-settings",h=".typo3-adminPanel-content",m="[data-typo3-zoom-target]",p="[data-typo3-zoom-close]",u="[data-typo3-role=typo3-adminPanel-content]",y="[data-typo3-role=typo3-adminPanel-content-pane]",v="active",E="typo3-adminPanel-module-active",g="typo3-adminPanel-content-settings-active",L="typo3-adminPanel-backdrop",P="typo3-adminPanel-content-header-item-active",b="typo3-adminPanel-content-panes-item-active",A="typo3-adminPanel-noscroll",S="typo3-adminPanel-zoom-show";class q{constructor(){this.adminPanel=document.querySelector(e),this.modules=this.querySelectorAll(t).map((e=>{const t=e.closest(i);return new w(this,t,e)})),this.popups=this.querySelectorAll(l).map((e=>new f(this,e))),this.querySelectorAll(o).forEach((e=>{const t=e.closest(r);new k(t,e)})),this.querySelectorAll(c).forEach((e=>{const t=e.closest(h).querySelector(d);new z(t,e)})),this.trigger=document.querySelector(n),this.initializeEvents(),this.addBackdropListener()}disableModules(){this.modules.forEach((e=>e.disable()))}disablePopups(){this.popups.forEach((e=>e.disable()))}renderBackdrop(){const e=document.getElementById("TSFE_ADMIN_PANEL_FORM"),t=document.createElement("div");document.querySelector("body").classList.add(A),t.classList.add(L),e.appendChild(t),this.addBackdropListener()}removeBackdrop(){const e=document.querySelector("."+L);document.querySelector("body").classList.remove(A),null!==e&&e.remove()}querySelectorAll(e,t=null){return null===t?Array.from(document.querySelectorAll(e)):Array.from(t.querySelectorAll(e))}initializeEvents(){this.querySelectorAll(s).forEach((e=>e.addEventListener("click",this.switchTab.bind(this)))),this.querySelectorAll(m).forEach((e=>e.addEventListener("click",this.openZoom.bind(this)))),this.querySelectorAll(p).forEach((e=>e.addEventListener("click",this.closeZoom.bind(this)))),this.querySelectorAll(n).forEach((e=>e.addEventListener("click",this.toggleAdminPanelState.bind(this)))),this.querySelectorAll(a).forEach((e=>e.addEventListener("click",this.sendAdminPanelForm.bind(this)))),this.querySelectorAll("[data-typo3-role=typo3-adminPanel-content-close]").forEach((e=>{e.addEventListener("click",(()=>{this.disableModules(),this.removeBackdrop()}))})),this.querySelectorAll(".typo3-adminPanel-table th, .typo3-adminPanel-table td").forEach((e=>{e.addEventListener("click",(()=>{e.focus();try{document.execCommand("copy")}catch{}}))}))}switchTab(e){e.preventDefault();const t=P,i=b,a=e.currentTarget,n=a.closest(u),l=this.querySelectorAll(s,n),o=this.querySelectorAll(y,n);l.forEach((e=>e.classList.remove(t))),a.classList.add(t),o.forEach((e=>e.classList.remove(i)));document.querySelector("[data-typo3-tab-id="+a.dataset.typo3TabTarget+"]").classList.add(i)}openZoom(e){e.preventDefault();const t=e.currentTarget.getAttribute("data-typo3-zoom-target");document.querySelector("[data-typo3-zoom-id="+t+"]").classList.add(S)}closeZoom(e){e.preventDefault();e.currentTarget.closest("[data-typo3-zoom-id]").classList.remove(S)}sendAdminPanelForm(e){e.preventDefault();const t=new FormData(this.adminPanel),i=new XMLHttpRequest;i.open("POST",this.adminPanel.dataset.typo3AjaxUrl),i.send(t),i.onload=()=>location.assign(this.getCleanReloadUrl())}toggleAdminPanelState(){const e=new XMLHttpRequest;e.open("GET",this.trigger.dataset.typo3AjaxUrl),e.send(),e.onload=()=>location.reload()}getCleanReloadUrl(){const e=[];location.search.substr(1).split("&").forEach((t=>{t&&!t.includes("ADMCMD_")&&e.push(t)}));const t=e?"?"+e.join("&"):"";return location.origin+location.pathname+t}addBackdropListener(){this.querySelectorAll("."+L).forEach((e=>{e.addEventListener("click",(()=>{this.removeBackdrop(),this.querySelectorAll(t).forEach((e=>{e.closest(i).classList.remove(E)}))}))}))}}class f{constructor(e,t){this.adminPanel=e,this.element=t,this.initializeEvents()}isActive(){return this.element.classList.contains(v)}enable(){this.element.classList.add(v)}disable(){this.element.classList.remove(v)}initializeEvents(){this.element.addEventListener("click",(()=>{this.isActive()?this.disable():(this.adminPanel.disablePopups(),this.enable())}))}}class k{constructor(e,t){this.element=e,this.trigger=t,this.initializeEvents()}isActive(){return this.element.classList.contains(v)}enable(){this.element.classList.add(v)}disable(){this.element.classList.remove(v)}initializeEvents(){this.trigger.addEventListener("click",(()=>{this.isActive()?this.disable():this.enable()}))}}class z{constructor(e,t){this.element=e,this.trigger=t,this.initializeEvents()}isActive(){return this.element.classList.contains(g)}enable(){this.element.classList.add(g)}disable(){this.element.classList.remove(g)}initializeEvents(){this.trigger.addEventListener("click",(()=>{this.isActive()?this.disable():this.enable()}))}}class w{constructor(e,t,i){this.adminPanel=e,this.element=t,this.trigger=i,this.initializeEvents()}isActive(){return this.element.classList.contains(E)}enable(){this.element.classList.add(E)}disable(){this.element.classList.remove(E)}initializeEvents(){this.trigger.addEventListener("click",(()=>{this.adminPanel.removeBackdrop(),this.isActive()?this.disable():(this.adminPanel.disableModules(),this.adminPanel.renderBackdrop(),this.enable())}))}}window.addEventListener("load",(()=>new q),!1)})();