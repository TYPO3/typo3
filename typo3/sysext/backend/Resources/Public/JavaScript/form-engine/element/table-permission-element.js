/*
 * This file is part of the TYPO3 CMS project.
 *
 * It is free software; you can redistribute it and/or modify it under
 * the terms of the GNU General Public License, either version 2
 * of the License, or any later version.
 *
 * For the full copyright and license information, please read the
 * LICENSE.txt file that was distributed with this source code.
 *
 * The TYPO3 project - inspiring people to share!
 */
import DocumentService from"@typo3/core/document-service.js";import RegularEvent from"@typo3/core/event/regular-event.js";import{selector}from"@typo3/core/literals.js";import{MultiRecordSelectionSelectors}from"@typo3/backend/multi-record-selection.js";var Permissions;!function(e){e.none="none",e.select="select",e.modify="modify"}(Permissions||(Permissions={}));class TablePermissionElement extends HTMLElement{constructor(){super(...arguments),this.selectStateField=null,this.modifyStateField=null}async connectedCallback(){await DocumentService.ready(),this.selectStateField=this.querySelector(selector`input[name=${this.getAttribute("selectStateFieldName")||""}]`),this.modifyStateField=this.querySelector(selector`input[name=${this.getAttribute("modifyStateFieldName")||""}]`),null!==this.selectStateField&&null!==this.modifyStateField&&this.registerEventHandler()}registerEventHandler(){new RegularEvent("change",(e=>{this.handleSingleItemChange(e.target)})).delegateTo(this.querySelector("table"),".t3js-table-permissions-item"),new RegularEvent("multiRecordSelection:checkbox:state:changed",(e=>{const t=e.target.name;if(0===this.querySelectorAll(selector`input[name="${t}"]:checked`).length){const e=this.querySelector(selector`input[name="${t}"]`);e.value=Permissions.none,this.handleSingleItemChange(e),this.querySelector(selector`input[name="${t}"][value="${Permissions.none}"]`).checked=!0}})).delegateTo(this.querySelector("table"),MultiRecordSelectionSelectors.checkboxSelector)}handleSingleItemChange(e){switch(e.value){case Permissions.select:this.addItem(e.dataset.table,this.selectStateField),this.removeItem(e.dataset.table,this.modifyStateField);break;case Permissions.modify:this.addItem(e.dataset.table,this.selectStateField),this.addItem(e.dataset.table,this.modifyStateField);break;case Permissions.none:default:this.removeItem(e.dataset.table,this.selectStateField),this.removeItem(e.dataset.table,this.modifyStateField)}}removeItem(e,t){t.value=(t.value.length?t.value.split(","):[]).filter((t=>t!==e)).join(",")}addItem(e,t){const i=t.value.length?t.value.split(","):[];i.includes(e)||(i.push(e),t.value=i.join(","))}}window.customElements.define("typo3-formengine-element-tablepermission",TablePermissionElement);