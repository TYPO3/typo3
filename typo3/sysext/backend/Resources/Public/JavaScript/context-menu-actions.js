/*
 * This file is part of the TYPO3 CMS project.
 *
 * It is free software; you can redistribute it and/or modify it under
 * the terms of the GNU General Public License, either version 2
 * of the License, or any later version.
 *
 * For the full copyright and license information, please read the
 * LICENSE.txt file that was distributed with this source code.
 *
 * The TYPO3 project - inspiring people to share!
 */
import{SeverityEnum as d}from"@typo3/backend/enum/severity.js";import p from"@typo3/backend/ajax-data-handler.js";import c from"@typo3/core/ajax/ajax-request.js";import m from"@typo3/backend/info-window.js";import s from"@typo3/backend/modal.js";import u from"@typo3/backend/module-menu.js";import g from"@typo3/backend/notification.js";import a from"@typo3/backend/viewport.js";import"@typo3/backend/new-record-wizard.js";import U from"@typo3/backend/utility.js";class o{static getReturnUrl(){return encodeURIComponent(top.list_frame.document.location.pathname+top.list_frame.document.location.search)}static editRecord(e,r,t){const n=t.pagesLanguageUid;let i="";n&&(i="&overrideVals[pages][sys_language_uid]="+n),a.ContentContainer.setUrl(top.TYPO3.settings.FormEngine.moduleUrl+"&edit["+e+"]["+r+"]=edit"+i+"&returnUrl="+o.getReturnUrl())}static viewRecord(e,r,t){const n=t.previewUrl;if(n){const i=window.open(n,"newTYPO3frontendWindow");i.focus(),U.urlsPointToSameServerSideResource(i.location.href,n)&&i.location.reload()}}static openInfoPopUp(e,r){m.showItem(e,r)}static mountAsTreeRoot(e,r){if(e==="pages"){const t=new CustomEvent("typo3:pagetree:mountPoint",{detail:{pageId:r}});top.document.dispatchEvent(t)}}static newPageWizard(e,r,t){const n=t.pagesNewWizardUrl;a.ContentContainer.setUrl(n+"&returnUrl="+o.getReturnUrl())}static newContentWizard(e,r,t){let n=t.newWizardUrl;n&&(n+="&returnUrl="+o.getReturnUrl(),s.advanced({title:t.title,type:s.types.ajax,size:s.sizes.large,content:n,severity:d.notice}))}static newRecord(e,r){a.ContentContainer.setUrl(top.TYPO3.settings.FormEngine.moduleUrl+"&edit["+e+"]["+(e!=="pages"?"-":"")+r+"]=new&returnUrl="+o.getReturnUrl())}static openHistoryPopUp(e,r){a.ContentContainer.setUrl(top.TYPO3.settings.RecordHistory.moduleUrl+"&element="+e+":"+r+"&returnUrl="+o.getReturnUrl())}static openListModule(e,r,t){const n=e==="pages"?r:t.pageUid;u.App.showModule("web_list","id="+n)}static pagesSort(e,r,t){const n=t.pagesSortUrl;n&&a.ContentContainer.setUrl(n)}static pagesNewMultiple(e,r,t){const n=t.pagesNewMultipleUrl;n&&a.ContentContainer.setUrl(n)}static disableRecord(e,r,t){const n=t.disableField||"hidden";a.ContentContainer.setUrl(top.TYPO3.settings.RecordCommit.moduleUrl+"&data["+e+"]["+r+"]["+n+"]=1&redirect="+o.getReturnUrl())}static enableRecord(e,r,t){const n=t.disableField||"hidden";a.ContentContainer.setUrl(top.TYPO3.settings.RecordCommit.moduleUrl+"&data["+e+"]["+r+"]["+n+"]=0&redirect="+o.getReturnUrl())}static showInMenus(e,r){a.ContentContainer.setUrl(top.TYPO3.settings.RecordCommit.moduleUrl+"&data["+e+"]["+r+"][nav_hide]=0&redirect="+o.getReturnUrl())}static hideInMenus(e,r){a.ContentContainer.setUrl(top.TYPO3.settings.RecordCommit.moduleUrl+"&data["+e+"]["+r+"][nav_hide]=1&redirect="+o.getReturnUrl())}static deleteRecord(e,r,t){const n=s.confirm(t.title,t.message,d.warning,[{text:t.buttonCloseText||TYPO3.lang["button.cancel"]||"Cancel",active:!0,btnClass:"btn-default",name:"cancel"},{text:t.buttonOkText||TYPO3.lang["button.delete"]||"Delete",btnClass:"btn-warning",name:"delete"}]);n.addEventListener("button.clicked",i=>{if(i.target.getAttribute("name")==="delete"){const l={component:"contextmenu",action:"delete",table:e,uid:r};p.process("cmd["+e+"]["+r+"][delete]=1",l).then(()=>{e==="pages"&&o.refreshPageTree(),o.triggerRefresh(a.ContentContainer.get().location.href)})}n.hideModal()})}static copy(e,r){const t=TYPO3.settings.ajaxUrls.contextmenu_clipboard+"&CB[el]["+e+"%7C"+r+"]=1&CB[setCopyMode]=1";new c(t).get().finally(()=>{o.triggerRefresh(a.ContentContainer.get().location.href)})}static clipboardRelease(e,r){const t=TYPO3.settings.ajaxUrls.contextmenu_clipboard+"&CB[el]["+e+"%7C"+r+"]=0";new c(t).get().finally(()=>{o.triggerRefresh(a.ContentContainer.get().location.href)})}static cut(e,r){const t=TYPO3.settings.ajaxUrls.contextmenu_clipboard+"&CB[el]["+e+"%7C"+r+"]=1&CB[setCopyMode]=0";new c(t).get().finally(()=>{o.triggerRefresh(a.ContentContainer.get().location.href)})}static triggerRefresh(e){e.includes("record%2Fedit")||a.ContentContainer.refresh()}static clearCache(e,r){new c(TYPO3.settings.ajaxUrls.web_list_clearpagecache).withQueryArguments({id:r}).get({cache:"no-cache"}).then(async t=>{const n=await t.resolve();n.success===!0?g.success(n.title,n.message,1):g.error(n.title,n.message,1)},()=>{g.error("Clearing page caches went wrong on the server side.")})}static pasteAfter(e,r,t){o.pasteInto(e,-r,t)}static pasteInto(e,r,t){const n=()=>{const l="&CB[paste]="+e+"%7C"+r+"&CB[pad]=normal&redirect="+o.getReturnUrl();a.ContentContainer.setUrl(top.TYPO3.settings.RecordCommit.moduleUrl+l)};if(!t.title){n();return}const i=s.confirm(t.title,t.message,d.warning,[{text:t.buttonCloseText||TYPO3.lang["button.cancel"]||"Cancel",active:!0,btnClass:"btn-default",name:"cancel"},{text:t.buttonOkText||TYPO3.lang["button.ok"]||"OK",btnClass:"btn-warning",name:"ok"}]);i.addEventListener("button.clicked",l=>{l.target.getAttribute("name")==="ok"&&n(),i.hideModal()})}static refreshPageTree(){top.document.dispatchEvent(new CustomEvent("typo3:pagetree:refresh"))}}export{o as default};
