/*
 * This file is part of the TYPO3 CMS project.
 *
 * It is free software; you can redistribute it and/or modify it under
 * the terms of the GNU General Public License, either version 2
 * of the License, or any later version.
 *
 * For the full copyright and license information, please read the
 * LICENSE.txt file that was distributed with this source code.
 *
 * The TYPO3 project - inspiring people to share!
 */
import{LitElement as p,html as z}from"lit";import{property as l,state as u,customElement as g}from"lit/decorators.js";var d=function(n,e,i,r){var o=arguments.length,t=o<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,i):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")t=Reflect.decorate(n,e,i,r);else for(var c=n.length-1;c>=0;c--)(a=n[c])&&(t=(o<3?a(t):o>3?a(e,i,t):a(e,i))||t);return o>3&&t&&Object.defineProperty(e,i,t),t},s;(function(n){n.move="move",n.resizeN="resizeN",n.resizeE="resizeE",n.resizeS="resizeS",n.resizeW="resizeW",n.resizeSE="resizeSE",n.resizeSW="resizeSW",n.resizeNE="resizeNE",n.resizeNW="resizeNW"})(s||(s={}));const v=[s.resizeNW,s.resizeN,s.resizeNE],m=[s.resizeNE,s.resizeE,s.resizeSE],b=[s.resizeSE,s.resizeS,s.resizeSW],E=[s.resizeSW,s.resizeW,s.resizeNW];class f{constructor(e,i,r,o){this.left=e,this.top=i,this.width=r,this.height=o}get right(){return this.left+this.width}get bottom(){return this.top+this.height}clone(){return new f(this.left,this.top,this.width,this.height)}}let h=class extends p{constructor(){super(...arguments),this.offset=null,this.container=null,this.pointerEventNames={pointerDown:["mousedown"],pointerMove:["mousemove"],pointerUp:["mouseup"]},this.reverting=!1,this.action=null,this.windowRef=window,this.documentRef=document,this.originOffset=null,this.originPosition=null}get document(){return this.documentRef}get window(){return this.windowRef}set window(e){this.windowRef=e,this.documentRef=e.document}revert(e){this.reverting=!0,this.offset=e,setTimeout(()=>this.reverting=!1,500)}connectedCallback(){super.connectedCallback(),this.container instanceof HTMLElement||(this.container=this.parentElement),this.pointerEventNames.pointerDown.forEach(e=>this.documentRef.addEventListener(e,this.handleStart.bind(this),!0)),this.pointerEventNames.pointerMove.forEach(e=>this.documentRef.addEventListener(e,this.handleUpdate.bind(this),!0)),this.pointerEventNames.pointerUp.forEach(e=>this.documentRef.addEventListener(e,this.handleFinish.bind(this),!0))}disconnectedCallback(){super.disconnectedCallback(),this.pointerEventNames.pointerDown.forEach(e=>this.documentRef.removeEventListener(e,this.handleStart.bind(this),!0)),this.pointerEventNames.pointerMove.forEach(e=>this.documentRef.removeEventListener(e,this.handleUpdate.bind(this),!0)),this.pointerEventNames.pointerUp.forEach(e=>this.documentRef.removeEventListener(e,this.handleFinish.bind(this),!0))}render(){return z`<div id=t3js-cropper-focus-area class="cropper-focus-area ui-draggable ui-draggable-handle ui-resizable"><div class="ui-resizable-handle ui-resizable-n" data-resize=n></div><div class="ui-resizable-handle ui-resizable-e" data-resize=e></div><div class="ui-resizable-handle ui-resizable-s" data-resize=s></div><div class="ui-resizable-handle ui-resizable-w" data-resize=w></div><div class="ui-resizable-handle ui-resizable-se ui-icon ui-icon-gripsmall-diagonal-se" data-resize=se></div><div class="ui-resizable-handle ui-resizable-sw" data-resize=sw></div><div class="ui-resizable-handle ui-resizable-ne" data-resize=ne></div><div class="ui-resizable-handle ui-resizable-nw" data-resize=nw></div></div>`}update(e){super.update(e),Object.assign(this.style,this.getOffsetStyles(this.offset))}createRenderRoot(){return this}handleStart(e){const i=e.target;if(!(e.buttons!==1||!this.contains(i))){if(i.dataset.resize){const r="resize"+i.dataset.resize.toUpperCase();this.action=s[r]}else this.action=s.move;this.reverting=!1,this.originOffset=this.offset.clone(),this.originPosition={x:e.clientX,y:e.clientY},this.dispatchEvent(this.createEvent("draggable-resizable-started",{action:this.action,originOffset:this.originOffset}))}}handleUpdate(e){if(!this.action)return;const i={x:e.clientX-this.originPosition.x,y:e.clientY-this.originPosition.y};this.offset=this.adjustOffset(this.originOffset,i),this.dispatchEvent(this.createEvent("draggable-resizable-updated",{action:this.action,originOffset:this.originOffset}))}handleFinish(){this.action&&(this.dispatchEvent(this.createEvent("draggable-resizable-finished",{action:this.action,originOffset:this.originOffset})),this.action=null,this.originOffset=null,this.originPosition=null)}adjustOffset(e,i){const o=this.container.getBoundingClientRect(),t=e.clone();if(this.action===s.move&&(t.left=this.minMax(t.left+i.x,0,o.width-t.width),t.top=this.minMax(t.top+i.y,0,o.height-t.height)),v.includes(this.action)){const a=this.minMax(i.y,-t.top,t.height-2);t.top+=a,t.height-=a}else b.includes(this.action)&&(t.height=this.minMax(t.height+i.y,2,o.height-t.top));if(E.includes(this.action)){const a=this.minMax(i.x,-t.left,t.width-2);t.left+=a,t.width-=a}else m.includes(this.action)&&(t.width+=i.x);return t}minMax(e,i,r){return e<i?i:e>r?r:e}createEvent(e,i){return new CustomEvent(e,{detail:i,bubbles:!0,composed:!0})}getOffsetStyles(e){return{left:`${e.left}px`,top:`${e.top}px`,width:`${e.width}px`,height:`${e.height}px`}}};d([l({type:Object,reflect:!0})],h.prototype,"offset",void 0),d([l({type:HTMLElement})],h.prototype,"container",void 0),d([l({type:Object})],h.prototype,"pointerEventNames",void 0),d([l({type:Boolean,reflect:!0})],h.prototype,"reverting",void 0),d([u()],h.prototype,"action",void 0),d([u()],h.prototype,"windowRef",void 0),d([u()],h.prototype,"documentRef",void 0),h=d([g("typo3-backend-draggable-resizable")],h);export{h as DraggableResizableElement,f as Offset};
