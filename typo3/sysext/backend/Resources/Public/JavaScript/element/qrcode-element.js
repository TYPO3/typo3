/*
 * This file is part of the TYPO3 CMS project.
 *
 * It is free software; you can redistribute it and/or modify it under
 * the terms of the GNU General Public License, either version 2
 * of the License, or any later version.
 *
 * For the full copyright and license information, please read the
 * LICENSE.txt file that was distributed with this source code.
 *
 * The TYPO3 project - inspiring people to share!
 */
import{property as d,state as f,customElement as b}from"lit/decorators.js";import{LitElement as h,html as l,nothing as m}from"lit";import g from"@typo3/core/ajax/ajax-request.js";import"@typo3/backend/element/spinner-element.js";import"@typo3/backend/element/icon-element.js";import"@typo3/backend/copy-to-clipboard.js";import{unsafeHTML as y}from"lit/directives/unsafe-html.js";var s=function(t,e,o,i){var c=arguments.length,n=c<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,o):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(t,e,o,i);else for(var u=t.length-1;u>=0;u--)(a=t[u])&&(n=(c<3?a(n):c>3?a(e,o,n):a(e,o))||n);return c>3&&n&&Object.defineProperty(e,o,n),n},p;(function(t){t[t.small=64]="small",t[t.medium=128]="medium",t[t.large=256]="large",t[t.mega=512]="mega"})(p||(p={}));let r=class extends h{constructor(){super(),this.content="",this.showDownload=!1,this.showUrl=!1,this.size=p.small,this.qrcodePreview=l`<typo3-backend-spinner size=large></typo3-backend-spinner>`,this.urlSectionVisible=!1,document.addEventListener("copy-to-clipboard-success",this.showCopySuccess.bind(this))}connectedCallback(){super.connectedCallback(),this.loadQrCode()}render(){return l`<div class=preview>${this.qrcodePreview}</div>${this.getUrlToggle()} ${this.getUrlSection()} ${this.getControls()}`}createRenderRoot(){return this}getUrlToggle(){if(!this.showUrl)return m;const e=TYPO3.lang["qrcode.showUrl"]||"Show URL";return l`<div class=url-info-icon><button type=button class="btn btn-default btn-sm" title=${e} @click=${this.toggleUrlSection}><typo3-backend-icon identifier=actions-eye-link size=small></typo3-backend-icon></button></div>`}getUrlSection(){if(!this.showUrl||!this.urlSectionVisible)return m;const e=TYPO3.lang["qrcode.url"]||"URL",o=TYPO3.lang["qrcode.copyUrl"]||"Copy URL";return l`<div class="form-group url-info-section"><label class=form-label>${e}</label><div class=input-group><input type=text class=form-control readonly .value=${this.content}><typo3-copy-to-clipboard text=${this.content} class="btn btn-default" silent><typo3-backend-icon identifier=actions-clipboard size=small></typo3-backend-icon>${o}</typo3-copy-to-clipboard></div></div>`}toggleUrlSection(){this.urlSectionVisible=!this.urlSectionVisible}getControls(){if(!this.showDownload)return l`${m}`;const e=TYPO3.lang["qrcode.format.png"]||"PNG",o=TYPO3.lang["qrcode.format.svg"]||"SVG",i=TYPO3.lang["qrcode.format"]||"Format",c=TYPO3.lang["qrcode.size"]||"Size",n=TYPO3.lang["qrcode.download"]||"Download";return l`<form name=qrcode-download method=POST action=${TYPO3.settings.ajaxUrls.qrcode_download}><div class=form-row><div class=form-group><input name=content type=hidden value=${this.content}> <label class=form-label>${i}</label> <select name=format class=form-select><option value=svg>${o}</option><option value=png>${e}</option></select></div><div class=form-group><label class=form-label>${c}</label> <select name=size class=form-select>${this.getSizeOptions()}</select></div><div class=form-group><button type=submit class="btn btn-primary">${n}</button></div></div></form>`}getSizeOptions(){return Object.entries(p).filter(([,e])=>typeof e=="number").map(([e,o])=>l`<option value=${e}>${o}x${o}</option>`)}async loadQrCode(){if(this.content===""){this.qrcodePreview=l`<typo3-backend-icon identifier=default-not-found size=small></typo3-backend-icon>`;return}await new g(TYPO3.settings.ajaxUrls.qrcode_generator).withQueryArguments({content:this.content,size:this.size}).get({cache:"no-cache"}).then(async e=>{this.qrcodePreview=l`${y(await e.resolve())}`})}showCopySuccess(){const e=this.querySelector(".url-info-section");e!==null&&(e.classList.add("copy-success"),setTimeout(()=>e.classList.remove("copy-success"),500))}};s([d({type:String,reflect:!0})],r.prototype,"content",void 0),s([d({type:Boolean,reflect:!0,attribute:"show-download"})],r.prototype,"showDownload",void 0),s([d({type:Boolean,reflect:!0,attribute:"show-url"})],r.prototype,"showUrl",void 0),s([d({type:String,reflect:!0})],r.prototype,"size",void 0),s([f()],r.prototype,"qrcodePreview",void 0),s([f()],r.prototype,"urlSectionVisible",void 0),r=s([b("typo3-qrcode")],r);export{r as QrCodeElement};
