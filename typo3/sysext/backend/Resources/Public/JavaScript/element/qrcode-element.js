/*
 * This file is part of the TYPO3 CMS project.
 *
 * It is free software; you can redistribute it and/or modify it under
 * the terms of the GNU General Public License, either version 2
 * of the License, or any later version.
 *
 * For the full copyright and license information, please read the
 * LICENSE.txt file that was distributed with this source code.
 *
 * The TYPO3 project - inspiring people to share!
 */
import{property as d,state as f,customElement as h}from"lit/decorators.js";import{LitElement as b,html as n,nothing as m}from"lit";import y from"@typo3/core/ajax/ajax-request.js";import"@typo3/backend/element/spinner-element.js";import"@typo3/backend/element/icon-element.js";import"@typo3/backend/copy-to-clipboard.js";import{unsafeHTML as v}from"lit/directives/unsafe-html.js";var c=function(t,e,o,l){var i=arguments.length,r=i<3?e:l===null?l=Object.getOwnPropertyDescriptor(e,o):l,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(t,e,o,l);else for(var u=t.length-1;u>=0;u--)(a=t[u])&&(r=(i<3?a(r):i>3?a(e,o,r):a(e,o))||r);return i>3&&r&&Object.defineProperty(e,o,r),r},p;(function(t){t[t.small=64]="small",t[t.medium=128]="medium",t[t.large=256]="large",t[t.mega=512]="mega"})(p||(p={}));let s=class extends b{constructor(){super(),this.content="",this.showDownload=!1,this.showUrl=!1,this.size=p.small,this.qrcodePreview=n`<typo3-backend-spinner size=large></typo3-backend-spinner>`,document.addEventListener("copy-to-clipboard-success",this.showCopySuccess.bind(this)),document.addEventListener("copy-to-clipboard-error",this.showCopyError.bind(this))}connectedCallback(){super.connectedCallback(),this.loadQrCode()}render(){return n`<div class=preview>${this.qrcodePreview}</div>${this.getUrlSection()} ${this.getControls()}`}createRenderRoot(){return this}getUrlSection(){if(!this.showUrl)return m;const e=TYPO3.lang["qrcode.url"]||"URL",o=TYPO3.lang["qrcode.copyUrl"]||"Copy URL";return n`<div class="form-group url-info-section"><label class=form-label>${e}</label><div class=input-group><input type=text class=form-control readonly .value=${this.content}><typo3-copy-to-clipboard text=${this.content} class="btn btn-default" silent><typo3-backend-icon identifier=actions-clipboard size=small></typo3-backend-icon>${o}</typo3-copy-to-clipboard></div></div>`}getControls(){if(!this.showDownload)return n`${m}`;const e=TYPO3.lang["qrcode.format.png"]||"PNG",o=TYPO3.lang["qrcode.format.svg"]||"SVG",l=TYPO3.lang["qrcode.format"]||"Format",i=TYPO3.lang["qrcode.size"]||"Size",r=TYPO3.lang["qrcode.download"]||"Download";return n`<form name=qrcode-download method=POST action=${TYPO3.settings.ajaxUrls.qrcode_download}><div class=form-row><div class=form-group><input name=content type=hidden value=${this.content}> <label class=form-label>${l}</label> <select name=format class=form-select><option value=svg>${o}</option><option value=png>${e}</option></select></div><div class=form-group><label class=form-label>${i}</label> <select name=size class=form-select>${this.getSizeOptions()}</select></div><div class=form-group><button type=submit class="btn btn-primary">${r}</button></div></div></form>`}getSizeOptions(){return Object.entries(p).filter(([,e])=>typeof e=="number").map(([e,o])=>n`<option value=${e}>${o}x${o}</option>`)}async loadQrCode(){if(this.content===""){this.qrcodePreview=n`<typo3-backend-icon identifier=default-not-found size=small></typo3-backend-icon>`;return}await new y(TYPO3.settings.ajaxUrls.qrcode_generator).withQueryArguments({content:this.content,size:this.size}).get({cache:"no-cache"}).then(async e=>{this.qrcodePreview=n`${v(await e.resolve())}`})}showCopySuccess(){const e=this.querySelector(".url-info-section");e!==null&&(e.classList.add("copy-success"),setTimeout(()=>e.classList.remove("copy-success"),500))}showCopyError(){const e=this.querySelector(".url-info-section");e!==null&&(e.classList.add("copy-error"),setTimeout(()=>e.classList.remove("copy-error"),750))}};c([d({type:String,reflect:!0})],s.prototype,"content",void 0),c([d({type:Boolean,reflect:!0,attribute:"show-download"})],s.prototype,"showDownload",void 0),c([d({type:Boolean,reflect:!0,attribute:"show-url"})],s.prototype,"showUrl",void 0),c([d({type:String,reflect:!0})],s.prototype,"size",void 0),c([f()],s.prototype,"qrcodePreview",void 0),s=c([h("typo3-qrcode")],s);export{s as QrCodeElement};
