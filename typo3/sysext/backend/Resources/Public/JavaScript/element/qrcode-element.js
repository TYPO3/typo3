/*
 * This file is part of the TYPO3 CMS project.
 *
 * It is free software; you can redistribute it and/or modify it under
 * the terms of the GNU General Public License, either version 2
 * of the License, or any later version.
 *
 * For the full copyright and license information, please read the
 * LICENSE.txt file that was distributed with this source code.
 *
 * The TYPO3 project - inspiring people to share!
 */
import{property as m,state as f,customElement as u}from"lit/decorators.js";import{LitElement as v,html as r,nothing as g}from"lit";import h from"@typo3/core/ajax/ajax-request.js";import"@typo3/backend/element/spinner-element.js";import"@typo3/backend/element/icon-element.js";import{unsafeHTML as b}from"lit/directives/unsafe-html.js";var i=function(t,e,o,a){var s=arguments.length,n=s<3?e:a===null?a=Object.getOwnPropertyDescriptor(e,o):a,c;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(t,e,o,a);else for(var p=t.length-1;p>=0;p--)(c=t[p])&&(n=(s<3?c(n):s>3?c(e,o,n):c(e,o))||n);return s>3&&n&&Object.defineProperty(e,o,n),n},d;(function(t){t[t.small=64]="small",t[t.medium=128]="medium",t[t.large=256]="large",t[t.mega=512]="mega"})(d||(d={}));let l=class extends v{constructor(){super(...arguments),this.content="",this.showDownload=!1,this.size=d.small,this.qrcodePreview=r`<typo3-backend-spinner size=large></typo3-backend-spinner>`}connectedCallback(){super.connectedCallback(),this.loadQrCode()}render(){return r`<div class=preview>${this.qrcodePreview}</div>${this.getControls()}`}createRenderRoot(){return this}getControls(){if(!this.showDownload)return r`${g}`;const e=TYPO3.lang["qrcode.format.png"]||"PNG",o=TYPO3.lang["qrcode.format.svg"]||"SVG",a=TYPO3.lang["qrcode.format"]||"Format",s=TYPO3.lang["qrcode.size"]||"Size",n=TYPO3.lang["qrcode.download"]||"Download";return r`<form name=qrcode-download method=POST action=${TYPO3.settings.ajaxUrls.qrcode_download}><div class=form-row><div class=form-group><input name=content type=hidden value=${this.content}> <label class=form-label>${a}</label> <select name=format class=form-select><option value=svg>${o}</option><option value=png>${e}</option></select></div><div class=form-group><label class=form-label>${s}</label> <select name=size class=form-select>${this.getSizeOptions()}</select></div><div class=form-group><button type=submit class="btn btn-default">${n}</button></div></div></form>`}getSizeOptions(){return Object.entries(d).filter(([,e])=>typeof e=="number").map(([e,o])=>r`<option value=${e}>${o}x${o}</option>`)}async loadQrCode(){if(this.content===""){this.qrcodePreview=r`<typo3-backend-icon identifier=default-not-found size=small></typo3-backend-icon>`;return}await new h(TYPO3.settings.ajaxUrls.qrcode_generator).withQueryArguments({content:this.content,size:this.size}).get({cache:"no-cache"}).then(async e=>{this.qrcodePreview=r`${b(await e.resolve())}`})}};i([m({type:String,reflect:!0})],l.prototype,"content",void 0),i([m({type:Boolean,reflect:!0,attribute:"show-download"})],l.prototype,"showDownload",void 0),i([m({type:String,reflect:!0})],l.prototype,"size",void 0),i([f()],l.prototype,"qrcodePreview",void 0),l=i([u("typo3-qrcode")],l);export{l as QrCodeElement};
