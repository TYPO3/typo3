/*
 * This file is part of the TYPO3 CMS project.
 *
 * It is free software; you can redistribute it and/or modify it under
 * the terms of the GNU General Public License, either version 2
 * of the License, or any later version.
 *
 * For the full copyright and license information, please read the
 * LICENSE.txt file that was distributed with this source code.
 *
 * The TYPO3 project - inspiring people to share!
 */
define(["require","exports","jquery","../AjaxDataHandler","../Modal","../Severity"],function(t,e,a,n,o,s){"use strict";return new(function(){function t(){var t=this;this.elementIdentifier=".t3js-page-ce",a(function(){a(".t3js-page-columns").length&&t.activatePasteIcons()})}return t.determineColumn=function(t){var e=t.closest("[data-colpos]");return e.length&&"undefined"!==e.data("colpos")?e.data("colpos"):0},t.prototype.activatePasteIcons=function(){var t=this;a(".t3-page-ce-wrapper-new-ce").each(function(e,n){a(n).find(".t3js-toggle-new-content-element-wizard").length&&(a(".t3js-page-lang-column .t3-page-ce > .t3-page-ce").removeClass("t3js-page-ce"),top.pasteAfterLinkTemplate&&top.pasteIntoLinkTemplate&&(a(n).parent().data("page")?a(n).append(top.pasteIntoLinkTemplate):a(n).append(top.pasteAfterLinkTemplate),a(n).find(".t3js-paste").on("click",function(e){e.preventDefault(),t.activatePasteModal(a(e.currentTarget))})))})},t.prototype.activatePasteModal=function(t){var e=this,n=a(t),i=n.data("url")||null,r=(TYPO3.lang["paste.modal.title.paste"]||"Paste record")+': "'+n.data("title")+'"',l=void 0!==top.TYPO3.Severity[n.data("severity")]?top.TYPO3.Severity[n.data("severity")]:top.TYPO3.Severity.info,p="",c=[];if(n.hasClass("t3js-paste-copy")?(p=TYPO3.lang["paste.modal.pastecopy"]||"Do you want to copy the record to this position?",c=[{text:TYPO3.lang["paste.modal.button.cancel"]||"Cancel",active:!0,btnClass:"btn-default",trigger:function(){o.currentModal.trigger("modal-dismiss")}},{text:TYPO3.lang["paste.modal.button.pastecopy"]||"Copy",btnClass:"btn-"+s.getCssClass(l),trigger:function(){o.currentModal.trigger("modal-dismiss"),e.execute(n)}}]):(p=TYPO3.lang["paste.modal.paste"]||"Do you want to move the record to this position?",c=[{text:TYPO3.lang["paste.modal.button.cancel"]||"Cancel",active:!0,btnClass:"btn-default",trigger:function(){o.currentModal.trigger("modal-dismiss")}},{text:TYPO3.lang["paste.modal.button.paste"]||"Move",btnClass:"btn-"+s.getCssClass(l),trigger:function(){o.currentModal.trigger("modal-dismiss"),e.execute(n)}}]),null!==i){var d=i.indexOf("?")>-1?"&":"?",u=a.param({data:n.data()});o.loadUrl(r,l,c,i+d+u)}else o.show(r,p,l,c)},t.prototype.execute=function(e){var a=t.determineColumn(e),o=e.closest(this.elementIdentifier),s=o.data("uid"),i={CB:{paste:"tt_content|"+(void 0===s?parseInt(o.data("page"),10):0-parseInt(s,10)),update:{colPos:a,sys_language_uid:parseInt(e.closest("[data-language-uid]").data("language-uid"),10)}}};n.process(i).done(function(t){t.hasErrors||window.location.reload(!0)})},t}())});