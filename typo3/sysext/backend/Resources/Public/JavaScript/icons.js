/*
 * This file is part of the TYPO3 CMS project.
 *
 * It is free software; you can redistribute it and/or modify it under
 * the terms of the GNU General Public License, either version 2
 * of the License, or any later version.
 *
 * For the full copyright and license information, please read the
 * LICENSE.txt file that was distributed with this source code.
 *
 * The TYPO3 project - inspiring people to share!
 */
import m from"@typo3/core/ajax/ajax-request.js";import n from"@typo3/backend/storage/client.js";import{Sizes as f,States as p,MarkupIdentifiers as u}from"@typo3/backend/enum/icon-types.js";import{css as d}from"lit";import{DedupeAsyncTask as y}from"@typo3/core/cache/dedupe-async-task.js";class z{static getStyles(){return[d`:host{display:inline-flex;align-items:center;justify-content:center;height:var(--icon-size,1em);width:var(--icon-size,1em);line-height:var(--icon-size,1em);vertical-align:-22%}:host([raw]) .icon-size-default,:host([size=default]){--icon-size:1em}:host([raw]) .icon-size-small,:host([size=small]){--icon-size:var(--icon-size-small,16px)}:host([raw]) .icon-size-medium,:host([size=medium]){--icon-size:var(--icon-size-medium,32px)}:host([raw]) .icon-size-large,:host([size=large]){--icon-size:var(--icon-size-large,48px)}:host([raw]) .icon-size-mega,:host([size=mega]){--icon-size:var(--icon-size-mega,64px)}.icon{position:relative;display:flex;overflow:hidden;white-space:nowrap;color:var(--icon-color-primary,currentColor);height:var(--icon-size,1em);width:var(--icon-size,1em);line-height:var(--icon-size,1em);flex-shrink:0}.icon img,.icon svg{display:block;height:100%;width:100%}.icon *{display:block;line-height:inherit}.icon-markup{display:block;top:0;left:0}.icon-markup,.icon-overlay{position:absolute;text-align:center;right:0;bottom:0}.icon-overlay{height:68.75%;width:68.75%}.icon-spin .icon-markup{-webkit-animation:icon-spin 2s linear infinite;animation:icon-spin 2s linear infinite}@keyframes icon-spin{0%{transform:rotate(0)}to{transform:rotate(1turn)}}.icon-state-disabled .icon-markup{opacity:var(--icon-opacity-disabled,.5)}.icon-unify{line-height:var(--icon-size,1em);font-size:calc(var(--icon-size, 1em)*var(--icon-unify-modifier, .86))}.icon-overlay .icon-unify{line-height:calc(var(--icon-size, 1em)/1.6);font-size:calc((var(--icon-size, 1em)/1.6)*var(--icon-unify-modifier, .86))}`]}}class v{constructor(){this.sizes=f,this.states=p,this.markupIdentifiers=u,this.promiseCache=new y}getIcon(e,i,r,s,o,t){i=i||f.default,s=s||p.default,o=o||u.default;const a=[e,i,r,s,o],l=a.join("_");return this.getIconRegistryCache().then(h=>((!n.isset("icon_registry_cache_identifier")||n.get("icon_registry_cache_identifier")!==h)&&(n.unsetByPrefix("icon_"),n.set("icon_registry_cache_identifier",h)),this.fetchFromLocal(l).then(null,()=>this.fetchFromRemote(a,l,t))))}getIconRegistryCache(){return this.promiseCache.get("icon_registry_cache_identifier",async i=>await(await new m(TYPO3.settings.ajaxUrls.icons_cache).get({signal:i})).resolve())}fetchFromRemote(e,i,r){return this.promiseCache.get(i,async s=>{const o=await new m(TYPO3.settings.ajaxUrls.icons).withQueryArguments({icon:JSON.stringify(e)}).get({signal:s}),t=await o.resolve();return!o.response.redirected&&t.startsWith("<span")&&t.includes("t3js-icon")&&t.includes('<span class="icon-markup">')&&n.set("icon_"+i,t),t},r)}fetchFromLocal(e){return n.isset("icon_"+e)?Promise.resolve(n.get("icon_"+e)):Promise.reject()}}let c;c||(c=new v,typeof TYPO3<"u"&&(TYPO3.Icons=c));var w=c;export{z as IconStyles,w as default};
