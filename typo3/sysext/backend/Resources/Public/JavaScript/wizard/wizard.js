/*
 * This file is part of the TYPO3 CMS project.
 *
 * It is free software; you can redistribute it and/or modify it under
 * the terms of the GNU General Public License, either version 2
 * of the License, or any later version.
 *
 * For the full copyright and license information, please read the
 * LICENSE.txt file that was distributed with this source code.
 *
 * The TYPO3 project - inspiring people to share!
 */
import{LitElement as m,html as a}from"lit";import{property as l,state as h,customElement as f}from"lit/decorators.js";import{classMap as S}from"lit/directives/class-map.js";import b from"@typo3/backend/modal.js";import"@typo3/backend/element/alert-element.js";import"@typo3/backend/element/icon-element.js";import"@typo3/backend/element/progress-tracker-element.js";import"@typo3/backend/element/spinner-element.js";import v from"@typo3/backend/wizard/steps/confirm-step.js";import g from"@typo3/backend/wizard/steps/finisher-step.js";import p from"~labels/backend.wizards.general";var o=function(c,t,e,r){var s=arguments.length,i=s<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,u;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(c,t,e,r);else for(var d=c.length-1;d>=0;d--)(u=c[d])&&(i=(s<3?u(i):s>3?u(t,e,i):u(t,e))||i);return s>3&&i&&Object.defineProperty(t,e,i),i};let n=class extends m{constructor(){super(...arguments),this.steps=[],this.currentStepIndex=0,this.dataStore={},this.allSteps=[],this.progressTracker=null,this.handleAutoAdvance=()=>{this.tryAutoAdvance()}}connectedCallback(){super.connectedCallback(),this.addEventListener("auto-advance",this.handleAutoAdvance),this.progressTracker=document.createElement("typo3-backend-progress-tracker")}disconnectedCallback(){super.disconnectedCallback(),this.removeEventListener("auto-advance",this.handleAutoAdvance),this.progressTracker=null}getStepSummaries(){const t=[];for(const e of this.allSteps)if(this.hasSummary(e)){const r=e.getSummaryData();t.push(...r)}return t}getStoreData(t){return this.dataStore[t]??null}setStoreData(t,e){this.dataStore={...this.dataStore,[t]:e}}getDataStore(){return this.dataStore}clearStoreData(t){const e={...this.dataStore};delete e[t],this.dataStore=e}tryAutoAdvance(){const t=this.getCurrentStep();t.autoAdvance&&t.isComplete()&&this.goToNextStep()}dismissWizard(){b.dismiss()}renderLoader(t){return a`<div class=wizard-loader><typo3-backend-spinner size=large></typo3-backend-spinner><p>${t??p.get("wizard.loading")}</p></div>`}renderError(t,e,r){let s="";e instanceof Error?s=e.message:Array.isArray(e)?s=e.join(`
`):e&&typeof e=="string"&&(s=e);const i=s?`${t}

${s}`:t;return a`<div class=wizard-error><typo3-backend-alert severity=2 heading=${r??p.get("wizard.step.error.title")} message=${i} show-icon></typo3-backend-alert></div>`}render(){return a`<div class=wizard><div class=wizard-progress>${this.renderProgressTracker()}</div><div class=wizard-content aria-live=polite>${this.currentStep?.render()}</div><div class=wizard-actions>${this.renderWizardButtons()}</div></div>`}createRenderRoot(){return this}updated(t){super.updated(t),(t.has("steps")||t.has("submissionService"))&&this.steps?.length&&this.submissionService&&(this.allSteps=[...this.steps,new v(this),new g(this,this.submissionService)],this.currentStep||(this.currentStep=this.allSteps[this.currentStepIndex]))}hasSummary(t){return"getSummaryData"in t}hasValue(t){return"getValue"in t&&"setValue"in t&&"reset"in t}renderWizardButtons(){return a`${this.renderPreviousButton()} ${this.renderNextButton()}`}renderPreviousButton(){const t=this.currentStepIndex===0,e=this.currentStepIndex===this.allSteps.length-1;return a`<button type=button class=${S({btn:!0,"btn-secondary":!0,disabled:t||e})} @click=${this.handlePrevious}><typo3-backend-icon identifier=actions-arrow-start-alt size=small bidi></typo3-backend-icon>${p.get("wizard.buttons.previous")}</button>`}renderNextButton(){const t=this.currentStep?.isComplete();let e;return this.currentStep?.key==="finisher"?e=p.get("wizard.buttons.finish"):this.currentStep?.key==="confirm"?e=this.confirmButtonLabel:e=p.get("wizard.buttons.next"),a`<button type=button class=${S({btn:!0,"btn-primary":!0,disabled:!t})} @click=${this.handleNext}>${e}<typo3-backend-icon identifier=actions-arrow-end-alt bidi size=small></typo3-backend-icon></button>`}getCurrentStep(){return this.currentStep}async goToStep(t){if(!(t<0||t>=this.allSteps.length||t===this.currentStepIndex)){if(t>this.currentStepIndex)for(let e=this.currentStepIndex;e<t;e++){const r=this.allSteps[e];if(!r.isComplete()){e!==this.currentStepIndex&&(this.currentStepIndex=e,this.currentStep=this.allSteps[e],await this.updateComplete);return}r.beforeAdvance&&await r.beforeAdvance()}else for(let e=this.currentStepIndex;e>t;e--){const r=this.allSteps[e];this.hasValue(r)&&r.reset()}this.currentStepIndex=t,this.currentStep=this.allSteps[t],await this.updateComplete}}goToNextStep(){this.currentStepIndex<this.allSteps.length-1&&this.goToStep(this.currentStepIndex+1)}goToPreviousStep(){this.currentStepIndex>0&&this.goToStep(this.currentStepIndex-1)}getProgressSteps(){return this.allSteps.map(t=>({key:t.key,title:t.title}))}getCurrentStepIndex(){return this.currentStepIndex}renderProgressTracker(){const t=this.getProgressSteps(),e=this.getCurrentStepIndex(),r=t.map(i=>i.title),s=e+1;return this.progressTracker&&(this.progressTracker.stages=r,this.progressTracker.activeStage=s),a`${this.progressTracker}`}handlePrevious(){const t=this.currentStepIndex===0,e=this.currentStepIndex===this.allSteps.length-1;t||e||this.goToPreviousStep()}async handleNext(){if(!this.currentStep.isComplete())return;if(this.currentStepIndex===this.allSteps.length-1){this.currentStep.beforeAdvance&&await this.currentStep.beforeAdvance();return}this.goToNextStep()}};o([l({type:Array,attribute:!1})],n.prototype,"steps",void 0),o([l({type:String,attribute:"confirm-button-label"})],n.prototype,"confirmButtonLabel",void 0),o([l({type:Object,attribute:!1})],n.prototype,"submissionService",void 0),o([h()],n.prototype,"currentStepIndex",void 0),o([h()],n.prototype,"currentStep",void 0),o([h()],n.prototype,"dataStore",void 0),n=o([f("typo3-backend-wizard")],n);export{n as Wizard};
