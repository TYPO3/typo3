/*
 * This file is part of the TYPO3 CMS project.
 *
 * It is free software; you can redistribute it and/or modify it under
 * the terms of the GNU General Public License, either version 2
 * of the License, or any later version.
 *
 * For the full copyright and license information, please read the
 * LICENSE.txt file that was distributed with this source code.
 *
 * The TYPO3 project - inspiring people to share!
 */
import{state as d,query as u,customElement as y}from"lit/decorators.js";import{LitElement as m,html as a,nothing as w}from"lit";import{classMap as b}from"lit/directives/class-map.js";import h,{WorkspaceChangedEvent as v,workspaceColors as k}from"@typo3/workspaces/workspace-state.js";import"@typo3/backend/element/spinner-element.js";import"@typo3/backend/dropdown.js";import f from"~labels/workspaces.messages";var i=function(l,e,o,t){var c=arguments.length,r=c<3?e:t===null?t=Object.getOwnPropertyDescriptor(e,o):t,p;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(l,e,o,t);else for(var n=l.length-1;n>=0;n--)(p=l[n])&&(r=(c<3?p(r):c>3?p(e,o,r):p(e,o))||r);return c>3&&r&&Object.defineProperty(e,o,r),r};let s=class extends m{constructor(){super(...arguments),this.loading=!0,this.currentWorkspace=null,this.workspaces=[],this.handleWorkspaceChanged=()=>{this.dropdownMenu?.hidePopover(),this.loadWorkspaceData()}}connectedCallback(){super.connectedCallback(),this.loadWorkspaceData(),document.addEventListener(v.eventName,this.handleWorkspaceChanged)}disconnectedCallback(){super.disconnectedCallback(),document.removeEventListener(v.eventName,this.handleWorkspaceChanged)}createRenderRoot(){return this}render(){if(this.loading)return a`<div class=workspace-selector-loading><typo3-backend-spinner size=medium></typo3-backend-spinner></div>`;const e=this.currentWorkspace===null||this.currentWorkspace.id===0,o=this.workspaces.length>1,t=this.currentWorkspace?.title||(e?"Live":"[No Title]");return o?a`<div class=dropdown><button class="workspace-selector dropdown-toggle" type=button title=${f.get("action.selectWorkspace")} popovertarget=workspace-menu><span class=workspace-selector-icon aria-hidden=true> <typo3-backend-icon identifier=module-workspaces size=medium></typo3-backend-icon> </span><span class=workspace-selector-name>${t}</span> <span class=workspace-selector-indicator aria-hidden=true><typo3-backend-icon identifier=actions-exchange size=small></typo3-backend-icon> </span></button><div id=workspace-menu class=dropdown-menu popover><ul class=dropdown-list>${this.workspaces.map(c=>a`<li>${this.renderWorkspaceItem(c)}</li>`)}</ul></div></div>`:a`<span class=workspace-selector disabled> <span class=workspace-selector-icon aria-hidden=true><typo3-backend-icon identifier=module-workspaces size=medium></typo3-backend-icon> </span> <span class=workspace-selector-name>${t}</span> </span>`}updated(e){if(super.updated(e),e.has("currentWorkspace"))if(this.currentWorkspace?.color&&k.includes(this.currentWorkspace.color)){const o=this.currentWorkspace.color;this.style.setProperty("--workspace-selector-active-color",`var(--typo3-state-${o}-color)`),this.style.setProperty("--workspace-selector-active-bg",`var(--typo3-state-${o}-bg)`),this.style.setProperty("--workspace-selector-active-border-color",`var(--typo3-state-${o}-border-color)`),this.style.setProperty("--workspace-selector-active-hover-color",`var(--typo3-state-${o}-hover-color)`),this.style.setProperty("--workspace-selector-active-hover-bg",`var(--typo3-state-${o}-hover-bg)`),this.style.setProperty("--workspace-selector-active-hover-border-color",`var(--typo3-state-${o}-hover-border-color)`),this.style.setProperty("--workspace-selector-active-focus-color",`var(--typo3-state-${o}-focus-color)`),this.style.setProperty("--workspace-selector-active-focus-bg",`var(--typo3-state-${o}-focus-bg)`),this.style.setProperty("--workspace-selector-active-focus-border-color",`var(--typo3-state-${o}-focus-border-color)`)}else this.style.removeProperty("--workspace-selector-active-color"),this.style.removeProperty("--workspace-selector-active-bg"),this.style.removeProperty("--workspace-selector-active-border-color"),this.style.removeProperty("--workspace-selector-active-hover-color"),this.style.removeProperty("--workspace-selector-active-hover-bg"),this.style.removeProperty("--workspace-selector-active-hover-border-color"),this.style.removeProperty("--workspace-selector-active-focus-color"),this.style.removeProperty("--workspace-selector-active-focus-bg"),this.style.removeProperty("--workspace-selector-active-focus-border-color")}renderWorkspaceItem(e){const o=e.id===this.currentWorkspace?.id,t=e.color&&k.includes(e.color)?`border-inline-start-color: var(--typo3-state-${e.color}-bg)`:"";return a`<button type=button class=${b({"dropdown-item":!0,active:o})} style=${t} title=${e.description||e.title} @click=${o?w:()=>this.switchWorkspace(e.id)}>${e.title}</button>`}async loadWorkspaceData(){try{this.currentWorkspace=await h.getCurrentWorkspace(),this.workspaces=await h.getWorkspaces()}catch(e){console.error("Failed to load workspace data",e)}finally{this.loading=!1}}async switchWorkspace(e){try{await h.switchWorkspace(e)}catch(o){console.error("Failed to switch workspace",o)}}};i([d()],s.prototype,"loading",void 0),i([d()],s.prototype,"currentWorkspace",void 0),i([d()],s.prototype,"workspaces",void 0),i([u(".dropdown-menu")],s.prototype,"dropdownMenu",void 0),s=i([y("typo3-backend-workspace-selector")],s);export{s as WorkspaceSelectorElement};
