/*
 * This file is part of the TYPO3 CMS project.
 *
 * It is free software; you can redistribute it and/or modify it under
 * the terms of the GNU General Public License, either version 2
 * of the License, or any later version.
 *
 * For the full copyright and license information, please read the
 * LICENSE.txt file that was distributed with this source code.
 *
 * The TYPO3 project - inspiring people to share!
 */
import{state as p,customElement as v}from"lit/decorators.js";import{LitElement as u,css as b,nothing as k,html as m}from"lit";import l,{WorkspaceChangedEvent as h,workspaceColors as f}from"@typo3/workspaces/workspace-state.js";import g from"@typo3/backend/storage/persistent.js";import"@typo3/backend/element/icon-element.js";import y from"~labels/workspaces.messages";var c=function(a,e,o,r){var s=arguments.length,t=s<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,o):r,n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")t=Reflect.decorate(a,e,o,r);else for(var d=a.length-1;d>=0;d--)(n=a[d])&&(t=(s<3?n(t):s>3?n(e,o,t):n(e,o))||t);return s>3&&t&&Object.defineProperty(e,o,t),t};let i=class extends u{constructor(){super(...arguments),this.currentWorkspace=null,this.workspaces=[],this.showLiveIndicator=!g.isset("showWorkspaceLiveIndicator")||g.get("showWorkspaceLiveIndicator")==1,this.handleWorkspaceChanged=()=>{this.loadWorkspaceData()},this.handlePersistentUpdate=e=>{const{fieldName:o,value:r}=e.detail;o==="showWorkspaceLiveIndicator"&&(this.showLiveIndicator=r==1)}}static{this.styles=b`:host{--indicator-font-size:.75rem;--indicator-color:color-mix(in srgb,var(--typo3-scaffold-sidebar-bg),var(--typo3-scaffold-sidebar-color) 95%);--indicator-bg:color-mix(in srgb,var(--typo3-scaffold-sidebar-bg),var(--typo3-scaffold-sidebar-color) 20%);--indicator-height:calc(var(--indicator-badge-height)*0.75);--indicator-badge-padding-x:.75rem;--indicator-badge-padding-y:.35rem;--indicator-badge-height:calc(var(--indicator-font-size) + var(--indicator-badge-padding-y)*2);--indicator-z-index:10001;display:block;position:relative;color:var(--indicator-color);height:var(--indicator-height);background-color:var(--indicator-bg);font-size:var(--indicator-font-size);line-height:1;z-index:var(--indicator-z-index);user-select:none;transition:margin-top .25s ease-out,background-color .25s ease-out,color .25s ease-out,display allow-discrete .25s ease-out}@starting-style{:host{margin-top:calc(var(--indicator-height)*-1)}}:host([hidden]){display:none;margin-top:calc(var(--indicator-height)*-1)}.workspace-indicator-badge{position:absolute;top:0;left:var(--indicator-badge-padding-x);right:var(--indicator-badge-padding-x);width:fit-content;max-width:calc(100% - var(--indicator-badge-padding-x)*2);margin-inline:auto;box-sizing:border-box;padding:var(--indicator-badge-padding-y) var(--indicator-badge-padding-x);border-radius:0 0 .5rem .5rem;background-color:inherit;text-overflow:ellipsis;white-space:nowrap;overflow:hidden;transition:background-color .25s ease-out}`}connectedCallback(){super.connectedCallback(),this.loadWorkspaceData(),document.addEventListener(h.eventName,this.handleWorkspaceChanged),document.addEventListener("typo3:persistent:update",this.handlePersistentUpdate)}disconnectedCallback(){super.disconnectedCallback(),document.removeEventListener(h.eventName,this.handleWorkspaceChanged),document.removeEventListener("typo3:persistent:update",this.handlePersistentUpdate)}render(){return this.currentWorkspace?(this.hidden=this.currentWorkspace.id===0&&(this.workspaces.length<=1||!this.showLiveIndicator),m`<span class=workspace-indicator-badge title=${this.currentWorkspace.description||this.currentWorkspace.title}> ${y.get("indicator.workspacePrefix")}: ${this.currentWorkspace.title} </span>`):k}updated(){if(this.currentWorkspace?.color&&f.includes(this.currentWorkspace.color)){const e=this.currentWorkspace.color;this.style.setProperty("--indicator-color",`var(--typo3-state-${e}-color)`),this.style.setProperty("--indicator-bg",`var(--typo3-state-${e}-bg)`)}else this.style.removeProperty("--indicator-color"),this.style.removeProperty("--indicator-bg")}async loadWorkspaceData(){try{this.currentWorkspace=await l.getCurrentWorkspace(),this.workspaces=await l.getWorkspaces()}catch(e){console.error("Failed to load workspace data",e)}}};c([p()],i.prototype,"currentWorkspace",void 0),c([p()],i.prototype,"workspaces",void 0),c([p()],i.prototype,"showLiveIndicator",void 0),i=c([v("typo3-backend-workspace-top-indicator")],i);export{i as WorkspaceTopIndicatorElement};
