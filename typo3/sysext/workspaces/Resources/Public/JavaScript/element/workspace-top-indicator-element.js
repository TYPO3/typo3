/*
 * This file is part of the TYPO3 CMS project.
 *
 * It is free software; you can redistribute it and/or modify it under
 * the terms of the GNU General Public License, either version 2
 * of the License, or any later version.
 *
 * For the full copyright and license information, please read the
 * LICENSE.txt file that was distributed with this source code.
 *
 * The TYPO3 project - inspiring people to share!
 */
import{state as l,customElement as g}from"lit/decorators.js";import{LitElement as b,css as u,nothing as k,html as v}from"lit";import p,{WorkspaceChangedEvent as h,workspaceColors as m}from"@typo3/workspaces/workspace-state.js";import"@typo3/backend/element/icon-element.js";import{lll as f}from"@typo3/core/lit-helper.js";var d=function(a,e,o,i){var c=arguments.length,r=c<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,o):i,n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(a,e,o,i);else for(var s=a.length-1;s>=0;s--)(n=a[s])&&(r=(c<3?n(r):c>3?n(e,o,r):n(e,o))||r);return c>3&&r&&Object.defineProperty(e,o,r),r};let t=class extends b{constructor(){super(...arguments),this.currentWorkspace=null,this.workspaces=[],this.handleWorkspaceChanged=()=>{this.loadWorkspaceData()}}static{this.styles=u`:host{--indicator-font-size:.75rem;--indicator-color:color-mix(in srgb,var(--typo3-scaffold-sidebar-bg),var(--typo3-scaffold-sidebar-color) 95%);--indicator-bg:color-mix(in srgb,var(--typo3-scaffold-sidebar-bg),var(--typo3-scaffold-sidebar-color) 20%);--indicator-height:calc(var(--indicator-badge-height)*0.75);--indicator-badge-padding-x:.75rem;--indicator-badge-padding-y:.35rem;--indicator-badge-height:calc(var(--indicator-font-size) + var(--indicator-badge-padding-y)*2);--indicator-z-index:10001;display:block;position:relative;color:var(--indicator-color);height:var(--indicator-height);background-color:var(--indicator-bg);font-size:var(--indicator-font-size);line-height:1;z-index:var(--indicator-z-index);user-select:none;transition:margin-top .25s ease-out,background-color .25s ease-out,color .25s ease-out,display allow-discrete .25s ease-out}@starting-style{:host{margin-top:calc(var(--indicator-height)*-1)}}:host([hidden]){display:none;margin-top:calc(var(--indicator-height)*-1)}.workspace-indicator-badge{position:absolute;top:0;left:var(--indicator-badge-padding-x);right:var(--indicator-badge-padding-x);width:fit-content;max-width:calc(100% - var(--indicator-badge-padding-x)*2);margin-inline:auto;box-sizing:border-box;padding:var(--indicator-badge-padding-y) var(--indicator-badge-padding-x);border-radius:0 0 .5rem .5rem;background-color:inherit;text-overflow:ellipsis;white-space:nowrap;overflow:hidden;transition:background-color .25s ease-out}`}connectedCallback(){super.connectedCallback(),this.loadWorkspaceData(),document.addEventListener(h.eventName,this.handleWorkspaceChanged)}disconnectedCallback(){super.disconnectedCallback(),document.removeEventListener(h.eventName,this.handleWorkspaceChanged)}render(){return this.currentWorkspace?(this.hidden=this.currentWorkspace.id===0&&this.workspaces.length<=1,v`<span class=workspace-indicator-badge title=${this.currentWorkspace.description||this.currentWorkspace.title}> ${f("workspaces.messages:indicator.workspacePrefix")}: ${this.currentWorkspace.title} </span>`):k}updated(){if(this.currentWorkspace?.color&&m.includes(this.currentWorkspace.color)){const e=this.currentWorkspace.color;this.style.setProperty("--indicator-color",`var(--typo3-state-${e}-color)`),this.style.setProperty("--indicator-bg",`var(--typo3-state-${e}-bg)`)}else this.style.removeProperty("--indicator-color"),this.style.removeProperty("--indicator-bg")}async loadWorkspaceData(){try{this.currentWorkspace=await p.getCurrentWorkspace(),this.workspaces=await p.getWorkspaces()}catch(e){console.error("Failed to load workspace data",e)}}};d([l()],t.prototype,"currentWorkspace",void 0),d([l()],t.prototype,"workspaces",void 0),t=d([g("typo3-backend-workspace-top-indicator")],t);export{t as WorkspaceTopIndicatorElement};
