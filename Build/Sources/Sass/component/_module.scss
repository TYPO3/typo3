//
// ModuleTemplate
// ======
// General component for backend modules.
//

//
// Variables
//
:root {
    --module-color: var(--typo3-text-color-base);
    --module-bg: var(--typo3-surface-container-lowest);
    --module-docheader-zindex: var(--typo3-zindex-header);
    --module-docheader-padding-y: .75rem;
    --module-docheader-padding-x: 1.5rem;
    --module-docheader-padding: var(--module-docheader-padding-y) var(--module-docheader-padding-x);
    --module-docheader-spacing-y: .5rem;
    --module-docheader-spacing-x: .75rem;
    --module-docheader-spacing: var(--module-docheader-spacing-y) var(--module-docheader-spacing-x);
    --module-docheader-bg: var(--module-bg);
    --module-docheader-border-color: color-mix(in srgb, var(--module-docheader-bg), var(--module-color) 10%);
    --module-docheader-border-width: 1px;
    --module-docheader-bar-height: calc((var(--module-docheader-padding-y) * 2) + 1.78125rem); // 28.5px / 16 - to match input small height
    --module-docheader-scroll-offset: calc(-1 * (var(--module-docheader-bar-height) + var(--module-docheader-padding-y)));
    --module-docheader-height: calc(var(--module-docheader-bar-height) * 2 + var(--module-docheader-border-width));
    --module-docheader-box-shadow: var(--typo3-shadow-2);
    --module-body-padding-y: 1.5rem;
    --module-body-padding-x: 1.5rem;
    --module-body-padding: var(--module-body-padding-y) var(--module-body-padding-x);
}

body:has(.module) *:target {
    scroll-margin-top: var(--module-docheader-height);
}

//
// Template
//
.module {
    display: grid;
    grid-template-areas:
        "moduleDocHeaderNavigation"
        "moduleDocHeaderButtons"
        "moduleBody";
    grid-template-rows: auto auto 1fr;
    position: relative;
    min-height: 100%;
    max-width: 100%;
    width: 100%;
    background-color: var(--module-bg);
    color: var(--module-color);

    body > & {
        min-height: 100dvh;
    }
}

//
// Loading indicator
//
.module-loading-indicator {
    position: fixed;
    min-height: 5px;
    width: 100%;
    z-index: calc(var(--typo3-zindex-header) + 1);
}

//
// Docheader
//
.module-docheader {
    position: relative;
    z-index: var(--typo3-zindex-header);
    display: flex;
    justify-content: space-between;
    flex-wrap: wrap;
    gap: var(--module-docheader-spacing);
    padding: var(--module-docheader-padding);
    min-height: var(--module-docheader-bar-height);
    background-color: var(--module-docheader-bg);

    &-column {
        align-items: center;
        display: flex;
        max-width: 100%;

        &:has(typo3-backend-content-navigation-toggle[hidden]) {
            display: none;
        }
    }

    &-column-grow {
        flex-grow: 1;
    }

    &-container {
        display: flex;
        gap: var(--module-docheader-spacing);
        flex-wrap: wrap;
    }

    .dropdown-menu {
        max-height: calc(100dvh - var(--module-docheader-height));
    }
}

//
// DocHeader Navigation
//
.module-docheader-navigation {
    grid-area: moduleDocHeaderNavigation;
    min-height: calc(var(--module-docheader-bar-height) + var(--module-docheader-border-width));
    border-bottom: var(--module-docheader-border-width) solid var(--module-docheader-border-color);
}

//
// DocHeader Buttons
//
.module-docheader-buttons:has(.module-docheader-column:empty) {
    padding: 0;
}

// Sticky and Animation
.module-docheader-buttons {
    z-index: calc(var(--typo3-zindex-header) - 1);
    grid-area: moduleDocHeaderButtons;
    position: sticky;
    top: 0;
    animation: module-docheader-buttons-shadow linear forwards;
    animation-timeline: scroll(root);
    animation-range: 0 calc(var(--module-docheader-bar-height) + 1px);
}

@keyframes module-docheader-buttons-shadow {
    from {
        box-shadow: 0 0 0 transparent;
    }

    to {
        box-shadow: var(--module-docheader-box-shadow);
    }
}

//
// Body
//
.module-body {
    grid-area: moduleBody;
    position: relative;
    padding: var(--module-body-padding);
    background-color: var(--module-bg);
    contain: inline-size;

    > .container {
        padding-left: 0;
        padding-right: 0;
    }

    .container-small {
        max-width: 768px;
        margin: 0 auto;
    }

    > *:last-child {
        margin-bottom: 0;
    }
}
