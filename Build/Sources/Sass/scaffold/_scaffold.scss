//
// Scaffold
// ========
//

//
// Variables
//
$scaffold-overlay-bg: rgba(0, 0, 0, .65);
$scaffold-overlay-zindex: var(--typo3-zindex-modal-backdrop);
$scaffold-secondary-bg: #151515;
$scaffold-secondary-color: #f5f5f5;
$scaffold-topbar-bg: $scaffold-secondary-bg;
$scaffold-topbar-color: $scaffold-secondary-color;
$scaffold-topbar-height: 45px;
$scaffold-topbar-zindex: $zindex-dropdown;
$scaffold-topbar-toolbar-bg: $scaffold-secondary-bg;
$scaffold-topbar-toolbar-color: $scaffold-secondary-color;
$scaffold-header-zindex: $scaffold-topbar-zindex;
$scaffold-modulemenu-bg: lighten($scaffold-secondary-bg, 8);
$scaffold-modulemenu-color: $scaffold-secondary-color;
$scaffold-modulemenu-expanded-width: 240px;
$scaffold-modulemenu-zindex: $zindex-dropdown;
$scaffold-toolbar-bg: lighten($scaffold-secondary-bg, 8);
$scaffold-toolbar-color: $scaffold-secondary-color;
$scaffold-toolbar-zindex: $zindex-dropdown;
$scaffold-content-navigation-width: 300px;
$scaffold-content-toggle-bg: lighten($scaffold-secondary-bg, 12);
$scaffold-content-toggle-color: $scaffold-secondary-color;

:root {
    --scaffold-bg: var(--typo3-surface-base);
    --scaffold-color: var(--typo3-text-color-base);
    --scaffold-content-navigation-drag-bg: color-mix(in srgb, var(--typo3-surface-container-high), var(--typo3-text-color-base) 10%);
    --scaffold-content-navigation-drag-bg-hover: color-mix(in srgb, var(--typo3-surface-container-high), var(--typo3-text-color-base) 20%);
    --scaffold-content-navigation-switcher-bg: var(--typo3-surface-container-base);
    --scaffold-content-navigation-switcher-border: color-mix(in srgb, var(--typo3-surface-container-base), var(--typo3-text-color-base) 10%);
}

//
// Prevent Browser Rebounce
//
html {
    height: 100%;
    overflow: hidden;
}

body {
    height: 100%;
    background-color: var(--scaffold-bg);

    &.with-overflow {
        // @todo: This is a workaround until all browser support dvh units in combination with overscroll-behavior
        // https://caniuse.com/viewport-unit-variants
        // also see Build/Sources/TypeScript/backend/modal.ts, renderModalBody()
        overflow: auto;
    }
}

iframe {
    background-color: var(--scaffold-bg);
}

//
// Component
//
.scaffold {
    display: flex;
    flex-wrap: wrap;
    background-color: var(--scaffold-bg);
    color: var(--scaffold-color);
    position: relative;
    height: 100vh;
}

.scaffold-header {
    flex: 0 0 100%;
    position: sticky;
    top: 0;
    z-index: $scaffold-header-zindex;
    display: flex;
    flex-flow: row wrap;
    align-items: stretch;
    height: $scaffold-topbar-height;
}

//
// Topbar
//
.scaffold-topbar {
    background-color: $scaffold-topbar-bg;
    color: $scaffold-topbar-color;
    height: $scaffold-topbar-height;
    flex: 1 0 auto;
}

//
// ModuleMenu
//
.scaffold-modulemenu {
    background-color: $scaffold-modulemenu-bg;
    color: $scaffold-modulemenu-color;
    top: $scaffold-topbar-height;
    width: auto;
    height: calc(100vh - #{$scaffold-topbar-height});
    max-width: 100%;
    overflow-x: hidden;
    overflow-y: auto;
    color-scheme: dark;
    position: absolute;
    z-index: $scaffold-overlay-zindex + 1;

    @include media-breakpoint-up('lg') {
        z-index: $scaffold-modulemenu-zindex;
        position: sticky;
    }
}

//
// Toolbar
//
.scaffold-toolbar {
    background-color: $scaffold-toolbar-bg;
    color: $scaffold-toolbar-color;
    z-index: $scaffold-toolbar-zindex;

    .toolbar-item-link {
        color: transparentize($scaffold-toolbar-color, .3);

        &:focus,
        &:hover {
            color: $scaffold-toolbar-color;
        }

        &:after {
            display: none;
        }
    }

    .active > .toolbar-item-link {
        color: $scaffold-toolbar-color;
    }
    display: none;

    @include media-breakpoint-up('lg') {
        overflow: visible;
        background-color: transparent;
        height: $scaffold-topbar-height;
        inset-inline-start: auto;
        bottom: auto;
        display: block;
    }
}

.scaffold-toolbar-expanded {
    .scaffold-toolbar {
        .toolbar {
            background-color: $scaffold-modulemenu-bg;
        }

        @include media-breakpoint-down('lg') {
            min-height: calc(100vh - #{$scaffold-topbar-height});
            padding: 8px;
            flex: 1 0 100%;
            display: block;
        }
    }
}

//
// Content
//
.scaffold-content {
    position: relative !important;
    flex: 1 0 0%;
    height: calc(100vh - #{$scaffold-topbar-height});
    display: flex;
    flex-direction: row;
    background: var(--scaffold-bg);
}

.scaffold-content-module-iframe {
    display: block;
    border: none;
    height: 100%;
    width: 1px;
    min-width: 100%;
}

.scaffold-content-navigation {
    display: none;

    .scaffold-content-navigation-expanded & {
        display: flex;
    }
    flex-direction: column;
    position: sticky !important;
    inset-inline-start: 0;
    top: 0;
    bottom: 0;
    height: 100%;
    width: $scaffold-content-navigation-width;

    &-component {
        flex: 1 0 auto;
    }
}

.scaffold-content-module {
    flex: 1 0 0%;
    display: flex;
    flex-direction: row;
}

//
// Content Overlay
//
.scaffold-content-overlay {
    display: none;
    position: absolute;
    z-index: $scaffold-overlay-zindex;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: $scaffold-overlay-bg;
}

.scaffold-modulemenu-expanded {
    .scaffold-content-overlay {
        display: block;

        @include media-breakpoint-up('lg') {
            display: none;
        }
    }
}

//
// Medium Screen
//
.scaffold {
    .scaffold-modulemenu {
        @include media-breakpoint-down('lg') {
            display: none;
        }
    }
}

.scaffold-modulemenu-expanded {
    .scaffold-modulemenu {
        width: $scaffold-modulemenu-expanded-width;

        @include media-breakpoint-down('lg') {
            display: block;
        }
    }
}

.scaffold-content-navigation-drag {
    color-scheme: light dark;
    display: none;
    flex: 0 0 auto;
    width: 1px;
    height: 100%;
    user-select: none;
    z-index: 3;
    color: var(--scaffold-color);
    background-color: var(--scaffold-content-navigation-drag-bg);
    transition: background-color .2s ease-in-out, border .2s ease-in-out;

    &:hover {
        --scaffold-content-navigation-drag-bg: var(--scaffold-content-navigation-drag-bg-hover);
        background-color: var(--scaffold-content-navigation-drag-bg);

        &:after {
            border-inline-end: 2px solid var(--scaffold-content-navigation-drag-bg);
        }
    }

    &:after {
        content: '';
        position: absolute;
        height: 100%;
        width: 8px;
        margin-inline-start: -5px;
        border-inline-end: 2px solid transparent;
    }

    &.resizing {
        &:before {
            background-color: transparent;
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            user-select: none;
            z-index: 2;
        }
    }

    .scaffold-content-navigation-expanded & {
        display: block;
        cursor: ew-resize;
    }
}

.scaffold-content-navigation-switcher {
    color-scheme: light dark;
    display: none;

    .scaffold-content-navigation-available & {
        width: 38px;
        height: 100%;
        display: flex;
        position: relative;
        flex-direction: column;
        color: var(--scaffold-color);
        border-inline-end: 1px solid var(--scaffold-content-navigation-switcher-border);
        padding: 4px;
        background: var(--scaffold-content-navigation-switcher-bg);
    }

    .scaffold-content-navigation-available.scaffold-content-navigation-expanded & {
        position: static;
        display: block;
        width: 0;
        height: 30px;
        border-inline-end: 0;
        background: transparent;
        transform: translate(calc(-41px * var(--typo3-position-modifier)), var(--module-docheader-padding-y));
        z-index: 3;
        padding: 0;
    }

    .scaffold-content-navigation-switcher-btn {
        display: inline-flex;
    }

    .scaffold-content-navigation-switcher-open {
        display: inline-flex;

        .scaffold-content-navigation-expanded & {
            display: none;
        }
    }

    .scaffold-content-navigation-switcher-close {
        display: none;

        .scaffold-content-navigation-expanded & {
            display: inline-flex;
        }
    }
}

typo3-backend-navigation-switcher {
    display: flex;
}
